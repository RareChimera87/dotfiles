LavaPack.loadBundle([[3191,{"../logger.cjs":3195},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,i,s=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},o=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.Bundler=void 0;const c=e("../logger.cjs"),l=(0,c.createModuleLogger)(c.projectLogger,"bundler");n.Bundler=class{constructor(e){r.add(this),a.set(this,void 0),s(this,a,e,"f")}async estimateUserOperationGas(e,t){l("Estimating gas",{url:o(this,a,"f"),userOperation:e,entrypoint:t});const n=await o(this,r,"m",i).call(this,"eth_estimateUserOperationGas",[e,t]);return l("Estimated gas",{response:n}),n}async getUserOperationReceipt(e){return l("Getting user operation receipt",{url:o(this,a,"f"),hash:e}),await o(this,r,"m",i).call(this,"eth_getUserOperationReceipt",[e])}async sendUserOperation(e,t){l("Sending user operation",{url:o(this,a,"f"),userOperation:e,entrypoint:t});const n=await o(this,r,"m",i).call(this,"eth_sendUserOperation",[e,t]);return l("Sent user operation",n),n}},a=new WeakMap,r=new WeakSet,i=async function(e,t){const n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:e,params:t})},r=await fetch(o(this,a,"f"),n),i=await r.json();if(i.error){const e=new Error(i.error.message||i.error);throw e.code=i.error.code,e}return i.result}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/helpers/Bundler.cjs"}],[3192,{"../logger.cjs":3195,"../types.cjs":3196,"./Bundler.cjs":3191,"@metamask/controller-utils":1494,"@metamask/eth-query":2079,"@metamask/polling-controller":3205,"@metamask/utils":3217,events:4433},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,i,s,o,c,l,u,d,p,m,h=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},f=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},g=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.PendingUserOperationTracker=void 0;const y=e("@metamask/controller-utils"),v=g(e("@metamask/eth-query")),b=e("@metamask/polling-controller"),T=e("@metamask/utils"),w=g(e("events")),k=e("../logger.cjs"),_=e("../types.cjs"),P=e("./Bundler.cjs"),E=(0,T.createModuleLogger)(k.projectLogger,"pending-user-operations");class S extends((0,b.BlockTrackerPollingControllerOnly)()){constructor({getUserOperations:e,messenger:t}){super(),r.add(this),a.set(this,void 0),i.set(this,void 0),this.hub=new w.default,h(this,a,e,"f"),h(this,i,t,"f")}async _executePoll({networkClientId:e}){try{const{blockTracker:t,configuration:n,provider:a}=this._getNetworkClientById(e);E("Polling",{blockNumber:t.getCurrentBlock(),chainId:n.chainId}),await f(this,r,"m",s).call(this,n.chainId,a)}catch(e){E("Failed to check user operations",e)}}_getNetworkClientById(e){return f(this,i,"f").call("NetworkController:getNetworkClientById",e)}}n.PendingUserOperationTracker=S,a=new WeakMap,i=new WeakMap,r=new WeakSet,s=async function(e,t){const n=f(this,r,"m",u).call(this).filter(t=>t.chainId===e);n.length?(E("Found pending user operations to check",{count:n.length,ids:n.map(e=>e.id)}),await Promise.all(n.map(e=>f(this,r,"m",o).call(this,e,t)))):E("No pending user operations to check")},o=async function(e,t){const{bundlerUrl:n,hash:a,id:i}=e;if(a&&n)try{const s=await f(this,r,"m",p).call(this,a,n),o=s?.success;if(s&&!o)return void f(this,r,"m",l).call(this,e,s);if(o)return void await f(this,r,"m",c).call(this,e,s,t);E("No receipt found for user operation",{id:i,hash:a})}catch(e){E("Failed to check user operation",i,e)}else E("Skipping user operation as missing hash or bundler",i)},c=async function(e,t,n){const{id:a}=e,{actualGasCost:i,actualGasUsed:s,receipt:{blockHash:o,transactionHash:c}}=t;E("User operation confirmed",a,c);const{baseFeePerGas:l}=await(0,y.query)(new v.default(n),"getBlockByHash",[o,!1]);e.actualGasCost=f(this,r,"m",m).call(this,i),e.actualGasUsed=f(this,r,"m",m).call(this,s),e.baseFeePerGas=l,e.status=_.UserOperationStatus.Confirmed,e.transactionHash=c,f(this,r,"m",d).call(this,e),this.hub.emit("user-operation-confirmed",e)},l=function(e,t){const{id:n}=e;E("User operation failed",n),e.status=_.UserOperationStatus.Failed,f(this,r,"m",d).call(this,e),this.hub.emit("user-operation-failed",e,new Error("User operation receipt has failed status"))},u=function(){return f(this,a,"f").call(this).filter(e=>e.status===_.UserOperationStatus.Submitted)},d=function(e){this.hub.emit("user-operation-updated",e)},p=async function(e,t){return new P.Bundler(t).getUserOperationReceipt(e)},m=function(e){return"number"==typeof e?(0,y.toHex)(e):e}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/helpers/PendingUserOperationTracker.cjs"}],[3193,{"../constants.cjs":3190,"../utils/chain-id.cjs":3197},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},i=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.SnapSmartContractAccount=void 0;const s=e("../constants.cjs"),o=e("../utils/chain-id.cjs");n.SnapSmartContractAccount=class{constructor(e){r.set(this,void 0),a(this,r,e,"f")}async prepareUserOperation(e){const{chainId:t,data:n,from:a,to:c,value:l}=e,u=n??s.EMPTY_BYTES,d=c??s.ADDRESS_ZERO,p=l??s.VALUE_ZERO,m=await i(this,r,"f").call("KeyringController:prepareUserOperation",a,[{data:u,to:d,value:p}],{chainId:(0,o.toEip155ChainId)(t)}),{bundlerUrl:h,callData:f,dummyPaymasterAndData:g,dummySignature:y,gasLimits:v,initCode:b,nonce:T}=m;return{bundler:h,callData:f,dummyPaymasterAndData:g,dummySignature:y,gas:v,initCode:b,nonce:T,sender:a}}async updateUserOperation(e){const{userOperation:t,chainId:n}=e,{sender:a}=t,{paymasterAndData:c,verificationGasLimit:l,preVerificationGas:u,callGasLimit:d}=await i(this,r,"f").call("KeyringController:patchUserOperation",a,t,{chainId:(0,o.toEip155ChainId)(n)});return{paymasterAndData:c===s.EMPTY_BYTES?undefined:c,verificationGasLimit:l,preVerificationGas:u,callGasLimit:d}}async signUserOperation(e){const{userOperation:t,chainId:n}=e,{sender:a}=t;return{signature:await i(this,r,"f").call("KeyringController:signUserOperation",a,t,{chainId:(0,o.toEip155ChainId)(n)})}}},r=new WeakMap}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/helpers/SnapSmartContractAccount.cjs"}],[3194,{"./UserOperationController.cjs":3189,"./types.cjs":3196},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),a(e("./UserOperationController.cjs"),n),a(e("./types.cjs"),n)}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/index.cjs"}],[3195,{"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.projectLogger=void 0;const r=e("@metamask/utils");Object.defineProperty(n,"createModuleLogger",{enumerable:!0,get:function(){return r.createModuleLogger}}),n.projectLogger=(0,r.createProjectLogger)("user-operation-controller")}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/logger.cjs"}],[3196,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r;Object.defineProperty(n,"__esModule",{value:!0}),n.UserOperationStatus=void 0,function(e){e.Unapproved="unapproved",e.Approved="approved",e.Signed="signed",e.Submitted="submitted",e.Failed="failed",e.Confirmed="confirmed"}(r||(n.UserOperationStatus=r={}))}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/types.cjs"}],[3197,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.toEip155ChainId=void 0,n.toEip155ChainId=function(e){const t=Number(e);return Number.isInteger(t)?t.toString():e}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/utils/chain-id.cjs"}],[3198,{"../constants.cjs":3190,"../logger.cjs":3195,"@metamask/controller-utils":1494,"@metamask/eth-query":2079,"@metamask/gas-fee-controller":2192,"@metamask/transaction-controller":3095,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.updateGasFees=void 0;const a=e("@metamask/controller-utils"),i=r(e("@metamask/eth-query")),s=e("@metamask/gas-fee-controller"),o=e("@metamask/transaction-controller"),c=e("@metamask/utils"),l=e("../constants.cjs"),u=e("../logger.cjs"),d=(0,u.createModuleLogger)(u.projectLogger,"gas-fees");function p(e){return(0,a.toHex)((0,a.gweiDecToWEIBN)(e))}function m(e){return!e||e===l.EMPTY_BYTES}n.updateGasFees=async function(e){const{metadata:t,originalRequest:n,transaction:r}=e,{userOperation:l}=t;let u;const h=async()=>(u||(u=await async function(e){const{getGasFeeEstimates:t,provider:n}=e;try{const{gasFeeEstimates:e,gasEstimateType:n}=await t();if(n===s.GAS_ESTIMATE_TYPES.FEE_MARKET){const{medium:{suggestedMaxPriorityFeePerGas:t,suggestedMaxFeePerGas:n}={}}=e;if(t&&n){const e={maxFeePerGas:p(n),maxPriorityFeePerGas:p(t)};return d("Using medium values from fee market estimate",e),e}}if(n===s.GAS_ESTIMATE_TYPES.LEGACY){const t=p(e.medium);return d("Using medium value from legacy estimate",t),{maxFeePerGas:t}}if(n===s.GAS_ESTIMATE_TYPES.ETH_GASPRICE){const t=p(e.gasPrice);return d("Using gasPrice from estimate",t),{maxFeePerGas:t}}}catch(e){d("Failed to get estimate",e)}const r=await(0,a.query)(new i.default(n),"gasPrice");if(!r)return{};const o=(0,c.add0x)(r.toString(16));return d("Using gasPrice from network as fallback",o),{maxFeePerGas:o}}(e)),u);l.maxFeePerGas=await async function(e,t,n){const{maxFeePerGas:r,maxPriorityFeePerGas:a}=e,{gasPrice:i}=n??{};if(!m(r))return d("Using maxFeePerGas from request",r),r;if(m(a)&&i)return d("Setting maxFeePerGas to transaction gasPrice",i),i;const{maxFeePerGas:s}=await t();if(!s)throw new Error("Failed to get gas fee estimate for maxFeePerGas");return d("Using maxFeePerGas from estimate",s),s}(n,h,r),l.maxPriorityFeePerGas=await async function(e,t,n,r){const{maxFeePerGas:a,maxPriorityFeePerGas:i}=e,{gasPrice:s}=r??{},{maxFeePerGas:o}=n;if(!m(i))return d("Using maxPriorityFeePerGas from request",i),i;if(m(a)&&s)return d("Setting maxPriorityFeePerGas to transaction gasPrice",s),s;const{maxPriorityFeePerGas:c}=await t();if(c)return d("Using maxPriorityFeePerGas from estimate",c),c;return d("Setting maxPriorityFeePerGas to maxFeePerGas",o),o}(n,h,l,r),t.userFeeLevel=function(e,t,n,r){const{origin:i}=e,{maxFeePerGas:s,maxPriorityFeePerGas:c}=t,{maxFeePerGas:l,maxPriorityFeePerGas:u}=n||{};if(m(s)&&m(c)&&r?.gasPrice)return i===a.ORIGIN_METAMASK?o.UserFeeLevel.CUSTOM:o.UserFeeLevel.DAPP_SUGGESTED;if(m(s)&&m(c)&&l&&u)return o.UserFeeLevel.MEDIUM;if(i===a.ORIGIN_METAMASK)return o.UserFeeLevel.CUSTOM;return o.UserFeeLevel.DAPP_SUGGESTED}(t,n,u,r)}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/utils/gas-fees.cjs"}],[3199,{"../constants.cjs":3190,"../helpers/Bundler.cjs":3191,"../logger.cjs":3195,"@metamask/controller-utils":1494,"@metamask/utils":3217,"bn.js":4076},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.updateGas=void 0;const a=e("@metamask/controller-utils"),i=e("@metamask/utils"),s=r(e("bn.js")),o=e("../constants.cjs"),c=e("../helpers/Bundler.cjs"),l=e("../logger.cjs"),u=(0,l.createModuleLogger)(l.projectLogger,"gas");function d(e){const t=("string"==typeof e?(0,a.hexToBN)(e):new s.default(e)).muln(1.5);return(0,i.add0x)(t.toString(16))}n.updateGas=async function(e,t,n){const{userOperation:r}=e;if(t.gas)return r.callGasLimit=t.gas.callGasLimit,r.preVerificationGas=t.gas.preVerificationGas,r.verificationGasLimit=t.gas.verificationGasLimit,void u("Using gas values from smart contract account",{callGasLimit:r.callGasLimit,preVerificationGas:r.preVerificationGas,verificationGasLimit:r.verificationGasLimit});const a={...r,maxFeePerGas:o.VALUE_ZERO,maxPriorityFeePerGas:o.VALUE_ZERO,callGasLimit:o.VALUE_ZERO,preVerificationGas:o.VALUE_ZERO,verificationGasLimit:"0xF4240"},i=new c.Bundler(e.bundlerUrl),s=await i.estimateUserOperationGas(a,n);r.callGasLimit=d(s.callGasLimit),r.preVerificationGas=d(s.preVerificationGas),r.verificationGasLimit=d(s.verificationGasLimit??s.verificationGas),u("Using buffered gas values from bundler estimate",{callGasLimit:r.callGasLimit,preVerificationGas:r.preVerificationGas,verificationGasLimit:r.verificationGasLimit,multiplier:1.5,estimate:s})}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/utils/gas.cjs"}],[32,{"../../../shared/constants/bridge":5839,"../../../shared/lib/trace":5960,"@metamask/bridge-status-controller":1452,"@metamask/controller-utils":1494},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.BridgeStatusControllerInit=void 0;var r=e("@metamask/bridge-status-controller"),a=e("@metamask/controller-utils"),i=e("../../../shared/lib/trace"),s=e("../../../shared/constants/bridge");n.BridgeStatusControllerInit=({controllerMessenger:e,persistedState:t,getController:n})=>{const o=n("TransactionController");return{controller:new r.BridgeStatusController({messenger:e,state:t.BridgeStatusController,fetchFn:async(e,t)=>await(0,a.handleFetch)(e,{method:"GET",...t}),addTransactionFn:(...e)=>o.addTransaction(...e),addTransactionBatchFn:(...e)=>o.addTransactionBatch(...e),estimateGasFeeFn:(...e)=>o.estimateGasFee(...e),updateTransactionFn:(...e)=>o.updateTransaction(...e),config:{customBridgeApiBaseUrl:s.BRIDGE_API_BASE_URL},traceFn:(...e)=>(0,i.trace)(...e)})}}}}},{package:"$root$",file:"app/scripts/controller-init/bridge-status-controller-init.ts"}],[320,{"../../../../../shared/constants/app":5837,"../../../../../shared/constants/metametrics":5853,"../../util":374,"@metamask/rpc-errors":2698},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("@metamask/rpc-errors"),a=e("../../../../../shared/constants/app"),i=e("../../../../../shared/constants/metametrics"),s=e("../../util");const o={methodNames:[a.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS],implementation:async function(e,t,n,o,{getAccounts:l,sendMetrics:u,metamaskState:d,getCaip25PermissionFromLegacyPermissionsForOrigin:p,requestPermissionsForOrigin:m}){const{origin:h}=e??{};if(c.has(h))return t.error=r.rpcErrors.resourceUnavailable(`Already processing ${a.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS}. Please wait.`),o();let f=l(h);if(f.length>0){try{c.add(h),t.result=f,o()}catch(e){o(e)}finally{c.delete(h)}return undefined}try{const e=p();await m(e)}catch(e){return o(e)}if(f=l(h),(0,s.shouldEmitDappViewedEvent)(d.metaMetricsId)){const e=!Object.keys(d.permissionHistory).includes(h);u({event:i.MetaMetricsEventName.DappViewed,category:i.MetaMetricsEventCategory.InpageProvider,referrer:{url:h},properties:{is_first_visit:e,number_of_accounts:Object.keys(d.identities).length,number_of_accounts_connected:f.length}},{excludeMetaMetricsId:!0})}return t.result=f,o()},hookNames:{getAccounts:!0,sendMetrics:!0,metamaskState:!0,getCaip25PermissionFromLegacyPermissionsForOrigin:!0,requestPermissionsForOrigin:!0}};n.default=o;const c=new Set}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/request-accounts.ts"}],[3200,{"../constants.cjs":3190,"../types.cjs":3196,"@metamask/transaction-controller":3095,"@metamask/utils":3217,"bn.js":4076},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getTransactionMetadata=void 0;const a=e("@metamask/transaction-controller"),i=e("@metamask/utils"),s=r(e("bn.js")),o=e("../constants.cjs"),c=e("../types.cjs");n.getTransactionMetadata=function(e){const{actualGasCost:t,actualGasUsed:n,baseFeePerGas:r,chainId:l,error:u,origin:d,transactionHash:p,id:m,swapsMetadata:h,time:f,transactionParams:g,transactionType:y,userFeeLevel:v,userOperation:b}=e;if(!g)return undefined;const T=t&&n?(0,i.add0x)(new s.default((0,i.remove0x)(t),16).div(new s.default((0,i.remove0x)(n),16)).toString(16)):undefined,w=u?{name:u.name,message:u.message,stack:u.stack,code:u.code,rpc:u.rpc}:undefined,k={[c.UserOperationStatus.Unapproved]:a.TransactionStatus.unapproved,[c.UserOperationStatus.Approved]:a.TransactionStatus.approved,[c.UserOperationStatus.Signed]:a.TransactionStatus.signed,[c.UserOperationStatus.Submitted]:a.TransactionStatus.submitted,[c.UserOperationStatus.Confirmed]:a.TransactionStatus.confirmed,[c.UserOperationStatus.Failed]:a.TransactionStatus.failed}[e.status],_=function(...e){const t=new s.default(0);for(const n of e)n&&t.iadd(new s.default((0,i.remove0x)(n),16));return(0,i.add0x)(t.toString(16))}(b.preVerificationGas,b.verificationGasLimit,b.callGasLimit),P=b.paymasterAndData!==o.EMPTY_BYTES,E=P?o.VALUE_ZERO:b.maxFeePerGas,S=P?o.VALUE_ZERO:b.maxPriorityFeePerGas,A=b.nonce===o.EMPTY_BYTES?undefined:b.nonce,C={...g,from:b.sender,gas:_,nonce:A,maxFeePerGas:E,maxPriorityFeePerGas:S};delete C.gasPrice;const M={approvalTxId:h?.approvalTxId??undefined,destinationTokenAddress:h?.destinationTokenAddress??undefined,destinationTokenAmount:h?.destinationTokenAmount??undefined,destinationTokenDecimals:h?.destinationTokenDecimals??undefined,destinationTokenSymbol:h?.destinationTokenSymbol??undefined,estimatedBaseFee:h?.estimatedBaseFee??undefined,sourceTokenAddress:h?.sourceTokenAddress??undefined,sourceTokenAmount:h?.sourceTokenAmount??undefined,sourceTokenDecimals:h?.sourceTokenDecimals??undefined,sourceTokenSymbol:h?.sourceTokenSymbol??undefined,swapAndSendRecipient:h?.swapAndSendRecipient??undefined,swapMetaData:h?.swapMetaData??undefined,swapTokenValue:h?.swapTokenValue??undefined},O=P?a.UserFeeLevel.CUSTOM:v;return{baseFeePerGas:r??undefined,chainId:l,error:w,hash:p??undefined,id:m,isUserOperation:!0,networkClientId:"user-operation",origin:d,status:k,time:f,txParams:C,txReceipt:{effectiveGasPrice:T??undefined,gasUsed:n??undefined},type:y??undefined,userFeeLevel:O,...M}}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/utils/transaction.cjs"}],[3201,{"../constants.cjs":3190,"@metamask/superstruct":3037,"@metamask/transaction-controller":3095,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateSignUserOperationResponse=n.validateUpdateUserOperationResponse=n.validatePrepareUserOperationResponse=n.validateAddUserOperationOptions=n.validateAddUserOperationRequest=void 0;const r=e("@metamask/superstruct"),a=e("@metamask/transaction-controller"),i=e("@metamask/utils"),s=e("../constants.cjs");function o(e,t,n){try{(0,r.assert)(e,t,n)}catch(e){const t=e.failures().map(e=>e.path.length?`${e.path.join(".")} - ${e.message}`:e.message).join("\n");throw new Error(`${n}\n${t}`)}}function c(){return(0,r.define)("Hexadecimal String",e=>(0,i.isStrictHexString)(e))}function l(){return(0,r.define)("Hexadecimal String or 0x",e=>(0,i.isStrictHexString)(e)||e===s.EMPTY_BYTES)}n.validateAddUserOperationRequest=function(e){const t=c(),n=l();o(e,(0,r.object)({data:(0,r.optional)(n),from:t,maxFeePerGas:(0,r.optional)(t),maxPriorityFeePerGas:(0,r.optional)(t),to:(0,r.optional)(t),value:(0,r.optional)(t)}),"Invalid request to add user operation")},n.validateAddUserOperationOptions=function(e){o(e,(0,r.object)({networkClientId:(0,r.string)(),origin:(0,r.string)(),requireApproval:(0,r.optional)((0,r.boolean)()),smartContractAccount:(0,r.optional)((0,r.object)({prepareUserOperation:(0,r.func)(),updateUserOperation:(0,r.func)(),signUserOperation:(0,r.func)()})),swaps:(0,r.optional)((0,r.object)({approvalTxId:(0,r.optional)((0,r.string)()),destinationTokenAddress:(0,r.optional)((0,r.string)()),destinationTokenDecimals:(0,r.optional)((0,r.number)()),destinationTokenSymbol:(0,r.optional)((0,r.string)()),estimatedBaseFee:(0,r.optional)((0,r.string)()),sourceTokenSymbol:(0,r.optional)((0,r.string)()),swapMetaData:(0,r.optional)((0,r.object)()),swapTokenValue:(0,r.optional)((0,r.string)()),destinationTokenAmount:(0,r.optional)((0,r.string)()),sourceTokenAddress:(0,r.optional)((0,r.string)()),sourceTokenAmount:(0,r.optional)((0,r.string)()),sourceTokenDecimals:(0,r.optional)((0,r.number)()),swapAndSendRecipient:(0,r.optional)((0,r.string)())})),type:(0,r.optional)((0,r.enums)(Object.values(a.TransactionType)))}),"Invalid options to add user operation")},n.validatePrepareUserOperationResponse=function(e){const t=c(),n=l();o(e,(0,r.refine)((0,r.object)({bundler:(0,r.string)(),callData:t,dummyPaymasterAndData:(0,r.optional)(n),dummySignature:(0,r.optional)(n),gas:(0,r.optional)((0,r.object)({callGasLimit:t,preVerificationGas:t,verificationGasLimit:t})),initCode:(0,r.optional)(n),nonce:t,sender:t}),"ValidPrepareUserOperationResponse",({gas:e,dummySignature:t})=>!!(e||t&&t!==s.EMPTY_BYTES)||"Must specify dummySignature if not specifying gas"),"Invalid response when preparing user operation")},n.validateUpdateUserOperationResponse=function(e){o(e,(0,r.optional)((0,r.object)({paymasterAndData:(0,r.optional)(l()),callGasLimit:(0,r.optional)(l()),preVerificationGas:(0,r.optional)(l()),verificationGasLimit:(0,r.optional)(l())})),"Invalid response when updating user operation")},n.validateSignUserOperationResponse=function(e){const t=c();o(e,(0,r.object)({signature:t}),"Invalid response when signing user operation")}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/utils/validation.cjs"}],[3202,{"fast-json-stable-stringify":4452,uuid:5796},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.AbstractPollingControllerBaseMixin=n.getKey=void 0;const i=a(e("fast-json-stable-stringify")),s=e("uuid");n.getKey=e=>(0,i.default)(e),n.AbstractPollingControllerBaseMixin=function(e){var t,a;return t=new WeakMap,a=new WeakMap,class extends e{constructor(){super(...arguments),t.set(this,new Map),a.set(this,new Map)}startPolling(e){const a=(0,s.v4)(),i=(0,n.getKey)(e),o=r(this,t,"f").get(i)??new Set;return o.add(a),r(this,t,"f").set(i,o),1===o.size&&this._startPolling(e),a}stopAllPolling(){r(this,t,"f").forEach((e,t)=>{e.forEach(e=>{this.stopPollingByPollingToken(e)})})}stopPollingByPollingToken(e){if(!e)throw new Error("pollingToken required");let n=null;for(const[a,i]of r(this,t,"f"))if(i.delete(e)){0===i.size&&(n=a);break}if(n){this._stopPollingByPollingTokenSetId(n),r(this,t,"f").delete(n);const e=r(this,a,"f").get(n);if(e){for(const t of e)t(JSON.parse(n));e.clear()}}}onPollingComplete(e,t){const i=(0,n.getKey)(e),s=r(this,a,"f").get(i)??new Set;s.add(t),r(this,a,"f").set(i,s)}}}}}},{package:"@metamask/user-operation-controller>@metamask/polling-controller",file:"node_modules/@metamask/user-operation-controller/node_modules/@metamask/polling-controller/dist/AbstractPollingController.cjs"}],[3203,{"./AbstractPollingController.cjs":3202,"@metamask/base-controller":1407},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.BlockTrackerPollingController=n.BlockTrackerPollingControllerOnly=void 0;const a=e("@metamask/base-controller"),i=e("./AbstractPollingController.cjs");function s(e){var t;class n extends((0,i.AbstractPollingControllerBaseMixin)(e)){constructor(){super(...arguments),t.set(this,{})}_startPolling(e){const n=(0,i.getKey)(e);if(r(this,t,"f")[n])return;const a=this._getNetworkClientById(e.networkClientId);if(!a)throw new Error(`Unable to retrieve blockTracker for networkClientId ${e.networkClientId}`);{const i=this._executePoll.bind(this,e);a.blockTracker.addListener("latest",i),r(this,t,"f")[n]=i}}_stopPollingByPollingTokenSetId(e){const{networkClientId:n}=JSON.parse(e),a=this._getNetworkClientById(n);if(a&&r(this,t,"f")[e]){const n=r(this,t,"f")[e];n&&(a.blockTracker.removeListener("latest",n),delete r(this,t,"f")[e])}}}return t=new WeakMap,n}class o{}n.BlockTrackerPollingControllerOnly=()=>s(o);n.BlockTrackerPollingController=()=>s(a.BaseController)}}},{package:"@metamask/user-operation-controller>@metamask/polling-controller",file:"node_modules/@metamask/user-operation-controller/node_modules/@metamask/polling-controller/dist/BlockTrackerPollingController.cjs"}],[3204,{"./AbstractPollingController.cjs":3202,"@metamask/base-controller":1407},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},a=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.StaticIntervalPollingController=n.StaticIntervalPollingControllerOnly=void 0;const i=e("@metamask/base-controller"),s=e("./AbstractPollingController.cjs");function o(e){var t,n;class i extends((0,s.AbstractPollingControllerBaseMixin)(e)){constructor(){super(...arguments),t.set(this,{}),n.set(this,1e3)}setIntervalLength(e){r(this,n,e,"f")}getIntervalLength(){return a(this,n,"f")}_startPolling(e){if(!a(this,n,"f"))throw new Error("intervalLength must be defined and greater than 0");const r=(0,s.getKey)(e),i=a(this,t,"f")[r];this._stopPollingByPollingTokenSetId(r);const o=a(this,t,"f")[r]=setTimeout(async()=>{try{await this._executePoll(e)}catch(e){console.error(e)}o===a(this,t,"f")[r]&&this._startPolling(e)},i?a(this,n,"f"):0)}_stopPollingByPollingTokenSetId(e){const n=a(this,t,"f")[e];n&&(clearTimeout(n),delete a(this,t,"f")[e])}}return t=new WeakMap,n=new WeakMap,i}class c{}n.StaticIntervalPollingControllerOnly=()=>o(c);n.StaticIntervalPollingController=()=>o(i.BaseController)}}},{package:"@metamask/user-operation-controller>@metamask/polling-controller",file:"node_modules/@metamask/user-operation-controller/node_modules/@metamask/polling-controller/dist/StaticIntervalPollingController.cjs"}],[3205,{"./BlockTrackerPollingController.cjs":3203,"./StaticIntervalPollingController.cjs":3204},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.StaticIntervalPollingController=n.StaticIntervalPollingControllerOnly=n.BlockTrackerPollingController=n.BlockTrackerPollingControllerOnly=void 0;var r=e("./BlockTrackerPollingController.cjs");Object.defineProperty(n,"BlockTrackerPollingControllerOnly",{enumerable:!0,get:function(){return r.BlockTrackerPollingControllerOnly}}),Object.defineProperty(n,"BlockTrackerPollingController",{enumerable:!0,get:function(){return r.BlockTrackerPollingController}});var a=e("./StaticIntervalPollingController.cjs");Object.defineProperty(n,"StaticIntervalPollingControllerOnly",{enumerable:!0,get:function(){return a.StaticIntervalPollingControllerOnly}}),Object.defineProperty(n,"StaticIntervalPollingController",{enumerable:!0,get:function(){return a.StaticIntervalPollingController}})}}},{package:"@metamask/user-operation-controller>@metamask/polling-controller",file:"node_modules/@metamask/user-operation-controller/node_modules/@metamask/polling-controller/dist/index.cjs"}],[321,{"../../../../../shared/constants/app":5837,"@metamask/rpc-errors":2698,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("@metamask/rpc-errors"),a=e("@metamask/utils");const i={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.SEND_METADATA],implementation:function(e,t,n,i,{addSubjectMetadata:s,subjectType:o}){const{origin:c,params:l}=e;if(!(0,a.isObject)(l))return i(r.rpcErrors.invalidParams({data:l}));{const{icon:e=null,name:t=null,...n}=l;s({...n,iconUrl:e,name:t,subjectType:o,origin:c})}return t.result=!0,i()},hookNames:{addSubjectMetadata:!0,subjectType:!0}};n.default=i}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/send-metadata.ts"}],[322,{"../../../../../shared/constants/app":5837,"./ethereum-chain-utils":316,"@metamask/rpc-errors":2698,"@metamask/snaps-utils":3004},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("@metamask/rpc-errors"),a=e("@metamask/snaps-utils"),i=e("../../../../../shared/constants/app"),s=e("./ethereum-chain-utils");const o={methodNames:[i.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN],implementation:async function(e,t,n,o,{getNetworkConfigurationByChainId:c,setActiveNetwork:l,requestUserApproval:u,getCaveat:d,getCurrentChainIdForDomain:p,requestPermittedChainsPermissionIncrementalForOrigin:m,rejectApprovalRequestsForOrigin:h,setTokenNetworkFilter:f,setEnabledNetworks:g,getEnabledNetworks:y,hasApprovalRequestsForOrigin:v}){let b;try{b=(0,s.validateSwitchEthereumChainParams)(e)}catch(e){return o(e)}const{origin:T}=e,w=p(T);if(w===b)return t.result=null,o();const k=c(b),_=null==k?void 0:k.rpcEndpoints[k.defaultRpcEndpointIndex].networkClientId;if(!_)return o(r.providerErrors.custom({code:4902,message:`Unrecognized chain ID "${b}". Try adding the chain using ${i.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN} first.`}));const P=c(w),E=c(b);return(0,s.switchChain)(t,o,b,_,{origin:T,isSwitchFlow:!0,autoApprove:(0,a.isSnapId)(T),setActiveNetwork:l,getCaveat:d,requestPermittedChainsPermissionIncrementalForOrigin:m,rejectApprovalRequestsForOrigin:h,setTokenNetworkFilter:f,setEnabledNetworks:g,getEnabledNetworks:y,requestUserApproval:u,hasApprovalRequestsForOrigin:v,toNetworkConfiguration:E,fromNetworkConfiguration:P})},hookNames:{getNetworkConfigurationByChainId:!0,setActiveNetwork:!0,requestUserApproval:!0,getCaveat:!0,getCurrentChainIdForDomain:!0,requestPermittedChainsPermissionIncrementalForOrigin:!0,rejectApprovalRequestsForOrigin:!0,setTokenNetworkFilter:!0,setEnabledNetworks:!0,getEnabledNetworks:!0,hasApprovalRequestsForOrigin:!0}};n.default=o}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/switch-ethereum-chain.js"}],[323,{"../../../../../shared/constants/permissions":5861,"../../../controllers/permissions":239,"@metamask/chain-agnostic-permission":1465,"@metamask/permission-controller":2534},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getPermissionsHandler=void 0;var r=e("@metamask/permission-controller"),a=e("@metamask/chain-agnostic-permission"),i=e("../../../controllers/permissions"),s=e("../../../../../shared/constants/permissions");n.getPermissionsHandler={methodNames:[r.MethodNames.GetPermissions],implementation:async function(e,t,n,r,{getPermissionsForOrigin:o,getAccounts:c}){var l;const u={...o()},d=u[a.Caip25EndowmentPermissionName],p=null==d||null===(l=d.caveats)||void 0===l||null===(l=l.find(({type:e})=>e===a.Caip25CaveatType))||void 0===l?void 0:l.value;if(delete u[a.Caip25EndowmentPermissionName],p){const e=c();e.length>0&&(u[s.RestrictedMethods.eth_accounts]={...d,parentCapability:s.RestrictedMethods.eth_accounts,caveats:[{type:s.CaveatTypes.restrictReturnedAccounts,value:e}]});const t=(0,a.getPermittedEthChainIds)(p);t.length>0&&(u[i.PermissionNames.permittedChains]={...d,parentCapability:i.PermissionNames.permittedChains,caveats:[{type:s.CaveatTypes.restrictNetworkSwitching,value:t}]})}return t.result=Object.values(u),r()},hookNames:{getPermissionsForOrigin:!0,getAccounts:!0}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/wallet-getPermissions.ts"}],[3230,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var r=0;r<e.length;r++){var a=e.charAt(r),i=a.charCodeAt(0);if(255!==t[i])throw new TypeError(a+" is ambiguous");t[i]=r}var s=e.length,o=e.charAt(0),c=Math.log(s)/Math.log(256),l=Math.log(256)/Math.log(s);function u(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var n=0;if(" "!==e[n]){for(var r=0,a=0;e[n]===o;)r++,n++;for(var i=(e.length-n)*c+1>>>0,l=new Uint8Array(i);e[n];){var u=t[e.charCodeAt(n)];if(255===u)return;for(var d=0,p=i-1;(0!==u||d<a)&&-1!==p;p--,d++)u+=s*l[p]>>>0,l[p]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");a=d,n++}if(" "!==e[n]){for(var m=i-a;m!==i&&0===l[m];)m++;for(var h=new Uint8Array(r+(i-m)),f=r;m!==i;)h[f++]=l[m++];return h}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,a=0,i=t.length;a!==i&&0===t[a];)a++,n++;for(var c=(i-a)*l+1>>>0,u=new Uint8Array(c);a!==i;){for(var d=t[a],p=0,m=c-1;(0!==d||p<r)&&-1!==m;m--,p++)d+=256*u[m]>>>0,u[m]=d%s>>>0,d=d/s>>>0;if(0!==d)throw new Error("Non-zero carry");r=p,a++}for(var h=c-r;h!==c&&0===u[h];)h++;for(var f=o.repeat(n);h<c;++h)f+=e.charAt(u[h]);return f},decodeUnsafe:u,decode:function(e){var t=u(e);if(t)return t;throw new Error("Non-base"+s+" character")}}}}}},{package:"@ensdomains/content-hash>cids>multibase>@multiformats/base-x",file:"node_modules/@multiformats/base-x/src/index.js"}],[324,{"../../../../../shared/constants/permissions":5861,"../../../controllers/permissions":239,"@metamask/chain-agnostic-permission":1465,"@metamask/controller-utils":1494,"@metamask/permission-controller":2534,lodash:4901},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.requestPermissionsHandler=void 0;var r=e("lodash"),a=e("@metamask/controller-utils"),i=e("@metamask/permission-controller"),s=e("@metamask/chain-agnostic-permission"),o=e("../../../../../shared/constants/permissions"),c=e("../../../controllers/permissions");n.requestPermissionsHandler={methodNames:[i.MethodNames.RequestPermissions],implementation:async function(e,t,n,l,{getAccounts:u,requestPermissionsForOrigin:d,getCaip25PermissionFromLegacyPermissionsForOrigin:p}){const{params:m}=e;if(!Array.isArray(m)||!(0,a.isPlainObject)(m[0]))return l((0,i.invalidParams)({data:{request:e}}));let[h]=m;delete h[s.Caip25EndowmentPermissionName];const f=(0,r.pick)(h,[o.RestrictedMethods.eth_accounts,c.PermissionNames.permittedChains]);delete h[o.RestrictedMethods.eth_accounts],delete h[c.PermissionNames.permittedChains];const g=Object.keys(f).length>0;if(g){const e=p(f);h={...h,...e}}let y={};const[v]=await d(h);if(y={...v},g){var b;const e=y[s.Caip25EndowmentPermissionName];if(!e)throw new Error(`could not find ${s.Caip25EndowmentPermissionName} permission.`);const t=null===(b=e.caveats)||void 0===b||null===(b=b.find(({type:e})=>e===s.Caip25CaveatType))||void 0===b?void 0:b.value;if(!t)throw new Error(`could not find ${s.Caip25CaveatType} in granted ${s.Caip25EndowmentPermissionName} permission.`);delete y[s.Caip25EndowmentPermissionName];const n=u(origin);y[o.RestrictedMethods.eth_accounts]={...e,parentCapability:o.RestrictedMethods.eth_accounts,caveats:[{type:o.CaveatTypes.restrictReturnedAccounts,value:n}]};const r=(0,s.getPermittedEthChainIds)(t);r.length>0&&(y[c.PermissionNames.permittedChains]={...e,parentCapability:c.PermissionNames.permittedChains,caveats:[{type:o.CaveatTypes.restrictNetworkSwitching,value:r}]})}return t.result=Object.values(y).filter(e=>e!==undefined),l()},hookNames:{getAccounts:!0,requestPermissionsForOrigin:!0,getCaip25PermissionFromLegacyPermissionsForOrigin:!0}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/wallet-requestPermissions.ts"}],[325,{"../../../../../shared/constants/permissions":5861,"../../../controllers/permissions":239,"@metamask/chain-agnostic-permission":1465,"@metamask/permission-controller":2534,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.revokePermissionsHandler=void 0;var r=e("@metamask/permission-controller"),a=e("@metamask/utils"),i=e("@metamask/chain-agnostic-permission"),s=e("../../../../../shared/constants/permissions"),o=e("../../../controllers/permissions");n.revokePermissionsHandler={methodNames:[r.MethodNames.RevokePermissions],implementation:function(e,t,n,c,{revokePermissionsForOrigin:l,rejectApprovalRequestsForOrigin:u}){const{params:d}=e,p=null==d?void 0:d[0];if(!p)return c((0,r.invalidParams)({data:{request:e}}));const m=Object.keys(p).filter(e=>e!==i.Caip25EndowmentPermissionName);if(!(0,a.isNonEmptyArray)(m))return c((0,r.invalidParams)({data:{request:e}}));const h=[s.RestrictedMethods.eth_accounts,o.PermissionNames.permittedChains],f=m.filter(e=>!h.includes(e));f.length!==m.length&&f.push(i.Caip25EndowmentPermissionName);return l(f),u(),t.result=null,c()},hookNames:{revokePermissionsForOrigin:!0,rejectApprovalRequestsForOrigin:!0,updateCaveat:!0}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/wallet-revokePermissions.ts"}],[326,{"../../../../../shared/constants/app":5837,"@metamask/controller-utils":1494,"@metamask/rpc-errors":2698},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("@metamask/rpc-errors"),a=e("@metamask/controller-utils"),i=e("../../../../../shared/constants/app");const s={methodNames:[i.MESSAGE_TYPE.WATCH_ASSET,i.MESSAGE_TYPE.WATCH_ASSET_LEGACY],implementation:async function(e,t,n,i,{handleWatchAssetRequest:s}){try{const{params:{options:n,type:o},origin:c,networkClientId:l}=e,{tokenId:u}=n;return[a.ERC721,a.ERC1155].includes(o)&&u!==undefined&&"string"!=typeof u?i(r.rpcErrors.invalidParams({message:`Expected parameter 'tokenId' to be type 'string'. Received type '${typeof u}'`})):(await s({asset:n,type:o,origin:c??"",networkClientId:l??""}),t.result=!0,i())}catch(e){return i(e)}},hookNames:{handleWatchAssetRequest:!0}};n.default=s}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/watch-asset.ts"}],[3260,{"./utils.js":3274},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.aoutput=n.anumber=n.aexists=n.abytes=void 0;const r=e("./utils.js");n.abytes=r.abytes,n.aexists=r.aexists,n.anumber=r.anumber,n.aoutput=r.aoutput}}},{package:"@noble/hashes",file:"node_modules/@noble/hashes/_assert.js"}],[327,{"./createMethodMiddleware":312,"./createUnsupportedMethodMiddleware":313},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=e("./createMethodMiddleware");Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&(e in n&&n[e]===r[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return r[e]}}))});var a=e("./createUnsupportedMethodMiddleware");Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&(e in n&&n[e]===a[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return a[e]}}))})}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/index.js"}],[3275,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.openrpcDocument=void 0,n.openrpcDocument={$schema:"https://meta.json-schema.tools/",$id:"https://meta.open-rpc.org/",title:"openrpcDocument",type:"object",required:["info","methods","openrpc"],additionalProperties:!1,patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}},properties:{openrpc:{title:"openrpc",type:"string",enum:["1.3.2","1.3.1","1.3.0","1.2.6","1.2.5","1.2.4","1.2.3","1.2.2","1.2.1","1.2.0","1.1.12","1.1.11","1.1.10","1.1.9","1.1.8","1.1.7","1.1.6","1.1.5","1.1.4","1.1.3","1.1.2","1.1.1","1.1.0","1.0.0","1.0.0-rc1","1.0.0-rc0"]},info:{$ref:"#/definitions/infoObject"},externalDocs:{$ref:"#/definitions/externalDocumentationObject"},servers:{title:"servers",type:"array",additionalItems:!1,items:{$ref:"#/definitions/serverObject"}},methods:{title:"methods",type:"array",additionalItems:!1,items:{title:"methodOrReference",oneOf:[{$ref:"#/definitions/methodObject"},{$ref:"#/definitions/referenceObject"}]}},components:{title:"components",type:"object",properties:{schemas:{title:"schemaComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/JSONSchema"}}},links:{title:"linkComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/linkObject"}}},errors:{title:"errorComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/errorObject"}}},examples:{title:"exampleComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/exampleObject"}}},examplePairings:{title:"examplePairingComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/examplePairingObject"}}},contentDescriptors:{title:"contentDescriptorComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/contentDescriptorObject"}}},tags:{title:"tagComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/tagObject"}}}}},$schema:{title:"metaSchema",description:"JSON Schema URI (used by some editors)",type:"string",default:"https://meta.open-rpc.org/"}},definitions:{specificationExtension:{title:"specificationExtension"},JSONSchema:{$ref:"https://meta.json-schema.tools"},referenceObject:{title:"referenceObject",type:"object",additionalProperties:!1,required:["$ref"],properties:{$ref:{$ref:"https://meta.json-schema.tools/#/definitions/JSONSchemaObject/properties/$ref"}}},errorObject:{title:"errorObject",type:"object",description:"Defines an application level error.",additionalProperties:!1,required:["code","message"],properties:{code:{title:"errorObjectCode",description:"A Number that indicates the error type that occurred. This MUST be an integer. The error codes from and including -32768 to -32000 are reserved for pre-defined errors. These pre-defined errors SHOULD be assumed to be returned from any JSON-RPC api.",type:"integer"},message:{title:"errorObjectMessage",description:"A String providing a short description of the error. The message SHOULD be limited to a concise single sentence.",type:"string"},data:{title:"errorObjectData",description:"A Primitive or Structured value that contains additional information about the error. This may be omitted. The value of this member is defined by the Server (e.g. detailed error information, nested errors etc.)."}}},licenseObject:{title:"licenseObject",type:"object",additionalProperties:!1,properties:{name:{title:"licenseObjectName",type:"string"},url:{title:"licenseObjectUrl",type:"string"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},contactObject:{title:"contactObject",type:"object",additionalProperties:!1,properties:{name:{title:"contactObjectName",type:"string"},email:{title:"contactObjectEmail",type:"string"},url:{title:"contactObjectUrl",type:"string"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},infoObject:{title:"infoObject",type:"object",additionalProperties:!1,required:["title","version"],properties:{title:{title:"infoObjectProperties",type:"string"},description:{title:"infoObjectDescription",type:"string"},termsOfService:{title:"infoObjectTermsOfService",type:"string",format:"uri"},version:{title:"infoObjectVersion",type:"string"},contact:{$ref:"#/definitions/contactObject"},license:{$ref:"#/definitions/licenseObject"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},serverObject:{title:"serverObject",type:"object",required:["url"],additionalProperties:!1,properties:{url:{title:"serverObjectUrl",type:"string",format:"uri"},name:{title:"serverObjectName",type:"string"},description:{title:"serverObjectDescription",type:"string"},summary:{title:"serverObjectSummary",type:"string"},variables:{title:"serverObjectVariables",type:"object",patternProperties:{"[0-z]+":{title:"serverObjectVariable",type:"object",required:["default"],properties:{default:{title:"serverObjectVariableDefault",type:"string"},description:{title:"serverObjectVariableDescription",type:"string"},enum:{title:"serverObjectVariableEnum",type:"array",items:{title:"serverObjectVariableEnumItem",type:"string"}}}}}}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},linkObject:{title:"linkObject",type:"object",additionalProperties:!1,properties:{name:{title:"linkObjectName",type:"string",minLength:1},summary:{title:"linkObjectSummary",type:"string"},method:{title:"linkObjectMethod",type:"string"},description:{title:"linkObjectDescription",type:"string"},params:{title:"linkObjectParams"},server:{title:"linkObjectServer",$ref:"#/definitions/serverObject"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},externalDocumentationObject:{title:"externalDocumentationObject",type:"object",additionalProperties:!1,description:"information about external documentation",required:["url"],properties:{description:{title:"externalDocumentationObjectDescription",type:"string"},url:{title:"externalDocumentationObjectUrl",type:"string",format:"uri"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},methodObject:{title:"methodObject",type:"object",required:["name","params"],additionalProperties:!1,properties:{name:{title:"methodObjectName",description:"The cannonical name for the method. The name MUST be unique within the methods array.",type:"string",minLength:1},description:{title:"methodObjectDescription",description:"A verbose explanation of the method behavior. GitHub Flavored Markdown syntax MAY be used for rich text representation.",type:"string"},summary:{title:"methodObjectSummary",description:"A short summary of what the method does.",type:"string"},servers:{title:"servers",type:"array",additionalItems:!1,items:{$ref:"#/definitions/serverObject"}},tags:{title:"methodObjectTags",type:"array",items:{title:"tagOrReference",oneOf:[{$ref:"#/definitions/tagObject"},{$ref:"#/definitions/referenceObject"}]}},paramStructure:{title:"methodObjectParamStructure",type:"string",description:"Format the server expects the params. Defaults to 'either'.",enum:["by-position","by-name","either"],default:"either"},params:{title:"methodObjectParams",type:"array",items:{title:"contentDescriptorOrReference",oneOf:[{$ref:"#/definitions/contentDescriptorObject"},{$ref:"#/definitions/referenceObject"}]}},result:{title:"methodObjectResult",oneOf:[{$ref:"#/definitions/contentDescriptorObject"},{$ref:"#/definitions/referenceObject"}]},errors:{title:"methodObjectErrors",description:"Defines an application level error.",type:"array",items:{title:"errorOrReference",oneOf:[{$ref:"#/definitions/errorObject"},{$ref:"#/definitions/referenceObject"}]}},links:{title:"methodObjectLinks",type:"array",items:{title:"linkOrReference",oneOf:[{$ref:"#/definitions/linkObject"},{$ref:"#/definitions/referenceObject"}]}},examples:{title:"methodObjectExamples",type:"array",items:{title:"examplePairingOrReference",oneOf:[{$ref:"#/definitions/examplePairingObject"},{$ref:"#/definitions/referenceObject"}]}},deprecated:{title:"methodObjectDeprecated",type:"boolean",default:!1},externalDocs:{$ref:"#/definitions/externalDocumentationObject"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},tagObject:{title:"tagObject",type:"object",additionalProperties:!1,required:["name"],properties:{name:{title:"tagObjectName",type:"string",minLength:1},description:{title:"tagObjectDescription",type:"string"},externalDocs:{$ref:"#/definitions/externalDocumentationObject"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},exampleObject:{title:"exampleObject",type:"object",required:["name","value"],properties:{summary:{title:"exampleObjectSummary",type:"string"},value:{title:"exampleObjectValue"},description:{title:"exampleObjectDescription",type:"string"},name:{title:"exampleObjectName",type:"string",minLength:1}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},examplePairingObject:{title:"examplePairingObject",type:"object",required:["name","params"],properties:{name:{title:"examplePairingObjectName",type:"string",minLength:1},description:{title:"examplePairingObjectDescription",type:"string"},params:{title:"examplePairingObjectParams",type:"array",items:{title:"exampleOrReference",oneOf:[{$ref:"#/definitions/exampleObject"},{$ref:"#/definitions/referenceObject"}]}},result:{title:"examplePairingObjectResult",oneOf:[{$ref:"#/definitions/exampleObject"},{$ref:"#/definitions/referenceObject"}]}}},contentDescriptorObject:{title:"contentDescriptorObject",type:"object",additionalProperties:!1,required:["name","schema"],properties:{name:{title:"contentDescriptorObjectName",type:"string",minLength:1},description:{title:"contentDescriptorObjectDescription",type:"string"},summary:{title:"contentDescriptorObjectSummary",type:"string"},schema:{$ref:"#/definitions/JSONSchema"},required:{title:"contentDescriptorObjectRequired",type:"boolean",default:!1},deprecated:{title:"contentDescriptorObjectDeprecated",type:"boolean",default:!1}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}}}},n.default=n.openrpcDocument}}},{package:"@open-rpc/meta-schema",file:"node_modules/@open-rpc/meta-schema/index.js"}],[3276,{"@json-schema-tools/dereferencer":876,"@json-schema-tools/reference-resolver":880,"fast-safe-stringify":4453},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},r.apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,o)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,a,i,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(s=0)),s;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(a=s.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.OpenRPCDocumentDereferencingError=void 0;var o=s(e("@json-schema-tools/dereferencer")),c=s(e("@json-schema-tools/reference-resolver")),l=s(e("fast-safe-stringify")),u=function(e){this.name="OpenRPCDocumentDereferencingError",this.message="The json schema provided cannot be dereferenced. Received Error: \n ".concat(e)};n.OpenRPCDocumentDereferencingError=u;var d=function(e,t,n){return a(void 0,void 0,void 0,function(){var r,a;return i(this,function(i){switch(i.label){case 0:if((r=e.$ref)===undefined)return[2,e];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n.resolve(r,t)];case 2:return[2,i.sent()];case 3:throw a=i.sent(),new u(["unable to eval pointer against OpenRPC Document.","error type: ".concat(a.name),"instance: ".concat(a.instance),"token: ".concat(a.token),"pointer: ".concat(r),"reference object: ".concat((0,l.default)(e))].join("\n"));case 4:return[2]}})})},p=function(e,t,n){return a(void 0,void 0,void 0,function(){var r,a,s,o,c,l;return i(this,function(i){switch(i.label){case 0:r=[],a=0,s=e,i.label=1;case 1:return a<s.length?(o=s[a],l=(c=r).push,[4,d(o,t,n)]):[3,4];case 2:l.apply(c,[i.sent()]),i.label=3;case 3:return a++,[3,1];case 4:return[2,r]}})})},m=function(e,t){return a(void 0,void 0,void 0,function(){var n,r,a;return i(this,function(i){switch(i.label){case 0:if(!0===e||!1===e)return[2,Promise.resolve(e)];t!==undefined&&(e.components={schemas:t}),n=new o.default(e),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n.resolve()];case 2:return!0!==(r=i.sent())&&!1!==r&&(delete r.components,delete e.components),[2,r];case 3:throw a=i.sent(),new u(["Unable to parse reference inside of JSONSchema",e.title?"Schema Title: ".concat(e.title):"","error message: ".concat(a.message),"schema in question: ".concat((0,l.default)(e))].join("\n"));case 4:return[2]}})})},h=function(e){return a(void 0,void 0,void 0,function(){var t,n,r,a,s,o,c;return i(this,function(i){switch(i.label){case 0:if(e.components===undefined)return[2,Promise.resolve(e)];if(e.components.contentDescriptors===undefined)return[2,Promise.resolve(e)];t=e.components.contentDescriptors,n=Object.keys(t),r={},e.components.schemas&&(r=e.components.schemas),a=0,s=n,i.label=1;case 1:return a<s.length?(o=s[a],c=t[o],[4,m(t[o].schema,r)]):[3,4];case 2:c.schema=i.sent(),i.label=3;case 3:return a++,[3,1];case 4:return[2,e]}})})},f=function(e,t,n){return a(void 0,void 0,void 0,function(){var r,a,s,o,c,l,u,h,f,g,y,v,b,T,w,k,_,P,E,S;return i(this,function(i){switch(i.label){case 0:return r=e,e.$ref===undefined?[3,2]:[4,d({$ref:e.$ref},t,n)];case 1:r=i.sent(),i.label=2;case 2:return r.tags===undefined?[3,4]:(a=r,[4,p(r.tags,t,n)]);case 3:a.tags=i.sent(),i.label=4;case 4:return r.errors===undefined?[3,6]:(s=r,[4,p(r.errors,t,n)]);case 5:s.errors=i.sent(),i.label=6;case 6:return r.links===undefined?[3,8]:(o=r,[4,p(r.links,t,n)]);case 7:o.links=i.sent(),i.label=8;case 8:return r.examples===undefined?[3,14]:(c=r,[4,p(r.examples,t,n)]);case 9:c.examples=i.sent(),l=0,u=r.examples,i.label=10;case 10:return l<u.length?(h=u[l],f=h,[4,p(h.params,t,n)]):[3,14];case 11:return f.params=i.sent(),h.result===undefined?[3,13]:(g=h,[4,d(h.result,t,n)]);case 12:g.result=i.sent(),i.label=13;case 13:return l++,[3,10];case 14:return y=r,[4,p(r.params,t,n)];case 15:return y.params=i.sent(),r.result===undefined?[3,17]:(v=r,[4,d(r.result,t,n)]);case 16:v.result=i.sent(),i.label=17;case 17:b={},t.components&&t.components.schemas&&(b=t.components.schemas),T=r.params,w=0,k=T,i.label=18;case 18:return w<k.length?(_=k[w],P=_,[4,m(_.schema,b)]):[3,21];case 19:P.schema=i.sent(),i.label=20;case 20:return w++,[3,18];case 21:return r.result===undefined?[3,23]:(E=r.result,S=E,[4,m(E.schema,b)]);case 22:S.schema=i.sent(),i.label=23;case 23:return[2,r]}})})};n.default=function(e,t){return void 0===t&&(t=c.default),a(this,void 0,void 0,function(){var n,s,o,c,l,u,d;return i(this,function(p){switch(p.label){case 0:return n=r({},e),[4,(g=n,a(void 0,void 0,void 0,function(){var e,t,n,r,a,s,o;return i(this,function(i){switch(i.label){case 0:if(g.components===undefined)return[2,Promise.resolve(g)];if(g.components.schemas===undefined)return[2,Promise.resolve(g)];e=g.components.schemas,t=Object.keys(e),n=0,r=t,i.label=1;case 1:return n<r.length?(a=r[n],s=e,o=a,[4,m(e[a],e)]):[3,4];case 2:s[o]=i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2,g]}})}))];case 1:return n=p.sent(),[4,h(n)];case 2:n=p.sent(),s=[],o=0,c=n.methods,p.label=3;case 3:return o<c.length?(l=c[o],d=(u=s).push,[4,f(l,n,t)]):[3,6];case 4:d.apply(u,[p.sent()]),p.label=5;case 5:return o++,[3,3];case 6:return n.methods=s,[2,n]}var g})})}}}},{package:"@open-rpc/schema-utils-js",file:"node_modules/@open-rpc/schema-utils-js/build/dereference-document.js"}],[3277,{"./dereference-document":3276,"./validate-open-rpc-document":3278,"@json-schema-tools/reference-resolver":880,"@json-schema-tools/reference-resolver/build/reference-resolver":881,"is-url":4704},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},r.apply(this,arguments)},a=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,o)}c((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,a,i,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(s=0)),s;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(a=s.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.makeCustomResolver=void 0;var u=l(e("./dereference-document")),d=s(e("./validate-open-rpc-document")),p=l(e("@json-schema-tools/reference-resolver")),m=e("is-url"),h=l(e("@json-schema-tools/reference-resolver/build/reference-resolver")),f={dereference:!0,validate:!0};n.makeCustomResolver=function(e){return new h.default(e)},n.default=function(e,t){return function(n,a){return void 0===n&&(n="./openrpc.json"),void 0===a&&(a=f),o(this,void 0,void 0,function(){var i,s,o,l;return c(this,function(c){switch(c.label){case 0:return s=r(r({},f),a),"string"==typeof n?[3,1]:(i=n,[3,6]);case 1:return function(e){try{return JSON.parse(e),!0}catch(e){return!1}}(n)?(i=JSON.parse(n),[3,6]):[3,2];case 2:return m(n)?[4,e(n)]:[3,4];case 3:return i=c.sent(),[3,6];case 4:return[4,t(n)];case 5:i=c.sent(),c.label=6;case 6:if(s.validate&&(l=(0,d.default)(i))instanceof d.OpenRPCDocumentValidationError)throw l;return o=i,s.dereference?s.resolver===undefined?[3,8]:[4,(0,u.default)(i,s.resolver)]:[3,10];case 7:return o=c.sent(),[3,10];case 8:return[4,(0,u.default)(i,p.default)];case 9:o=c.sent(),c.label=10;case 10:if(s.validate&&(l=(0,d.default)(o))instanceof d.OpenRPCDocumentValidationError)throw l;return[2,o]}})})}}}}},{package:"@open-rpc/schema-utils-js",file:"node_modules/@open-rpc/schema-utils-js/build/parse-open-rpc-document.js"}],[3278,{"@json-schema-tools/meta-schema":877,"@open-rpc/meta-schema":3275,ajv:3920},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},r.apply(this,arguments)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.OpenRPCDocumentValidationError=void 0;var i=a(e("@open-rpc/meta-schema")),s=a(e("ajv")),o=a(e("@json-schema-tools/meta-schema")),c=function(e){this.name="OpenRPCDocumentDereferencingError",this.message=["Error validating OpenRPC Document against @open-rpc/meta-schema.","The errors found are as follows:",JSON.stringify(e,undefined,"  ")].join("\n")};n.OpenRPCDocumentValidationError=c,n.default=function(e){var t=new s.default;t.addSchema(o.default,"https://meta.json-schema.tools");var n=r({},i.default);delete n.definitions.JSONSchema.$id,delete n.definitions.JSONSchema.$schema,delete n.$schema,delete n.$id;try{t.validate(n,e)}catch(e){throw new Error(["schema-utils-js: Internal Error","-----",e,"-----","If you see this report it: https://github.com/open-rpc/schema-utils-js/issues"].join("\n"))}return!t.errors||new c(t.errors)}}}},{package:"@open-rpc/schema-utils-js",file:"node_modules/@open-rpc/schema-utils-js/build/validate-open-rpc-document.js"}],[328,{"../../../shared/lib/snaps/snaps":5955,"@metamask/rpc-errors":2698,"@metamask/snaps-sdk":2887},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({allowedOrigins:e,errorMessage:t="Cannot process requests at this time",state:n}){return function(s,o,c,l){if(!n.isBlocked)return c();const{origin:u}=s;if(!u)return l(new a.InternalError(`No origin specified for request with method ${s.method}`));return e.includes(u)||(0,i.isSnapPreinstalled)(u)?c():l(r.rpcErrors.resourceUnavailable(t))}};var r=e("@metamask/rpc-errors"),a=e("@metamask/snaps-sdk"),i=e("../../../shared/lib/snaps/snaps")}}},{package:"$root$",file:"app/scripts/lib/rpcBlockingMiddleware.ts"}],[329,{"./operation-safener":305,loglevel:4909,"webextension-polyfill":5825},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRequestSafeReload=function(e){const t=new i.OperationSafener({op:async t=>{try{if("data"===e.storageKind){if(!t)throw new Error("State must be provided for 'data' storageKind");await e.set(t)}else await e.persist()}catch(e){a.default.error("MetaMask - Persistence failed",e),null==o||o.captureException(e)}},wait:1e3});return{safePersist:async(...e)=>t.execute(...e),requestSafeReload:async()=>{await t.evacuate(),r.default.runtime.reload()},evacuate:()=>t.evacuate()}};var r=s(e("webextension-polyfill")),a=s(e("loglevel")),i=e("./operation-safener");function s(e){return e&&e.__esModule?e:{default:e}}const{sentry:o}=global}}},{package:"$root$",file:"app/scripts/lib/safe-reload.ts"}],[33,{"@metamask/claims-controller":1484},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ClaimsControllerInit=void 0;var r=e("@metamask/claims-controller");n.ClaimsControllerInit=e=>{const{controllerMessenger:t,persistedState:n}=e;return{controller:new r.ClaimsController({messenger:t,state:n.ClaimsController})}}}}},{package:"$root$",file:"app/scripts/controller-init/claims/claims-controller-init.ts"}],[3333,{"@metamask/eth-sig-util":2081,tslib:5751},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.transformTypedData=void 0;const r=e("tslib").__importStar(e("@metamask/eth-sig-util"));function a(e){switch(Object.prototype.toString.call(e)){case"[object Object]":{const t=Object.keys(e).map(t=>[t,a(e[t])]);return Object.fromEntries(t)}case"[object Array]":return e.map(e=>a(e));case"[object BigInt]":return e.toString();default:return e}}n.transformTypedData=(e,t)=>{if(!t)throw new Error("Trezor: Only version 4 of typed data signing is supported");const n=r.SignTypedDataVersion.V4,{types:i,primaryType:s,domain:o,message:c}=r.TypedDataUtils.sanitizeData(e),l=r.TypedDataUtils.hashStruct("EIP712Domain",a(o),i,n).toString("hex");let u=null;return"EIP712Domain"!==s&&(u=r.TypedDataUtils.hashStruct(s,a(c),i,n).toString("hex")),Object.assign({domain_separator_hash:l,message_hash:u},e)},n.default=n.transformTypedData}}},{package:"@metamask/eth-trezor-keyring>@trezor/connect-plugin-ethereum",file:"node_modules/@trezor/connect-plugin-ethereum/lib/index.js"}],[334,{"../../../../shared/lib/trace":5960},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.addPersonalMessage=async function({signatureParams:e,signatureController:t}){return a(e,t,"newUnsignedPersonalMessage")},n.addTypedMessage=async function({signatureParams:e,signatureController:t}){return a(e,t,"newUnsignedTypedMessage")};var r=e("../../../../shared/lib/trace");async function a(e,t,n){const[a,i,s,o]=e,{id:c,method:l,params:u}=i,d={id:c,method:l,params:u,origin:s.get("origin"),networkClientId:s.get("networkClientId"),securityAlertResponse:s.get("securityAlertResponse")},p=null==c?void 0:c.toString();(0,r.endTrace)({name:r.TraceName.Middleware,id:p});const m=await t[n](a,d,o);return(0,r.endTrace)({name:r.TraceName.Signature,id:p}),m}}}},{package:"$root$",file:"app/scripts/lib/signature/util.ts"}],[335,{"../../../../shared/constants/app":5837,"../../../../shared/constants/smartTransactions":5867,"../../../../shared/modules/conversion.utils":5976,"../../../../shared/modules/selectors":5993,"../../../../shared/modules/selectors/networks":5995,"../../../../shared/modules/transaction.utils":6008,"../transaction/util":368,"@metamask/smart-transactions-controller":2743,"@metamask/transaction-controller":3095,loglevel:4909},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSmartTransactionCommonParams=function(e,t){const n=function(e){return{metamask:e}}(e),r=t??(0,d.getCurrentChainId)(n),a=(0,u.getIsSmartTransaction)(n,t),i=(0,u.getSmartTransactionsFeatureFlagsForChain)(n,r),s=(0,u.isHardwareWallet)(n);return{isSmartTransaction:a,featureFlags:i,isHardwareWalletAccount:s}},n.submitSmartTransactionHook=n.submitBatchSmartTransactionHook=void 0;var r,a=e("@metamask/smart-transactions-controller"),i=e("@metamask/transaction-controller"),s=(r=e("loglevel"))&&r.__esModule?r:{default:r},o=e("../../../../shared/constants/app"),c=e("../../../../shared/constants/smartTransactions"),l=e("../../../../shared/modules/conversion.utils"),u=e("../../../../shared/modules/selectors"),d=e("../../../../shared/modules/selectors/networks"),p=e("../../../../shared/modules/transaction.utils"),m=e("../transaction/util");function h(e,t,n){f(e,t),t.set(e,n)}function f(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function g(e,t){return e.get(v(e,t))}function y(e,t,n){return e.set(v(e,t),n),n}function v(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var b=new WeakMap,T=new WeakMap,w=new WeakMap,k=new WeakMap,_=new WeakMap,P=new WeakMap,E=new WeakMap,S=new WeakMap,A=new WeakMap,C=new WeakMap,M=new WeakMap,O=new WeakMap,j=new WeakMap,I=new WeakMap,x=new WeakSet;class R{constructor(e){!function(e,t){f(e,t),t.add(e)}(this,x),h(this,b,void 0),h(this,T,void 0),h(this,w,void 0),h(this,k,void 0),h(this,_,void 0),h(this,P,void 0),h(this,E,void 0),h(this,S,void 0),h(this,A,void 0),h(this,C,void 0),h(this,M,void 0),h(this,O,void 0),h(this,j,void 0),h(this,I,void 0);const{transactionMeta:t,signedTransactionInHex:n,smartTransactionsController:r,transactionController:a,isSmartTransaction:c,controllerMessenger:l,featureFlags:u,transactions:d}=e;y(T,this,""),y(b,this,!1),y(C,this,t),y(M,this,n),y(S,this,r),y(A,this,a),y(E,this,c),y(k,this,l),y(_,this,u),y(P,this,t.origin!==o.ORIGIN_METAMASK),y(w,this,t.chainId),y(j,this,t.txParams),y(O,this,d);const p=null==u?void 0:u.extensionSkipSmartTransactionStatusPage;y(I,this,!p&&Boolean(t.type!==i.TransactionType.bridge&&t.type!==i.TransactionType.shieldSubscriptionApprove||g(O,this)&&g(O,this).length>0)),s.default.info("[SmartTransaction] shouldShowStatusPage:",g(I,this))}async submit(){const e=!!g(C,this).type&&[i.TransactionType.swapAndSend,i.TransactionType.swapApproval,i.TransactionType.bridgeApproval].includes(g(C,this).type),t={transactionHash:undefined};if(!g(E,this)||e||(0,p.isLegacyTransaction)(g(C,this)))return t;let n;if(g(I,this)&&await v(x,this,N).call(this),!g(M,this)||!g(C,this).isGasFeeSponsored)try{n=await g(S,this).getFees({...g(j,this),chainId:g(w,this)},undefined,{networkClientId:g(C,this).networkClientId})}catch(e){return s.default.error("Error in smart transaction publish hook, falling back to regular transaction submission",e),v(x,this,G).call(this),t}try{var r;const e=await v(x,this,q).call(this,{getFeesResponse:n}),t=null==e?void 0:e.uuid;if(!t)throw new Error("No smart transaction UUID");await v(x,this,U).call(this,t);let a;if(a=(null===(r=g(_,this))||void 0===r?void 0:r.extensionReturnTxHashAsap)&&null!=e&&e.txHash?e.txHash:await v(x,this,H).call(this,{uuid:t}),null===a)throw new Error("Transaction does not have a transaction hash, there was a problem");return{transactionHash:a}}catch(e){throw s.default.error("Error in smart transaction publish hook",e),v(x,this,G).call(this),e}}async submitBatch(){if(!g(E,this))throw new Error("submitBatch: Smart Transaction is required for batch submissions");g(I,this)&&await v(x,this,N).call(this);try{var e,t;const n=await v(x,this,q).call(this),r=null==n?void 0:n.uuid;if(!r)throw new Error("submitBatch: No smart transaction UUID");let a;await v(x,this,U).call(this,r),a=null!=n&&n.txHashes?{results:n.txHashes.map(e=>({transactionHash:e}))}:{results:[]};if((null===(e=g(_,this))||void 0===e?void 0:e.extensionReturnTxHashAsapBatch)&&(null===(t=a)||void 0===t||null===(t=t.results)||void 0===t?void 0:t.length)>0)return a;if(null===await v(x,this,H).call(this,{uuid:r}))throw new Error("submitBatch: Transaction does not have a transaction hash, there was a problem");return a}catch(e){throw s.default.error("submitBatch: Error in smart transaction publish batch hook",e),v(x,this,G).call(this),e}}}async function D(e){try{await g(k,this).call("ApprovalController:endFlow",{id:e})}catch(e){}}async function F(e){try{await v(x,this,D).call(this,e),await g(k,this).call("ApprovalController:acceptRequest",e),Y._=""}catch(e){s.default.error("Error ending existing approval flow",e)}}async function N(){Y._&&await v(x,this,F).call(this,Y._);const{id:e}=await g(k,this).call("ApprovalController:startFlow");y(T,this,e),Y._=e}async function U(e){g(I,this)&&(v(x,this,B).call(this,{uuid:e}),v(x,this,L).call(this,{uuid:e}))}function G(){g(I,this)&&!g(b,this)&&(y(b,this,!0),v(x,this,D).call(this,g(T,this)),Y._===g(T,this)&&(Y._=""))}function B({uuid:e}){const t=()=>{v(x,this,G).call(this)};g(k,this).call("ApprovalController:addRequest",{id:g(T,this),origin:origin,type:o.SMART_TRANSACTION_CONFIRMATION_TYPES.showSmartTransactionStatusPage,requestState:{smartTransaction:{status:a.SmartTransactionStatuses.PENDING,creationTime:Date.now(),uuid:e,chainId:g(w,this)},isDapp:g(P,this),txId:g(C,this).id}},!0).then(t,t)}async function $({smartTransaction:e}){return await g(k,this).call("ApprovalController:updateRequestState",{id:g(T,this),requestState:{smartTransaction:e,isDapp:g(P,this),txId:g(C,this).id}})}async function L({uuid:e}){g(k,this).subscribe("SmartTransactionsController:smartTransaction",async t=>{if(t.uuid===e){const{status:e}=t;if(!e||e===a.SmartTransactionStatuses.PENDING)return;g(b,this)||await v(x,this,$).call(this,{smartTransaction:t})}})}function H({uuid:e}){return new Promise(t=>{g(k,this).subscribe("SmartTransactionsController:smartTransaction",async n=>{if(n.uuid===e){const{status:e,statusMetadata:r}=n;if(!e||e===a.SmartTransactionStatuses.PENDING)return;s.default.debug("Smart Transaction: ",n),null!=r&&r.minedHash?(s.default.debug("Smart Transaction - Received tx hash: ",null==r?void 0:r.minedHash),t(r.minedHash)):t(null)}})})}async function q({getFeesResponse:e}={}){let t=[],n=[];if(g(O,this)&&Array.isArray(g(O,this))&&g(O,this).length>0)t=g(O,this).filter(e=>null==e?void 0:e.signedTx).map(e=>{const t=(0,m.getTransactionById)(e.id??"",g(A,this)),n={tx:e.signedTx};return t&&(n.metadata={txType:t.type}),n});else if(g(M,this))t=[{tx:g(M,this),metadata:{txType:g(C,this).type}}];else if(e){var r;t=(await v(x,this,V).call(this,(null===(r=e.tradeTxFees)||void 0===r?void 0:r.fees)??[],!1)).map(e=>({tx:e,metadata:{txType:g(C,this).type}}))}return n=t.map(e=>e.tx),await g(S,this).submitSignedTransactions({signedTransactions:n,signedTransactionsWithMetadata:t,signedCanceledTransactions:[],txParams:g(j,this),transactionMeta:g(C,this),networkClientId:g(C,this).networkClientId})}function W(e,t){if(!g(j,this))throw new Error("Transaction params are required");const n={...g(j,this),maxFeePerGas:`0x${(0,l.decimalToHex)(e.maxFeePerGas)}`,maxPriorityFeePerGas:`0x${(0,l.decimalToHex)(e.maxPriorityFeePerGas)}`,gas:t?`0x${(0,l.decimalToHex)(c.CANCEL_GAS_LIMIT_DEC)}`:g(j,this).gas};return t&&(n.to=n.from,n.data="0x"),n}async function V(e,t){if(!g(j,this)||!g(w,this))throw new Error("Transaction params and chainId are required");const n=e.map(e=>v(x,this,W).call(this,e,t)).map(e=>({...e,chainId:e.chainId||g(w,this)}));return await g(A,this).approveTransactionsWithSameNonce(n,{hasNonce:!0})}var Y={_:""};n.submitSmartTransactionHook=e=>new R(e).submit();n.submitBatchSmartTransactionHook=e=>new R(e).submitBatch()}}},{package:"$root$",file:"app/scripts/lib/smart-transaction/smart-transactions.ts"}],[336,{"./snap-keyring":339,"./utils":340},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"getAccountsBySnapId",{enumerable:!0,get:function(){return a.getAccountsBySnapId}}),Object.defineProperty(n,"snapKeyringBuilder",{enumerable:!0,get:function(){return r.snapKeyringBuilder}});var r=e("./snap-keyring"),a=e("./utils")}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/index.ts"}],[337,{"@metamask/keyring-api":2306,"@metamask/permission-controller":2534},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isProtocolAllowed=u,n.keyringSnapPermissionsBuilder=function(e,t){return()=>{if("metamask"===t)return s;if(i.includes(t))return c;const n=e.getSubjectMetadata(t);return(null==n?void 0:n.subjectType)===a.SubjectType.Website&&u(t)?o:[]}};var r=e("@metamask/keyring-api"),a=e("@metamask/permission-controller");const i=["https://app.metamask.io"],s=[r.KeyringRpcMethod.ListAccounts,r.KeyringRpcMethod.GetAccount,r.KeyringRpcMethod.FilterAccountChains,r.KeyringRpcMethod.DeleteAccount,r.KeyringRpcMethod.ListRequests,r.KeyringRpcMethod.GetRequest,r.KeyringRpcMethod.SubmitRequest,r.KeyringRpcMethod.RejectRequest],o=[r.KeyringRpcMethod.ListAccounts,r.KeyringRpcMethod.GetAccount,r.KeyringRpcMethod.CreateAccount,r.KeyringRpcMethod.FilterAccountChains,r.KeyringRpcMethod.UpdateAccount,r.KeyringRpcMethod.DeleteAccount,r.KeyringRpcMethod.ExportAccount,r.KeyringRpcMethod.ListRequests,r.KeyringRpcMethod.GetRequest,r.KeyringRpcMethod.ApproveRequest,r.KeyringRpcMethod.RejectRequest],c=[r.KeyringRpcMethod.ListAccounts,r.KeyringRpcMethod.GetAccount,r.KeyringRpcMethod.GetAccountBalances,r.KeyringRpcMethod.SubmitRequest],l=["https:"];function u(e){try{const t=new URL(e);return l.includes(t.protocol)}catch(e){return!1}}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/keyring-snaps-permissions.ts"}],[338,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSnapAndHardwareInfoForMetrics=async function(e,t,n,r){var a,i,s;if(!r)return{};const o=r.call("AccountsController:getSelectedAccount"),c=o.address;let l;var u;null!==(a=o.metadata.snap)&&void 0!==a&&a.id&&(l=r.call("SnapController:get",null===(u=o.metadata.snap)||void 0===u?void 0:u.id));let d={};const{isUnlocked:p}=r.call("KeyringController:getState");if(p){d={account_type:await e(c),device_model:await t(c)};const r=await n(c);r&&(d={...d,account_hardware_type:r})}return{...d,account_snap_type:null===(i=l)||void 0===i?void 0:i.id,account_snap_version:null===(s=l)||void 0===s?void 0:s.version}}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/metrics.ts"}],[339,{"../../../../shared/constants/app":5837,"../../../../shared/constants/metametrics":5853,"../../../../shared/lib/accounts/snaps":5883,"../../../../shared/lib/snaps/snaps":5955,"../../../../shared/lib/translate":5965,"../../../../ui/components/component-library/icon":6593,"./utils/isBlockedUrl":341,"./utils/showResult":342,"@metamask/eth-snap-keyring":2137,"@metamask/snaps-utils":3004,"webextension-polyfill":5825},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.showAccountCreationDialog=T,n.snapKeyringBuilder=function(e,t){const n=()=>new a.SnapKeyring({messenger:e,callbacks:new S(e,t)});return n.state=null,n.type=a.SnapKeyring.type,n};var r,a=e("@metamask/eth-snap-keyring"),i=(r=e("webextension-polyfill"))&&r.__esModule?r:{default:r},s=e("@metamask/snaps-utils"),o=e("../../../../shared/constants/metametrics"),c=e("../../../../shared/constants/app"),l=e("../../../../shared/lib/translate"),u=e("../../../../ui/components/component-library/icon"),d=e("../../../../shared/lib/snaps/snaps"),p=e("../../../../shared/lib/accounts/snaps"),m=e("./utils/isBlockedUrl"),h=e("./utils/showResult");function f(e,t,n){g(e,t),t.set(e,n)}function g(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function y(e,t){return e.get(b(e,t))}function v(e,t,n){return e.set(b(e,t),n),n}function b(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}async function T(e,t){try{return Boolean(await t.call("ApprovalController:addRequest",{origin:e,type:c.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountCreation},!0))}catch(e){throw new Error(`Error occurred while showing account creation dialog.\n${e}`)}}var w=new WeakMap,k=new WeakMap,_=new WeakMap,P=new WeakMap,E=new WeakSet;class S{constructor(e,{trackEvent:t,persistKeyringHelper:n,removeAccountHelper:r}){!function(e,t){g(e,t),t.add(e)}(this,E),f(this,w,void 0),f(this,k,void 0),f(this,_,void 0),f(this,P,void 0),v(w,this,e),v(k,this,t),v(_,this,n),v(P,this,r)}async addressExists(e){return(await y(w,this).call("KeyringController:getAccounts")).includes(e.toLowerCase())}async redirectUser(e,t,n){if(t.length>0||n.length>0){const r=await(0,m.isBlockedUrl)(t,async()=>await y(w,this).call("PhishingController:maybeUpdateState"),e=>y(w,this).call("PhishingController:testOrigin",e)),a=await y(w,this).call("ApprovalController:addRequest",{origin:e,requestData:{url:t,message:n,isBlockedUrl:r},type:c.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showSnapAccountRedirect},!0);Boolean(a)&&t.length>0?i.default.tabs.create({url:t}):console.log("User refused snap account redirection to:",t)}else console.log("Error occurred when redirecting snap account. url or message must be defined")}async saveState(){await y(_,this).call(this)}async addAccount(e,t,n,r,i,{displayConfirmation:o,setSelectedAccount:c}=(0,a.getDefaultInternalOptions)()){(0,s.assertIsValidSnapId)(t);const l=(0,d.isSnapPreinstalled)(t);let u=l&&(0,p.isMultichainWalletSnap)(t);const m=u||l&&!o,h=u||l&&!c,f=m;await b(E,this,C).call(this,{snapId:t,skipConfirmationDialog:m,skipApprovalFlow:f,handleUserInput:n}),b(E,this,M).call(this,{address:e,snapId:t,skipConfirmationDialog:m,skipSetSelectedAccountStep:h,skipApprovalFlow:f,onceSaved:r})}async removeAccount(e,t,n){(0,s.assertIsValidSnapId)(t);const r=(0,p.getSnapName)(t,y(w,this)),{id:a}=y(w,this).call("ApprovalController:startFlow"),i="https://support.metamask.io/managing-my-wallet/accounts-and-addresses/how-to-remove-an-account-from-your-metamask-wallet/",d=e=>{y(k,this).call(this,{event:e,category:o.MetaMetricsEventCategory.Accounts,properties:{account_type:o.MetaMetricsEventAccountType.Snap,snap_id:t,snap_name:r}})};let m=!1;try{if(m=Boolean(await y(w,this).call("ApprovalController:addRequest",{origin:t,type:c.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountRemoval,requestData:{publicAddress:e}},!0)),!m)throw await n(m),new Error("User denied account removal");try{await y(P,this).call(this,e),await n(m),await this.saveState(),d(o.MetaMetricsEventName.RemoveSnapAccountSuccessViewed),await(0,h.showError)(y(w,this),t,{icon:u.IconName.UserCircleRemove,title:(0,l.t)("snapAccountRemoved")},{message:(0,l.t)("snapAccountRemovedDescription"),learnMoreLink:i}),d(o.MetaMetricsEventName.RemoveSnapAccountSuccessClicked)}catch(e){const n=e.message;throw await(0,h.showError)(y(w,this),t,{icon:u.IconName.UserCircleRemove,title:(0,l.t)("snapAccountRemovalFailed")},{message:(0,l.t)("snapAccountRemovalFailedDescription",r),learnMoreLink:i,error:n}),d(o.MetaMetricsEventName.AccountRemoveFailed),new Error(`Error occurred while removing snap account: ${n}`)}}finally{m&&d(o.MetaMetricsEventName.AccountRemoved),y(w,this).call("ApprovalController:endFlow",{id:a})}}}async function A(e){const{id:t}=y(w,this).call("ApprovalController:startFlow");try{return await e(t)}finally{y(w,this).call("ApprovalController:endFlow",{id:t})}}async function C({snapId:e,skipConfirmationDialog:t,skipApprovalFlow:n,handleUserInput:r}){return n?await r(!0):await b(E,this,A).call(this,async n=>{const a=t||await T(e,y(w,this));if(await r(a),!a)throw new Error("User denied account creation")})}async function M({address:e,snapId:t,skipConfirmationDialog:n,skipSetSelectedAccountStep:r,skipApprovalFlow:a,onceSaved:i}){const s="https://support.metamask.io/managing-my-wallet/accounts-and-addresses/how-to-add-accounts-in-your-wallet/",c=(0,p.getSnapName)(t,y(w,this)),d=e=>{y(k,this).call(this,{event:e,category:o.MetaMetricsEventCategory.Accounts,properties:{account_type:o.MetaMetricsEventAccountType.Snap,snap_id:t,snap_name:c,...e===o.MetaMetricsEventName.AccountAdded&&{is_suggested_name:!1}}})},m=async()=>{try{const a=await i;r||y(w,this).call("AccountsController:setSelectedAccount",a),n||(d(o.MetaMetricsEventName.AddSnapAccountSuccessViewed),await(0,h.showSuccess)(y(w,this),t,{icon:u.IconName.UserCircleAdd,title:(0,l.t)("snapAccountCreated")},{message:(0,l.t)("snapAccountCreatedDescription"),address:e,learnMoreLink:s}),d(o.MetaMetricsEventName.AddSnapAccountSuccessClicked)),d(o.MetaMetricsEventName.AccountAdded)}catch(e){const n=e.message;await(0,h.showError)(y(w,this),t,{icon:u.IconName.UserCircleAdd,title:(0,l.t)("snapAccountCreationFailed")},{message:(0,l.t)("snapAccountCreationFailedDescription",c),learnMoreLink:s,error:n}),console.error("Error occurred while creating snap account:",n)}};a?await m():await b(E,this,A).call(this,m)}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/snap-keyring.ts"}],[34,{"../../../../shared/modules/shield/config":6e3,"@metamask/claims-controller":1484},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ClaimsServiceInit=void 0;var r=e("@metamask/claims-controller"),a=e("../../../../shared/modules/shield/config");n.ClaimsServiceInit=e=>{const{controllerMessenger:t}=e,{claimsEnv:n}=(0,a.loadShieldConfig)();return{controller:new r.ClaimsService({messenger:t,env:n,fetchFunction:fetch.bind(globalThis)}),memStateKey:null,persistedStateKey:null}}}}},{package:"$root$",file:"app/scripts/controller-init/claims/claims-service-init.ts"}],[340,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getAccountsBySnapId=void 0;n.getAccountsBySnapId=async(e,t)=>{const n=await e();return await n.getAccountsBySnapId(t)}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/utils.ts"}],[341,{"../keyring-snaps-permissions":337},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isBlockedUrl=void 0;var r=e("../keyring-snaps-permissions");n.isBlockedUrl=async(e,t,n)=>{try{return!(0,r.isProtocolAllowed)(e)||(await t(),n(e).result)}catch(e){return console.error("Invalid URL passed into snap-keyring:",e),!1}}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/utils/isBlockedUrl.ts"}],[342,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.showSuccess=n.showError=void 0;const r=e=>({name:"SnapAuthorshipHeader",key:"snapHeader",properties:{snapId:e}});n.showError=(e,t,n,a)=>e.call("ApprovalController:showError",{header:[r(t)],title:n.title,icon:n.icon,error:{key:"snapAccountErrorMessage",name:"SnapAccountErrorMessage",properties:a}});n.showSuccess=(e,t,n,a)=>e.call("ApprovalController:showSuccess",{header:[r(t)],title:n.title,icon:n.icon,message:{key:"snapAccountSuccessMessage",name:"SnapAccountSuccessMessage",properties:a}})}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/utils/showResult.ts"}],[343,{loglevel:4909},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.tryPostMessage=function(e,t,n){const r={data:{method:t,params:n}};try{return e.postMessage(r),!0}catch(e){return a.default.error("MetaMask - Failed to message to port",e,r),!1}};var r,a=(r=e("loglevel"))&&r.__esModule?r:{default:r}}}},{package:"$root$",file:"app/scripts/lib/start-up-errors/start-up-errors.ts"}],[344,{"../../../../shared/constants/metametrics":5853,"../../../../shared/constants/start-up-errors":5869,"../../../../shared/constants/state-corruption":5870,"../start-up-errors/start-up-errors":343,"../stores/persistence-manager":351,"./track-vault-corruption":345,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.CorruptionHandler=void 0,n.hasVault=d;var r=e("@metamask/utils"),a=e("../../../../shared/constants/state-corruption"),i=e("../stores/persistence-manager"),s=e("../start-up-errors/start-up-errors"),o=e("../../../../shared/constants/start-up-errors"),c=e("../../../../shared/constants/metametrics"),l=e("./track-vault-corruption");function u(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){if((0,r.isObject)(e)&&(0,r.hasProperty)(e,"KeyringController")){const t=e.KeyringController;if((0,r.isObject)(t)&&(0,r.hasProperty)(t,"vault"))return Boolean(t.vault)}return!1}n.CorruptionHandler=class{constructor(){u(this,"connectedPorts",new Set)}async handleStateCorruptionError({port:e,error:t,database:n,repairCallback:u}){const{connectedPorts:p}=this,m=await async function(e,t){let n=(0,r.isObject)(e)&&(0,r.hasProperty)(e,"backup")&&null!==e.backup?e.backup:null;if(!n)try{n=await t.getBackup()??null}catch{n=null}return n}(t,n),h=function(e){if((0,r.isObject)(e)&&(0,r.hasProperty)(e,"PreferencesController")){const t=e.PreferencesController;if((0,r.isObject)(t)&&(0,r.hasProperty)(t,"currentLocale")&&"string"==typeof t.currentLocale)return t.currentLocale}return null}(m),f=Boolean(d(m)),g=function(e){return e instanceof i.PersistenceError&&e.cause instanceof Error&&e.cause.message?e.cause.message:null}(t);if(!(0,s.tryPostMessage)(e,a.METHOD_DISPLAY_STATE_CORRUPTION_ERROR,{error:{message:t.message,name:t.name,stack:t.stack,causeMessage:g},currentLocale:h,hasBackup:f}))return Promise.resolve();const y=function(e){return e instanceof i.PersistenceError?e.corruptionType:a.VaultCorruptionType.Unknown}(t);return(0,l.trackVaultCorruptionEvent)(m,c.MetaMetricsEventName.VaultCorruptionRestoreWalletScreenViewed,y),new Promise((t,n)=>{p.add(e),e.onDisconnect.addListener(function(){p.delete(e),t()}),e.onMessage.addListener(async function e(r){var i;if((null==r||null===(i=r.data)||void 0===i?void 0:i.method)===a.METHOD_REPAIR_DATABASE){p.forEach(t=>t.onMessage.removeListener(e)),(0,l.trackVaultCorruptionEvent)(m,c.MetaMetricsEventName.VaultCorruptionRestoreWalletButtonPressed,y);try{await async function(e){return await navigator.locks.request("repairDatabase",{ifAvailable:!0},async function(t){return null!==t&&(await e(),!0)})}(async function(){try{await u(m)}finally{p.forEach(e=>{(0,s.tryPostMessage)(e,o.RELOAD_WINDOW)})}}),t()}catch(e){n(e)}}})})}}}}},{package:"$root$",file:"app/scripts/lib/state-corruption/state-corruption-recovery.ts"}],[346,{lodash:4901},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.sanitizePatches=function(e){return e.filter(e=>{if(a.includes(e.path[0]))return!1;for(const t of i)if(s(e,t))return!1;return!0})},n.sanitizeUIState=function(e){const t={...e};for(const e of a)delete t[e];return function(e){const t=e.snaps;if(!t)return;e.snaps=Object.values(t).reduce((e,t)=>(e[t.id]=function(e){const t={...e};return delete t.sourceCode,delete t.auxiliaryFiles,t}(t),e),{})}(t),function(e){const t=e.srpSessionData;if(!t)return;e.srpSessionData=Object.entries(t).reduce((e,[t,n])=>{const r={...n.token};return delete r.accessToken,e[t]={...n,token:r},e},{})}(t),function(e){const t=e.nodeAuthTokens;t&&(e.nodeAuthTokens=t.map(e=>{const t={...e};return delete t.authToken,t}));const n=e.socialBackupsMetadata;n&&(e.socialBackupsMetadata=n.map(e=>{const t={...e};return delete t.hash,t}))}(t),t};var r=e("lodash");const a=["encryptionKey","encryptionSalt","vault","c2DomainBlocklistLastFetched","hotlistLastFetched","phishingLists","stalelistLastFetched","whitelist","whitelistPaths","accessToken","encryptedKeyringEncryptionKey","encryptedSeedlessEncryptionKey","metadataAccessToken","refreshToken","revokeToken","vaultEncryptionKey","vaultEncryptionSalt","snapStates","unencryptedSnapStates"],i=[["nodeAuthTokens",!0,"authToken"],["snaps",!0,"auxiliaryFiles"],["snaps",!0,"sourceCode"],["socialBackupsMetadata",!0,"hash"],["srpSessionData",!0,"token","accessToken"]];function s(e,t){for(let n=0;n<t.length;n++){const a=t[n],i=n===t.length-1,s=n===e.path.length-1;if(!(e.path[n]===a||!0===a&&e.path[n]!==undefined))return!1;if(i)return!0;if(s&&!c(e.value))return!1;if(s){const a=t.slice(n+1);return e.value=(0,r.cloneDeep)(e.value),o(e.value,a),!1}}return!1}function o(e,t,n=0){const r=t[n],a=n===t.length-1;if(a&&!0!==r&&r in e&&!Array.isArray(e))return void delete e[r];if(a)return;let i=[];!0===r?i=Object.values(e):Array.isArray(e)||(i=[e[r]]);const s=i.filter(c);for(const e of s)o(e,t,n+1)}function c(e){return"object"==typeof e&&null!==e&&e!==undefined}}}},{package:"$root$",file:"app/scripts/lib/state-utils.ts"}],[347,{"@metamask/storage-service":3027,"webextension-polyfill":5825},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.BrowserStorageAdapter=void 0;var r,a=(r=e("webextension-polyfill"))&&r.__esModule?r:{default:r},i=e("@metamask/storage-service");function s(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var c=new WeakSet;function l(e,t){return`${i.STORAGE_KEY_PREFIX}${e}:${t}`}n.BrowserStorageAdapter=class{constructor(){s(this,c)}async getItem(e,t){try{const n=o(c,this,l).call(this,e,t),r=await a.default.storage.local.get(n);return n in r?{result:r[n]}:{}}catch(n){return console.error(`StorageService: Failed to get item: ${e}:${t}`,n),{error:n}}}async setItem(e,t,n){try{const r=o(c,this,l).call(this,e,t);await a.default.storage.local.set({[r]:n})}catch(n){throw console.error(`StorageService: Failed to set item: ${e}:${t}`,n),n}}async removeItem(e,t){try{const n=o(c,this,l).call(this,e,t);await a.default.storage.local.remove(n)}catch(n){throw console.error(`StorageService: Failed to remove item: ${e}:${t}`,n),n}}async getAllKeys(e){try{const t=`${i.STORAGE_KEY_PREFIX}${e}:`,n=await a.default.storage.local.get(null);return Object.keys(n).filter(e=>e.startsWith(t)).map(e=>e.slice(t.length))}catch(t){throw console.error(`StorageService: Failed to get keys for ${e}`,t),t}}async clear(e){try{const t=(await this.getAllKeys(e)).map(t=>o(c,this,l).call(this,e,t));t.length>0&&await a.default.storage.local.remove(t)}catch(t){throw console.error(`StorageService: Failed to clear namespace ${e}`,t),t}}}}}},{package:"$root$",file:"app/scripts/lib/stores/browser-storage-adapter.ts"}],[35,{"./claims-controller-init":33,"./claims-service-init":34},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"ClaimsControllerInit",{enumerable:!0,get:function(){return r.ClaimsControllerInit}}),Object.defineProperty(n,"ClaimsServiceInit",{enumerable:!0,get:function(){return a.ClaimsServiceInit}});var r=e("./claims-controller-init"),a=e("./claims-service-init")}}},{package:"$root$",file:"app/scripts/controller-init/claims/index.ts"}],[354,{"../../../../../shared/lib/delegation":5927,"../../../../../shared/lib/delegation/delegation":5924,"@metamask/transaction-controller":3095,"@metamask/utils":3217,"bignumber.js":4025},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.enforceSimulations=async function({messenger:e,transactionMeta:t,useRealSignature:n=!1}){c("Enforcing simulations",{transactionMeta:t,useRealSignature:n});const{chainId:i,simulationData:d={tokenBalanceChanges:[]},txParams:p}=t,m=p.from,h=(0,a.hexToNumber)(i),f=(0,s.getDeleGatorEnvironment)(h),g=f.DelegationManager,y=function(e,t){const n=e.call("AppStateController:getState"),r=n.enforcedSimulationsSlippage;return n.enforcedSimulationsSlippageForTransactions[t]??r}(e,t.id),v=function({accountAddress:e,environment:t,simulationData:n,slippage:a}){const i=function(e,t,n,a){const i=(0,s.createCaveatBuilder)(t),{nativeBalanceChange:o,tokenBalanceChanges:l=[]}=n;if(o){const{difference:t,isDecrease:n}=o,r=u(t,a,n);c("Caveat - Native Balance Change",{enforceDecrease:n,recipient:e,delta:BigInt(t),slippage:a,deltaWithSlippage:r}),i.addCaveat("nativeBalanceChange",n,e,r)}for(const t of l){const{difference:n,isDecrease:s,address:o,standard:l,id:d}=t,p=BigInt(n),m=u(n,a,s),h=d?BigInt(d):0n;switch(c("Caveat - Token Balance Change",{enforceDecrease:s,token:o,recipient:e,delta:p,slippage:a,deltaWithSlippage:m}),l){case r.SimulationTokenStandard.erc20:i.addCaveat("erc20BalanceChange",s,o,e,m);break;case r.SimulationTokenStandard.erc721:i.addCaveat("erc721BalanceChange",s,o,e,p);break;case r.SimulationTokenStandard.erc1155:i.addCaveat("erc1155BalanceChange",s,o,e,h,p);break;default:c("Unsupported token standard",l)}}return i.build()}(e,t,n,a);c("Caveats",i);const o=(0,s.createDelegation)({from:e,to:e,caveats:i});return o}({accountAddress:m,environment:f,simulationData:d,slippage:y});c("Delegation",v);let b=l;n&&(c("Signing delegation"),b=await e.call("DelegationController:signDelegation",{chainId:i,delegation:v}));c("Delegation signature",b);const T=function({transaction:e,delegation:t}){const n=[[t]],r=[s.SINGLE_DEFAULT_MODE],a=[[{target:e.to,callData:e.data??"0x",value:e.value?BigInt(e.value):0n}]];return(0,o.encodeRedeemDelegations)({delegations:n,modes:r,executions:a})}({transaction:p,delegation:{...v,signature:b}});return c("Data",T),{updateTransaction:e=>{e.txParams.data=T,e.txParams.to=g,e.txParams.value="0x0"}}};var r=e("@metamask/transaction-controller"),a=e("@metamask/utils"),i=e("bignumber.js"),s=e("../../../../../shared/lib/delegation"),o=e("../../../../../shared/lib/delegation/delegation");const c=(0,a.createProjectLogger)("enforced-simulations"),l="0x2261a7810ed3e9cde160895909e138e2f68adb2da86fcf98ea0840701df107721fb369ab9b52550ea98832c09f8185284aca4c94bd345e867a4f4461868dd7751b";function u(e,t,n){const r=new i.BigNumber(e),a=(100+(n?t:-t))/100;return BigInt(r.mul(a).toFixed(0))}}}},{package:"$root$",file:"app/scripts/lib/transaction/containers/enforced-simulations.ts"}],[355,{"./enforced-simulations":354,"@metamask/transaction-controller":3095,"@metamask/utils":3217,lodash:4901},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.applyTransactionContainers=c,n.applyTransactionContainersExisting=async function({containerTypes:e,transactionId:t,messenger:n,updateEditableParams:r}){const i=(await n.call("TransactionController:getState")).transactions.find(e=>e.id===t);if(!i)throw new Error(`Transaction with ID ${t} not found.`);const{updateTransaction:s}=await c({isApproved:!1,messenger:n,transactionMeta:i,types:e}),o=(0,a.cloneDeep)(i);s(o),r(t,{containerTypes:e,data:o.txParams.data,gas:o.txParams.gas,to:o.txParams.to,value:o.txParams.value})};var r=e("@metamask/transaction-controller"),a=e("lodash"),i=e("@metamask/utils"),s=e("./enforced-simulations");const o=(0,i.createProjectLogger)("transaction-containers");async function c({isApproved:e,messenger:t,transactionMeta:n,types:i}){const{txParamsOriginal:c}=n,l=(0,a.cloneDeep)(n);if(c&&(l.txParams=(0,a.cloneDeep)(c)),i.includes(r.TransactionContainerType.EnforcedSimulations)){const{updateTransaction:n}=await(0,s.enforceSimulations)({messenger:t,transactionMeta:l,useRealSignature:e});n(l)}let u;if(!e){const{gas:e}=await t.call("TransactionController:estimateGas",l.txParams,l.networkClientId,{ignoreDelegationSignatures:!0});o("Estimated gas",e),u=e}return{updateTransaction:e=>{e.containerTypes=i,e.txParams=(0,a.cloneDeep)(l.txParams),u&&(e.txParams.gas=u)}}}}}},{package:"$root$",file:"app/scripts/lib/transaction/containers/util.ts"}],[356,{"../../../../../shared/lib/four-byte":5934,"@ethersproject/abi":754,"@metamask/utils":3217,"ethereumjs-util":4391},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.decodeTransactionDataWithFourByte=async function(e){const t=e.slice(0,10),n=await(0,s.getMethodFrom4Byte)(t);if(!n)return undefined;const i=n.split("(")[0],d=function(e){let t=e.slice(e.indexOf("(")+1,-1);const n=[];for(;t.includes("(");){const e=u(t);if(!e)break;n.push(e.value),t=`${t.slice(0,e.start)}${n.length-1}#${t.slice(e.end+1)}`}return l(t,n)}(n);o("Generated inputs",d);const p=(0,r.addHexPrefix)(e.slice(10)),m=a.Interface.getAbiCoder().decode(d,p),h=d.map((e,t)=>c(e,t,m));return{name:i,params:h}};var r=e("ethereumjs-util"),a=e("@ethersproject/abi"),i=e("@metamask/utils"),s=e("../../../../../shared/lib/four-byte");const o=(0,i.createProjectLogger)("four-byte");function c(e,t,n){var r;const a=n[t],{type:i,name:s}=e;let o=null===(r=e.components)||void 0===r?void 0:r.map((e,t)=>c(e,t,a));if(i.endsWith("[]")){const t=i.slice(0,-2);o=a.map((n,r)=>{const i=`Item ${r+1}`;return c({...e,name:i,type:t},r,a)})}return{name:s,type:i,value:a,children:o}}function l(e,t){return e.split(",").map(e=>{const n=e.split("#"),r=n.length>1?parseInt(n[0],10):undefined;return{type:r===undefined?e:`tuple${n[1]??""}`,components:r===undefined?undefined:l(t[r],t)}})}function u(e){let t=-1;for(let n=0;n<e.length;n++)if("("===e[n])t=n;else if(")"===e[n]&&-1!==t)return{start:t,end:n,value:e.slice(t+1,n)};return undefined}}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/four-byte.ts"}],[357,{"ethereumjs-util":4391},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getContractProxyAddress=async function(e,t){const n=(await Promise.all(a.map(n=>t.request({method:"eth_getStorageAt",params:[e,n,"latest"]})))).find(e=>(0,r.stripHexPrefix)(e)!==i);return n&&(0,r.addHexPrefix)(n.slice(26))};var r=e("ethereumjs-util");const a=["0x7050c9e0f4ca769c69bd3a8ef740bc37934f8e2c036e5a723fd8ee048ed3f8c3","0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc"],i="0".padEnd(64,"0")}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/proxy.ts"}],[358,{"@ethersproject/abi":754,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.decodeTransactionDataWithSourcify=async function(e,t,n){var o,c;const l=await async function(e,t){var n;const r=await async function(e,t){const n=parseInt(t,16),r=await fetch(`https://sourcify.dev/server/files/any/${n}/${e}`);if(!r.ok)throw new Error("Failed to fetch Sourcify files");return r.json()}(e,t),a=null===(n=r.files)||void 0===n?void 0:n.find(e=>e.name.includes("metadata.json"));if(!a)throw new Error("Metadata not found");return JSON.parse(a.content)}(t,n);a("Retrieved Sourcify metadata",{contractAddress:t,chainId:n,metadata:l});const{abi:u}=l.output,d=new r.Interface(u),p=e.slice(0,10);let m;try{m=d.getFunction(p)}catch(e){}if(!m)return a("Failed to find function in ABI",p,u),undefined;const{name:h,inputs:f}=m,g=s(h,f),y=null===(o=l.output.userdoc)||void 0===o?void 0:o.methods[g],v=null===(c=l.output.devdoc)||void 0===c?void 0:c.methods[g],b=(null==y?void 0:y.notice)??(null==v?void 0:v.details);a("Extracted NatSpec",{signature:g,userDoc:y,devDoc:v});const T=d.decodeFunctionData(p,e),w=f.map((e,t)=>i(e,t,T,y,v));return{name:h,description:b,params:w}};var r=e("@ethersproject/abi");const a=(0,e("@metamask/utils").createProjectLogger)("sourcify");function i(e,t,n,r,a){var s,o;const{name:c,type:l,components:u}=e,d=(null==r||null===(s=r.params)||void 0===s?void 0:s[c])??(null==a||null===(o=a.params)||void 0===o?void 0:o[c]),p=n[t];let m=null==u?void 0:u.map((e,t)=>i(e,t,p,{},{}));if(l.endsWith("[]")){const t=l.slice(0,-2);m=p.map((n,r)=>{const a=`Item ${r+1}`;return i({...e,name:a,type:t},r,p,{},{})})}return{name:c,description:d,type:l,value:p,children:m}}function s(e,t){return`${e??""}(${t.map(e=>{var t;return null!==(t=e.components)&&void 0!==t&&t.length?`${s(undefined,e.components)}${e.type.endsWith("[]")?"[]":""}`:e.type}).join(",")})`}}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/sourcify.ts"}],[359,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.UNISWAP_ROUTER_COMMANDS=void 0;n.UNISWAP_ROUTER_COMMANDS={0:{name:"V3_SWAP_EXACT_IN",params:[{type:"address",description:"The recipient of the output of the trade",name:"recipient"},{type:"uint256",description:"The amount of input tokens for the trade",name:"amountIn"},{type:"uint256",description:"The minimum amount of output tokens the user wants",name:"amountOutMin"},{type:"bytes",description:"The UniswapV3 encoded path to trade along",name:"path"},{type:"bool",description:"A flag for whether the input tokens should come from the msg.sender (through Permit2) or whether the funds are already in the UniversalRouter",name:"payerIsUser"}]},1:{name:"V3_SWAP_EXACT_OUT",params:[{type:"address",description:"The recipient of the output of the trade",name:"recipient"},{type:"uint256",description:"The amount of output tokens to receive",name:"amountOut"},{type:"uint256",description:"The maximum number of input tokens that should be spent",name:"amountInMax"},{type:"bytes",description:"The UniswapV3 encoded path to trade along",name:"path"},{type:"bool",description:"A flag for whether the input tokens should come from the msg.sender (through Permit2) or whether the funds are already in the UniversalRouter",name:"payerIsUser"}]},2:{name:"PERMIT2_TRANSFER_FROM",params:[{type:"address",description:"The token to fetch from Permit2",name:"token"},{type:"address",description:"The recipient of the tokens fetched",name:"recipient"},{type:"uint256",description:"The amount of token to fetch",name:"amount"}]},3:{name:"PERMIT2_PERMIT_BATCH",params:[{type:"bytes",description:"A PermitBatch struct outlining all of the Permit2 permits to execute.",name:"batch"},{type:"bytes",description:"The signature to provide to Permit2",name:"data"}]},4:{name:"SWEEP",params:[{type:"address",description:"The ERC20 token to sweep (or Constants.ETH for ETH)",name:"token"},{type:"address",description:"The recipient of the sweep",name:"recipient"},{type:"uint256",description:"The minimum required tokens to receive from the sweep",name:"amountMin"}]},5:{name:"TRANSFER",params:[{type:"address",description:"The ERC20 token to transfer (or Constants.ETH for ETH)",name:"token"},{type:"address",description:"The recipient of the transfer",name:"recipient"},{type:"uint256",description:"The amount to transfer",name:"value"}]},6:{name:"PAY_PORTION",params:[{type:"address",description:"The ERC20 token to transfer (or Constants.ETH for ETH)",name:"token"},{type:"address",description:"The recipient of the transfer",name:"recipient"},{type:"uint256",description:"In basis points, the percentage of the contracts balance to transfer",name:"bips"}]},8:{name:"V2_SWAP_EXACT_IN",params:[{type:"address",description:"The recipient of the output of the trade",name:"recipient"},{type:"uint256",description:"The amount of input tokens for the trade",name:"amountIn"},{type:"uint256",description:"The minimum amount of output tokens the user wants",name:"amountOutMin"},{type:"address[]",description:"The UniswapV2 token path to trade along",name:"path"},{type:"bool",description:"A flag for whether the input tokens should come from the msg.sender (through Permit2) or whether the funds are already in the UniversalRouter",name:"payerIsUser"}]},9:{name:"V2_SWAP_EXACT_OUT",params:[{type:"address",description:"The recipient of the output of the trade",name:"recipient"},{type:"uint256",description:"The amount of output tokens to receive",name:"amountOut"},{type:"uint256",description:"The maximum number of input tokens that should be spent",name:"amountInMax"},{type:"address[]",description:"The UniswapV2 token path to trade along",name:"path"},{type:"bool",description:"A flag for whether the input tokens should come from the msg.sender (through Permit2) or whether the funds are already in the UniversalRouter",name:"payerIsUser"}]},10:{name:"PERMIT2_PERMIT",params:[{type:"bytes",description:"A PermitSingle struct outlining the Permit2 permit to execute",name:"permitSingle"},{type:"bytes",description:"The signature to provide to Permit2",name:"signature"}]},11:{name:"WRAP_ETH",params:[{type:"address",description:"The recipient of the WETH",name:"recipient"},{type:"uint256",description:"The amount of ETH to wrap",name:"amountMin"}]},12:{name:"UNWRAP_WETH",params:[{type:"address",description:"The recipient of the ETH",name:"recipient"},{type:"uint256",description:"The minimum required ETH to receive from the unwrapping",name:"amountMin"}]},13:{name:"PERMIT2_TRANSFER_FROM_BATCH",params:[{type:"bytes",description:"An array of AllowanceTransferDetails structs that each describe a Permit2 transfer to perform",name:"batchDetails"}]},16:{name:"SEAPORT",params:[{type:"uint256",description:"The ETH value to forward to the Seaport contract",name:"value"},{type:"bytes",description:"The calldata to use to call the Seaport contract",name:"data"}]},17:{name:"LOOKS_RARE_721",params:[{type:"uint256",description:"The ETH value to forward to the LooksRare contract",name:"value"},{type:"bytes",description:"The calldata to use to call the LooksRare contract",name:"data"},{type:"address",description:"The recipient of the ERC721",name:"recipient"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC721",name:"id"}]},18:{name:"NFTX",params:[{type:"uint256",description:"The ETH value to forward to the NFTX contract",name:"value"},{type:"bytes",description:"The calldata to use to call the NFTX contract",name:"data"}]},19:{name:"CRYPTOPUNKS",params:[{type:"uint256",description:"The PunkID to purchase",name:"punkId"},{type:"address",description:"The recipient for the cryptopunk",name:"recipient"},{type:"uint256",description:"The ETH value to forward to the Cryptopunks contract",name:"value"}]},20:{name:"LOOKS_RARE_1155",params:[{type:"uint256",description:"The ETH value to forward to the LooksRare contract",name:"value"},{type:"bytes",description:"The calldata to use to call the LooksRare contract",name:"data"},{type:"address",description:"The recipient of the ERC1155",name:"recipient"},{type:"address",description:"The ERC1155 token address",name:"token"},{type:"uint256",description:"The ID of the ERC1155",name:"id"},{type:"uint256",description:"The amount of the ERC1155 to transfer",name:"amount"}]},21:{name:"OWNER_CHECK_721",params:[{type:"address",description:"The required owner of the ERC721",name:"owner"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC721",name:"id"}]},22:{name:"OWNER_CHECK_1155",params:[{type:"address",description:"The required owner of the ERC1155",name:"owner"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC1155",name:"id"},{type:"uint256",description:"The minimum required amount of the ERC1155",name:"minBalance"}]},23:{name:"SWEEP_ERC721",params:[{type:"address",description:"The ERC721 token address to transfer",name:"token"},{type:"address",description:"The recipient of the transfer",name:"recipient"},{type:"uint256",description:"The token ID to transfer",name:"id"}]},24:{name:"X2Y2_721",params:[{type:"uint256",description:"The ETH value to forward to the X2Y2 contract",name:"value"},{type:"bytes",description:"The calldata to use to call the X2Y2 contract",name:"data"},{type:"address",description:"The recipient of the ERC721",name:"recipient"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC721",name:"id"}]},25:{name:"SUDOSWAP",params:[{type:"uint256",description:"The ETH value to forward to the Sudoswap contract",name:"value"},{type:"bytes",description:"The calldata to use to call the Sudoswap contract",name:"data"}]},26:{name:"NFT20",params:[{type:"uint256",description:"The ETH value to forward to the NFT20 contract",name:"value"},{type:"bytes",description:"The calldata to use to call the NFT20 contract",name:"data"}]},27:{name:"X2Y2_1155",params:[{type:"uint256",description:"The ETH value to forward to the X2Y2 contract",name:"value"},{type:"bytes",description:"The calldata to use to call the X2Y2 contract",name:"data"},{type:"address",description:"The recipient of the ERC1155",name:"recipient"},{type:"address",description:"The ERC1155 token address",name:"token"},{type:"uint256",description:"The ID of the ERC1155",name:"id"},{type:"uint256",description:"The amount of the ERC1155 to transfer",name:"amount"}]},28:{name:"FOUNDATION",params:[{type:"uint256",description:"The ETH value to forward to the Foundation contract",name:"value"},{type:"bytes",description:"The calldata to use to call the Foundation contract",name:"data"},{type:"address",description:"The recipient of the ERC721",name:"recipient"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC721",name:"id"}]},29:{name:"SWEEP_ERC1155",params:[{type:"address",description:"The ERC1155 token address to sweep",name:"token"},{type:"address",description:"The recipient of the sweep",name:"recipient"},{type:"uint256",description:"The token ID to sweep",name:"id"},{type:"uint256",description:"The minimum required tokens to receive from the sweep",name:"amount"}]}}}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/uniswap-commands.ts"}],[36,{"@metamask/address-book-controller":1290},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AddressBookControllerInit=void 0;var r=e("@metamask/address-book-controller");n.AddressBookControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.AddressBookController({messenger:e,state:t.AddressBookController})})}}},{package:"$root$",file:"app/scripts/controller-init/confirmations/address-book-controller-init.ts"}],[360,{"../../../../../shared/constants/network":5857,"../../../../../shared/modules/decoding":5979,"./uniswap-commands":359,"@ethersproject/abi":754},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.UNISWAP_UNIVERSAL_ROUTER_ADDRESSES=void 0,n.decodeUniswapRouterTransactionData=function({transactionData:e,contractAddress:t,chainId:n}){const i=o[n];if(null==i||!i.map(e=>e.toLowerCase()).includes(t.toLowerCase()))return undefined;const l=new r.Interface(c);let u;try{u=l.parseTransaction({data:e})}catch(e){return undefined}const d=u.args.commands,p=u.args.inputs;return d.slice(2).match(/.{1,2}/gu).map((e,t)=>function(e,t){const n=parseInt(e,16),i=31&n,o=s.UNISWAP_ROUTER_COMMANDS[String(i)];if(!o)return undefined;const c=o.params.map(e=>e.type),l=r.Interface.getAbiCoder().decode(c,t),{name:u}=o,d=o.params.map((e,t)=>{const{name:n,type:r,description:i}=e,s=l[t];return{name:n,type:r,value:"path"===n?(0,a.decodeCommandV3Path)(s):s,description:i}});return{name:u,params:d}}(e,p[t])).filter(e=>e!==undefined)};var r=e("@ethersproject/abi"),a=e("../../../../../shared/modules/decoding"),i=e("../../../../../shared/constants/network"),s=e("./uniswap-commands");const o=n.UNISWAP_UNIVERSAL_ROUTER_ADDRESSES={[i.CHAIN_IDS.ARBITRUM]:["0x4C60051384bd2d3C01bfc845Cf5F4b44bcbE9de5","0xeC8B0F7Ffe3ae75d7FfAb09429e3675bb63503e4","0x5E325eDA8064b456f4781070C0738d849c824258"],[i.CHAIN_IDS.AVALANCHE]:["0x82635AF6146972cD6601161c4472ffe97237D292","0x4Dae2f939ACf50408e13d58534Ff8c2776d45265"],[i.CHAIN_IDS.BASE]:["0xeC8B0F7Ffe3ae75d7FfAb09429e3675bb63503e4","0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD"],[i.CHAIN_IDS.BSC]:["0x5Dc88340E1c5c6366864Ee415d6034cadd1A9897","0xeC8B0F7Ffe3ae75d7FfAb09429e3675bb63503e4","0x4Dae2f939ACf50408e13d58534Ff8c2776d45265"],[i.CHAIN_IDS.MAINNET]:["0xEf1c6E67703c7BD7107eed8303Fbe6EC2554BF6B","0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD"],[i.CHAIN_IDS.OPTIMISM]:["0xb555edF5dcF85f42cEeF1f3630a52A108E55A654","0xeC8B0F7Ffe3ae75d7FfAb09429e3675bb63503e4","0xCb1355ff08Ab38bBCE60111F1bb2B784bE25D7e8"],[i.CHAIN_IDS.POLYGON]:["0x4C60051384bd2d3C01bfc845Cf5F4b44bcbE9de5","0x643770E279d5D0733F21d6DC03A8efbABf3255B4","0xec7BE89e9d109e7e3Fec59c222CF297125FEFda2"],[i.CHAIN_IDS.SEPOLIA]:["0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD"]},c=[{constant:!0,inputs:[{name:"commands",type:"bytes"},{name:"inputs",type:"bytes[]"},{name:"deadline",type:"uint256"}],name:"execute",type:"function"},{constant:!0,inputs:[{name:"commands",type:"bytes"},{name:"inputs",type:"bytes[]"}],name:"execute",type:"function"}]}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/uniswap.ts"}],[361,{"../../../../../shared/types/transaction-decode":6012,"./four-byte":356,"./proxy":357,"./sourcify":358,"./uniswap":360,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.decodeTransactionData=async function({transactionData:e,contractAddress:t,chainId:n,provider:r}){l("Decoding transaction data",{transactionData:e,contractAddress:t,chainId:n});const d=(0,i.decodeUniswapRouterTransactionData)({transactionData:e,contractAddress:t,chainId:n});if(d)return l("Decoded with Uniswap commands",d),{data:u(d),source:a.DecodedTransactionDataSource.Uniswap};const p=await(0,o.getContractProxyAddress)(t,r);p&&l("Retrieved proxy implementation address",p);const m=p??t,h=(0,s.decodeTransactionDataWithSourcify)(e,m,n),f=(0,c.decodeTransactionDataWithFourByte)(e),[g,y]=await Promise.allSettled([h,f]);if("fulfilled"===g.status&&g.value)return l("Decoded data with Sourcify",g.value),{data:u([g.value]),source:a.DecodedTransactionDataSource.Sourcify};if(l("Failed to decode data with Sourcify",g),"fulfilled"===y.status&&y.value)return l("Decoded data with 4Byte",y.value),{data:u([y.value]),source:a.DecodedTransactionDataSource.FourByte};return l("Failed to decode data with 4Byte",y),undefined};var r=e("@metamask/utils"),a=e("../../../../../shared/types/transaction-decode"),i=e("./uniswap"),s=e("./sourcify"),o=e("./proxy"),c=e("./four-byte");const l=(0,r.createProjectLogger)("transaction-decode");function u(e){return e.map(e=>function(e){return{...e,params:e.params.map(e=>d(e))}}(e))}function d(e){var t;return{...e,value:p(e.value),children:null===(t=e.children)||void 0===t?void 0:t.map(e=>d(e))}}function p(e){const t=e._hex;return t?BigInt(t).toString():e}}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/util.ts"}],[362,{"@ethersproject/abi":754,"@metamask/keyring-controller":2316,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ROOT_AUTHORITY=n.PRIMARY_TYPE_DELEGATION=n.ExecutionMode=n.ANY_BENEFICIARY=void 0,n.encodeRedeemDelegations=function(e,t,n){return new i.Interface(u).encodeFunctionData("redeemDelegations",[p(e),t,(r=n,r.map(m))]);var r},n.signDelegation=async function({chainId:e,delegation:t,from:n,messenger:i}){const c={types:d,primaryType:s,domain:{chainId:String((0,r.hexToNumber)(e)),name:o,version:"1",verifyingContract:"0xdb9B1e94B5b69Df7e401DDbedE43491141047dB3"},message:{...t,chainId:(0,r.hexToNumber)(e)}};return await i.call("KeyringController:signTypedMessage",{from:n,data:c},a.SignTypedDataVersion.V4)};var r=e("@metamask/utils"),a=e("@metamask/keyring-controller"),i=e("@ethersproject/abi");n.ExecutionMode=function(e){return e.BATCH_DEFAULT_MODE="0x0100000000000000000000000000000000000000000000000000000000000000",e}({});n.ROOT_AUTHORITY="0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",n.ANY_BENEFICIARY="0x0000000000000000000000000000000000000a11";const s=n.PRIMARY_TYPE_DELEGATION="Delegation",o="DelegationManager",c=[{type:"address",name:"delegate"},{type:"address",name:"delegator"},{type:"bytes32",name:"authority"},{type:"tuple[]",name:"caveats",components:[{type:"address",name:"enforcer"},{type:"bytes",name:"terms"},{type:"bytes",name:"args"}]},{type:"uint256",name:"salt"},{type:"bytes",name:"signature"}],l=[{type:"address",name:"target"},{type:"uint256",name:"value"},{type:"bytes",name:"callData"}],u=[{type:"function",name:"redeemDelegations",inputs:[{name:"_permissionContexts",type:"bytes[]",internalType:"bytes[]"},{name:"_modes",type:"bytes32[]",internalType:"ModeCode[]"},{name:"_executionCallDatas",type:"bytes[]",internalType:"bytes[]"}],outputs:[],stateMutability:"nonpayable"}],d={EIP712Domain:[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}],Caveat:[{name:"enforcer",type:"address"},{name:"terms",type:"bytes"}],Delegation:[{name:"delegate",type:"address"},{name:"delegator",type:"address"},{name:"authority",type:"bytes32"},{name:"caveats",type:"Caveat[]"},{name:"salt",type:"uint256"}]};function p(e){return e.map(e=>{return t=e,i.defaultAbiCoder.encode([i.ParamType.from({components:c,name:"delegations",type:"tuple[]"})],[t]);var t})}function m(e){return i.defaultAbiCoder.encode([i.ParamType.from({components:l,name:"executions",type:"tuple[]"})],[e])}}}},{package:"$root$",file:"app/scripts/lib/transaction/delegation.ts"}],[363,{"../../../../../shared/lib/delegation":5927,"../../../../../shared/lib/delegation/caveatBuilder/exactExecutionBuilder":5918,"../../../../../shared/lib/delegation/caveatBuilder/limitedCallsBuilder":5920,"../../../../../shared/lib/delegation/caveatBuilder/specificActionERC20TransferBatchBuilder":5923,"../../../../../shared/lib/delegation/delegation":5924,"../../../../../shared/lib/eip7702-support-utils":5929,"../transaction-relay":367,"../util":368,"@ethersproject/abi":754,"@metamask/controller-utils":1494,"@metamask/metamask-eth-abis":2376,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.Delegation7702PublishHook=void 0;var r=e("@ethersproject/abi"),a=e("@metamask/metamask-eth-abis"),i=e("@metamask/utils"),s=e("@metamask/controller-utils"),o=e("../../../../../shared/lib/delegation"),c=e("../../../../../shared/lib/eip7702-support-utils"),l=e("../../../../../shared/lib/delegation/caveatBuilder/exactExecutionBuilder"),u=e("../../../../../shared/lib/delegation/caveatBuilder/limitedCallsBuilder"),d=e("../../../../../shared/lib/delegation/caveatBuilder/specificActionERC20TransferBatchBuilder"),p=e("../../../../../shared/lib/delegation/delegation"),m=e("../transaction-relay"),h=e("../util");function f(e,t,n){g(e,t),t.set(e,n)}function g(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function y(e,t){return e.get(b(e,t))}function v(e,t,n){return e.set(b(e,t),n),n}function b(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const T={transactionHash:undefined},w=(0,i.createProjectLogger)("delegation-7702-publish-hook");var k=new WeakMap,_=new WeakMap,P=new WeakMap,E=new WeakSet;async function S(e,t){try{return await b(E,this,A).call(this,e,t)}catch(e){throw w("Error",e),e}}async function A(e,t){const{chainId:n,gasFeeTokens:r,selectedGasFeeToken:a,txParams:i}=e,{from:s}=i,l=await y(k,this).call(this,{address:s,chainIds:[n]}),u=(0,c.findAtomicBatchSupportForChain)(l,n),{isSupported:d,delegationAddress:h,upgradeContractAddress:f}=(0,c.checkEip7702Support)(u);if(!d)return w("Skipping as EIP-7702 is not supported",{from:s,chainId:n}),T;const g=e.isGasFeeIncluded,v=Boolean(e.isGasFeeSponsored);if(!(a&&null!=r&&r.length||g||v))return w("Skipping as no selected gas fee token"),T;const _=g||v?undefined:null==r?void 0:r.find(e=>e.tokenAddress.toLowerCase()===(null==a?void 0:a.toLowerCase()));if(!_&&!g&&!v)throw new Error("Selected gas fee token not found");const P=(0,o.getDeleGatorEnvironment)(parseInt(e.chainId,16)),S=P.DelegationManager,A=!g&&!e.isGasFeeSponsored;if(A&&(!_||_===undefined))throw new Error("Gas fee token not found");const O=await b(E,this,C).call(this,P,e,_,A),j=[A?o.BATCH_DEFAULT_MODE:o.SINGLE_DEFAULT_MODE],x=b(E,this,M).call(this,e,_,A),R={chainId:n,data:(0,p.encodeRedeemDelegations)({delegations:O,modes:j,executions:x}),to:S,metadata:{txType:e.type}};h||(R.authorizationList=await b(E,this,I).call(this,e,f??undefined)),w("Relay request",R);const{uuid:D}=await(0,m.submitRelayTransaction)(R),{transactionHash:F,status:N}=await(0,m.waitForRelayResult)({chainId:n,uuid:D,interval:1e3});if(N!==m.RelayStatus.Success)throw new Error(`Transaction relay error - ${N}`);return{transactionHash:F}}async function C(e,t,n,r){const a=b(E,this,O).call(this,e,t,n,r);w("Signing delegation");const i=await y(_,this).call("DelegationController:signDelegation",{chainId:t.chainId,delegation:a});w("Delegation signature",i);return[[{...a,signature:i}]]}function M(e,t,n){const{txParams:r}=e,{data:a,to:i,value:s}=r,o=b(E,this,D).call(this,a),c={target:i,value:BigInt(s??"0x0"),callData:o};if(!n)return[[c]];if(!t)throw new Error("Selected gas fee token not found");return[[c,{target:t.tokenAddress,value:BigInt("0x0"),callData:b(E,this,x).call(this,t.recipient,t.amount)}]]}function O(e,t,n,r){const a=b(E,this,j).call(this,e,t,n,r);w("Caveats",a);const i=(0,o.createDelegation)({from:t.txParams.from,to:p.ANY_BENEFICIARY,caveats:a});return w("Delegation",i),i}function j(e,t,n,r){const a=(0,o.createCaveatBuilder)(e),{txParams:i}=t,{to:s,value:c,data:p}=i,m=b(E,this,D).call(this,p);if(r&&n!==undefined){const{tokenAddress:e,recipient:t,amount:r}=n;s!==undefined&&a.addCaveat(d.specificActionERC20TransferBatch,e,t,r,s,c??"0x0",m)}else s!==undefined&&a.addCaveat(l.exactExecution,s,c??"0x0",m);return a.addCaveat(u.limitedCalls,1),a.build()}async function I(e,t){const{chainId:n,txParams:r,networkClientId:a}=e,{from:i,nonce:s}=r,o=await y(P,this).call(this,i,a),c=s??o;if(w("Including authorization as not upgraded"),!t)throw new Error("Upgrade contract address not found");const l=await y(_,this).call("KeyringController:signEip7702Authorization",{chainId:parseInt(n,16),contractAddress:t,from:i,nonce:parseInt(c,16)}),{r:u,s:d,yParity:p}=b(E,this,R).call(this,l);return w("Authorization signature",{authorizationSignature:l,r:u,s:d,yParity:p}),[{address:t,chainId:n,nonce:c,r:u,s:d,yParity:p}]}function x(e,t){return new r.Interface(a.abiERC20).encodeFunctionData("transfer",[e,t])}function R(e){const t=(0,h.stripSingleLeadingZero)(e.slice(0,66)),n=(0,h.stripSingleLeadingZero)((0,i.add0x)(e.slice(66,130))),r=parseInt(e.slice(130,132),16);return{r:t,s:n,yParity:(0,s.toHex)(r-27==0?0:1)}}function D(e){if("string"!=typeof e||0===e.length)return"0x";const t="0x"===e.slice(0,2).toLowerCase(),n=e.toLowerCase(),r=t?`0x${n.slice(2)}`:`0x${n}`,a=r.slice(2);return 0===a.length?"0x":a.length%2!=0?b(E,this,D).call(this,`0x0${a}`):r}n.Delegation7702PublishHook=class{constructor({isAtomicBatchSupported:e,messenger:t,getNextNonce:n}){var r,a;g(r=this,a=E),a.add(r),f(this,k,void 0),f(this,_,void 0),f(this,P,void 0),v(k,this,e),v(_,this,t),v(P,this,n)}getHook(){return b(E,this,S).bind(this)}}}}},{package:"$root$",file:"app/scripts/lib/transaction/hooks/delegation-7702-publish.ts"}],[364,{"../containers/util":355,"@metamask/controller-utils":1494,"@metamask/transaction-controller":3095,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.EnforceSimulationHook=void 0;e("@metamask/transaction-controller");var r=e("@metamask/utils");e("@metamask/controller-utils"),e("../containers/util");function a(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t){return e.get(s(e,t))}function s(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const o=(0,r.createProjectLogger)("enforce-simulation-hook");var c=new WeakMap,l=new WeakSet;async function u(e,t){const{transactionMeta:n}=t,{isFinal:r}=e,{containerTypes:a,delegationAddress:s,id:l,origin:u,simulationData:d,txParamsOriginal:p}=n,m=i(c,this).call("AppStateController:getState");(null==m?void 0:m.enableEnforcedSimulationsForTransactions[l])??(null==m||m.enableEnforcedSimulations);return o("Skipping as enforced simulations are disabled"),{skipSimulation:!1}}n.EnforceSimulationHook=class{constructor({messenger:e}){var t,n;a(t=this,n=l),n.add(t),function(e,t,n){a(e,t),t.set(e,n)}(this,c,void 0),function(e,t,n){e.set(s(e,t),n)}(c,this,e)}getAfterSimulateHook(){return s(l,this,u).bind(this,{})}getBeforeSignHook(){return s(l,this,u).bind(this,{isFinal:!0})}}}}},{package:"$root$",file:"app/scripts/lib/transaction/hooks/enforce-simulation-hook.ts"}],[365,{"../../../../shared/constants/app":5837,"../../../../shared/constants/gas":5846,"../../../../shared/constants/metametrics":5853,"../../../../shared/constants/transaction":5876,"../../../../shared/lib/transactions-controller-utils":5962,"../../../../shared/lib/trust-signals":5966,"../../../../shared/modules/Numeric":5969,"../../../../shared/modules/conversion.utils":5976,"../../../../shared/modules/gas.utils":5983,"../../../../shared/modules/metametrics":5986,"../../../../shared/modules/transaction.utils":6008,"../../../../ui/helpers/utils/metrics":7147,"../snap-keyring/metrics":338,"../util":374,"@metamask/transaction-controller":3095,"@metamask/utils":3217,"bignumber.js":4025,"ethereumjs-util":4391},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.handleTransactionSubmitted=n.handleTransactionRejected=n.handleTransactionFailed=n.handleTransactionDropped=n.handleTransactionConfirmed=n.handleTransactionApproved=n.handleTransactionAdded=n.handlePostTransactionBalanceUpdate=n.createTransactionEventFragmentWithTxId=n.METRICS_STATUS_FAILED=void 0;var r=e("bignumber.js"),a=e("ethereumjs-util"),i=e("@metamask/transaction-controller"),s=e("@metamask/utils"),o=e("../../../../shared/constants/app"),c=e("../../../../shared/constants/gas"),l=e("../../../../shared/constants/metametrics"),u=e("../../../../shared/constants/transaction"),d=e("../../../../shared/lib/transactions-controller-utils"),p=e("../../../../shared/modules/conversion.utils"),m=e("../../../../shared/modules/metametrics"),h=e("../../../../shared/modules/transaction.utils"),f=e("../../../../ui/helpers/utils/metrics"),g=e("../snap-keyring/metrics"),y=e("../../../../shared/modules/gas.utils"),v=e("../../../../shared/modules/Numeric"),b=e("../util"),T=e("../../../../shared/lib/trust-signals");const w=(0,s.createProjectLogger)("transaction-metrics"),k=n.METRICS_STATUS_FAILED="failed on-chain",_=[i.TransactionType.bridge,i.TransactionType.bridgeApproval,i.TransactionType.contractInteraction,i.TransactionType.tokenMethodApprove,i.TransactionType.tokenMethodIncreaseAllowance,i.TransactionType.tokenMethodSafeTransferFrom,i.TransactionType.tokenMethodSetApprovalForAll,i.TransactionType.tokenMethodTransfer,i.TransactionType.tokenMethodTransferFrom,i.TransactionType.swap,i.TransactionType.swapAndSend,i.TransactionType.swapApproval];var P=function(e){return e.swap="mm_swap",e.bridge="mm_bridge",e}(P||{});n.handleTransactionAdded=async(e,t)=>{if(!t.transactionMeta)return;const{properties:n,sensitiveProperties:r}=await C({transactionEventPayload:t,transactionMetricsRequest:e});E({eventName:u.TransactionMetaMetricsEvent.added,transactionEventPayload:t,transactionMetricsRequest:e,payload:{properties:n,sensitiveProperties:r}})};n.handleTransactionApproved=async(e,t)=>{t.transactionMeta&&await S({eventName:u.TransactionMetaMetricsEvent.approved,transactionEventPayload:t,transactionMetricsRequest:e})};n.handleTransactionFailed=async(e,t)=>{if(!t.transactionMeta)return;const n={};t.error&&(n.error=t.error),await S({eventName:u.TransactionMetaMetricsEvent.finalized,extraParams:n,transactionEventPayload:t,transactionMetricsRequest:e})};n.handleTransactionConfirmed=async(e,t)=>{if(0===Object.keys(t).length)return;const n={},r={...t},{txReceipt:a}=r;n.gas_used=null==a?void 0:a.gasUsed,n.block_number=(null==a?void 0:a.blockNumber)&&(0,p.hexToDecimal)(a.blockNumber);const{submittedTime:i,blockTimestamp:s}=r;i&&(n.completion_time=function(e){return Math.round((Date.now()-e)/1e3).toString()}(i)),i&&s&&(n.completion_time_onchain=function(e,t){const n=2,r=Number((0,p.hexToDecimal)(t))-e/1e3;return(Math.round(r*10**n)/10**n).toString()}(i,s)),"0x0"===(null==a?void 0:a.status)&&(n.status=k),await S({eventName:u.TransactionMetaMetricsEvent.finalized,extraParams:n,transactionEventPayload:{actionId:r.actionId,transactionMeta:r},transactionMetricsRequest:e})};n.handleTransactionDropped=async(e,t)=>{if(!t.transactionMeta)return;await S({eventName:u.TransactionMetaMetricsEvent.finalized,extraParams:{dropped:!0},transactionEventPayload:t,transactionMetricsRequest:e})};n.handleTransactionRejected=async(e,t)=>{t.transactionMeta&&await S({eventName:u.TransactionMetaMetricsEvent.rejected,transactionEventPayload:t,transactionMetricsRequest:e})};n.handleTransactionSubmitted=async(e,t)=>{if(!t.transactionMeta)return;const{properties:n,sensitiveProperties:r}=await C({transactionEventPayload:t,transactionMetricsRequest:e});E({eventName:u.TransactionMetaMetricsEvent.submitted,transactionEventPayload:t,transactionMetricsRequest:e,payload:{properties:n,sensitiveProperties:r}})};n.createTransactionEventFragmentWithTxId=async(e,{transactionId:t,actionId:n})=>{const r={...e.getTransaction(t),actionId:n},{properties:a,sensitiveProperties:i}=await C({transactionEventPayload:{transactionMeta:r},transactionMetricsRequest:e});E({eventName:u.TransactionMetaMetricsEvent.approved,transactionEventPayload:{actionId:r.actionId,transactionMeta:r},transactionMetricsRequest:e,payload:{properties:a,sensitiveProperties:i}})};function E({eventName:e,transactionEventPayload:{transactionMeta:t,actionId:n},transactionMetricsRequest:r,payload:a}){if(function(e,t,n){const r=A(t,n.id);return void 0!==e(r)}(r.getEventFragmentById,e,t)&&e!==u.TransactionMetaMetricsEvent.submitted)return;const i=A(e,t.id);switch(e){case u.TransactionMetaMetricsEvent.added:r.createEventFragment({category:l.MetaMetricsEventCategory.Transactions,initialEvent:u.TransactionMetaMetricsEvent.added,successEvent:u.TransactionMetaMetricsEvent.approved,failureEvent:u.TransactionMetaMetricsEvent.rejected,properties:a.properties,sensitiveProperties:a.sensitiveProperties,actionId:n,uniqueIdentifier:i,persist:!0});break;case u.TransactionMetaMetricsEvent.approved:case u.TransactionMetaMetricsEvent.rejected:r.createEventFragment({category:l.MetaMetricsEventCategory.Transactions,successEvent:u.TransactionMetaMetricsEvent.approved,failureEvent:u.TransactionMetaMetricsEvent.rejected,properties:a.properties,sensitiveProperties:a.sensitiveProperties,actionId:n,uniqueIdentifier:i,persist:!0});break;case u.TransactionMetaMetricsEvent.submitted:r.createEventFragment({category:l.MetaMetricsEventCategory.Transactions,initialEvent:u.TransactionMetaMetricsEvent.submitted,successEvent:u.TransactionMetaMetricsEvent.finalized,properties:a.properties,sensitiveProperties:a.sensitiveProperties,actionId:n,uniqueIdentifier:i,persist:!0});break;case u.TransactionMetaMetricsEvent.finalized:r.createEventFragment({category:l.MetaMetricsEventCategory.Transactions,successEvent:u.TransactionMetaMetricsEvent.finalized,properties:a.properties,sensitiveProperties:a.sensitiveProperties,actionId:n,uniqueIdentifier:i,persist:!0})}}async function S({eventName:e,transactionEventPayload:t,transactionMetricsRequest:n,extraParams:r={}}){const{properties:a,sensitiveProperties:i}=await C({transactionEventPayload:t,transactionMetricsRequest:n,extraParams:r});E({eventName:e,transactionEventPayload:t,transactionMetricsRequest:n,payload:{properties:a,sensitiveProperties:i}}),function({eventName:e,transactionEventPayload:{transactionMeta:t},transactionMetricsRequest:n,payload:r}){const a=A(e,t.id);switch(e){case u.TransactionMetaMetricsEvent.approved:case u.TransactionMetaMetricsEvent.rejected:case u.TransactionMetaMetricsEvent.finalized:n.updateEventFragment(a,{properties:r.properties,sensitiveProperties:r.sensitiveProperties})}}({eventName:e,transactionEventPayload:t,transactionMetricsRequest:n,payload:{properties:a,sensitiveProperties:i}}),function({eventName:e,transactionMetricsRequest:t,transactionEventPayload:{transactionMeta:n}}){const r=A(e,n.id);switch(e){case u.TransactionMetaMetricsEvent.approved:case u.TransactionMetaMetricsEvent.finalized:t.finalizeEventFragment(r);break;case u.TransactionMetaMetricsEvent.rejected:t.finalizeEventFragment(r,{abandoned:!0})}}({eventName:e,transactionEventPayload:t,transactionMetricsRequest:n})}function A(e,t){return`transaction-${e===u.TransactionMetaMetricsEvent.finalized||e===u.TransactionMetaMetricsEvent.submitted?"submitted":"added"}-${t}`}async function C({transactionEventPayload:{transactionMeta:e},transactionMetricsRequest:t,extraParams:n={}}){var k;const{type:P,time:E,status:S,chainId:A,origin:C,txParams:{gasPrice:O,gas:j,maxFeePerGas:I,maxPriorityFeePerGas:x,estimateSuggested:R,estimateUsed:D},defaultGasEstimates:F,originalType:N,replacedById:U,customTokenAmount:G,dappProposedTokenAmount:B,currentTokenBalance:$,originalApprovalAmount:L,finalApprovalAmount:H,securityProviderResponse:q,simulationFails:W,id:V,userFeeLevel:Y}=e,K=C===o.ORIGIN_METAMASK?"user":"dapp",z="dappSuggested"===Y?"dapp_proposed":Y,{assetType:J,tokenStandard:X}=await(0,h.determineTransactionAssetType)(e,t.provider,t.getTokenStandardAndDetails);let Z;if(e.txParams.data){const n=await t.getMethodData(e.txParams.data);Z=null==n?void 0:n.name}const Q={};if((0,h.isEIP1559Transaction)(e)?(Q.max_fee_per_gas=I,Q.max_priority_fee_per_gas=x):(Q.gas_price=O,Q.default_estimate=l.MetaMetricsEventTransactionEstimateType.DefaultEstimate),F){var ee,te;const{estimateType:n}=F;if(n){var ne,re;Q.default_estimate=n===c.PriorityLevels.dAppSuggested?l.MetaMetricsEventTransactionEstimateType.DappProposed:n;let r=null===(ne=e.defaultGasEstimates)||void 0===ne?void 0:ne.maxFeePerGas,a=null===(re=e.defaultGasEstimates)||void 0===re?void 0:re.maxPriorityFeePerGas;if([c.GasRecommendations.low,c.GasRecommendations.medium,c.GasRecommendations.high].includes(n)){var ae,ie;const{gasFeeEstimates:e}=await t.getEIP1559GasFeeEstimates();var se,oe;if(null!=e&&null!==(ae=e[n])&&void 0!==ae&&ae.suggestedMaxFeePerGas)r=null===(se=e[n])||void 0===se?void 0:se.suggestedMaxFeePerGas,Q.default_max_fee_per_gas=r;if(null!=e&&null!==(ie=e[n])&&void 0!==ie&&ie.suggestedMaxPriorityFeePerGas)a=null===(oe=e[n])||void 0===oe?void 0:oe.suggestedMaxPriorityFeePerGas,Q.default_max_priority_fee_per_gas=a}}null!==(ee=e.defaultGasEstimates)&&void 0!==ee&&ee.gas&&(Q.default_gas=e.defaultGasEstimates.gas),null!==(te=e.defaultGasEstimates)&&void 0!==te&&te.gasPrice&&(Q.default_gas_price=e.defaultGasEstimates.gasPrice)}R&&(Q.estimate_suggested=R),D&&(Q.estimate_used=D),null!=n&&n.gas_used&&(Q.gas_used=n.gas_used);const ce=function(e){const t={};for(const n in e)(0,a.isHexString)(e[n])?t[n]=(0,p.hexWEIToDecGWEI)(e[n]):t[n]=e[n];return t}(Q);let le="0";e.txParams.maxFeePerGas&&(le="2");const ue="Approve";let de,pe,me,he,fe,ge;const{transactionType:ye,isContractInteraction:ve}=function(e,t){const n=e&&_.includes(e);if([i.TransactionType.swapAndSend,i.TransactionType.cancel,i.TransactionType.deployContract,i.TransactionType.gasPayment,i.TransactionType.batch,i.TransactionType.shieldSubscriptionApprove].includes(e))return{transactionType:e,isContractInteraction:n};if(e===i.TransactionType.retry&&t)return{transactionType:t,isContractInteraction:n};if(n){const t=M(e);return t?{transactionType:t,isContractInteraction:!0}:{transactionType:i.TransactionType.contractInteraction,isContractInteraction:!0}}return{transactionType:i.TransactionType.simpleSend,isContractInteraction:!1}}(P,N);var be,Te;ve&&(pe=Z,fe=null===(be=e.txParams)||void 0===be?void 0:be.to,ge=null===(Te=e.txParams)||void 0===Te||null===(Te=Te.data)||void 0===Te?void 0:Te.slice(0,10),pe===ue&&X===u.TokenStandard.ERC20&&("0"===B||"0"===G?de=u.TransactionApprovalAmountType.revoke:G&&G!==B?de=u.TransactionApprovalAmountType.custom:B&&(de=u.TransactionApprovalAmountType.dappProposed),me=function(e,t,n){if(e===u.TransactionApprovalAmountType.custom&&t&&n)return`${new r.BigNumber(t,10).div(n,10).times(100).round(2)}`;return null}(de,L,H),he=function(e,t,n){if((e===u.TransactionApprovalAmountType.custom||e===u.TransactionApprovalAmountType.dappProposed)&&t&&n)return`${new r.BigNumber(t,16).div(n,10).times(100).round(2)}`;return null}(de,B,$)));const we=t.getTransaction(U),ke={RETRY:i.TransactionType.retry,CANCEL:i.TransactionType.cancel,SAME_NONCE:"other"};let _e;null!=n&&n.dropped&&(_e=ke.SAME_NONCE,(null==we?void 0:we.type)===i.TransactionType.cancel?_e=ke.CANCEL:(null==we?void 0:we.type)===i.TransactionType.retry&&(_e=ke.RETRY));const Pe=[];1===(null==q?void 0:q.flagAsDangerous)?Pe.push(l.MetaMetricsEventUiCustomization.FlaggedAsMalicious):2===(null==q?void 0:q.flagAsDangerous)&&Pe.push(l.MetaMetricsEventUiCustomization.FlaggedAsSafetyUnknown);const Ee=(0,f.getBlockaidMetricsProps)(e);(null==Ee||null===(k=Ee.ui_customizations)||void 0===k?void 0:k.length)>0&&Pe.push(...Ee.ui_customizations),W&&Pe.push(l.MetaMetricsEventUiCustomization.GasEstimationFailed);const Se=t.getIsConfirmationAdvancedDetailsOpen(),Ae=(0,m.getSmartTransactionMetricsProperties)(t,e),Ce=(0,f.getSwapAndSendMetricsProps)(e),Me={hd_entropy_index:t.getHDEntropyIndex()},Oe=function(e,t){const n=t.getSecurityAlertsEnabled();if(!n)return{address_alert_response:"not_applicable"};const{to:r}=e.txParams;if("string"!=typeof r)return{address_alert_response:"not_applicable"};const{chainId:a}=e,i=(0,T.mapChainIdToSupportedEVMChain)(a);if(!i)return{address_alert_response:"not_applicable"};const s=(0,T.createCacheKey)(i,r),o=t.getAddressSecurityAlertResponse(s);if(o)return{address_alert_response:o.result_type};return{address_alert_response:T.ResultType.Loading}}(e,t);let je;try{je=await t.getAccountType(t.getSelectedAddress())}catch(e){je="error",w("Error getting account type for transaction metrics:",e)}let Ie={chain_id:A,referrer:C,source:K,status:S,network:`${parseInt(A,16)}`,eip_1559_version:le,gas_edit_type:"none",gas_edit_attempted:"none",gas_estimation_failed:Boolean(W),account_type:je,device_model:await t.getDeviceModel(t.getSelectedAddress()),asset_type:J,token_standard:X,transaction_type:ye,transaction_speed_up:P===i.TransactionType.retry,transaction_internal_id:V,gas_fee_selected:z,...Ee,ui_customizations:Pe.length>0?Pe:null,transaction_advanced_view:Se,transaction_contract_method:pe?[pe]:[],...Ae,...Ce,...Me,...Oe};const xe=await(0,g.getSnapAndHardwareInfoForMetrics)(t.getAccountType,t.getDeviceModel,t.getHardwareTypeForMetric,t.snapAndHardwareMessenger);var Re,De;(Object.assign(Ie,xe),pe===ue||M(P))&&(Ie={...Ie,simulation_receiving_assets_total_value:Ie.simulation_receiving_assets_total_value??(null==e||null===(Re=e.assetsFiatValues)||void 0===Re?void 0:Re.receiving),simulation_sending_assets_total_value:Ie.simulation_sending_assets_total_value??(null==e||null===(De=e.assetsFiatValues)||void 0===De?void 0:De.sending),transaction_approval_amount_type:de});let Fe={transaction_envelope_type:(0,h.isEIP1559Transaction)(e)?d.TRANSACTION_ENVELOPE_TYPE_NAMES.FEE_MARKET:d.TRANSACTION_ENVELOPE_TYPE_NAMES.LEGACY,first_seen:E,gas_limit:j,transaction_replaced:_e,transaction_contract_address:fe?[fe]:[],transaction_contract_method_4byte:ge,...n,...ce};if(pe===ue&&(Fe={...Fe,transaction_approval_amount_vs_balance_ratio:he,transaction_approval_amount_vs_proposed_ratio:me}),await async function(e,t,n,r){const a=origin&&origin!==o.ORIGIN_METAMASK,{delegationAddress:s,nestedTransactions:c,txParams:l}=e,{authorizationList:d}=l,p=Boolean(null==c?void 0:c.length),m=Boolean(null==d?void 0:d.length);a&&(n.api_method=p?o.MESSAGE_TYPE.WALLET_SEND_CALLS:o.MESSAGE_TYPE.ETH_SEND_TRANSACTION);p&&(n.batch_transaction_count=null==c?void 0:c.length,n.batch_transaction_method="eip7702",n.transaction_contract_method=await async function(e,t){const n=e.filter(e=>_.includes(e.type)&&e.data).map(e=>e.data),r=await Promise.all(n.map(e=>t(e)));return r.map(e=>null==e?void 0:e.name).filter(e=>null==e?void 0:e.length)}(c??[],t),r.transaction_contract_address=null==c?void 0:c.filter(e=>{var t;return _.includes(e.type)&&(null===(t=e.to)||void 0===t?void 0:t.length)}).map(e=>e.to));if(e.status===i.TransactionStatus.rejected){const{error:t}=e;n.eip7702_upgrade_rejection=m&&t.code===u.EIP5792ErrorCode.RejectedUpgrade}n.eip7702_upgrade_transaction=m,r.account_eip7702_upgraded=s}(e,t.getMethodData,Ie,Fe),function(e,t,n,r){var a;const{gasFeeTokens:i,selectedGasFeeToken:o}=e;t.gas_payment_tokens_available=null==i?void 0:i.map(e=>e.symbol),t.gas_paid_with=null==i||null===(a=i.find(e=>e.tokenAddress.toLowerCase()===(null==o?void 0:o.toLowerCase())))||void 0===a?void 0:a.symbol,(null==o?void 0:o.toLowerCase())===u.NATIVE_TOKEN_ADDRESS&&(t.gas_paid_with="pre-funded_ETH");t.gas_insufficient_native_asset=function(e,t){const{chainId:n,txParams:r}=e,{from:a,gas:i,gasPrice:o,maxFeePerGas:c,value:l}=r,u=t(a,n),d=(0,y.getMaximumGasTotalInHexWei)({gasLimit:i,gasPrice:o,maxFeePerGas:c}),m=(0,s.add0x)((0,p.addHexes)(d,l??"0x0"));return new v.Numeric(m,16).greaterThan(new v.Numeric(u,16))}(e,r)}(e,Ie,0,t.getAccountBalance),function(e,t,n){var r;const a=null===(r=n.getFeatureFlags())||void 0===r?void 0:r.extensionUxPna25,s=n.getPna25Acknowledged(),o=n.getParticipateInMetrics(),c=[i.TransactionStatus.confirmed,i.TransactionStatus.dropped,i.TransactionStatus.failed].includes(e.status);a&&s&&o&&c&&(t.transaction_hash=e.hash)}(e,Ie,t),S===i.TransactionStatus.submitted||S===i.TransactionStatus.confirmed){const n=t.getNetworkRpcUrl(e.chainId),r=(0,b.extractRpcDomain)(n);Ie.rpc_domain=r}return{properties:Ie,sensitiveProperties:Fe}}function M(e){return e===i.TransactionType.swap?P.swap:e===i.TransactionType.bridge?P.bridge:null}n.handlePostTransactionBalanceUpdate=async({getParticipateInMetrics:e,trackEvent:t,getHDEntropyIndex:n},{transactionMeta:a,approvalTransactionMeta:i})=>{var s;if(e()&&a.swapMetaData)if("0x0"===(null===(s=a.txReceipt)||void 0===s?void 0:s.status))t({event:l.MetaMetricsEventName.SwapFailed,category:l.MetaMetricsEventCategory.Swaps,sensitiveProperties:{...a.swapMetaData},properties:{hd_entropy_index:n()}});else{var o;const e=(0,d.getSwapsTokensReceivedFromTxMeta)(a.destinationTokenSymbol,a,a.destinationTokenAddress,a.txParams.from,a.destinationTokenDecimals,i,a.chainId),s=e?`${new r.BigNumber(e,10).div(a.swapMetaData.token_to_amount,10).times(100).round(2)}%`:null,c=null!==(o=a.txReceipt)&&void 0!==o&&o.gasUsed&&a.swapMetaData.estimated_gas?`${new r.BigNumber(a.txReceipt.gasUsed,16).div(a.swapMetaData.estimated_gas,10).times(100).round(2)}%`:null,u=function(e,t){var n,a;let i="0x0";null!=t&&t.txReceipt&&(i=(0,d.calcGasTotal)(t.txReceipt.gasUsed,t.txReceipt.effectiveGasPrice));const s=(0,d.calcGasTotal)(null===(n=e.txReceipt)||void 0===n?void 0:n.gasUsed,null===(a=e.txReceipt)||void 0===a?void 0:a.effectiveGasPrice),o=new r.BigNumber(s,16).plus(i,16).toString(16);return{approvalGasCostInEth:Number((0,p.hexWEIToDecETH)(i)),tradeGasCostInEth:Number((0,p.hexWEIToDecETH)(s)),tradeAndApprovalGasCostInEth:Number((0,p.hexWEIToDecETH)(o))}}(a,i);t({event:l.MetaMetricsEventName.SwapCompleted,category:l.MetaMetricsEventCategory.Swaps,sensitiveProperties:{...a.swapMetaData,token_to_amount_received:e,quote_vs_executionRatio:s,estimated_vs_used_gasRatio:c,approval_gas_cost_in_eth:u.approvalGasCostInEth,trade_gas_cost_in_eth:u.tradeGasCostInEth,trade_and_approval_gas_cost_in_eth:u.tradeAndApprovalGasCostInEth,token_to_amount:a.swapMetaData.token_to_amount.toString(10)},properties:{hd_entropy_index:n()}})}}}}},{package:"$root$",file:"app/scripts/lib/transaction/metrics.ts"}],[366,{"../../../../shared/modules/conversion.utils":5976,"../../../../shared/modules/fetch-with-timeout":5982},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.buildUrl=d,n.getSendBundleSupportedChains=async function(e){const t=await l();return e.reduce((e,n)=>{const r=(0,a.hexToDecimal)(n),i=t[r];return e[n]=(null==i?void 0:i.sendBundle)??!1,e},{})},n.getSentinelApiHeaders=function(){const e={"X-Client-Id":c};e["X-Client-Version"]="13.16.4";return e},n.getSentinelNetworkFlags=u,n.isSendBundleSupported=async function(e){const t=await u(e);if(null==t||!t.sendBundle)return!1;return!0};var r,a=e("../../../../shared/modules/conversion.utils"),i=(r=e("../../../../shared/modules/fetch-with-timeout"))&&r.__esModule?r:{default:r};const s="https://tx-sentinel-{0}.api.cx.metamask.io/",o="networks",c="extension";async function l(){const e=`${d("ethereum-mainnet")}${o}`;return(await(0,i.default)()(e)).json()}async function u(e){const t=(0,a.hexToDecimal)(e);return(await l())[t]}function d(e){return s.replace("{0}",e)}}}},{package:"$root$",file:"app/scripts/lib/transaction/sentinel-api.ts"}],[367,{"../../../../shared/modules/fetch-with-timeout":5982,"../../../../shared/modules/rpc.utils":5991,"./sentinel-api":366,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RelayStatus=n.RELAY_RPC_METHOD=void 0,n.isRelaySupported=async function(e){return Boolean(await d(e))},n.submitRelayTransaction=async function(e){const{chainId:t}=e,n=await d(t);if(!n)throw new Error(`Chain not supported by transaction relay - ${t}`);c("Request",n,e);const r=await(0,i.jsonRpcRequest)(n,u,[e]);return c("Response",r),r},n.waitForRelayResult=async function(e){const{chainId:t,interval:n,uuid:r}=e,a=await d(t);if(!a)throw new Error(`Chain not supported by transaction relay - ${t}`);const i=`${a}smart-transactions/${r}`;return new Promise((e,t)=>{const r=setInterval(async()=>{try{const t=await async function(e){c("Polling request",e);const t=await(0,s.default)()(e);if(c("Polling response",t),!t.ok){const e=await t.text();throw new Error(`Failed to fetch relay transaction status: ${t.status} - ${e}`)}const n=await t.json(),r=null==n?void 0:n.transactions[0],{hash:a,status:i}=r||{};return{status:i,transactionHash:a}}(i);t.status!==l.Pending&&(clearInterval(r),e(t))}catch(e){clearInterval(r),t(e)}},n)})};var r,a=e("@metamask/utils"),i=e("../../../../shared/modules/rpc.utils"),s=(r=e("../../../../shared/modules/fetch-with-timeout"))&&r.__esModule?r:{default:r},o=e("./sentinel-api");const c=(0,a.createProjectLogger)("transaction-relay");let l=n.RelayStatus=function(e){return e.Pending="PENDING",e.Success="VALIDATED",e}({});const u=n.RELAY_RPC_METHOD="eth_sendRelayTransaction";async function d(e){const t=await(0,o.getSentinelNetworkFlags)(e);return null!=t&&t.relayTransactions?(0,o.buildUrl)(t.network):(c("Chain is not supported",e),undefined)}}}},{package:"$root$",file:"app/scripts/lib/transaction/transaction-relay.ts"}],[368,{"../../../../shared/constants/app":5837,"../../../../shared/constants/security-provider":5865,"../../../../shared/lib/trace":5960,"../../../../shared/lib/trust-signals":5966,"../../../../shared/modules/transaction.utils":6008,"../ppom/ppom-util":308,"../trust-signals/security-alerts-api":369,"@metamask/keyring-api":2306,"@metamask/transaction-controller":3095,"ethereumjs-util":4391},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.addDappTransaction=async function(e){const{dappRequest:t,requestContext:n}=e,{id:r,method:a}=t,i=String(r),s=n.assertGet("origin"),o=n.get("securityAlertResponse"),l=n.get("traceContext"),u={actionId:i,requestId:String(r),method:a,origin:s,requireApproval:!0,securityAlertResponse:o};(0,c.endTrace)({name:c.TraceName.Middleware,id:i});const{waitForHash:d}=await h({...e,transactionOptions:{...u,traceContext:l}}),p=await d();return(0,c.endTrace)({name:c.TraceName.Transaction,id:i}),p},n.addTransaction=async function(e){await async function(e){const{chainId:t,ppomController:n,securityAlertsEnabled:r,transactionOptions:a,transactionParams:i,updateSecurityAlertResponse:c,internalAccounts:h,getSecurityAlertsConfig:f}=e;!function(e){const{getSecurityAlertResponse:t,addSecurityAlertResponse:n,securityAlertsEnabled:r,transactionOptions:a,transactionParams:i,chainId:s}=e,{origin:o}=a;if(o!==l.ORIGIN_METAMASK||!r)return;const{to:c}=i;if("string"!=typeof c)return;const p=(0,d.mapChainIdToSupportedEVMChain)(s);if(!p)return;const m=e=>t(e),h=(e,t)=>n(e,t);(0,u.scanAddressAndAddToCache)(c,m,h,p).catch(e=>{console.error("[scanAddressForTrustSignals] error scanning address for trust signals:",e)})}(e);const{type:g}=a,{data:v,value:b,to:T}=i,w=o.SECURITY_PROVIDER_EXCLUDED_TRANSACTION_TYPES.includes(g);if(!r||w)return;const k="0x0"===b&&m.includes(g)&&v?(0,p.getTransactionDataRecipient)(v):undefined;if(y(h,T)||y(h,k))return;try{const{from:r}=i,{actionId:l,origin:u}=a,d={method:"eth_sendTransaction",id:l??"",origin:u??"",params:[{from:r,to:T??"",value:b??"",data:v??""}],jsonrpc:"2.0"},p=(0,s.generateSecurityAlertId)();(0,s.validateRequestWithPPOM)({ppomController:n,request:d,securityAlertId:p,chainId:t,updateSecurityAlertResponse:c,getSecurityAlertsConfig:f});const m={...o.LOADING_SECURITY_ALERT_RESPONSE,securityAlertId:p};e.transactionOptions.securityAlertResponse=m}catch(e){(0,s.handlePPOMError)(e,"Error validating JSON RPC using PPOM: ")}}(e);const{transactionMeta:t,waitForHash:n}=await h(e);if(!e.waitForSubmit)return n().catch(()=>{}),t;const r=await n();return function(e,t){return t.state.transactions.find(t=>t.hash===e)}(r,e.transactionController)},n.getTransactionById=f,n.stripSingleLeadingZero=function(e){if(!e.startsWith("0x0")||e.length<=3)return e;return`0x${e.slice(3)}`};var r=e("@metamask/keyring-api"),a=e("@metamask/transaction-controller"),i=e("ethereumjs-util"),s=e("../ppom/ppom-util"),o=e("../../../../shared/constants/security-provider"),c=e("../../../../shared/lib/trace"),l=e("../../../../shared/constants/app"),u=e("../trust-signals/security-alerts-api"),d=e("../../../../shared/lib/trust-signals"),p=e("../../../../shared/modules/transaction.utils");const m=[a.TransactionType.tokenMethodTransfer,a.TransactionType.tokenMethodTransferFrom,a.TransactionType.tokenMethodSafeTransferFrom];async function h(e){const{selectedAccount:t}=e;return t.type===r.EthAccountType.Erc4337?async function(e){var t;const{networkClientId:n,transactionController:r,transactionOptions:a,transactionParams:s,userOperationController:o}=e,{maxFeePerGas:c,maxPriorityFeePerGas:l}=s,{origin:u,requireApproval:d,type:p}=a,m={...s,maxFeePerGas:(0,i.addHexPrefix)(c),maxPriorityFeePerGas:(0,i.addHexPrefix)(l)},h=null==a||null===(t=a.swaps)||void 0===t?void 0:t.meta;null!=h&&h.type&&delete h.type;const g={networkClientId:n,origin:u,requireApproval:d,swaps:h,type:p},y=await o.addUserOperationFromTransaction(m,g);o.startPollingByNetworkClientId(n);return{transactionMeta:f(y.id,r),waitForHash:y.transactionHash}}(e):async function(e){const{transactionController:t,transactionOptions:n,transactionParams:r,networkClientId:a}=e,{result:i,transactionMeta:s}=await t.addTransaction(r,{...n,networkClientId:a});return{transactionMeta:s,waitForHash:()=>i}}(e)}function f(e,t){return t.state.transactions.find(t=>t.id===e)}function g(e){return null==e?void 0:e.toLowerCase()}function y(e,t){const n=g(t);if(!n)return!1;return new Set(e.map(e=>g(e.address))).has(n)}}}},{package:"$root$",file:"app/scripts/lib/transaction/util.ts"}],[369,{"../../../../shared/constants/time":5874,"../../../../shared/lib/trust-signals":5966,"../../../../shared/modules/fetch-with-timeout":5982},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.scanAddress=l,n.scanAddressAndAddToCache=async function(e,t,n,r){const a=(0,s.createCacheKey)(r,e),i=t(a);if(i)return i;const o={result_type:s.ResultType.Loading,label:""};n(a,o);try{const t=await l(r,e);return n(a,t),t}catch(e){throw n(a,{result_type:s.ResultType.ErrorResult,label:""}),e}};var r,a=e("../../../../shared/constants/time"),i=(r=e("../../../../shared/modules/fetch-with-timeout"))&&r.__esModule?r:{default:r},s=e("../../../../shared/lib/trust-signals");const o=5*a.SECOND,c="address/evm/scan";async function l(e,t){const n="https://security-alerts.api.cx.metamask.io";const r=`${n}/${c}`,a={chain:e,address:t},s=await(0,i.default)(o)(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await s.json()}}}},{package:"$root$",file:"app/scripts/lib/trust-signals/security-alerts-api.ts"}],[3691,{"./types.js":3692},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=e("./types.js");const a={type:"xstate.init"},i="xstate.assign";function s(e){return e===undefined?[]:[].concat(e)}function o(e,t){return"string"==typeof(e="string"==typeof e&&t&&t[e]?t[e]:e)?{type:e}:"function"==typeof e?{type:e.name,exec:e}:e}function c(e){return t=>e===t}function l(e){return"string"==typeof e?{type:e}:e}function u(e,t){return{value:e,context:t,actions:[],changed:!1,matches:c(e)}}function d(e,t,n){let r=t,a=!1;return[e.filter(e=>{if(e.type===i){a=!0;let t=Object.assign({},r);return"function"==typeof e.assignment?t=e.assignment(r,n):Object.keys(e.assignment).forEach(a=>{t[a]="function"==typeof e.assignment[a]?e.assignment[a](r,n):e.assignment[a]}),r=t,!1}return!0}),r,a]}const p=(e,t)=>e.actions.forEach(({exec:n})=>n&&n(e.context,t));Object.defineProperty(n,"InterpreterStatus",{enumerable:!0,get:function(){return r.InterpreterStatus}}),n.assign=function(e){return{type:i,assignment:e}},n.createMachine=function(e,t={}){const[n,r]=d(s(e.states[e.initial].entry).map(e=>o(e,t.actions)),e.context,a),i={config:e,_options:t,initialState:{value:e.initial,actions:n,context:r,matches:c(e.initial)},transition:(t,n)=>{const{value:r,context:a}="string"==typeof t?{value:t,context:e.context}:t,p=l(n),m=e.states[r];if(m.on){const t=s(m.on[p.type]);for(const n of t){if(n===undefined)return u(r,a);const{target:t,actions:l=[],cond:h=()=>!0}="string"==typeof n?{target:n}:n,f=t===undefined,g=null!=t?t:r,y=e.states[g];if(h(a,p)){const e=(f?s(l):[].concat(m.exit,l,y.entry).filter(e=>e)).map(e=>o(e,i._options.actions)),[n,u,h]=d(e,a,p),g=null!=t?t:r;return{value:g,context:u,actions:n,changed:t!==r||n.length>0||h,matches:c(g)}}}}return u(r,a)}};return i},n.interpret=function(e){let t=e.initialState,n=r.InterpreterStatus.NotStarted;const i=new Set,s={_machine:e,send:a=>{n===r.InterpreterStatus.Running&&(t=e.transition(t,a),p(t,l(a)),i.forEach(e=>e(t)))},subscribe:e=>(i.add(e),e(t),{unsubscribe:()=>i.delete(e)}),start:i=>{if(i){const n="object"==typeof i?i:{context:e.config.context,value:i};t={value:n.value,actions:[],context:n.context,matches:c(n.value)}}else t=e.initialState;return n=r.InterpreterStatus.Running,p(t,a),s},stop:()=>(n=r.InterpreterStatus.Stopped,i.clear(),s),get state(){return t},get status(){return n}};return s}}}},{package:"@metamask/snaps-controllers>@xstate/fsm",file:"node_modules/@xstate/fsm/lib/index.js"}],[3692,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r;Object.defineProperty(n,"__esModule",{value:!0}),n.InterpreterStatus=void 0,(r=n.InterpreterStatus||(n.InterpreterStatus={}))[r.NotStarted=0]="NotStarted",r[r.Running=1]="Running",r[r.Stopped=2]="Stopped"}}},{package:"@metamask/snaps-controllers>@xstate/fsm",file:"node_modules/@xstate/fsm/lib/types.js"}],[37,{"../../../../shared/constants/app":5837,"@metamask/approval-controller":1295,"@metamask/controller-utils":1494},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ApprovalControllerInit=void 0;var r=e("@metamask/approval-controller"),a=e("@metamask/controller-utils"),i=e("../../../../shared/constants/app");n.ApprovalControllerInit=({controllerMessenger:e,showUserConfirmation:t})=>({persistedStateKey:null,memStateKey:null,controller:new r.ApprovalController({messenger:e,showApprovalRequest:t,typesExcludedFromRateLimiting:[a.ApprovalType.PersonalSign,a.ApprovalType.EthSignTypedData,a.ApprovalType.Transaction,a.ApprovalType.WatchAsset,a.ApprovalType.EthGetEncryptionPublicKey,a.ApprovalType.EthDecrypt,i.SMART_TRANSACTION_CONFIRMATION_TYPES.showSmartTransactionStatusPage]})})}}},{package:"$root$",file:"app/scripts/controller-init/confirmations/approval-controller-init.ts"}],[370,{"../../../../shared/constants/signatures":5866,"../../../../shared/lib/trust-signals":5966,"../../../../shared/modules/transaction.utils":6008,"../ppom/security-alerts-api":310,"../transaction/delegation":362,"./security-alerts-api":369,"./trust-signals-util":371},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createTrustSignalsMiddleware=function(e,t,n,d,p){return async(m,h,f)=>{try{if(!(0,l.isSecurityAlertsEnabledByUser)(d)||!(0,s.isSecurityAlertsAPIEnabled)())return;(0,l.isEthSendTransaction)(m)?(!function(e,t,n){if(!(0,l.hasValidTransactionParams)(e))return;const{to:a,data:i}=e.params[0],{chainId:s}=n.getNetworkConfigurationByNetworkClientId(e.networkClientId)??{};if(!s)return void console.error("ChainID not found for networkClientId");const u=(0,o.mapChainIdToSupportedEVMChain)(s);if(!u)return void console.error("Unsupported chainId:",s);if((0,c.scanAddressAndAddToCache)(a,t.getAddressSecurityAlertResponse,t.addAddressSecurityAlertResponse,u).catch(e=>{console.error("[createTrustSignalsMiddleware] error scanning address for transaction:",e)}),i&&"string"==typeof i){const e=(0,r.parseApprovalTransactionData)(i),n=null==e?void 0:e.spender;n&&(0,c.scanAddressAndAddToCache)(n,t.getAddressSecurityAlertResponse,t.addAddressSecurityAlertResponse,u).catch(e=>{console.error("[createTrustSignalsMiddleware] error scanning spender address for approval:",e)})}}(m,t,e),u(m,n)):(0,l.isEthSignTypedData)(m)?(!function(e,t,n){var s;if(!(0,l.hasValidTypedDataParams)(e))return;const u=(0,r.parseTypedDataMessage)("string"==typeof e.params[1]?e.params[1]:JSON.stringify(e.params[1])),d=null===(s=u.domain)||void 0===s?void 0:s.verifyingContract;if(!d)return;const{chainId:p}=n.getNetworkConfigurationByNetworkClientId(e.networkClientId)??{};if(!p)return void console.error("ChainID not found for networkClientId");const m=(0,o.mapChainIdToSupportedEVMChain)(p);if(!m)return void console.error("Unsupported chainId:",p);(0,c.scanAddressAndAddToCache)(d,t.getAddressSecurityAlertResponse,t.addAddressSecurityAlertResponse,m).catch(e=>{console.error("[createTrustSignalsMiddleware] error scanning address for signature:",e)});const{primaryType:h}=u;if(!h)return;if(a.PRIMARY_TYPES_PERMIT.includes(h)){var f;const e=null===(f=u.message)||void 0===f?void 0:f.spender;e&&(0,c.scanAddressAndAddToCache)(e,t.getAddressSecurityAlertResponse,t.addAddressSecurityAlertResponse,m).catch(e=>{console.error("[createTrustSignalsMiddleware] error scanning spender address for permit:",e)})}if(h===i.PRIMARY_TYPE_DELEGATION){var g;const e=null===(g=u.message)||void 0===g?void 0:g.delegate;e&&(0,c.scanAddressAndAddToCache)(e,t.getAddressSecurityAlertResponse,t.addAddressSecurityAlertResponse,m).catch(e=>{console.error("[createTrustSignalsMiddleware] error scanning delegate address for delegation:",e)})}}(m,t,e),u(m,n)):((0,l.isConnected)(m,p)||(0,l.connectScreenHasBeenPrompted)(m))&&u(m,n)}catch(e){console.error("[createTrustSignalsMiddleware] error: ",e)}finally{f()}}};var r=e("../../../../shared/modules/transaction.utils"),a=e("../../../../shared/constants/signatures"),i=e("../transaction/delegation"),s=e("../ppom/security-alerts-api"),o=e("../../../../shared/lib/trust-signals"),c=e("./security-alerts-api"),l=e("./trust-signals-util");function u(e,t){e.origin&&t.scanUrl(e.origin).catch(e=>{console.error("[createTrustSignalsMiddleware] error:",e)})}}}},{package:"$root$",file:"app/scripts/lib/trust-signals/trust-signals-middleware.ts"}],[371,{"../../../../shared/constants/app":5837,"../../../../shared/lib/trust-signals":5966,"../../../../shared/modules/selectors/networks":5995},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.connectScreenHasBeenPrompted=function(e){return e.method===a.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS||e.method===a.MESSAGE_TYPE.WALLET_REQUEST_PERMISSIONS},n.getChainId=function(e){var t;const n=null===(t=(0,r.getProviderConfig)({metamask:e.state}))||void 0===t?void 0:t.chainId;if(!n)throw new Error("Chain ID not found");return(0,i.mapChainIdToSupportedEVMChain)(n)},n.hasValidTransactionParams=function(e){if(!("params"in e)||!e.params)return!1;if(!Array.isArray(e.params)||0===e.params.length)return!1;const t=e.params[0];return"object"==typeof t&&null!==t&&"to"in t},n.hasValidTypedDataParams=function(e){if(!("params"in e)||!e.params)return!1;if(!Array.isArray(e.params)||e.params.length<2)return!1;return e.params[1]!==undefined&&null!==e.params[1]},n.isConnected=function(e,t){if(!e.origin||e.method!==a.MESSAGE_TYPE.ETH_ACCOUNTS)return!1;const n=t(e.origin);return Array.isArray(n)&&n.length>0},n.isEthSendTransaction=function(e){return e.method===a.MESSAGE_TYPE.ETH_SEND_TRANSACTION},n.isEthSignTypedData=function(e){return e.method===a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA||e.method===a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V1||e.method===a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3||e.method===a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4},n.isSecurityAlertsEnabledByUser=function(e){const{securityAlertsEnabled:t}=e.state;return t};var r=e("../../../../shared/modules/selectors/networks"),a=e("../../../../shared/constants/app"),i=e("../../../../shared/lib/trust-signals")}}},{package:"$root$",file:"app/scripts/lib/trust-signals/trust-signals-util.ts"}],[372,{loglevel:4909},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.updateRemoteFeatureFlags=async function(e){try{const t=e.remoteFeatureFlagController;await t.updateRemoteFeatureFlags()}catch(e){a.default.error("Error initializing remote feature flags:",e)}};var r,a=(r=e("loglevel"))&&r.__esModule?r:{default:r}}}},{package:"$root$",file:"app/scripts/lib/update-remote-feature-flags.ts"}],[373,{"../../../shared/modules/environment":5980,"@metamask/utils":3217,"webextension-polyfill":5825},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.useSplitStateStorage=async function(e){var t;if((0,s.getIsSettingsPageDevOptionsEnabled)()){const t=await async function(){const{splitStateMigrationEnabled:e,splitStateMigrationMaxAccounts:t,splitStateMigrationMaxNetworks:n}=await a.default.storage.local.get(["splitStateMigrationEnabled","splitStateMigrationMaxAccounts","splitStateMigrationMaxNetworks"]);return{enabled:e===undefined?null:"1"===e,maxAccounts:t===undefined?0:Number(t),maxNetworks:n===undefined?0:Number(n)}}();if(null!==t.enabled){if(!1===t.enabled)return!1;const{accountCount:n,networkCount:r}=o(e);return n<=t.maxAccounts&&r<=t.maxNetworks}}const n=e.RemoteFeatureFlagController,r=null==n||null===(t=n.remoteFeatureFlags)||void 0===t?void 0:t.platformSplitStateGradualRollout;if(!function(e){return(0,i.isObject)(e)&&(0,i.hasProperty)(e,"value")&&(0,i.isObject)(e.value)&&(0,i.hasProperty)(e.value,"enabled")&&"number"==typeof e.value.enabled&&(0,i.hasProperty)(e.value,"maxAccounts")&&"number"==typeof e.value.maxAccounts&&(0,i.hasProperty)(e.value,"maxNetworks")&&"number"==typeof e.value.maxNetworks}(r)||r.value.enabled<=0)return!1;const{accountCount:c,networkCount:l}=o(e);return c<=r.value.maxAccounts&&l<=r.value.maxNetworks};var r,a=(r=e("webextension-polyfill"))&&r.__esModule?r:{default:r},i=e("@metamask/utils"),s=e("../../../shared/modules/environment");function o(e){var t;const n=e.AccountsController,r=Object.keys((null==n||null===(t=n.internalAccounts)||void 0===t?void 0:t.accounts)??{}).length,a=e.NetworkController;return{accountCount:r,networkCount:Object.keys((null==a?void 0:a.networkConfigurationsByChainId)??{}).length}}}}},{package:"$root$",file:"app/scripts/lib/use-split-state-storage.ts"}]],[],{});
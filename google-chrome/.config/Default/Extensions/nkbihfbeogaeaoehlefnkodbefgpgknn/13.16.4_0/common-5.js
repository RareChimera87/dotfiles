LavaPack.loadBundle([[3010,{"../array.cjs":2977,"../cronjob.cjs":2984,"../entropy.cjs":2989,"../json-rpc.cjs":3005,"../snaps.cjs":3013,"../structs.cjs":3015,"../types.cjs":3018,"@metamask/key-tree":2270,"@metamask/superstruct":3037,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createSnapManifest=n.assertIsSnapManifest=n.isSnapManifest=n.SnapManifestStruct=n.InitialConnectionsStruct=n.SnapAuxilaryFilesStruct=n.SnapAuxiliaryFilesStruct=n.PermissionsStruct=n.EmptyObjectStruct=n.HandlerCaveatsStruct=n.ProtocolScopesStruct=n.MaxRequestTimeStruct=n.MAXIMUM_REQUEST_TIMEOUT=n.MINIMUM_REQUEST_TIMEOUT=n.LookupMatchersStruct=n.ChainIdsStruct=n.SnapIdsStruct=n.SemVerRangeStruct=n.SnapGetBip32EntropyPermissionsStruct=n.Bip32EntropyStruct=n.CurveStruct=n.bip32entropy=n.Bip32PathStruct=n.FORBIDDEN_COIN_TYPES=void 0;const a=e("@metamask/key-tree"),r=e("@metamask/superstruct"),s=e("@metamask/utils"),i=e("../array.cjs"),o=e("../cronjob.cjs"),c=e("../entropy.cjs"),l=e("../json-rpc.cjs"),u=e("../snaps.cjs"),d=e("../structs.cjs"),h=e("../types.cjs"),m=[c.SIP_6_MAGIC_VALUE,c.STATE_ENCRYPTION_MAGIC_VALUE];n.FORBIDDEN_COIN_TYPES=[60];const f=n.FORBIDDEN_COIN_TYPES.map(e=>["m","44'",`${e}'`]);n.Bip32PathStruct=(0,r.refine)((0,r.array)((0,r.string)()),"BIP-32 path",e=>0===e.length?"Path must be a non-empty BIP-32 derivation path array":"m"!==e[0]?'Path must start with "m".':e.length<3?"Paths must have a length of at least three.":e.slice(1).some(e=>!(0,a.isValidBIP32PathSegment)(e))?"Path must be a valid BIP-32 derivation path array.":m.includes(e[1])?`The purpose "${e[1]}" is not allowed for entropy derivation.`:!f.some(t=>(0,i.isEqual)(e.slice(0,t.length),t))||`The path "${e.join("/")}" is not allowed for entropy derivation.`);n.bip32entropy=e=>(0,r.refine)(e,"BIP-32 entropy",e=>"ed25519"!==e.curve||!e.path.slice(1).some(e=>!e.endsWith("'"))||"Ed25519 does not support unhardened paths."),n.CurveStruct=(0,r.enums)(["ed25519","secp256k1","ed25519Bip32"]),n.Bip32EntropyStruct=(0,n.bip32entropy)((0,r.type)({path:n.Bip32PathStruct,curve:n.CurveStruct})),n.SnapGetBip32EntropyPermissionsStruct=(0,r.size)((0,r.array)(n.Bip32EntropyStruct),1,Infinity),n.SemVerRangeStruct=(0,r.refine)((0,r.string)(),"SemVer range",e=>!!(0,s.isValidSemVerRange)(e)||"Expected a valid SemVer range."),n.SnapIdsStruct=(0,r.refine)((0,r.record)(u.SnapIdStruct,(0,r.object)({version:(0,r.optional)(n.SemVerRangeStruct)})),"SnapIds",e=>0!==Object.keys(e).length),n.ChainIdsStruct=(0,r.size)((0,r.array)(s.CaipChainIdStruct),1,Infinity),n.LookupMatchersStruct=(0,r.union)([(0,r.object)({tlds:(0,r.size)((0,r.array)((0,r.string)()),1,Infinity)}),(0,r.object)({schemes:(0,r.size)((0,r.array)((0,r.string)()),1,Infinity)}),(0,r.object)({tlds:(0,r.size)((0,r.array)((0,r.string)()),1,Infinity),schemes:(0,r.size)((0,r.array)((0,r.string)()),1,Infinity)})]),n.MINIMUM_REQUEST_TIMEOUT=(0,s.inMilliseconds)(5,s.Duration.Second),n.MAXIMUM_REQUEST_TIMEOUT=(0,s.inMilliseconds)(3,s.Duration.Minute),n.MaxRequestTimeStruct=(0,r.size)((0,r.integer)(),n.MINIMUM_REQUEST_TIMEOUT,n.MAXIMUM_REQUEST_TIMEOUT),n.ProtocolScopesStruct=(0,r.record)(s.CaipChainIdStruct,(0,r.object)({methods:(0,r.array)((0,r.string)())})),n.HandlerCaveatsStruct=(0,r.object)({maxRequestTime:(0,r.optional)(n.MaxRequestTimeStruct)}),n.EmptyObjectStruct=(0,r.object)({}),n.PermissionsStruct=(0,r.type)({"endowment:assets":(0,r.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,(0,r.object)({scopes:n.ChainIdsStruct}))),"endowment:cronjob":(0,r.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,(0,r.object)({jobs:(0,r.optional)(o.CronjobSpecificationArrayStruct)}))),"endowment:ethereum-provider":(0,r.optional)(n.EmptyObjectStruct),"endowment:keyring":(0,r.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,l.KeyringOriginsStruct)),"endowment:protocol":(0,r.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,(0,r.object)({scopes:n.ProtocolScopesStruct}))),"endowment:lifecycle-hooks":(0,r.optional)(n.HandlerCaveatsStruct),"endowment:name-lookup":(0,r.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,(0,r.object)({chains:(0,r.optional)(n.ChainIdsStruct),matchers:(0,r.optional)(n.LookupMatchersStruct)}))),"endowment:network-access":(0,r.optional)(n.EmptyObjectStruct),"endowment:page-home":(0,r.optional)(n.HandlerCaveatsStruct),"endowment:rpc":(0,r.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,l.RpcOriginsStruct)),"endowment:signature-insight":(0,r.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,(0,r.object)({allowSignatureOrigin:(0,r.optional)((0,r.boolean)())}))),"endowment:transaction-insight":(0,r.optional)((0,d.mergeStructs)(n.HandlerCaveatsStruct,(0,r.object)({allowTransactionOrigin:(0,r.optional)((0,r.boolean)())}))),"endowment:webassembly":(0,r.optional)(n.EmptyObjectStruct),snap_dialog:(0,r.optional)(n.EmptyObjectStruct),snap_manageState:(0,r.optional)(n.EmptyObjectStruct),snap_manageAccounts:(0,r.optional)(n.EmptyObjectStruct),snap_notify:(0,r.optional)(n.EmptyObjectStruct),snap_getBip32Entropy:(0,r.optional)(n.SnapGetBip32EntropyPermissionsStruct),snap_getBip32PublicKey:(0,r.optional)(n.SnapGetBip32EntropyPermissionsStruct),snap_getBip44Entropy:(0,r.optional)((0,r.size)((0,r.array)((0,r.object)({coinType:(0,r.size)((0,r.integer)(),0,2**32-1)})),1,Infinity)),snap_getEntropy:(0,r.optional)(n.EmptyObjectStruct),snap_getLocale:(0,r.optional)(n.EmptyObjectStruct),wallet_snap:(0,r.optional)(n.SnapIdsStruct)}),n.SnapAuxiliaryFilesStruct=(0,r.array)((0,r.string)()),n.SnapAuxilaryFilesStruct=n.SnapAuxiliaryFilesStruct,n.InitialConnectionsStruct=(0,r.record)((0,r.intersection)([(0,r.string)(),(0,h.uri)()]),(0,r.object)({})),n.SnapManifestStruct=(0,r.object)({version:s.VersionStruct,description:(0,r.size)((0,r.string)(),1,280),proposedName:(0,r.size)((0,r.string)(),1,214),repository:(0,r.optional)((0,r.type)({type:(0,r.size)((0,r.string)(),1,Infinity),url:(0,r.size)((0,r.string)(),1,Infinity)})),source:(0,r.object)({shasum:s.ChecksumStruct,location:(0,r.object)({npm:(0,r.object)({filePath:(0,r.size)((0,r.string)(),1,Infinity),iconPath:(0,r.optional)((0,r.size)((0,r.string)(),1,Infinity)),packageName:h.NameStruct,registry:(0,r.union)([(0,r.literal)("https://registry.npmjs.org"),(0,r.literal)("https://registry.npmjs.org/")])})}),files:(0,r.optional)(n.SnapAuxiliaryFilesStruct),locales:(0,r.optional)(n.SnapAuxiliaryFilesStruct)}),initialConnections:(0,r.optional)(n.InitialConnectionsStruct),initialPermissions:n.PermissionsStruct,manifestVersion:(0,r.literal)("0.1"),platformVersion:(0,r.optional)(s.VersionStruct),$schema:(0,r.optional)((0,r.string)())}),n.isSnapManifest=function(e){return(0,r.is)(e,n.SnapManifestStruct)},n.assertIsSnapManifest=function(e){(0,s.assertStruct)(e,n.SnapManifestStruct,`"${h.NpmSnapFileNames.Manifest}" is invalid`)},n.createSnapManifest=function(e){return(0,r.create)(e,n.SnapManifestStruct)}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/manifest/validation.cjs"}],[3011,{"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.normalizeRelative=void 0;const a=e("@metamask/utils");n.normalizeRelative=function(e){return(0,a.assert)(!e.startsWith("/")),(0,a.assert)(-1===e.search(/:|\/\//u),`Path "${e}" potentially an URI instead of local relative`),e.startsWith("./")?e.slice(2):e}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/path.cjs"}],[3012,{"@metamask/snaps-sdk/package.json":2975},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getPlatformVersion=void 0;const r=a(e("@metamask/snaps-sdk/package.json"));n.getPlatformVersion=function(){return r.default.version}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/platform-version.cjs"}],[3013,{"./caveats.cjs":2981,"./checksum.cjs":2982,"./types.cjs":3018,"@metamask/snaps-sdk":2887,"@metamask/superstruct":3037,"@metamask/utils":3217,"@scure/base":3297,"fast-json-stable-stringify":4452,"validate-npm-package-name":5812},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.verifyRequestedSnapPermissions=n.isSnapPermitted=n.assertIsValidSnapId=n.isSnapId=n.stripSnapPrefix=n.getSnapPrefix=n.SnapIdStruct=n.SnapIdPrefixStruct=n.HttpSnapIdStruct=n.NpmSnapIdStruct=n.LocalSnapIdStruct=n.BaseSnapIdStruct=n.LOCALHOST_HOSTNAMES=n.validateSnapShasum=n.getSnapChecksum=n.SnapStatusEvents=n.SnapStatus=n.PROPOSED_NAME_REGEX=void 0;const r=e("@metamask/snaps-sdk"),s=e("@metamask/superstruct"),i=e("@metamask/utils"),o=e("@scure/base"),c=a(e("fast-json-stable-stringify")),l=a(e("validate-npm-package-name")),u=e("./caveats.cjs"),d=e("./checksum.cjs"),h=e("./types.cjs");var m,f;function p(e){const t=e.clone();return delete t.result.source.shasum,t.value=(0,c.default)(t.result),t}async function g(e){const{manifest:t,sourceCode:n,svgIcon:a,auxiliaryFiles:r,localizationFiles:s}=e,i=[p(t),n,a,...r,...s].filter(e=>e!==undefined);return o.base64.encode(await(0,d.checksumFiles)(i))}n.PROPOSED_NAME_REGEX=/^(?:[A-Za-z0-9-_]+( [A-Za-z0-9-_]+)*)|(?:(?:@[A-Za-z0-9-*~][A-Za-z0-9-*._~]*\/)?[A-Za-z0-9-~][A-Za-z0-9-._~]*)$/u,function(e){e.Installing="installing",e.Updating="updating",e.Running="running",e.Stopped="stopped",e.Crashed="crashed"}(m||(n.SnapStatus=m={})),function(e){e.Start="START",e.Stop="STOP",e.Crash="CRASH",e.Update="UPDATE"}(f||(n.SnapStatusEvents=f={})),n.getSnapChecksum=g,n.validateSnapShasum=async function(e,t="Invalid Snap manifest: manifest shasum does not match computed shasum."){if(e.manifest.result.source.shasum!==await g(e))throw new Error(t)},n.LOCALHOST_HOSTNAMES=["localhost","127.0.0.1","[::1]"],n.BaseSnapIdStruct=(0,i.definePattern)("Base Snap Id",/^[\x21-\x7E]*$/u);const T=(0,h.uri)({protocol:(0,s.enums)(["http:","https:"]),hostname:(0,s.enums)(n.LOCALHOST_HOSTNAMES),hash:(0,s.empty)((0,s.string)()),search:(0,s.empty)((0,s.string)())});function w(e){const t=Object.values(h.SnapIdPrefixes).find(t=>e.startsWith(t));if(t!==undefined)return t;throw new Error(`Invalid or no prefix found for "${e}"`)}n.LocalSnapIdStruct=(0,s.refine)(n.BaseSnapIdStruct,"local Snap Id",e=>{if(!e.startsWith(h.SnapIdPrefixes.local))return`Expected local snap ID, got "${e}".`;const[t]=(0,s.validate)(e.slice(h.SnapIdPrefixes.local.length),T);return t??!0}),n.NpmSnapIdStruct=(0,s.intersection)([n.BaseSnapIdStruct,(0,h.uri)({protocol:(0,s.literal)(h.SnapIdPrefixes.npm),pathname:(0,s.refine)((0,s.string)(),"package name",function*(e){const t=e.startsWith("/")?e.slice(1):e,{errors:n,validForNewPackages:a,warnings:r}=(0,l.default)(t);return a||(n===undefined?((0,i.assert)(r!==undefined),yield*r):yield*n),!0}),search:(0,s.empty)((0,s.string)()),hash:(0,s.empty)((0,s.string)())})]),n.HttpSnapIdStruct=(0,s.intersection)([n.BaseSnapIdStruct,(0,h.uri)({protocol:(0,s.enums)(["http:","https:"]),search:(0,s.empty)((0,s.string)()),hash:(0,s.empty)((0,s.string)())})]),n.SnapIdPrefixStruct=(0,s.refine)((0,s.string)(),"Snap ID prefix",e=>{if(Object.values(h.SnapIdPrefixes).some(t=>e.startsWith(t)))return!0;return`Invalid or no prefix found. Expected Snap ID to start with one of: ${Object.values(h.SnapIdPrefixes).map(e=>`"${e}"`).join(", ")}, but received: "${e}"`}),n.SnapIdStruct=(0,r.selectiveUnion)(e=>"string"==typeof e&&e.startsWith(h.SnapIdPrefixes.npm)?n.NpmSnapIdStruct:"string"==typeof e&&e.startsWith(h.SnapIdPrefixes.local)?n.LocalSnapIdStruct:n.SnapIdPrefixStruct),n.getSnapPrefix=w,n.stripSnapPrefix=function(e){return e.replace(w(e),"")},n.isSnapId=function(e){return(0,s.is)(e,n.SnapIdStruct)},n.assertIsValidSnapId=function(e){(0,i.assertStruct)(e,n.SnapIdStruct,"Invalid snap ID")},n.isSnapPermitted=function(e,t){var n,a;return Boolean(null===(n=((null==e||null===(a=e.wallet_snap)||void 0===a||null===(a=a.caveats)||void 0===a?void 0:a.find(e=>e.type===u.SnapCaveatType.SnapIds))??{}).value)||void 0===n?void 0:n[t])},n.verifyRequestedSnapPermissions=function(e){(0,i.assert)((0,i.isObject)(e),"Requested permissions must be an object.");const{wallet_snap:t}=e;(0,i.assert)((0,i.isObject)(t),"wallet_snap is missing from the requested permissions.");const{caveats:n}=t;(0,i.assert)(Array.isArray(n)&&1===n.length,"wallet_snap must have a caveat property with a single-item array value.");const[a]=n;(0,i.assert)((0,i.isObject)(a)&&a.type===u.SnapCaveatType.SnapIds&&(0,i.isObject)(a.value),`The requested permissions do not have a valid ${u.SnapCaveatType.SnapIds} caveat.`)}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/snaps.cjs"}],[3014,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.indent=void 0,n.indent=function(e,t=2){return e.replace(/^/gmu," ".repeat(t))}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/strings.cjs"}],[3015,{"./strings.cjs":3014,"@metamask/snaps-sdk":2887,"@metamask/superstruct":3037,"@metamask/utils":3217,chalk:4159},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.mergeStructs=n.createUnion=n.validateUnion=n.getStructErrorMessage=n.getStructFailureMessage=n.getStructErrorPrefix=n.getUnionStructNames=n.getStructFromPath=n.createFromStruct=n.getError=n.arrayToGenerator=n.SnapsStructError=n.named=void 0;const a=e("@metamask/snaps-sdk"),r=e("@metamask/superstruct"),s=e("@metamask/utils"),i=e("chalk"),o=e("./strings.cjs");function c(e,t,n){return n?t(e):e}n.named=function(e,t){return new r.Struct({...t,type:e})};class l extends r.StructError{constructor(e,t,n,a,r,s=!0){super(a,r),this.name="SnapsStructError",this.message=`${t}.\n\n${g(e,[...r()],s)}${n?`\n\n${n}`:""}`}}function*u(e){for(const t of e)yield t}function d({struct:e,prefix:t,suffix:n="",error:a,colorize:r}){return new l(e,t,n,a,()=>u(a.failures()),r)}function h(e,t){return t.reduce((t,n)=>(0,s.isObject)(e.schema)&&e.schema[n]?e.schema[n]:t,e)}function m(e,t=!0){return Array.isArray(e.schema)?e.schema.map(({type:e})=>c(e,i.green,t)):null}function f(e,t=!0){return"never"===e.type||0===e.path.length?"":`At path: ${c(e.path.join("."),i.bold,t)} — `}function p(e,t,n=!0){const a=c(JSON.stringify(t.value),i.red,n),r=f(t,n);if("union"===t.type){const s=m(h(e,t.path),n);return s?`${r}Expected the value to be one of: ${s.join(", ")}, but received: ${a}.`:`${r}${t.message}.`}if("literal"===t.type){return`${r}${t.message.replace(/the literal `(.+)`,/u,`the value to be \`${c("$1",i.green,n)}\`,`).replace(/, but received: (.+)/u,`, but received: ${c("$1",i.red,n)}`)}.`}if("never"===t.type)return`Unknown key: ${c(t.path.join("."),i.bold,n)}, received: ${a}.`;if("size"===t.refinement){return`${r}${t.message.replace(/length between `(\d+)` and `(\d+)`/u,`length between ${c("$1",i.green,n)} and ${c("$2",i.green,n)},`).replace(/length of `(\d+)`/u,`length of ${c("$1",i.red,n)}`).replace(/a array/u,"an array")}.`}return t.refinement!==undefined?`${r}${t.message}.`:`${r}Expected a value of type ${c(t.type,i.green,n)}, but received: ${a}.`}function g(e,t,n=!0){return t.map(t=>(0,o.indent)(`• ${p(e,t,n)}`)).join("\n")}function T(e,t,n,i=!1){(0,s.assert)(t.schema,"Expected a struct with a schema. Make sure to use `union` from `@metamask/snaps-sdk`."),(0,s.assert)(t.schema.length>0,"Expected a non-empty array of structs.");const o=t.schema.map(e=>e.schema[n]),c=(0,r.type)({[n]:(0,a.union)(o)}),[l]=(0,r.validate)(e,c,{coerce:i});if(l)throw new Error(p(c,l.failures()[0],!1));const u=e,d=t.schema.filter(e=>(0,r.is)(u[n],e.schema[n]));(0,s.assert)(d.length>0,"Expected a struct to match the value.");const h=d.map(e=>(0,r.validate)(u,e,{coerce:i})),m=h.find(([e])=>!e);if(m)return m[1];(0,s.assert)(h[0][0],"Expected at least one error.");const f=h.reduce((e,[t])=>((0,s.assert)(t,"Expected an error."),t.failures().length<e.failures().length?t:e),h[0][0]);throw new Error(p(t,f.failures()[0],!1))}n.SnapsStructError=l,n.arrayToGenerator=u,n.getError=d,n.createFromStruct=function(e,t,n,a=""){try{return(0,r.create)(e,t)}catch(e){if(e instanceof r.StructError)throw d({struct:t,prefix:n,suffix:a,error:e});throw e}},n.getStructFromPath=h,n.getUnionStructNames=m,n.getStructErrorPrefix=f,n.getStructFailureMessage=p,n.getStructErrorMessage=g,n.validateUnion=T,n.createUnion=function(e,t,n){return T(e,t,n,!0)},n.mergeStructs=function(...e){const t=r.assign(...e);return new r.Struct({...t,*refiner(t,n){for(const a of e)yield*a.refiner(t,n)}})}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/structs.cjs"}],[3016,{"@metamask/utils":3217,"fast-xml-parser":4454},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isSvg=n.parseSvg=void 0;const a=e("@metamask/utils"),r=e("fast-xml-parser");function s(e){try{const t=e.trim();(0,a.assert)(t.length>0);const n=new r.XMLParser({ignoreAttributes:!1,parseAttributeValue:!0}).parse(t,!0);return(0,a.assert)((0,a.hasProperty)(n,"svg")),(0,a.isObject)(n.svg)?n.svg:{}}catch{throw new Error("Snap icon must be a valid SVG.")}}n.parseSvg=s,n.isSvg=function(e){try{return s(e),!0}catch{return!1}}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/svg.cjs"}],[3017,{"@metamask/snaps-sdk":2887,"@metamask/superstruct":3037,luxon:4912},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ISO8601DateStruct=n.toCensoredISO8601String=n.ISO8601DurationStruct=void 0;const a=e("@metamask/superstruct"),r=e("luxon");n.ISO8601DurationStruct=(0,a.refine)((0,a.string)(),"ISO 8601 duration",e=>!!r.Duration.fromISO(e).isValid||"Not a valid ISO 8601 duration"),n.toCensoredISO8601String=function(e){return r.DateTime.fromISO(e,{setZone:!0}).startOf("second").toISO({suppressMilliseconds:!0})};var s=e("@metamask/snaps-sdk");Object.defineProperty(n,"ISO8601DateStruct",{enumerable:!0,get:function(){return s.ISO8601DateStruct}})}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/time.cjs"}],[3018,{"@metamask/snaps-sdk":2887,"@metamask/superstruct":3037,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.WALLET_SNAP_PERMISSION_KEY=n.isValidUrl=n.uri=n.SNAP_STREAM_NAMES=n.SnapIdPrefixes=n.NpmSnapPackageJsonStruct=n.NameStruct=n.NpmSnapFileNames=void 0;const a=e("@metamask/snaps-sdk"),r=e("@metamask/superstruct"),s=e("@metamask/utils");var i,o,c;!function(e){e.PackageJson="package.json",e.Manifest="snap.manifest.json"}(i||(n.NpmSnapFileNames=i={})),n.NameStruct=(0,r.size)((0,s.definePattern)("Snap Name",/^(?:@[a-z0-9-*~][a-z0-9-*._~]*\/)?[a-z0-9-~][a-z0-9-._~]*$/u),1,214),n.NpmSnapPackageJsonStruct=(0,r.type)({version:s.VersionStruct,name:n.NameStruct,main:(0,r.optional)((0,r.size)((0,r.string)(),1,Infinity)),repository:(0,r.optional)((0,r.type)({type:(0,r.size)((0,r.string)(),1,Infinity),url:(0,r.size)((0,r.string)(),1,Infinity)}))}),function(e){e.npm="npm:",e.local="local:"}(o||(n.SnapIdPrefixes=o={})),function(e){e.JSON_RPC="jsonRpc",e.COMMAND="command"}(c||(n.SNAP_STREAM_NAMES=c={}));var l=e("@metamask/snaps-sdk");Object.defineProperty(n,"uri",{enumerable:!0,get:function(){return l.uri}}),n.isValidUrl=function(e,t={}){return(0,r.is)(e,(0,a.uri)(t))},n.WALLET_SNAP_PERMISSION_KEY="wallet_snap"}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/types.cjs"}],[3019,{"./types.cjs":3018,"./url.cjs":3020,"@metamask/snaps-sdk":2887,"@metamask/snaps-sdk/jsx":2974,"@metamask/snaps-sdk/jsx-runtime":2973,"@metamask/utils":3217,marked:4913},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.serialiseJsx=n.walkJsx=n.getJsxChildren=n.hasChildren=n.getTotalTextLength=n.validateJsxElements=n.validateAssetSelector=n.validateTextLinks=n.validateLink=n.getJsxElementFromComponent=n.getTextChildren=void 0;const a=e("@metamask/snaps-sdk/jsx-runtime"),r=e("@metamask/snaps-sdk"),s=e("@metamask/snaps-sdk/jsx"),i=e("@metamask/utils"),o=e("marked"),c=e("./types.cjs"),l=e("./url.cjs"),u=["https:","mailto:","metamask:"];function d(e){switch(e){case"primary":return"primary";case"secondary":return"destructive";default:return undefined}}function h(e){return 1===e.length?e[0]:e}function m(e){return e.tokens&&e.tokens.length>0?h(e.tokens.flatMap(p)):e.href}function f(e){return h(e.flatMap(p))}function p(e){switch(e.type){case"link":return(0,a.jsx)(s.Link,{href:e.href,children:m(e)});case"text":return e.text;case"strong":return(0,a.jsx)(s.Bold,{children:f(e.tokens)});case"em":return(0,a.jsx)(s.Italic,{children:f(e.tokens)});default:return null}}function g(e){const t=(0,o.lexer)(e,{gfm:!1}),n=[];return(0,o.walkTokens)(t,e=>{if("paragraph"===e.type){n.length>0&&n.push("\n\n");const{tokens:t}=e;n.push(...t.flatMap(p))}}),n.filter(e=>null!==e)}function T(e,t,n){try{const a=new URL(e);if((0,i.assert)(u.includes(a.protocol),`Protocol must be one of: ${u.join(", ")}.`),"metamask:"===a.protocol){const t=(0,l.parseMetaMaskUrl)(e);t.snapId&&(0,i.assert)(n(t.snapId),"The Snap being navigated to is not installed.")}else if("mailto:"===a.protocol){const e=a.pathname.split(",");for(const n of e){const e=n.split("@")[1];(0,i.assert)(!e.includes(":"));const a=`https://${e}`;(0,i.assert)(!t(a),"The specified URL is not allowed.")}return}(0,i.assert)(!t(a.href),"The specified URL is not allowed.")}catch(e){throw new Error(`Invalid URL: ${"ERR_ASSERTION"===(null==e?void 0:e.code)?e.message:"Unable to parse URL."}`)}}function w(e,t){const n=t(e);(0,i.assert)(n,`Could not find account for address: ${e}`)}function b(e){const{type:t}=e;switch(t){case r.NodeType.Panel:return e.children.reduce((e,t)=>e+b(t),0);case r.NodeType.Row:return b(e.value);case r.NodeType.Text:return e.value.length;default:return 0}}function E(e){return(0,i.hasProperty)(e.props,"children")}function y(e){return Boolean(e)&&!0!==e}function S(e){if(E(e)){if(Array.isArray(e.props.children))return e.props.children.filter(y).flat(Infinity);if(e.props.children)return[e.props.children]}return[]}function k(e,t,n=0){if(Array.isArray(e)){for(const a of e){const e=k(a,t,n);if(e!==undefined)return e}return undefined}const a=t(e,n);if(a!==undefined)return a;if((0,i.hasProperty)(e,"props")&&(0,i.isPlainObject)(e.props)&&(0,i.hasProperty)(e.props,"children")){const a=S(e);for(const e of a)if((0,i.isPlainObject)(e)){const a=k(e,t,n+1);if(a!==undefined)return a}}return undefined}function I(e){return Object.entries(e).filter(([e])=>"children"!==e).sort(([e],[t])=>e.localeCompare(t)).map(([e,t])=>{return` ${e}=${n=t,"string"==typeof n?`"${n}"`:`{${JSON.stringify(n)}}`}`;var n}).join("")}n.getTextChildren=g,n.getJsxElementFromComponent=function(e){return function(e){const t=b(e);(0,i.assert)(t<=5e4,"The text in a Snap UI may not be larger than 50 kB.")}(e),function e(t){switch(t.type){case r.NodeType.Address:return(0,a.jsx)(s.Address,{address:t.value});case r.NodeType.Button:return(0,a.jsx)(s.Button,{name:t.name,variant:d(t.variant),type:t.buttonType,children:t.value});case r.NodeType.Copyable:return(0,a.jsx)(s.Copyable,{value:t.value,sensitive:t.sensitive});case r.NodeType.Divider:return(0,a.jsx)(s.Divider,{});case r.NodeType.Form:return(0,a.jsx)(s.Form,{name:t.name,children:h(t.children.map(e))});case r.NodeType.Heading:return(0,a.jsx)(s.Heading,{children:t.value});case r.NodeType.Image:return(0,a.jsx)(s.Image,{src:t.value});case r.NodeType.Input:return(0,a.jsx)(s.Field,{label:t.label,error:t.error,children:(0,a.jsx)(s.Input,{name:t.name,type:t.inputType,value:t.value,placeholder:t.placeholder})});case r.NodeType.Panel:return(0,a.jsx)(s.Box,{children:h(t.children.map(e))});case r.NodeType.Row:return(0,a.jsx)(s.Row,{label:t.label,variant:t.variant,children:e(t.value)});case r.NodeType.Spinner:return(0,a.jsx)(s.Spinner,{});case r.NodeType.Text:return(0,a.jsx)(s.Text,{children:h(g(t.value))});default:return(0,i.assertExhaustive)(t)}}(e)},n.validateLink=T,n.validateTextLinks=function(e,t,n){const a=function(e){const t=(0,o.lexer)(e,{gfm:!1}),n=[];return(0,o.walkTokens)(t,e=>{"link"===e.type&&n.push(e)}),n}(e);for(const e of a)T(e.href,t,n)},n.validateAssetSelector=w,n.validateJsxElements=function(e,{isOnPhishingList:t,getSnap:n,getAccountByAddress:a,hasPermission:r}){k(e,e=>{switch(e.type){case"Link":T(e.props.href,t,n);break;case"AssetSelector":w(e.props.addresses[0],a);break;case"Image":{const{src:t}=e.props,n=(0,c.isValidUrl)(t);(0,i.assert)(!n||n&&r("endowment:network-access"),"Using external images is only permitted with the `endowment:network-access` permission.");break}}})},n.getTotalTextLength=b,n.hasChildren=E,n.getJsxChildren=S,n.walkJsx=k,n.serialiseJsx=function e(t,n=0){if(Array.isArray(t))return t.map(t=>e(t,n)).join("");const a="  ".repeat(n);if("string"==typeof t)return`${a}${t}\n`;if(!t)return"";const{type:r,props:s}=t,o=n>0?"\n":"";if((0,i.hasProperty)(s,"children")){const t=e(s.children,n+1);return`${a}<${r}${I(s)}>\n${t}${a}</${r}>${o}`}return`${a}<${r}${I(s)} />${o}`}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/ui.cjs"}],[3020,{"./snaps.cjs":3013,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.parseMetaMaskUrl=n.SNAP_PATHS=n.CLIENT_PATHS=void 0;const a=e("@metamask/utils"),r=e("./snaps.cjs");n.CLIENT_PATHS=["/"],n.SNAP_PATHS=["/home"],n.parseMetaMaskUrl=function(e){const t=new URL(e),{protocol:s}=t;if("metamask:"!==s)throw new Error(`Unable to parse URL. Expected the protocol to be "metamask:", but received "${s}".`);const[i,...o]=t.href.replace("metamask://","").split("/"),c=`/${o.join("/")}`;switch(i){case"client":return(0,a.assert)(n.CLIENT_PATHS.includes(c),`Unable to navigate to "${c}". The provided path is not allowed.`),{authority:i,path:c};case"snap":return function(e){const t="Invalid MetaMask url:",s=(0,r.stripSnapPrefix)(e.slice(1)),i=e.slice(1).startsWith("npm:")?"npm:":"local:",o=s.startsWith("@"),c=s.split("/"),l=`/${c[c.length-1]}`;let u;if("local:"===i){const[e,,...r]=c.slice(0,-1);u=`${e}//${r.join("/")}`,(0,a.assert)(n.SNAP_PATHS.includes(l),`${t} invalid snap path.`)}else u=o?`${c[0]}/${c[1]}`:c[0],(0,a.assert)(o?3===c.length&&n.SNAP_PATHS.includes(l):2===c.length&&n.SNAP_PATHS.includes(l),`${t} invalid snap path.`);const d=`${i}${u}`;return(0,r.assertIsValidSnapId)(d),{authority:"snap",snapId:d,path:l}}(c);default:throw new Error(`Expected "metamask:" URL to start with "client" or "snap", but received "${i}".`)}}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/url.cjs"}],[3021,{"./icon.cjs":3002,"./localization.cjs":3007,"./manifest/validation.cjs":3010,"./snaps.cjs":3013},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateFetchedSnap=void 0;const a=e("./icon.cjs"),r=e("./localization.cjs"),s=e("./manifest/validation.cjs"),i=e("./snaps.cjs");n.validateFetchedSnap=async function(e){(0,s.assertIsSnapManifest)(e.manifest.result),await(0,i.validateSnapShasum)(e),(0,r.validateSnapManifestLocalizations)(e.manifest.result,e.localizationFiles.map(e=>e.result)),e.svgIcon&&(0,a.assertIsSnapIcon)(e.svgIcon)}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/validation.cjs"}],[3022,{"@metamask/superstruct":3037,"@metamask/utils":3217,semver:5649},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.resolveVersionRange=n.getTargetVersion=n.DEFAULT_REQUESTED_SNAP_VERSION=void 0;const a=e("@metamask/superstruct"),r=e("@metamask/utils"),s=e("semver");n.DEFAULT_REQUESTED_SNAP_VERSION="*",n.getTargetVersion=function(e,t){const n=(0,s.maxSatisfying)(e,t);return n||(0,s.maxSatisfying)(e,t,{includePrerelease:!0})},n.resolveVersionRange=function(e){return e===undefined||"latest"===e?[undefined,n.DEFAULT_REQUESTED_SNAP_VERSION]:(0,a.validate)(e,r.VersionRangeStruct)}}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/versions.cjs"}],[3023,{"../deep-clone.cjs":2986,"@metamask/utils":3217,"@scure/base":3297},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.VirtualFile=void 0;const r=e("@metamask/utils"),s=e("@scure/base"),i=e("../deep-clone.cjs");class o{constructor(e){var t,n,r,s;let i;a(this,"value",void 0),a(this,"result",void 0),a(this,"data",void 0),a(this,"path",void 0),i="string"==typeof e||e instanceof Uint8Array?{value:e}:e,this.value=(null===(t=i)||void 0===t?void 0:t.value)??"",this.result=(null===(n=i)||void 0===n?void 0:n.result)??undefined,this.data=(null===(r=i)||void 0===r?void 0:r.data)??{},this.path=(null===(s=i)||void 0===s?void 0:s.path)??"/"}get size(){return"string"==typeof this.value?this.value.length:this.value.byteLength}toString(e){if("string"==typeof this.value)return(0,r.assert)(e===undefined,"Tried to encode string."),this.value;if(this.value instanceof Uint8Array&&"hex"===e)return(0,r.bytesToHex)(this.value);if(this.value instanceof Uint8Array&&"base64"===e)return s.base64.encode(this.value);return new TextDecoder(e).decode(this.value)}clone(){const e=new o;return"string"==typeof this.value?e.value=this.value:e.value=this.value.slice(0),e.result=(0,i.deepClone)(this.result),e.data=(0,i.deepClone)(this.data),e.path=this.path,e}}n.VirtualFile=o}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/virtual-file/VirtualFile.cjs"}],[3024,{"./VirtualFile.cjs":3023},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a=Object.create?function(e,t,n,a){a===undefined&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){a===undefined&&(a=n),e[a]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||a(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./VirtualFile.cjs"),n)}}},{package:"@metamask/snaps-utils",file:"node_modules/@metamask/snaps-utils/dist/virtual-file/index.cjs"}],[3029,{"./constants.cjs":3031,"./types.cjs":3034,"@metamask/polling-controller":2561,"@metamask/transaction-controller":3095,"bignumber.js":3035},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l,u,d,h,m,f,p,g,T,w,b=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},E=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.SubscriptionController=n.getDefaultSubscriptionControllerState=void 0;const y=e("@metamask/polling-controller"),S=e("@metamask/transaction-controller"),k=e("bignumber.js"),I=e("./constants.cjs"),A=e("./types.cjs");function _(){return{subscriptions:[],trialedProducts:[]}}n.getDefaultSubscriptionControllerState=_;const C={subscriptions:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},lastSubscription:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},customerId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},trialedProducts:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},pricing:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},lastSelectedPaymentMethod:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0}};class P extends((0,y.StaticIntervalPollingController)()){constructor({messenger:e,state:t,subscriptionService:n,pollingInterval:i=I.DEFAULT_POLLING_INTERVAL}){super({name:I.controllerName,metadata:C,state:{subscriptions:[],trialedProducts:[],...t},messenger:e}),a.add(this),r.set(this,void 0),this.setIntervalLength(i),b(this,r,n,"f"),E(this,a,"m",s).call(this)}async getPricing(){const e=await E(this,r,"f").getPricing();return this.update(t=>{t.pricing=e}),e}async getSubscriptions(){const e=this.state.subscriptions,t=this.state.trialedProducts,n=this.state.customerId,s=this.state.lastSubscription,{customerId:i,subscriptions:o,trialedProducts:c,lastSubscription:l}=await E(this,r,"f").getSubscriptions(),u=E(this,a,"m",g).call(this,e,o),d=E(this,a,"m",p).call(this,t,c),h=E(this,a,"m",T).call(this,s,l);return u&&h&&d&&n===i||(this.update(e=>{e.subscriptions=o,e.customerId=i,e.trialedProducts=c,e.lastSubscription=l}),this.triggerAccessTokenRefresh()),o}getSubscriptionByProduct(e){return this.state.subscriptions.find(t=>t.products.some(t=>t.name===e))}async getSubscriptionsEligibilities(e){return await E(this,r,"f").getSubscriptionsEligibilities(e)}async cancelSubscription(e){E(this,a,"m",d).call(this,{subscriptionId:e.subscriptionId});const t=await E(this,r,"f").cancelSubscription({subscriptionId:e.subscriptionId});this.update(n=>{n.subscriptions=n.subscriptions.map(n=>n.id===e.subscriptionId?{...n,...t}:n)}),this.triggerAccessTokenRefresh()}async unCancelSubscription(e){E(this,a,"m",d).call(this,{subscriptionId:e.subscriptionId});const t=await E(this,r,"f").unCancelSubscription({subscriptionId:e.subscriptionId});this.update(n=>{n.subscriptions=n.subscriptions.map(n=>n.id===e.subscriptionId?{...n,...t}:n)}),this.triggerAccessTokenRefresh()}async startShieldSubscriptionWithCard(e){E(this,a,"m",u).call(this,{products:e.products});return await E(this,r,"f").startSubscriptionWithCard(e)}async startSubscriptionWithCrypto(e){E(this,a,"m",u).call(this,{products:e.products});return await E(this,r,"f").startSubscriptionWithCrypto(e)}async submitShieldSubscriptionCryptoApproval(e,t,n){if(e.type!==S.TransactionType.shieldSubscriptionApprove)return;const{chainId:r,rawTx:s}=e;if(!r||!s)throw new Error("Chain ID or raw transaction not found");const{pricing:i,trialedProducts:o,lastSelectedPaymentMethod:u}=this.state;if(!i)throw new Error("Subscription pricing not found");if(!u)throw new Error("Last selected payment method not found");const d=u[A.PRODUCT_TYPES.SHIELD];E(this,a,"m",h).call(this,d);const m=E(this,a,"m",c).call(this,A.PRODUCT_TYPES.SHIELD,d.plan),f=o?.includes(A.PRODUCT_TYPES.SHIELD);await this.getSubscriptions();const p=this.state.subscriptions.find(e=>e.products.some(e=>e.name===A.PRODUCT_TYPES.SHIELD));E(this,a,"m",l).call(this,{product:A.PRODUCT_TYPES.SHIELD});if(Boolean(p))await this.updatePaymentMethod({paymentType:A.PAYMENT_TYPES.byCrypto,subscriptionId:p.id,chainId:r,payerAddress:e.txParams.from,tokenSymbol:d.paymentTokenSymbol,rawTransaction:s,recurringInterval:m.interval,billingCycles:m.minBillingCycles});else{const a={products:[A.PRODUCT_TYPES.SHIELD],isTrialRequested:!f,recurringInterval:m.interval,billingCycles:m.minBillingCycles,chainId:r,payerAddress:e.txParams.from,tokenSymbol:d.paymentTokenSymbol,rawTransaction:s,isSponsored:t,useTestClock:d.useTestClock,rewardAccountId:n};await this.startSubscriptionWithCrypto(a)}await this.getSubscriptions()}getCryptoApproveTransactionParams(e){const{pricing:t}=this.state;if(!t)throw new Error("Subscription pricing not found");const n=t.products.find(t=>t.name===e.productType);if(!n)throw new Error("Product price not found");const a=n.prices.find(t=>t.interval===e.interval);if(!a)throw new Error("Price not found");const r=t.paymentMethods.find(e=>e.type===A.PAYMENT_TYPES.byCrypto);if(!r)throw new Error("Chains payment info not found");const s=r.chains?.find(t=>t.chainId===e.chainId);if(!s)throw new Error("Invalid chain id");const i=s.tokens.find(t=>t.address===e.paymentTokenAddress);if(!i)throw new Error("Invalid token address");return{approveAmount:this.getTokenApproveAmount(a,i),paymentAddress:s.paymentAddress,paymentTokenAddress:e.paymentTokenAddress,chainId:e.chainId}}async updatePaymentMethod(e){if(e.paymentType===A.PAYMENT_TYPES.byCard){const{paymentType:t,...n}=e;return await E(this,r,"f").updatePaymentMethodCard(n)}if(e.paymentType===A.PAYMENT_TYPES.byCrypto){const{paymentType:t,...n}=e;return await E(this,r,"f").updatePaymentMethodCrypto(n),await this.getSubscriptions()}throw new Error("Invalid payment type")}async getBillingPortalUrl(){return await E(this,r,"f").getBillingPortalUrl()}cacheLastSelectedPaymentMethod(e,t){if(!(t.type!==A.PAYMENT_TYPES.byCrypto||t.paymentTokenAddress&&t.paymentTokenSymbol))throw new Error(I.SubscriptionControllerErrorMessage.PaymentTokenAddressAndSymbolRequiredForCrypto);this.update(n=>{n.lastSelectedPaymentMethod={...n.lastSelectedPaymentMethod,[e]:t}})}async submitSponsorshipIntents(e){if(0===e.products.length)throw new Error(I.SubscriptionControllerErrorMessage.SubscriptionProductsEmpty);E(this,a,"m",u).call(this,{products:e.products});const t=this.state.lastSelectedPaymentMethod?.[e.products[0]];E(this,a,"m",h).call(this,t);if(!E(this,a,"m",m).call(this,e.chainId,e.products))return!1;const{paymentTokenSymbol:n,plan:s}=t,i=E(this,a,"m",c).call(this,e.products[0],s).minBillingCycles;return await E(this,r,"f").submitSponsorshipIntents({...e,paymentTokenSymbol:n,billingCycles:i,recurringInterval:s}),!0}async submitUserEvent(e){await E(this,r,"f").submitUserEvent(e)}async assignUserToCohort(e){await E(this,r,"f").assignUserToCohort(e)}async linkRewards(e){E(this,a,"m",d).call(this,{subscriptionId:e.subscriptionId});if(!(await E(this,r,"f").linkRewards({rewardAccountId:e.rewardAccountId})).success)throw new Error(I.SubscriptionControllerErrorMessage.LinkRewardsFailed)}async _executePoll(){await this.getSubscriptions()}getTokenApproveAmount(e,t){const n=t.conversionRate[e.currency];if(!n)throw new Error("Conversion rate not found");const r=new k.BigNumber(E(this,a,"m",i).call(this,e)),s=new k.BigNumber(10).pow(t.decimals);return r.multipliedBy(s).div(n).toFixed(0)}getTokenMinimumBalanceAmount(e,t){const n=t.conversionRate[e.currency];if(!n)throw new Error("Conversion rate not found");const r=new k.BigNumber(E(this,a,"m",o).call(this,e)),s=new k.BigNumber(10).pow(t.decimals);return r.multipliedBy(s).div(n).toFixed(0)}triggerAccessTokenRefresh(){this.messenger.call("AuthenticationController:performSignOut")}}n.SubscriptionController=P,r=new WeakMap,a=new WeakSet,s=function(){this.messenger.registerActionHandler("SubscriptionController:getSubscriptions",this.getSubscriptions.bind(this)),this.messenger.registerActionHandler("SubscriptionController:getSubscriptionByProduct",this.getSubscriptionByProduct.bind(this)),this.messenger.registerActionHandler("SubscriptionController:cancelSubscription",this.cancelSubscription.bind(this)),this.messenger.registerActionHandler("SubscriptionController:startShieldSubscriptionWithCard",this.startShieldSubscriptionWithCard.bind(this)),this.messenger.registerActionHandler("SubscriptionController:getPricing",this.getPricing.bind(this)),this.messenger.registerActionHandler("SubscriptionController:getCryptoApproveTransactionParams",this.getCryptoApproveTransactionParams.bind(this)),this.messenger.registerActionHandler("SubscriptionController:startSubscriptionWithCrypto",this.startSubscriptionWithCrypto.bind(this)),this.messenger.registerActionHandler("SubscriptionController:updatePaymentMethod",this.updatePaymentMethod.bind(this)),this.messenger.registerActionHandler("SubscriptionController:getBillingPortalUrl",this.getBillingPortalUrl.bind(this)),this.messenger.registerActionHandler(`${I.controllerName}:submitSponsorshipIntents`,this.submitSponsorshipIntents.bind(this)),this.messenger.registerActionHandler(`${I.controllerName}:submitShieldSubscriptionCryptoApproval`,this.submitShieldSubscriptionCryptoApproval.bind(this)),this.messenger.registerActionHandler(`${I.controllerName}:linkRewards`,this.linkRewards.bind(this))},i=function(e){return new k.BigNumber(e.unitAmount).div(10**e.unitDecimals).multipliedBy(e.minBillingCycles).toString()},o=function(e){return new k.BigNumber(e.unitAmount).div(10**e.unitDecimals).multipliedBy(e.minBillingCyclesForBalance).toString()},c=function(e,t){const{pricing:n}=this.state,a=n?.products.find(t=>t.name===e),r=a?.prices.find(e=>e.interval===t);if(!r)throw new Error(I.SubscriptionControllerErrorMessage.ProductPriceNotFound);return r},l=function({product:e}){const t=this.state.subscriptions.find(t=>t.products.some(t=>t.name===e));if(!(!t||[A.SUBSCRIPTION_STATUSES.pastDue,A.SUBSCRIPTION_STATUSES.unpaid,A.SUBSCRIPTION_STATUSES.paused,A.SUBSCRIPTION_STATUSES.provisional,A.SUBSCRIPTION_STATUSES.active,A.SUBSCRIPTION_STATUSES.trialing].includes(t.status)))throw new Error(I.SubscriptionControllerErrorMessage.SubscriptionNotValidForCryptoApproval)},u=function({products:e}){const t=this.state.subscriptions.find(t=>t.products.some(t=>e.includes(t.name)));if(t&&I.ACTIVE_SUBSCRIPTION_STATUSES.includes(t.status))throw new Error(I.SubscriptionControllerErrorMessage.UserAlreadySubscribed)},d=function(e){if(!this.state.subscriptions.find(t=>t.id===e.subscriptionId))throw new Error(I.SubscriptionControllerErrorMessage.UserNotSubscribed)},h=function(e){if(!e||e.type!==A.PAYMENT_TYPES.byCrypto||!e.paymentTokenAddress||!e.paymentTokenSymbol)throw new Error(I.SubscriptionControllerErrorMessage.PaymentMethodNotCrypto)},m=function(e,t){const n=E(this,a,"m",f).call(this,e),r=this.state.trialedProducts.some(e=>t.includes(e));return n&&!r},f=function(e){const t=this.state.pricing?.paymentMethods.find(e=>e.type===A.PAYMENT_TYPES.byCrypto),n=t?.chains?.find(t=>t.chainId===e)?.isSponsorshipSupported;return Boolean(n)},p=function(e,t){return e.length===t?.length&&e.every(e=>t?.includes(e))},g=function(e,t){if(e.length!==t.length)return!1;const n=[...e].sort((e,t)=>e.id.localeCompare(t.id)),r=[...t].sort((e,t)=>e.id.localeCompare(t.id));return n.every((e,t)=>{const n=r[t];return E(this,a,"m",T).call(this,e,n)})},T=function(e,t){return e&&t?E(this,a,"m",w).call(this,e)===E(this,a,"m",w).call(this,t):!e&&!t},w=function(e){const t={...e,products:[...e.products].sort((e,t)=>e.name.localeCompare(t.name))};return JSON.stringify(t)}}}},{package:"@metamask/subscription-controller",file:"node_modules/@metamask/subscription-controller/dist/SubscriptionController.cjs"}],[3030,{"./constants.cjs":3031,"./errors.cjs":3032,"@metamask/controller-utils":1494},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},c=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.SubscriptionService=n.SUBSCRIPTION_URL=void 0;const l=e("@metamask/controller-utils"),u=e("./constants.cjs"),d=e("./errors.cjs");n.SUBSCRIPTION_URL=(e,t)=>`${(0,u.getEnvUrls)(e).subscriptionApiUrl}/v1/${t}`;n.SubscriptionService=class{constructor(e){a.add(this),r.set(this,void 0),o(this,r,e.env,"f"),this.authUtils=e.auth}async getSubscriptions(){return await c(this,a,"m",s).call(this,"subscriptions")}async cancelSubscription(e){const t=`subscriptions/${e.subscriptionId}/cancel`;return await c(this,a,"m",s).call(this,t,"POST",{})}async unCancelSubscription(e){const t=`subscriptions/${e.subscriptionId}/uncancel`;return await c(this,a,"m",s).call(this,t,"POST",{})}async startSubscriptionWithCard(e){if(0===e.products.length)throw new d.SubscriptionServiceError(u.SubscriptionControllerErrorMessage.SubscriptionProductsEmpty);return await c(this,a,"m",s).call(this,"subscriptions/card","POST",e)}async startSubscriptionWithCrypto(e){return await c(this,a,"m",s).call(this,"subscriptions/crypto","POST",e)}async updatePaymentMethodCard(e){const t=`subscriptions/${e.subscriptionId}/payment-method/card`;return await c(this,a,"m",s).call(this,t,"PATCH",{...e,subscriptionId:undefined})}async updatePaymentMethodCrypto(e){const t=`subscriptions/${e.subscriptionId}/payment-method/crypto`;await c(this,a,"m",s).call(this,t,"PATCH",{...e,subscriptionId:undefined})}async getSubscriptionsEligibilities(e){let t;e?.balanceCategory!==undefined&&(t={balanceCategory:e.balanceCategory});return(await c(this,a,"m",s).call(this,"subscriptions/eligibility","GET",undefined,t)).map(e=>({...e,canSubscribe:e.canSubscribe||!1,canViewEntryModal:e.canViewEntryModal||!1,cohorts:e.cohorts||[],assignedCohort:e.assignedCohort||null,hasAssignedCohortExpired:e.hasAssignedCohortExpired||!1}))}async submitUserEvent(e){await c(this,a,"m",s).call(this,"user-events","POST",e)}async assignUserToCohort(e){await c(this,a,"m",s).call(this,"cohorts/assign","POST",e)}async submitSponsorshipIntents(e){await c(this,a,"m",s).call(this,"transaction-sponsorship/intents","POST",e)}async linkRewards(e){return await c(this,a,"m",s).call(this,"rewards/link","POST",e)}async getPricing(){return await c(this,a,"m",s).call(this,"pricing")}async getBillingPortalUrl(){return await c(this,a,"m",s).call(this,"billing-portal")}},r=new WeakMap,a=new WeakSet,s=async function(e,t="GET",s,o){try{const u=await c(this,a,"m",i).call(this),d=new URL((0,n.SUBSCRIPTION_URL)(c(this,r,"f"),e));o&&Object.entries(o).forEach(([e,t])=>{d.searchParams.append(e,t)});return await(0,l.handleFetch)(d.toString(),{method:t,headers:{"Content-Type":"application/json",...u},body:s?JSON.stringify(s):undefined})}catch(e){const t=e instanceof Error?e.message:JSON.stringify(e);throw new d.SubscriptionServiceError(`failed to make request. ${t}`)}},i=async function(){return{Authorization:`Bearer ${await this.authUtils.getAccessToken()}`}}}}},{package:"@metamask/subscription-controller",file:"node_modules/@metamask/subscription-controller/dist/SubscriptionService.cjs"}],[3031,{"./types.cjs":3034},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ACTIVE_SUBSCRIPTION_STATUSES=n.DEFAULT_POLLING_INTERVAL=n.SubscriptionControllerErrorMessage=n.getEnvUrls=n.Env=n.controllerName=void 0;const a=e("./types.cjs");var r;n.controllerName="SubscriptionController",function(e){e.DEV="dev",e.UAT="uat",e.PRD="prd"}(r||(n.Env=r={}));const s={dev:{subscriptionApiUrl:"https://subscription.dev-api.cx.metamask.io"},uat:{subscriptionApiUrl:"https://subscription.uat-api.cx.metamask.io"},prd:{subscriptionApiUrl:"https://subscription.api.cx.metamask.io"}};var i;n.getEnvUrls=function(e){if(!s[e])throw new Error("invalid environment configuration");return s[e]},function(e){e.UserAlreadySubscribed="SubscriptionController - User is already subscribed",e.UserNotSubscribed="SubscriptionController - User is not subscribed",e.SubscriptionProductsEmpty="SubscriptionController - Subscription products array cannot be empty",e.PaymentTokenAddressAndSymbolRequiredForCrypto="SubscriptionController - Payment token address and symbol are required for crypto payment",e.PaymentMethodNotCrypto="SubscriptionController - Payment method is not crypto",e.ProductPriceNotFound="SubscriptionController - Product price not found",e.SubscriptionNotValidForCryptoApproval="SubscriptionController - Subscription is not valid for crypto approval",e.LinkRewardsFailed="SubscriptionController - Failed to link rewards"}(i||(n.SubscriptionControllerErrorMessage=i={})),n.DEFAULT_POLLING_INTERVAL=3e5,n.ACTIVE_SUBSCRIPTION_STATUSES=[a.SUBSCRIPTION_STATUSES.active,a.SUBSCRIPTION_STATUSES.trialing,a.SUBSCRIPTION_STATUSES.provisional]}}},{package:"@metamask/subscription-controller",file:"node_modules/@metamask/subscription-controller/dist/constants.cjs"}],[3032,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SubscriptionServiceError=void 0;class a extends Error{constructor(e){super(e),this.name="SubscriptionServiceError"}}n.SubscriptionServiceError=a}}},{package:"@metamask/subscription-controller",file:"node_modules/@metamask/subscription-controller/dist/errors.cjs"}],[3033,{"./SubscriptionController.cjs":3029,"./SubscriptionService.cjs":3030,"./constants.cjs":3031,"./errors.cjs":3032,"./types.cjs":3034},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SubscriptionService=n.SubscriptionControllerErrorMessage=n.Env=n.SubscriptionServiceError=n.MODAL_TYPE=n.BALANCE_CATEGORIES=n.COHORT_NAMES=n.SubscriptionUserEvent=n.PAYMENT_TYPES=n.RECURRING_INTERVALS=n.PRODUCT_TYPES=n.SUBSCRIPTION_STATUSES=n.CRYPTO_PAYMENT_METHOD_ERRORS=n.getDefaultSubscriptionControllerState=n.SubscriptionController=void 0;var a=e("./SubscriptionController.cjs");Object.defineProperty(n,"SubscriptionController",{enumerable:!0,get:function(){return a.SubscriptionController}}),Object.defineProperty(n,"getDefaultSubscriptionControllerState",{enumerable:!0,get:function(){return a.getDefaultSubscriptionControllerState}});var r=e("./types.cjs");Object.defineProperty(n,"CRYPTO_PAYMENT_METHOD_ERRORS",{enumerable:!0,get:function(){return r.CRYPTO_PAYMENT_METHOD_ERRORS}}),Object.defineProperty(n,"SUBSCRIPTION_STATUSES",{enumerable:!0,get:function(){return r.SUBSCRIPTION_STATUSES}}),Object.defineProperty(n,"PRODUCT_TYPES",{enumerable:!0,get:function(){return r.PRODUCT_TYPES}}),Object.defineProperty(n,"RECURRING_INTERVALS",{enumerable:!0,get:function(){return r.RECURRING_INTERVALS}}),Object.defineProperty(n,"PAYMENT_TYPES",{enumerable:!0,get:function(){return r.PAYMENT_TYPES}}),Object.defineProperty(n,"SubscriptionUserEvent",{enumerable:!0,get:function(){return r.SubscriptionUserEvent}}),Object.defineProperty(n,"COHORT_NAMES",{enumerable:!0,get:function(){return r.COHORT_NAMES}}),Object.defineProperty(n,"BALANCE_CATEGORIES",{enumerable:!0,get:function(){return r.BALANCE_CATEGORIES}}),Object.defineProperty(n,"MODAL_TYPE",{enumerable:!0,get:function(){return r.MODAL_TYPE}});var s=e("./errors.cjs");Object.defineProperty(n,"SubscriptionServiceError",{enumerable:!0,get:function(){return s.SubscriptionServiceError}});var i=e("./constants.cjs");Object.defineProperty(n,"Env",{enumerable:!0,get:function(){return i.Env}}),Object.defineProperty(n,"SubscriptionControllerErrorMessage",{enumerable:!0,get:function(){return i.SubscriptionControllerErrorMessage}});var o=e("./SubscriptionService.cjs");Object.defineProperty(n,"SubscriptionService",{enumerable:!0,get:function(){return o.SubscriptionService}})}}},{package:"@metamask/subscription-controller",file:"node_modules/@metamask/subscription-controller/dist/index.cjs"}],[3034,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SubscriptionUserEvent=n.BALANCE_CATEGORIES=n.COHORT_NAMES=n.MODAL_TYPE=n.CRYPTO_PAYMENT_METHOD_ERRORS=n.SUBSCRIPTION_STATUSES=n.RECURRING_INTERVALS=n.PAYMENT_TYPES=n.PRODUCT_TYPES=void 0,n.PRODUCT_TYPES={SHIELD:"shield"},n.PAYMENT_TYPES={byCard:"card",byCrypto:"crypto"},n.RECURRING_INTERVALS={month:"month",year:"year"},n.SUBSCRIPTION_STATUSES={incomplete:"incomplete",incompleteExpired:"incomplete_expired",provisional:"provisional",trialing:"trialing",active:"active",pastDue:"past_due",unpaid:"unpaid",canceled:"canceled",paused:"paused"},n.CRYPTO_PAYMENT_METHOD_ERRORS={APPROVAL_TRANSACTION_TOO_OLD:"approval_transaction_too_old",APPROVAL_TRANSACTION_REVERTED:"approval_transaction_reverted",APPROVAL_TRANSACTION_MAX_VERIFICATION_ATTEMPTS_REACHED:"approval_transaction_max_verification_attempts_reached",INSUFFICIENT_BALANCE:"insufficient_balance",INSUFFICIENT_ALLOWANCE:"insufficient_allowance"},n.MODAL_TYPE={A:"A",B:"B"},n.COHORT_NAMES={POST_TX:"post_tx",WALLET_HOME:"wallet_home"},n.BALANCE_CATEGORIES={RANGE_0_99:"0-99",RANGE_100_999:"100-999",RANGE_1K_9_9K:"1k-9.9k",RANGE_10K_99_9K:"10k-99.9k",RANGE_100K_999_9K:"100k-999.9k",RANGE_1M_PLUS:"1M+"},n.SubscriptionUserEvent={ShieldEntryModalViewed:"shield_entry_modal_viewed",ShieldCohortAssigned:"shield_cohort_assigned"}}}},{package:"@metamask/subscription-controller",file:"node_modules/@metamask/subscription-controller/dist/types.cjs"}],[3035,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){!function(e){var n,a=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,r=Math.ceil,s=Math.floor,i="[BigNumber Error] ",o=i+"Number primitive has more than 15 significant digits: ",c=1e14,l=14,u=9007199254740991,d=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],h=1e7,m=1e9;function f(e){var t=0|e;return e>0||e===t?t:t-1}function p(e){for(var t,n,a=1,r=e.length,s=e[0]+"";a<r;){for(t=e[a++]+"",n=l-t.length;n--;t="0"+t);s+=t}for(r=s.length;48===s.charCodeAt(--r););return s.slice(0,r+1||1)}function g(e,t){var n,a,r=e.c,s=t.c,i=e.s,o=t.s,c=e.e,l=t.e;if(!i||!o)return null;if(n=r&&!r[0],a=s&&!s[0],n||a)return n?a?0:-o:i;if(i!=o)return i;if(n=i<0,a=c==l,!r||!s)return a?0:!r^n?1:-1;if(!a)return c>l^n?1:-1;for(o=(c=r.length)<(l=s.length)?c:l,i=0;i<o;i++)if(r[i]!=s[i])return r[i]>s[i]^n?1:-1;return c==l?0:c>l^n?1:-1}function T(e,t,n,a){if(e<t||e>n||e!==s(e))throw Error(i+(a||"Argument")+("number"==typeof e?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function w(e){var t=e.c.length-1;return f(e.e/l)==t&&e.c[t]%2!=0}function b(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function E(e,t,n){var a,r;if(t<0){for(r=n+".";++t;r+=n);e=r+e}else if(++t>(a=e.length)){for(r=n,t-=a;--t;r+=n);e+=r}else t<a&&(e=e.slice(0,t)+"."+e.slice(t));return e}n=function e(t){var n,y,S,k,I,A,_,C,P,v,N=K.prototype={constructor:K,toString:null,valueOf:null},R=new K(1),j=20,O=4,x=-7,L=21,M=-1e7,F=1e7,D=!1,B=1,G=0,U={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},H="0123456789abcdefghijklmnopqrstuvwxyz",q=!0;function K(e,t){var n,r,i,c,d,h,m,f,p=this;if(!(p instanceof K))return new K(e,t);if(null==t){if(e&&!0===e._isBigNumber)return p.s=e.s,void(!e.c||e.e>F?p.c=p.e=null:e.e<M?p.c=[p.e=0]:(p.e=e.e,p.c=e.c.slice()));if((h="number"==typeof e)&&0*e==0){if(p.s=1/e<0?(e=-e,-1):1,e===~~e){for(c=0,d=e;d>=10;d/=10,c++);return void(c>F?p.c=p.e=null:(p.e=c,p.c=[e]))}f=String(e)}else{if(!a.test(f=String(e)))return S(p,f,h);p.s=45==f.charCodeAt(0)?(f=f.slice(1),-1):1}(c=f.indexOf("."))>-1&&(f=f.replace(".","")),(d=f.search(/e/i))>0?(c<0&&(c=d),c+=+f.slice(d+1),f=f.substring(0,d)):c<0&&(c=f.length)}else{if(T(t,2,H.length,"Base"),10==t&&q)return Y(p=new K(e),j+p.e+1,O);if(f=String(e),h="number"==typeof e){if(0*e!=0)return S(p,f,h,t);if(p.s=1/e<0?(f=f.slice(1),-1):1,K.DEBUG&&f.replace(/^0\.0*|\./,"").length>15)throw Error(o+e)}else p.s=45===f.charCodeAt(0)?(f=f.slice(1),-1):1;for(n=H.slice(0,t),c=d=0,m=f.length;d<m;d++)if(n.indexOf(r=f.charAt(d))<0){if("."==r){if(d>c){c=m;continue}}else if(!i&&(f==f.toUpperCase()&&(f=f.toLowerCase())||f==f.toLowerCase()&&(f=f.toUpperCase()))){i=!0,d=-1,c=0;continue}return S(p,String(e),h,t)}h=!1,(c=(f=y(f,t,10,p.s)).indexOf("."))>-1?f=f.replace(".",""):c=f.length}for(d=0;48===f.charCodeAt(d);d++);for(m=f.length;48===f.charCodeAt(--m););if(f=f.slice(d,++m)){if(m-=d,h&&K.DEBUG&&m>15&&(e>u||e!==s(e)))throw Error(o+p.s*e);if((c=c-d-1)>F)p.c=p.e=null;else if(c<M)p.c=[p.e=0];else{if(p.e=c,p.c=[],d=(c+1)%l,c<0&&(d+=l),d<m){for(d&&p.c.push(+f.slice(0,d)),m-=l;d<m;)p.c.push(+f.slice(d,d+=l));d=l-(f=f.slice(d)).length}else d-=m;for(;d--;f+="0");p.c.push(+f)}}else p.c=[p.e=0]}function W(e,t,n,a){var r,s,i,o,c;if(null==n?n=O:T(n,0,8),!e.c)return e.toString();if(r=e.c[0],i=e.e,null==t)c=p(e.c),c=1==a||2==a&&(i<=x||i>=L)?b(c,i):E(c,i,"0");else if(s=(e=Y(new K(e),t,n)).e,o=(c=p(e.c)).length,1==a||2==a&&(t<=s||s<=x)){for(;o<t;c+="0",o++);c=b(c,s)}else if(t-=i,c=E(c,s,"0"),s+1>o){if(--t>0)for(c+=".";t--;c+="0");}else if((t+=s-o)>0)for(s+1==o&&(c+=".");t--;c+="0");return e.s<0&&r?"-"+c:c}function $(e,t){for(var n,a,r=1,s=new K(e[0]);r<e.length;r++)(!(a=new K(e[r])).s||(n=g(s,a))===t||0===n&&s.s===t)&&(s=a);return s}function V(e,t,n){for(var a=1,r=t.length;!t[--r];t.pop());for(r=t[0];r>=10;r/=10,a++);return(n=a+n*l-1)>F?e.c=e.e=null:n<M?e.c=[e.e=0]:(e.e=n,e.c=t),e}function Y(e,t,n,a){var i,o,u,h,m,f,p,g=e.c,T=d;if(g){e:{for(i=1,h=g[0];h>=10;h/=10,i++);if((o=t-i)<0)o+=l,u=t,m=g[f=0],p=s(m/T[i-u-1]%10);else if((f=r((o+1)/l))>=g.length){if(!a)break e;for(;g.length<=f;g.push(0));m=p=0,i=1,u=(o%=l)-l+1}else{for(m=h=g[f],i=1;h>=10;h/=10,i++);p=(u=(o%=l)-l+i)<0?0:s(m/T[i-u-1]%10)}if(a=a||t<0||null!=g[f+1]||(u<0?m:m%T[i-u-1]),a=n<4?(p||a)&&(0==n||n==(e.s<0?3:2)):p>5||5==p&&(4==n||a||6==n&&(o>0?u>0?m/T[i-u]:0:g[f-1])%10&1||n==(e.s<0?8:7)),t<1||!g[0])return g.length=0,a?(t-=e.e+1,g[0]=T[(l-t%l)%l],e.e=-t||0):g[0]=e.e=0,e;if(0==o?(g.length=f,h=1,f--):(g.length=f+1,h=T[l-o],g[f]=u>0?s(m/T[i-u]%T[u])*h:0),a)for(;;){if(0==f){for(o=1,u=g[0];u>=10;u/=10,o++);for(u=g[0]+=h,h=1;u>=10;u/=10,h++);o!=h&&(e.e++,g[0]==c&&(g[0]=1));break}if(g[f]+=h,g[f]!=c)break;g[f--]=0,h=1}for(o=g.length;0===g[--o];g.pop());}e.e>F?e.c=e.e=null:e.e<M&&(e.c=[e.e=0])}return e}function Q(e){var t,n=e.e;return null===n?e.toString():(t=p(e.c),t=n<=x||n>=L?b(t,n):E(t,n,"0"),e.s<0?"-"+t:t)}return K.clone=e,K.ROUND_UP=0,K.ROUND_DOWN=1,K.ROUND_CEIL=2,K.ROUND_FLOOR=3,K.ROUND_HALF_UP=4,K.ROUND_HALF_DOWN=5,K.ROUND_HALF_EVEN=6,K.ROUND_HALF_CEIL=7,K.ROUND_HALF_FLOOR=8,K.EUCLID=9,K.config=K.set=function(e){var t,n;if(null!=e){if("object"!=typeof e)throw Error(i+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(T(n=e[t],0,m,t),j=n),e.hasOwnProperty(t="ROUNDING_MODE")&&(T(n=e[t],0,8,t),O=n),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((n=e[t])&&n.pop?(T(n[0],-m,0,t),T(n[1],0,m,t),x=n[0],L=n[1]):(T(n,-m,m,t),x=-(L=n<0?-n:n))),e.hasOwnProperty(t="RANGE"))if((n=e[t])&&n.pop)T(n[0],-m,-1,t),T(n[1],1,m,t),M=n[0],F=n[1];else{if(T(n,-m,m,t),!n)throw Error(i+t+" cannot be zero: "+n);M=-(F=n<0?-n:n)}if(e.hasOwnProperty(t="CRYPTO")){if((n=e[t])!==!!n)throw Error(i+t+" not true or false: "+n);if(n){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw D=!n,Error(i+"crypto unavailable");D=n}else D=n}if(e.hasOwnProperty(t="MODULO_MODE")&&(T(n=e[t],0,9,t),B=n),e.hasOwnProperty(t="POW_PRECISION")&&(T(n=e[t],0,m,t),G=n),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(n=e[t]))throw Error(i+t+" not an object: "+n);U=n}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(n=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(n))throw Error(i+t+" invalid: "+n);q="0123456789"==n.slice(0,10),H=n}}return{DECIMAL_PLACES:j,ROUNDING_MODE:O,EXPONENTIAL_AT:[x,L],RANGE:[M,F],CRYPTO:D,MODULO_MODE:B,POW_PRECISION:G,FORMAT:U,ALPHABET:H}},K.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!K.DEBUG)return!0;var t,n,a=e.c,r=e.e,o=e.s;e:if("[object Array]"=={}.toString.call(a)){if((1===o||-1===o)&&r>=-m&&r<=m&&r===s(r)){if(0===a[0]){if(0===r&&1===a.length)return!0;break e}if((t=(r+1)%l)<1&&(t+=l),String(a[0]).length==t){for(t=0;t<a.length;t++)if((n=a[t])<0||n>=c||n!==s(n))break e;if(0!==n)return!0}}}else if(null===a&&null===r&&(null===o||1===o||-1===o))return!0;throw Error(i+"Invalid BigNumber: "+e)},K.maximum=K.max=function(){return $(arguments,-1)},K.minimum=K.min=function(){return $(arguments,1)},K.random=(k=9007199254740992,I=Math.random()*k&2097151?function(){return s(Math.random()*k)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,n,a,o,c,u=0,h=[],f=new K(R);if(null==e?e=j:T(e,0,m),o=r(e/l),D)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));u<o;)(c=131072*t[u]+(t[u+1]>>>11))>=9e15?(n=crypto.getRandomValues(new Uint32Array(2)),t[u]=n[0],t[u+1]=n[1]):(h.push(c%1e14),u+=2);u=o/2}else{if(!crypto.randomBytes)throw D=!1,Error(i+"crypto unavailable");for(t=crypto.randomBytes(o*=7);u<o;)(c=281474976710656*(31&t[u])+1099511627776*t[u+1]+4294967296*t[u+2]+16777216*t[u+3]+(t[u+4]<<16)+(t[u+5]<<8)+t[u+6])>=9e15?crypto.randomBytes(7).copy(t,u):(h.push(c%1e14),u+=7);u=o/7}if(!D)for(;u<o;)(c=I())<9e15&&(h[u++]=c%1e14);for(o=h[--u],e%=l,o&&e&&(c=d[l-e],h[u]=s(o/c)*c);0===h[u];h.pop(),u--);if(u<0)h=[a=0];else{for(a=-1;0===h[0];h.splice(0,1),a-=l);for(u=1,c=h[0];c>=10;c/=10,u++);u<l&&(a-=l-u)}return f.e=a,f.c=h,f}),K.sum=function(){for(var e=1,t=arguments,n=new K(t[0]);e<t.length;)n=n.plus(t[e++]);return n},y=function(){var e="0123456789";function t(e,t,n,a){for(var r,s,i=[0],o=0,c=e.length;o<c;){for(s=i.length;s--;i[s]*=t);for(i[0]+=a.indexOf(e.charAt(o++)),r=0;r<i.length;r++)i[r]>n-1&&(null==i[r+1]&&(i[r+1]=0),i[r+1]+=i[r]/n|0,i[r]%=n)}return i.reverse()}return function(a,r,s,i,o){var c,l,u,d,h,m,f,g,T=a.indexOf("."),w=j,b=O;for(T>=0&&(d=G,G=0,a=a.replace(".",""),m=(g=new K(r)).pow(a.length-T),G=d,g.c=t(E(p(m.c),m.e,"0"),10,s,e),g.e=g.c.length),u=d=(f=t(a,r,s,o?(c=H,e):(c=e,H))).length;0==f[--d];f.pop());if(!f[0])return c.charAt(0);if(T<0?--u:(m.c=f,m.e=u,m.s=i,f=(m=n(m,g,w,b,s)).c,h=m.r,u=m.e),T=f[l=u+w+1],d=s/2,h=h||l<0||null!=f[l+1],h=b<4?(null!=T||h)&&(0==b||b==(m.s<0?3:2)):T>d||T==d&&(4==b||h||6==b&&1&f[l-1]||b==(m.s<0?8:7)),l<1||!f[0])a=h?E(c.charAt(1),-w,c.charAt(0)):c.charAt(0);else{if(f.length=l,h)for(--s;++f[--l]>s;)f[l]=0,l||(++u,f=[1].concat(f));for(d=f.length;!f[--d];);for(T=0,a="";T<=d;a+=c.charAt(f[T++]));a=E(a,u,c.charAt(0))}return a}}(),n=function(){function e(e,t,n){var a,r,s,i,o=0,c=e.length,l=t%h,u=t/h|0;for(e=e.slice();c--;)o=((r=l*(s=e[c]%h)+(a=u*s+(i=e[c]/h|0)*l)%h*h+o)/n|0)+(a/h|0)+u*i,e[c]=r%n;return o&&(e=[o].concat(e)),e}function t(e,t,n,a){var r,s;if(n!=a)s=n>a?1:-1;else for(r=s=0;r<n;r++)if(e[r]!=t[r]){s=e[r]>t[r]?1:-1;break}return s}function n(e,t,n,a){for(var r=0;n--;)e[n]-=r,r=e[n]<t[n]?1:0,e[n]=r*a+e[n]-t[n];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(a,r,i,o,u){var d,h,m,p,g,T,w,b,E,y,S,k,I,A,_,C,P,v=a.s==r.s?1:-1,N=a.c,R=r.c;if(!(N&&N[0]&&R&&R[0]))return new K(a.s&&r.s&&(N?!R||N[0]!=R[0]:R)?N&&0==N[0]||!R?0*v:v/0:NaN);for(E=(b=new K(v)).c=[],v=i+(h=a.e-r.e)+1,u||(u=c,h=f(a.e/l)-f(r.e/l),v=v/l|0),m=0;R[m]==(N[m]||0);m++);if(R[m]>(N[m]||0)&&h--,v<0)E.push(1),p=!0;else{for(A=N.length,C=R.length,m=0,v+=2,(g=s(u/(R[0]+1)))>1&&(R=e(R,g,u),N=e(N,g,u),C=R.length,A=N.length),I=C,S=(y=N.slice(0,C)).length;S<C;y[S++]=0);P=R.slice(),P=[0].concat(P),_=R[0],R[1]>=u/2&&_++;do{if(g=0,(d=t(R,y,C,S))<0){if(k=y[0],C!=S&&(k=k*u+(y[1]||0)),(g=s(k/_))>1)for(g>=u&&(g=u-1),w=(T=e(R,g,u)).length,S=y.length;1==t(T,y,w,S);)g--,n(T,C<w?P:R,w,u),w=T.length,d=1;else 0==g&&(d=g=1),w=(T=R.slice()).length;if(w<S&&(T=[0].concat(T)),n(y,T,S,u),S=y.length,-1==d)for(;t(R,y,C,S)<1;)g++,n(y,C<S?P:R,S,u),S=y.length}else 0===d&&(g++,y=[0]);E[m++]=g,y[0]?y[S++]=N[I]||0:(y=[N[I]],S=1)}while((I++<A||null!=y[0])&&v--);p=null!=y[0],E[0]||E.splice(0,1)}if(u==c){for(m=1,v=E[0];v>=10;v/=10,m++);Y(b,i+(b.e=m+h*l-1)+1,o,p)}else b.e=h,b.r=+p;return b}}(),A=/^(-?)0([xbo])(?=\w[\w.]*$)/i,_=/^([^.]+)\.$/,C=/^\.([^.]+)$/,P=/^-?(Infinity|NaN)$/,v=/^\s*\+(?=[\w.])|^\s+|\s+$/g,S=function(e,t,n,a){var r,s=n?t:t.replace(v,"");if(P.test(s))e.s=isNaN(s)?null:s<0?-1:1;else{if(!n&&(s=s.replace(A,function(e,t,n){return r="x"==(n=n.toLowerCase())?16:"b"==n?2:8,a&&a!=r?e:t}),a&&(r=a,s=s.replace(_,"$1").replace(C,"0.$1")),t!=s))return new K(s,r);if(K.DEBUG)throw Error(i+"Not a"+(a?" base "+a:"")+" number: "+t);e.s=null}e.c=e.e=null},N.absoluteValue=N.abs=function(){var e=new K(this);return e.s<0&&(e.s=1),e},N.comparedTo=function(e,t){return g(this,new K(e,t))},N.decimalPlaces=N.dp=function(e,t){var n,a,r,s=this;if(null!=e)return T(e,0,m),null==t?t=O:T(t,0,8),Y(new K(s),e+s.e+1,t);if(!(n=s.c))return null;if(a=((r=n.length-1)-f(this.e/l))*l,r=n[r])for(;r%10==0;r/=10,a--);return a<0&&(a=0),a},N.dividedBy=N.div=function(e,t){return n(this,new K(e,t),j,O)},N.dividedToIntegerBy=N.idiv=function(e,t){return n(this,new K(e,t),0,1)},N.exponentiatedBy=N.pow=function(e,t){var n,a,o,c,u,d,h,m,f=this;if((e=new K(e)).c&&!e.isInteger())throw Error(i+"Exponent not an integer: "+Q(e));if(null!=t&&(t=new K(t)),u=e.e>14,!f.c||!f.c[0]||1==f.c[0]&&!f.e&&1==f.c.length||!e.c||!e.c[0])return m=new K(Math.pow(+Q(f),u?e.s*(2-w(e)):+Q(e))),t?m.mod(t):m;if(d=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new K(NaN);(a=!d&&f.isInteger()&&t.isInteger())&&(f=f.mod(t))}else{if(e.e>9&&(f.e>0||f.e<-1||(0==f.e?f.c[0]>1||u&&f.c[1]>=24e7:f.c[0]<8e13||u&&f.c[0]<=9999975e7)))return c=f.s<0&&w(e)?-0:0,f.e>-1&&(c=1/c),new K(d?1/c:c);G&&(c=r(G/l+2))}for(u?(n=new K(.5),d&&(e.s=1),h=w(e)):h=(o=Math.abs(+Q(e)))%2,m=new K(R);;){if(h){if(!(m=m.times(f)).c)break;c?m.c.length>c&&(m.c.length=c):a&&(m=m.mod(t))}if(o){if(0===(o=s(o/2)))break;h=o%2}else if(Y(e=e.times(n),e.e+1,1),e.e>14)h=w(e);else{if(0===(o=+Q(e)))break;h=o%2}f=f.times(f),c?f.c&&f.c.length>c&&(f.c.length=c):a&&(f=f.mod(t))}return a?m:(d&&(m=R.div(m)),t?m.mod(t):c?Y(m,G,O,undefined):m)},N.integerValue=function(e){var t=new K(this);return null==e?e=O:T(e,0,8),Y(t,t.e+1,e)},N.isEqualTo=N.eq=function(e,t){return 0===g(this,new K(e,t))},N.isFinite=function(){return!!this.c},N.isGreaterThan=N.gt=function(e,t){return g(this,new K(e,t))>0},N.isGreaterThanOrEqualTo=N.gte=function(e,t){return 1===(t=g(this,new K(e,t)))||0===t},N.isInteger=function(){return!!this.c&&f(this.e/l)>this.c.length-2},N.isLessThan=N.lt=function(e,t){return g(this,new K(e,t))<0},N.isLessThanOrEqualTo=N.lte=function(e,t){return-1===(t=g(this,new K(e,t)))||0===t},N.isNaN=function(){return!this.s},N.isNegative=function(){return this.s<0},N.isPositive=function(){return this.s>0},N.isZero=function(){return!!this.c&&0==this.c[0]},N.minus=function(e,t){var n,a,r,s,i=this,o=i.s;if(t=(e=new K(e,t)).s,!o||!t)return new K(NaN);if(o!=t)return e.s=-t,i.plus(e);var u=i.e/l,d=e.e/l,h=i.c,m=e.c;if(!u||!d){if(!h||!m)return h?(e.s=-t,e):new K(m?i:NaN);if(!h[0]||!m[0])return m[0]?(e.s=-t,e):new K(h[0]?i:3==O?-0:0)}if(u=f(u),d=f(d),h=h.slice(),o=u-d){for((s=o<0)?(o=-o,r=h):(d=u,r=m),r.reverse(),t=o;t--;r.push(0));r.reverse()}else for(a=(s=(o=h.length)<(t=m.length))?o:t,o=t=0;t<a;t++)if(h[t]!=m[t]){s=h[t]<m[t];break}if(s&&(r=h,h=m,m=r,e.s=-e.s),(t=(a=m.length)-(n=h.length))>0)for(;t--;h[n++]=0);for(t=c-1;a>o;){if(h[--a]<m[a]){for(n=a;n&&!h[--n];h[n]=t);--h[n],h[a]+=c}h[a]-=m[a]}for(;0==h[0];h.splice(0,1),--d);return h[0]?V(e,h,d):(e.s=3==O?-1:1,e.c=[e.e=0],e)},N.modulo=N.mod=function(e,t){var a,r,s=this;return e=new K(e,t),!s.c||!e.s||e.c&&!e.c[0]?new K(NaN):!e.c||s.c&&!s.c[0]?new K(s):(9==B?(r=e.s,e.s=1,a=n(s,e,0,3),e.s=r,a.s*=r):a=n(s,e,0,B),(e=s.minus(a.times(e))).c[0]||1!=B||(e.s=s.s),e)},N.multipliedBy=N.times=function(e,t){var n,a,r,s,i,o,u,d,m,p,g,T,w,b,E,y=this,S=y.c,k=(e=new K(e,t)).c;if(!(S&&k&&S[0]&&k[0]))return!y.s||!e.s||S&&!S[0]&&!k||k&&!k[0]&&!S?e.c=e.e=e.s=null:(e.s*=y.s,S&&k?(e.c=[0],e.e=0):e.c=e.e=null),e;for(a=f(y.e/l)+f(e.e/l),e.s*=y.s,(u=S.length)<(p=k.length)&&(w=S,S=k,k=w,r=u,u=p,p=r),r=u+p,w=[];r--;w.push(0));for(b=c,E=h,r=p;--r>=0;){for(n=0,g=k[r]%E,T=k[r]/E|0,s=r+(i=u);s>r;)n=((d=g*(d=S[--i]%E)+(o=T*d+(m=S[i]/E|0)*g)%E*E+w[s]+n)/b|0)+(o/E|0)+T*m,w[s--]=d%b;w[s]=n}return n?++a:w.splice(0,1),V(e,w,a)},N.negated=function(){var e=new K(this);return e.s=-e.s||null,e},N.plus=function(e,t){var n,a=this,r=a.s;if(t=(e=new K(e,t)).s,!r||!t)return new K(NaN);if(r!=t)return e.s=-t,a.minus(e);var s=a.e/l,i=e.e/l,o=a.c,u=e.c;if(!s||!i){if(!o||!u)return new K(r/0);if(!o[0]||!u[0])return u[0]?e:new K(o[0]?a:0*r)}if(s=f(s),i=f(i),o=o.slice(),r=s-i){for(r>0?(i=s,n=u):(r=-r,n=o),n.reverse();r--;n.push(0));n.reverse()}for((r=o.length)-(t=u.length)<0&&(n=u,u=o,o=n,t=r),r=0;t;)r=(o[--t]=o[t]+u[t]+r)/c|0,o[t]=c===o[t]?0:o[t]%c;return r&&(o=[r].concat(o),++i),V(e,o,i)},N.precision=N.sd=function(e,t){var n,a,r,s=this;if(null!=e&&e!==!!e)return T(e,1,m),null==t?t=O:T(t,0,8),Y(new K(s),e,t);if(!(n=s.c))return null;if(a=(r=n.length-1)*l+1,r=n[r]){for(;r%10==0;r/=10,a--);for(r=n[0];r>=10;r/=10,a++);}return e&&s.e+1>a&&(a=s.e+1),a},N.shiftedBy=function(e){return T(e,-9007199254740991,u),this.times("1e"+e)},N.squareRoot=N.sqrt=function(){var e,t,a,r,s,i=this,o=i.c,c=i.s,l=i.e,u=j+4,d=new K("0.5");if(1!==c||!o||!o[0])return new K(!c||c<0&&(!o||o[0])?NaN:o?i:1/0);if(0==(c=Math.sqrt(+Q(i)))||c==1/0?(((t=p(o)).length+l)%2==0&&(t+="0"),c=Math.sqrt(+t),l=f((l+1)/2)-(l<0||l%2),a=new K(t=c==1/0?"5e"+l:(t=c.toExponential()).slice(0,t.indexOf("e")+1)+l)):a=new K(c+""),a.c[0])for((c=(l=a.e)+u)<3&&(c=0);;)if(s=a,a=d.times(s.plus(n(i,s,u,1))),p(s.c).slice(0,c)===(t=p(a.c)).slice(0,c)){if(a.e<l&&--c,"9999"!=(t=t.slice(c-3,c+1))&&(r||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(Y(a,a.e+j+2,1),e=!a.times(a).eq(i));break}if(!r&&(Y(s,s.e+j+2,0),s.times(s).eq(i))){a=s;break}u+=4,c+=4,r=1}return Y(a,a.e+j+1,O,e)},N.toExponential=function(e,t){return null!=e&&(T(e,0,m),e++),W(this,e,t,1)},N.toFixed=function(e,t){return null!=e&&(T(e,0,m),e=e+this.e+1),W(this,e,t)},N.toFormat=function(e,t,n){var a,r=this;if(null==n)null!=e&&t&&"object"==typeof t?(n=t,t=null):e&&"object"==typeof e?(n=e,e=t=null):n=U;else if("object"!=typeof n)throw Error(i+"Argument not an object: "+n);if(a=r.toFixed(e,t),r.c){var s,o=a.split("."),c=+n.groupSize,l=+n.secondaryGroupSize,u=n.groupSeparator||"",d=o[0],h=o[1],m=r.s<0,f=m?d.slice(1):d,p=f.length;if(l&&(s=c,c=l,l=s,p-=s),c>0&&p>0){for(s=p%c||c,d=f.substr(0,s);s<p;s+=c)d+=u+f.substr(s,c);l>0&&(d+=u+f.slice(s)),m&&(d="-"+d)}a=h?d+(n.decimalSeparator||"")+((l=+n.fractionGroupSize)?h.replace(new RegExp("\\d{"+l+"}\\B","g"),"$&"+(n.fractionGroupSeparator||"")):h):d}return(n.prefix||"")+a+(n.suffix||"")},N.toFraction=function(e){var t,a,r,s,o,c,u,h,m,f,g,T,w=this,b=w.c;if(null!=e&&(!(u=new K(e)).isInteger()&&(u.c||1!==u.s)||u.lt(R)))throw Error(i+"Argument "+(u.isInteger()?"out of range: ":"not an integer: ")+Q(u));if(!b)return new K(w);for(t=new K(R),m=a=new K(R),r=h=new K(R),T=p(b),o=t.e=T.length-w.e-1,t.c[0]=d[(c=o%l)<0?l+c:c],e=!e||u.comparedTo(t)>0?o>0?t:m:u,c=F,F=1/0,u=new K(T),h.c[0]=0;f=n(u,t,0,1),1!=(s=a.plus(f.times(r))).comparedTo(e);)a=r,r=s,m=h.plus(f.times(s=m)),h=s,t=u.minus(f.times(s=t)),u=s;return s=n(e.minus(a),r,0,1),h=h.plus(s.times(m)),a=a.plus(s.times(r)),h.s=m.s=w.s,g=n(m,r,o*=2,O).minus(w).abs().comparedTo(n(h,a,o,O).minus(w).abs())<1?[m,r]:[h,a],F=c,g},N.toNumber=function(){return+Q(this)},N.toPrecision=function(e,t){return null!=e&&T(e,1,m),W(this,e,t,2)},N.toString=function(e){var t,n=this,a=n.s,r=n.e;return null===r?a?(t="Infinity",a<0&&(t="-"+t)):t="NaN":(null==e?t=r<=x||r>=L?b(p(n.c),r):E(p(n.c),r,"0"):10===e&&q?t=E(p((n=Y(new K(n),j+r+1,O)).c),n.e,"0"):(T(e,2,H.length,"Base"),t=y(E(p(n.c),r,"0"),10,e,a,!0)),a<0&&n.c[0]&&(t="-"+t)),t},N.valueOf=N.toJSON=function(){return Q(this)},N._isBigNumber=!0,null!=t&&K.set(t),K}(),n.default=n.BigNumber=n,"function"==typeof define&&define.amd?define(function(){return n}):void 0!==t&&t.exports?t.exports=n:(e||(e="undefined"!=typeof self&&self?self:window),e.BigNumber=n)}(this)}}},{package:"@metamask/subscription-controller>bignumber.js",file:"node_modules/@metamask/subscription-controller/node_modules/bignumber.js/bignumber.js"}],[3036,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.StructError=void 0;class a extends TypeError{constructor(e,t){let n;const{message:a,explanation:r,...s}=e,{path:i}=e,o=0===i.length?a:`At path: ${i.join(".")} -- ${a}`;super(r??o),null!==r&&r!==undefined&&(this.cause=o),Object.assign(this,s),this.name=this.constructor.name,this.failures=()=>n??(n=[e,...t()])}}n.StructError=a}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/error.cjs"}],[3037,{"./error.cjs":3036,"./struct.cjs":3038,"./structs/coercions.cjs":3039,"./structs/refinements.cjs":3040,"./structs/types.cjs":3041,"./structs/utilities.cjs":3042},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){a===undefined&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){a===undefined&&(a=n),e[a]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||a(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./error.cjs"),n),r(e("./struct.cjs"),n),r(e("./structs/coercions.cjs"),n),r(e("./structs/refinements.cjs"),n),r(e("./structs/types.cjs"),n),r(e("./structs/utilities.cjs"),n)}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/index.cjs"}],[3038,{"./error.cjs":3036,"./utils.cjs":3043},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validate=n.is=n.mask=n.create=n.assert=n.ExactOptionalStruct=n.Struct=void 0;const a=e("./error.cjs"),r=e("./utils.cjs");class s{constructor(e){const{type:t,schema:n,validator:a,refiner:s,coercer:i=e=>e,entries:o=function*(){}}=e;this.type=t,this.schema=n,this.entries=o,this.coercer=i,this.validator=a?(e,t)=>{const n=a(e,t);return(0,r.toFailures)(n,t,this,e)}:()=>[],this.refiner=s?(e,t)=>{const n=s(e,t);return(0,r.toFailures)(n,t,this,e)}:()=>[]}assert(e,t){return o(e,this,t)}create(e,t){return c(e,this,t)}is(e){return u(e,this)}mask(e,t){return l(e,this,t)}validate(e,t={}){return d(e,this,t)}}n.Struct=s;const i="EXACT_OPTIONAL";function o(e,t,n){const a=d(e,t,{message:n});if(a[0])throw a[0]}function c(e,t,n){const a=d(e,t,{coerce:!0,message:n});if(a[0])throw a[0];return a[1]}function l(e,t,n){const a=d(e,t,{coerce:!0,mask:!0,message:n});if(a[0])throw a[0];return a[1]}function u(e,t){return!d(e,t)[0]}function d(e,t,n={}){const s=(0,r.run)(e,t,n),i=(0,r.shiftIterator)(s);if(i[0]){return[new a.StructError(i[0],function*(){for(const e of s)e[0]&&(yield e[0])}),undefined]}const o=i[1];return[undefined,o]}n.ExactOptionalStruct=class extends s{constructor(e){super({...e,type:`exact optional ${e.type}`}),this.brand=i}static isExactOptional(e){return(0,r.isObject)(e)&&"brand"in e&&e.brand===i}},n.assert=o,n.create=c,n.mask=l,n.is=u,n.validate=d}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/struct.cjs"}],[3039,{"../struct.cjs":3038,"../utils.cjs":3043,"./types.cjs":3041},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.trimmed=n.defaulted=n.coerce=void 0;const a=e("../struct.cjs"),r=e("../utils.cjs"),s=e("./types.cjs");function i(e,t,n){return new a.Struct({...e,coercer:(r,s)=>(0,a.is)(r,t)?e.coercer(n(r,s),s):e.coercer(r,s)})}n.coerce=i,n.defaulted=function(e,t,n={}){return i(e,(0,s.unknown)(),e=>{const a="function"==typeof t?t():t;if(e===undefined)return a;if(!n.strict&&(0,r.isPlainObject)(e)&&(0,r.isPlainObject)(a)){const t={...e};let n=!1;for(const e in a)t[e]===undefined&&(t[e]=a[e],n=!0);if(n)return t}return e})},n.trimmed=function(e){return i(e,(0,s.string)(),e=>e.trim())}}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/structs/coercions.cjs"}],[3040,{"../struct.cjs":3038,"../utils.cjs":3043},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.refine=n.size=n.pattern=n.nonempty=n.min=n.max=n.empty=void 0;const a=e("../struct.cjs"),r=e("../utils.cjs");function s(e){return e instanceof Map||e instanceof Set?e.size:e.length}function i(e,t,n){return new a.Struct({...e,*refiner(a,s){yield*e.refiner(a,s);const i=n(a,s),o=(0,r.toFailures)(i,s,e,a);for(const e of o)yield{...e,refinement:t}}})}n.empty=function(e){return i(e,"empty",t=>{const n=s(t);return 0===n||`Expected an empty ${e.type} but received one with a size of \`${n}\``})},n.max=function(e,t,n={}){const{exclusive:a}=n;return i(e,"max",n=>a?n<t:n<=t||`Expected a ${e.type} less than ${a?"":"or equal to "}${t} but received \`${n}\``)},n.min=function(e,t,n={}){const{exclusive:a}=n;return i(e,"min",n=>a?n>t:n>=t||`Expected a ${e.type} greater than ${a?"":"or equal to "}${t} but received \`${n}\``)},n.nonempty=function(e){return i(e,"nonempty",t=>s(t)>0||`Expected a nonempty ${e.type} but received an empty one`)},n.pattern=function(e,t){return i(e,"pattern",n=>t.test(n)||`Expected a ${e.type} matching \`/${t.source}/\` but received "${n}"`)},n.size=function(e,t,n=t){const a=`Expected a ${e.type}`,r=t===n?`of \`${t}\``:`between \`${t}\` and \`${n}\``;return i(e,"size",e=>{if("number"==typeof e||e instanceof Date)return t<=e&&e<=n||`${a} ${r} but received \`${e}\``;if(e instanceof Map||e instanceof Set){const{size:s}=e;return t<=s&&s<=n||`${a} with a size ${r} but received one with a size of \`${s}\``}const{length:s}=e;return t<=s&&s<=n||`${a} with a length ${r} but received one with a length of \`${s}\``})},n.refine=i}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/structs/refinements.cjs"}],[3041,{"../struct.cjs":3038,"../utils.cjs":3043,"./utilities.cjs":3042},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.unknown=n.union=n.type=n.tuple=n.string=n.set=n.regexp=n.record=n.exactOptional=n.optional=n.object=n.number=n.nullable=n.never=n.map=n.literal=n.intersection=n.integer=n.instance=n.func=n.enums=n.date=n.boolean=n.bigint=n.array=n.any=void 0;const a=e("../struct.cjs"),r=e("../utils.cjs"),s=e("./utilities.cjs");function i(){return(0,s.define)("never",()=>!1)}n.any=function(){return(0,s.define)("any",()=>!0)},n.array=function(e){return new a.Struct({type:"array",schema:e,*entries(t){if(e&&Array.isArray(t))for(const[n,a]of t.entries())yield[n,a,e]},coercer:e=>Array.isArray(e)?e.slice():e,validator:e=>Array.isArray(e)||`Expected an array value, but received: ${(0,r.print)(e)}`})},n.bigint=function(){return(0,s.define)("bigint",e=>"bigint"==typeof e)},n.boolean=function(){return(0,s.define)("boolean",e=>"boolean"==typeof e)},n.date=function(){return(0,s.define)("date",e=>e instanceof Date&&!isNaN(e.getTime())||`Expected a valid \`Date\` object, but received: ${(0,r.print)(e)}`)},n.enums=function(e){const t={},n=e.map(e=>(0,r.print)(e)).join();for(const n of e)t[n]=n;return new a.Struct({type:"enums",schema:t,validator:t=>e.includes(t)||`Expected one of \`${n}\`, but received: ${(0,r.print)(t)}`})},n.func=function(){return(0,s.define)("func",e=>"function"==typeof e||`Expected a function, but received: ${(0,r.print)(e)}`)},n.instance=function(e){return(0,s.define)("instance",t=>t instanceof e||`Expected a \`${e.name}\` instance, but received: ${(0,r.print)(t)}`)},n.integer=function(){return(0,s.define)("integer",e=>"number"==typeof e&&!isNaN(e)&&Number.isInteger(e)||`Expected an integer, but received: ${(0,r.print)(e)}`)},n.intersection=function(e){return new a.Struct({type:"intersection",schema:null,*entries(t,n){for(const{entries:a}of e)yield*a(t,n)},*validator(t,n){for(const{validator:a}of e)yield*a(t,n)},*refiner(t,n){for(const{refiner:a}of e)yield*a(t,n)}})},n.literal=function(e){const t=(0,r.print)(e),n=typeof e;return new a.Struct({type:"literal",schema:"string"===n||"number"===n||"boolean"===n?e:null,validator:n=>n===e||`Expected the literal \`${t}\`, but received: ${(0,r.print)(n)}`})},n.map=function(e,t){return new a.Struct({type:"map",schema:null,*entries(n){if(e&&t&&n instanceof Map)for(const[a,r]of n.entries())yield[a,a,e],yield[a,r,t]},coercer:e=>e instanceof Map?new Map(e):e,validator:e=>e instanceof Map||`Expected a \`Map\` object, but received: ${(0,r.print)(e)}`})},n.never=i,n.nullable=function(e){return new a.Struct({...e,validator:(t,n)=>null===t||e.validator(t,n),refiner:(t,n)=>null===t||e.refiner(t,n)})},n.number=function(){return(0,s.define)("number",e=>"number"==typeof e&&!isNaN(e)||`Expected a number, but received: ${(0,r.print)(e)}`)},n.object=function(e){const t=e?Object.keys(e):[],n=i();return new a.Struct({type:"object",schema:e??null,*entries(s){if(e&&(0,r.isObject)(s)){const r=new Set(Object.keys(s));for(const n of t){r.delete(n);const t=e[n];a.ExactOptionalStruct.isExactOptional(t)&&!Object.prototype.hasOwnProperty.call(s,n)||(yield[n,s[n],e[n]])}for(const e of r)yield[e,s[e],n]}},validator:e=>(0,r.isObject)(e)||`Expected an object, but received: ${(0,r.print)(e)}`,coercer:e=>(0,r.isObject)(e)?{...e}:e})},n.optional=function(e){return new a.Struct({...e,validator:(t,n)=>t===undefined||e.validator(t,n),refiner:(t,n)=>t===undefined||e.refiner(t,n)})},n.exactOptional=function(e){return new a.ExactOptionalStruct(e)},n.record=function(e,t){return new a.Struct({type:"record",schema:null,*entries(n){if((0,r.isObject)(n))for(const a in n){const r=n[a];yield[a,a,e],yield[a,r,t]}},validator:e=>(0,r.isObject)(e)||`Expected an object, but received: ${(0,r.print)(e)}`})},n.regexp=function(){return(0,s.define)("regexp",e=>e instanceof RegExp)},n.set=function(e){return new a.Struct({type:"set",schema:null,*entries(t){if(e&&t instanceof Set)for(const n of t)yield[n,n,e]},coercer:e=>e instanceof Set?new Set(e):e,validator:e=>e instanceof Set||`Expected a \`Set\` object, but received: ${(0,r.print)(e)}`})},n.string=function(){return(0,s.define)("string",e=>"string"==typeof e||`Expected a string, but received: ${(0,r.print)(e)}`)},n.tuple=function(e){const t=i();return new a.Struct({type:"tuple",schema:null,*entries(n){if(Array.isArray(n)){const a=Math.max(e.length,n.length);for(let r=0;r<a;r++)yield[r,n[r],e[r]||t]}},validator:e=>Array.isArray(e)||`Expected an array, but received: ${(0,r.print)(e)}`})},n.type=function(e){const t=Object.keys(e);return new a.Struct({type:"type",schema:e,*entries(n){if((0,r.isObject)(n))for(const a of t)yield[a,n[a],e[a]]},validator:e=>(0,r.isObject)(e)||`Expected an object, but received: ${(0,r.print)(e)}`,coercer:e=>(0,r.isObject)(e)?{...e}:e})},n.union=function(e){const t=e.map(e=>e.type).join(" | ");return new a.Struct({type:"union",schema:null,coercer(t){for(const n of e){const[e,a]=n.validate(t,{coerce:!0});if(!e)return a}return t},validator(n,a){const s=[];for(const t of e){const[...e]=(0,r.run)(n,t,a),[i]=e;if(!i?.[0])return[];for(const[t]of e)t&&s.push(t)}return[`Expected the value to satisfy a union of \`${t}\`, but received: ${(0,r.print)(n)}`,...s]}})},n.unknown=function(){return(0,s.define)("unknown",()=>!0)}}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/structs/types.cjs"}],[3042,{"../struct.cjs":3038,"./types.cjs":3041},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.pick=n.partial=n.omit=n.lazy=n.dynamic=n.deprecated=n.define=n.assign=void 0;const a=e("../struct.cjs"),r=e("./types.cjs");n.assign=function(...e){const t="type"===e[0]?.type,n=e.map(({schema:e})=>e),a=Object.assign({},...n);return t?(0,r.type)(a):(0,r.object)(a)},n.define=function(e,t){return new a.Struct({type:e,schema:null,validator:t})},n.deprecated=function(e,t){return new a.Struct({...e,refiner:(t,n)=>t===undefined||e.refiner(t,n),validator:(n,a)=>n===undefined||(t(n,a),e.validator(n,a))})},n.dynamic=function(e){return new a.Struct({type:"dynamic",schema:null,*entries(t,n){const a=e(t,n);yield*a.entries(t,n)},validator:(t,n)=>e(t,n).validator(t,n),coercer:(t,n)=>e(t,n).coercer(t,n),refiner:(t,n)=>e(t,n).refiner(t,n)})},n.lazy=function(e){let t;return new a.Struct({type:"lazy",schema:null,*entries(n,a){t??(t=e()),yield*t.entries(n,a)},validator:(n,a)=>(t??(t=e()),t.validator(n,a)),coercer:(n,a)=>(t??(t=e()),t.coercer(n,a)),refiner:(n,a)=>(t??(t=e()),t.refiner(n,a))})},n.omit=function(e,t){const{schema:n}=e,a={...n};for(const e of t)delete a[e];return"type"===e.type?(0,r.type)(a):(0,r.object)(a)},n.partial=function(e){const t=e instanceof a.Struct,n=t?{...e.schema}:{...e};for(const e in n)n[e]=(0,r.optional)(n[e]);return t&&"type"===e.type?(0,r.type)(n):(0,r.object)(n)},n.pick=function(e,t){const{schema:n}=e,a={};for(const e of t)a[e]=n[e];return"type"===e.type?(0,r.type)(a):(0,r.object)(a)}}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/structs/utilities.cjs"}],[3043,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function a(e){return"object"==typeof e&&null!==e}function r(e){return"symbol"==typeof e?e.toString():"string"==typeof e?JSON.stringify(e):`${e}`}function s(e,t,n,a){if(!0===e)return undefined;!1===e?e={}:"string"==typeof e&&(e={message:e});const{path:s,branch:i}=t,{type:o}=n,{refinement:c,message:l=`Expected a value of type \`${o}\`${c?` with refinement \`${c}\``:""}, but received: \`${r(a)}\``}=e;return{value:a,type:o,refinement:c,key:s[s.length-1],path:s,branch:i,...e,message:l}}Object.defineProperty(n,"__esModule",{value:!0}),n.run=n.toFailures=n.toFailure=n.shiftIterator=n.print=n.isPlainObject=n.isObject=void 0,n.isObject=a,n.isPlainObject=function(e){if("[object Object]"!==Object.prototype.toString.call(e))return!1;const t=Object.getPrototypeOf(e);return null===t||t===Object.prototype},n.print=r,n.shiftIterator=function(e){const{done:t,value:n}=e.next();return t?undefined:n},n.toFailure=s,n.toFailures=function*(e,t,n,r){(function(e){return a(e)&&"function"==typeof e[Symbol.iterator]})(e)||(e=[e]);for(const a of e){const e=s(a,t,n,r);e&&(yield e)}},n.run=function*e(t,n,r={}){const{path:s=[],branch:i=[t],coerce:o=!1,mask:c=!1}=r,l={path:s,branch:i};if(o&&(t=n.coercer(t,l),c&&"type"!==n.type&&a(n.schema)&&a(t)&&!Array.isArray(t)))for(const e in t)n.schema[e]===undefined&&delete t[e];let u="valid";for(const e of n.validator(t,l))e.explanation=r.message,u="not_valid",yield[e,undefined];for(let[d,h,m]of n.entries(t,l)){const n=e(h,m,{path:d===undefined?s:[...s,d],branch:d===undefined?i:[...i,h],coerce:o,mask:c,message:r.message});for(const e of n)e[0]?(u=null===e[0].refinement||e[0].refinement===undefined?"not_valid":"not_refined",yield[e[0],undefined]):o&&(h=e[1],d===undefined?t=h:t instanceof Map?t.set(d,h):t instanceof Set?t.add(h):a(t)&&(h!==undefined||d in t)&&(t[d]=h))}if("not_valid"!==u)for(const e of n.refiner(t,l))e.explanation=r.message,u="not_refined",yield[e,undefined];"valid"===u&&(yield[undefined,t])}}}},{package:"@metamask/superstruct",file:"node_modules/@metamask/superstruct/dist/utils.cjs"}],[3044,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createEventEmitterProxy=void 0;const a=()=>!0,r=["newListener","removeListener"],s=e=>!r.includes(e);n.createEventEmitterProxy=function(e,{eventFilter:t=a}={}){const n="skipInternal"===t?s:t;if("function"!=typeof n)throw new Error("createEventEmitterProxy - Invalid eventFilter");let r=[],i=e,o=e=>{const t=i;i=e,r.forEach(({name:n,handler:a,addedWith:r,filtered:s})=>{s||e[r](n,a),t.off(n,a)})};const c=(e,t)=>{r=r.filter(n=>e!==n.name||t!==n.handler&&t!==n.unwrappedHandler)};return new Proxy(i,{get(e,t,a){if("setTarget"===t)return o;const s=i[t];return"function"==typeof s?function(...e){const o=e[1];if("once"===t){const t=(...n)=>(c(e[0],t),o(...n));e[1]=t}if("on"===t||"addListener"===t||"prependListener"===t||"once"===t)r.push({addedWith:t,name:e[0],unwrappedHandler:o,handler:e[1],filtered:!n(e[0])});else if("off"===t||"removeListener"===t){const t=r.find(({name:t,unwrappedHandler:n})=>t===e[0]&&n===e[1]);if(t===undefined)return i;c(e[0],e[1]),e[1]=t.handler}return s.apply(this===a?i:this,e)}:s},set:(e,t,n)=>"setTarget"===t?(o=n,!0):(i[t]=n,!0)})}}}},{package:"@metamask/network-controller>@metamask/swappable-obj-proxy",file:"node_modules/@metamask/swappable-obj-proxy/dist/createEventEmitterProxy.js"}],[3045,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createSwappableProxy=void 0,n.createSwappableProxy=function(e){let t=e,n=e=>{t=e};return new Proxy(t,{get(e,a,r){if("setTarget"===a)return n;const s=t[a];return s instanceof Function?function(...e){return s.apply(this===r?t:this,e)}:s},set:(e,a,r)=>"setTarget"===a?(n=r,!0):(t[a]=r,!0)})}}}},{package:"@metamask/network-controller>@metamask/swappable-obj-proxy",file:"node_modules/@metamask/swappable-obj-proxy/dist/createSwappableProxy.js"}],[3046,{"./createEventEmitterProxy":3044,"./createSwappableProxy":3045,"./types":3047},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){a===undefined&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){a===undefined&&(a=n),e[a]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||a(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./createEventEmitterProxy"),n),r(e("./createSwappableProxy"),n),r(e("./types"),n)}}},{package:"@metamask/network-controller>@metamask/swappable-obj-proxy",file:"node_modules/@metamask/swappable-obj-proxy/dist/index.js"}],[3047,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0})}}},{package:"@metamask/network-controller>@metamask/swappable-obj-proxy",file:"node_modules/@metamask/swappable-obj-proxy/dist/types.js"}],[3048,{"./constants.cjs":3050,"./errors.cjs":3051,"./utils.cjs":3061,"@metamask/auth-network-utils":3066,"@toruslabs/http-helpers":3071},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.authenticateUser=n.createAuthResponseHandler=void 0;const a=e("@metamask/auth-network-utils"),r=e("@toruslabs/http-helpers"),s=e("./constants.cjs"),i=e("./errors.cjs"),o=e("./utils.cjs");n.createAuthResponseHandler=(e,t)=>{let n=null;return async()=>{const r=(0,a.filterCompletedRequests)(e);if(r.length>=s.AUTHENTICATION_THRESHOLD){n??(n=Date.now());const e=Date.now()-n>1e3;if(t||e){const e=r.map(e=>{const{pubKey:t,keyIndex:n}=e.result;return{pubKey:t,keyIndex:n}}),t=(0,a.thresholdSame)(e,s.AUTHENTICATION_THRESHOLD);if(!t)throw i.TOPRFError.invalidAuthenticateResults(`Authentication threshold met, but pubKey/keyIndex data inconsistent: ${JSON.stringify(e)}`);return{authRequestResults:r.map(e=>e.result),isNewUser:!t.pubKey}}return undefined}if(t)throw i.TOPRFError.invalidAuthenticateResults(`Authentication threshold not met after all requests processed. Expected: ${s.AUTHENTICATION_THRESHOLD}, got: ${r.length}`);return undefined}};n.authenticateUser=async e=>{const{idToken:t,nodeEndpointsMap:c,authConnectionId:l,userId:u,commitmentSignatures:d,groupedAuthConnectionId:h,hashedIdToken:m,sessionPrivateKey:f}=e,p=(e=>{const t=e.groupedAuthConnectionId?{subVerifierAuthParams:[{subVerifierIdToken:e.idToken,subVerifier:e.authConnectionId}]}:undefined;if(e.groupedAuthConnectionId&&!e.hashedIdToken)throw i.TOPRFError.fromCode(i.TOPRFErrorCode.NoHashedIdToken);return{authData:{authenticationContext:{idToken:e.groupedAuthConnectionId&&e.hashedIdToken?e.hashedIdToken:e.idToken,verifier:e.groupedAuthConnectionId??e.authConnectionId,verifierId:e.userId},singleIdVerifierParams:t},commitmentSignatures:e.commitmentSignatures,clientTime:Math.floor(Date.now()/1e3).toString()}})({idToken:t,authConnectionId:l,userId:u,commitmentSignatures:d,groupedAuthConnectionId:h,hashedIdToken:m}),g=Object.values(c).map(async e=>(async(e,t)=>{const n=(0,r.generateJsonRPCObject)(s.JRPC_METHODS.AUTHENTICATE_REQUEST,t);return(0,o.postJRPCRequest)(e,n)})(e,p)),T=await(0,a.Some)(g,async(e,t)=>(0,n.createAuthResponseHandler)(e,t.allSettled)());return{authTokensData:await Promise.all(T.authRequestResults.map(async e=>{const{authToken:t,nodeIndex:n,nodePubKey:a,pubKey:r,keyIndex:s}=e;return{authToken:await(0,o.decryptAuthToken)(t,f),nodeIndex:n,nodePubKey:a,pubKey:r,keyIndex:s}})),isNewUser:T.isNewUser}}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/authenticateRequest.cjs"}],[3049,{"./constants.cjs":3050,"./errors.cjs":3051,"./utils.cjs":3061,"@metamask/auth-network-utils":3066,"@noble/hashes/utils":3274,"@toruslabs/http-helpers":3071},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.commitIdToken=n.createHandleCommitmentResponses=void 0;const a=e("@metamask/auth-network-utils"),r=e("@noble/hashes/utils"),s=e("@toruslabs/http-helpers"),i=e("./constants.cjs"),o=e("./errors.cjs"),c=e("./utils.cjs");n.createHandleCommitmentResponses=(e,t)=>{let n=null;return async()=>{const r=(0,a.filterCompletedRequests)(e);if(r.length>=i.COMMIT_RESPONSE_THRESHOLD){n??(n=Date.now());const e=Date.now()-n>1e3;return t||e?r.map(e=>e.result):undefined}if(t)throw o.TOPRFError.invalidCommitResults(`Threshold not met after all requests processed. Expected: ${i.COMMIT_RESPONSE_THRESHOLD}, got: ${r.length}`);return undefined}};n.commitIdToken=async e=>{const{idToken:t,endpoints:o,authConnectionId:l,sessionPubKeyX:u,sessionPubKeyY:d}=e,h=((e,t,n,a)=>({tokenCommitment:e,verifier:t,tempPubKeyX:n,tempPubKeyY:a}))((0,a.keccak256AndHexify)((0,r.utf8ToBytes)(t)).slice(2),l,u,d),m=o.map(async e=>(async(e,t)=>{const n=(0,s.generateJsonRPCObject)(i.JRPC_METHODS.COMMITMENT_REQUEST,t);return(0,c.postJRPCRequest)(e,n)})(e,h));return(0,a.Some)(m,async(e,t)=>(0,n.createHandleCommitmentResponses)(e,t.allSettled)())}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/commitRequest.cjs"}],[3050,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a;Object.defineProperty(n,"__esModule",{value:!0}),n.JsonRpcErrorCodes=n.PW_BACKUP_ITEM_ID=n.MAX_PASSWORD_CHAIN_LENGTH=n.FIRST_KEY_INDEX=n.GENERATE_SHARE_THRESHOLD=n.GET_PUB_KEY_THRESHOLD=n.TOPRF_EVAL_THRESHOLD=n.AUTHENTICATION_THRESHOLD=n.COMMIT_RESPONSE_THRESHOLD=n.JRPC_METHODS=void 0,n.JRPC_METHODS={COMMITMENT_REQUEST:"TOPRFCommitmentRequest",AUTHENTICATE_REQUEST:"TOPRFAuthenticateRequest",STORE_KEY_SHARES_REQUEST:"TOPRFStoreKeyShareRequest",RESET_RATE_LIMIT_REQUEST:"TOPRFResetRateLimitRequest",TOPRF_EVAL_REQUEST:"TOPRFEvalRequest",GET_PUB_KEY_REQUEST:"TOPRFGetPubKeyRequest"},n.COMMIT_RESPONSE_THRESHOLD=4,n.AUTHENTICATION_THRESHOLD=4,n.TOPRF_EVAL_THRESHOLD=3,n.GET_PUB_KEY_THRESHOLD=3,n.GENERATE_SHARE_THRESHOLD=3,n.FIRST_KEY_INDEX=1,n.MAX_PASSWORD_CHAIN_LENGTH=10,n.PW_BACKUP_ITEM_ID="PW_BACKUP",function(e){e[e.ErrorCodeInvalidParams=-32602]="ErrorCodeInvalidParams",e[e.ErrorCodeInternal=-32603]="ErrorCodeInternal"}(a||(n.JsonRpcErrorCodes=a={}))}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/constants.cjs"}],[3051,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a;Object.defineProperty(n,"__esModule",{value:!0}),n.TOPRFError=n.TOPRFErrorCode=void 0,function(e){e[e.Default=1e3]="Default",e[e.InvalidAuthenticateResults=1001]="InvalidAuthenticateResults",e[e.InvalidCommitResults=1002]="InvalidCommitResults",e[e.PwdInputRateLimitExceeded=1003]="PwdInputRateLimitExceeded",e[e.InsufficientValidResponses=1004]="InsufficientValidResponses",e[e.CouldNotDeriveThresholdAuthPubKey=1005]="CouldNotDeriveThresholdAuthPubKey",e[e.CouldNotDeriveEncryptionKey=1006]="CouldNotDeriveEncryptionKey",e[e.EndpointNotFound=1007]="EndpointNotFound",e[e.InsufficientAuthTokens=1008]="InsufficientAuthTokens",e[e.RateLimitExceeded=1009]="RateLimitExceeded",e[e.InvalidAuthToken=1010]="InvalidAuthToken",e[e.AuthTokenExpired=1011]="AuthTokenExpired",e[e.JsonRpcError=1012]="JsonRpcError",e[e.CouldNotFetchPassword=1013]="CouldNotFetchPassword",e[e.NoHashedIdToken=1014]="NoHashedIdToken",e[e.MaxKeyChainLengthExceeded=1015]="MaxKeyChainLengthExceeded"}(a||(n.TOPRFErrorCode=a={}));class r extends Error{constructor(e,t,n){super(t),this.code=e,this.meta=n,Object.defineProperty(this,"name",{value:"TOPRFError"})}static fromCode(e,t="",n){const s=t?` ${t}`:"";return r.messages[e]?new r(e,`${r.messages[e]}${s}`,n):new r(1e3,`${r.messages[a.Default]}${s}`,n)}static default(e=""){return new r(a.Default,`${r.messages[a.Default]} ${e}`)}static invalidAuthenticateResults(e=""){return r.fromCode(a.InvalidAuthenticateResults,e)}static invalidCommitResults(e=""){return r.fromCode(a.InvalidCommitResults,e)}static pwdInputRateLimitExceeded(e=""){return r.fromCode(a.PwdInputRateLimitExceeded,e)}static insufficientValidResponses(e=""){return r.fromCode(a.InsufficientValidResponses,e)}static couldNotDeriveThresholdAuthPubKey(e=""){return r.fromCode(a.CouldNotDeriveThresholdAuthPubKey,e)}static couldNotDeriveEncryptionKey(e=""){return r.fromCode(a.CouldNotDeriveEncryptionKey,e)}static endpointNotFound(e=""){return r.fromCode(a.EndpointNotFound,e)}static insufficientAuthTokens(e=""){return r.fromCode(a.InsufficientAuthTokens,e)}static rateLimitExceeded(e,t=""){return r.fromCode(a.RateLimitExceeded,t||e.message,{rateLimitDetails:e})}static invalidAuthToken(e=""){return r.fromCode(a.InvalidAuthToken,e)}static authTokenExpired(e=""){return r.fromCode(a.AuthTokenExpired,e)}static jsonRpcError(e){return r.fromCode(a.JsonRpcError,e)}static couldNotFetchPassword(e=""){return r.fromCode(a.CouldNotFetchPassword,e)}static maxKeyChainLengthExceeded(e=""){return r.fromCode(a.MaxKeyChainLengthExceeded,e)}toJSON(){return{name:this.name,code:this.code,message:this.message,meta:this.meta}}toString(){return JSON.stringify(this.toJSON())}}n.TOPRFError=r,r.messages={[a.Default]:"Something went wrong.",[a.InvalidAuthenticateResults]:"Invalid authenticate results.",[a.InvalidCommitResults]:"Invalid commit results.",[a.PwdInputRateLimitExceeded]:"Rate limit exceeded for password input attempts.",[a.InsufficientValidResponses]:"Insufficient valid responses.",[a.CouldNotDeriveThresholdAuthPubKey]:"Could not derive threshold auth pub key.",[a.CouldNotDeriveEncryptionKey]:"Could not derive encryption key.",[a.EndpointNotFound]:"Endpoint not found.",[a.InsufficientAuthTokens]:"Insufficient number of auth tokens.",[a.RateLimitExceeded]:"Rate limit error from server.",[a.InvalidAuthToken]:"Invalid auth token.",[a.AuthTokenExpired]:"Auth token expired.",[a.JsonRpcError]:"Json rpc error.",[a.CouldNotFetchPassword]:"Could not fetch password.",[a.MaxKeyChainLengthExceeded]:"Exceeded maximum key chain length.",[a.NoHashedIdToken]:"hashedIdToken is required when using single-id(aggregate) verifier."}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/errors.cjs"}],[3052,{"./constants.cjs":3050,"./errors.cjs":3051,"./utils.cjs":3061,"@metamask/auth-network-utils":3066,"@noble/hashes/utils":3274,"@toruslabs/http-helpers":3071},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getPubKey=n.validatePubKey=void 0;const a=e("@metamask/auth-network-utils"),r=e("@noble/hashes/utils"),s=e("@toruslabs/http-helpers"),i=e("./constants.cjs"),o=e("./errors.cjs"),c=e("./utils.cjs");n.validatePubKey=async e=>{const t=(0,c.checkAuthTokenErrors)(e);if(t)throw t;const n=(0,a.filterCompletedRequests)(e);if(n.length<i.GET_PUB_KEY_THRESHOLD)throw o.TOPRFError.insufficientValidResponses(`Insufficient get pub key request results, expected ${i.GET_PUB_KEY_THRESHOLD} but got ${n.length}`);const s=(0,a.thresholdSame)(n.map(e=>({pubKey:e.result?.pubKey,keyIndex:e.result?.keyIndex})),i.GET_PUB_KEY_THRESHOLD);if(!s?.pubKey||!s?.keyIndex)throw o.TOPRFError.couldNotDeriveThresholdAuthPubKey();return{authPubKey:(0,r.hexToBytes)(s.pubKey),keyIndex:s.keyIndex}};n.getPubKey=async e=>{const{authTokens:t,nodeEndpointsMap:r,authConnectionId:l,userId:u,groupedAuthConnectionId:d}=e;if(t.length<i.GET_PUB_KEY_THRESHOLD)throw o.TOPRFError.insufficientAuthTokens(`At least ${i.GET_PUB_KEY_THRESHOLD} auth tokens are required.`);const h=(0,c.mergeEndpointsWithAuthTokens)(t,r).map(async({endpoint:e,authToken:t})=>{const n=((e,t,n,a)=>({authToken:e,verifier:a??t,verifierId:n}))(t.authToken,l,u,d);return(async(e,t)=>{const n=(0,s.generateJsonRPCObject)(i.JRPC_METHODS.GET_PUB_KEY_REQUEST,t);return(0,c.postJRPCRequest)(e,n)})(e,n)});return(0,a.Some)(h,async e=>(0,n.validatePubKey)(e))}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/getPubKeyRequest.cjs"}],[3053,{"./errors.cjs":3051,"./toprfSecureBackup.cjs":3060,"./utils.cjs":3061},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){a===undefined&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){a===undefined&&(a=n),e[a]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||a(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.TOPRFErrorCode=n.TOPRFError=void 0,r(e("./toprfSecureBackup.cjs"),n);var s=e("./errors.cjs");Object.defineProperty(n,"TOPRFError",{enumerable:!0,get:function(){return s.TOPRFError}}),Object.defineProperty(n,"TOPRFErrorCode",{enumerable:!0,get:function(){return s.TOPRFErrorCode}}),r(e("./utils.cjs"),n)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/index.cjs"}],[3054,{"@noble/curves/abstract/utils":3255,"@noble/curves/secp256k1":3258,"@noble/hashes/hkdf":3264,"@noble/hashes/sha2":3270},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.derivePwEncKey=n.deriveEncryptionKey=n.deriveAuthenticationKeyPair=void 0;const a=e("@noble/curves/abstract/utils"),r=e("@noble/curves/secp256k1"),s=e("@noble/hashes/hkdf"),i=e("@noble/hashes/sha2");n.deriveAuthenticationKeyPair=function(e){const t=(0,s.hkdf)(i.sha256,e,undefined,"authentication-key",32),n=(0,a.bytesToNumberBE)(t)%r.secp256k1.CURVE.n;return{sk:n,pk:r.secp256k1.getPublicKey(n,!1)}},n.deriveEncryptionKey=function(e){return(0,s.hkdf)(i.sha256,e,undefined,"encryption-key",32)},n.derivePwEncKey=function(e){return(0,s.hkdf)(i.sha256,e,undefined,"pwd-encryption-key",32)}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/keyDerivation.cjs"}],[3055,{"./constants.cjs":3050,"@metamask/auth-network-utils":3066,"@noble/ciphers/aes":3245,"@noble/ciphers/webcrypto":3248,"@noble/curves/secp256k1":3258,"@noble/hashes/sha3":3272,"@noble/hashes/utils":3274,buffer:4137},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var a,r,s,i,o,c,l,u,d,h,m,f,p,g,T,w=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},b=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.MetadataStore=n.MetadataStoreError=n.MetadataLockStatus=void 0;const E=e("@metamask/auth-network-utils"),y=e("@noble/ciphers/aes"),S=e("@noble/ciphers/webcrypto"),k=e("@noble/curves/secp256k1"),I=e("@noble/hashes/sha3"),A=e("@noble/hashes/utils"),_=e("./constants.cjs");var C;!function(e){e[e.FAILED=0]="FAILED",e[e.SUCCESS=1]="SUCCESS"}(C||(n.MetadataLockStatus=C={}));class P extends Error{constructor(e){super(e),this.name="MetadataStoreError",Object.setPrototypeOf(this,P.prototype)}}n.MetadataStoreError=P;n.MetadataStore=class{constructor(e){a.add(this),r.set(this,"srp-backup"),s.set(this,void 0),i.set(this,void 0),w(this,s,e.metadataEndpoint,"f"),w(this,i,e.fetchMetadataAccessCreds,"f")}async addSecretDataItem(e){try{const{secretData:t,encKey:n,authKeyPair:r}=e;await b(this,a,"m",o).call(this,{secretData:t,encKey:n,authKeyPair:r,metadataEndpoint:b(this,s,"f")})}catch(e){throw new P(`failed to add metadata: ${e.message}`)}}async batchAddSecretData(e){try{const{secretData:t,encKey:n,authKeyPair:r}=e;await b(this,a,"m",c).call(this,{secretData:t,encKey:n,authKeyPair:r,metadataEndpoint:b(this,s,"f")})}catch(e){throw new P(`failed to add batch metadata: ${e.message}`)}}async fetchAllSecretDataItems(e,t,n){try{return await b(this,a,"m",l).call(this,{encKey:e,authKeyPair:t,metadataEndpoint:b(this,s,"f"),itemId:n})}catch(e){throw new P(`failed to fetch metadata: ${e.message}`)}}async acquireMetadataLock(e){const{status:t,id:n}=await b(this,a,"m",u).call(this,b(this,s,"f"),e);if(t!==C.SUCCESS)throw new P("Failed to acquire metadata lock");if(!n)throw new P("Failed to acquire metadata lock. Missing lock id");return n}async releaseMetadataLock(e,t){const n=await b(this,a,"m",d).call(this,b(this,s,"f"),e,t);if(n!==C.SUCCESS)throw new P(`Failed to release metadata lock with id ${t}`);return n}},r=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakSet,o=async function(e){try{const t=`${e.metadataEndpoint}/enc_account_data/set`,n=b(this,a,"m",g).call(this,e.secretData.data,e.encKey),r=await b(this,a,"m",h).call(this,{itemId:e.secretData.itemId,data:n},e.authKeyPair),s=JSON.stringify(r),i=await fetch(t,{headers:{"Content-Type":"application/json"},method:"POST",body:s});if(!i.ok){const e=await i.json();throw new Error(`HTTP error message: ${e.error}`)}return(await i.json()).success}catch(e){const t=e.message||"Unknown error";throw new P(`failed to upsert metadata: ${t}`)}},c=async function(e){const t=Array.isArray(e.encKey)?e.encKey:e.secretData.map(()=>e.encKey);if(t.length!==e.secretData.length)throw new P("encKey must be of same length as secretData");try{const n=`${e.metadataEndpoint}/enc_account_data/batch_set`,r=e.secretData.map((e,n)=>({data:b(this,a,"m",g).call(this,e.data,t[n]),itemId:e.itemId})),s=await b(this,a,"m",h).call(this,r,e.authKeyPair),i=await fetch(n,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(s)});if(!i.ok){const e=await i.json();throw new Error(`HTTP error message: ${e.error}`)}return(await i.json()).success}catch(e){const t=e.message||"Unknown error";throw new P(`failed to upsert metadata: ${t}`)}},l=async function(e){try{const n=`${e.metadataEndpoint}/enc_account_data/get`,r=await b(this,a,"m",m).call(this,e.authKeyPair,e.itemId),s=await fetch(n,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(r)});if(!s.ok){const e=await s.json();throw new Error(`HTTP error message: ${e.error}`)}const i=await s.json();if(!i.data)throw new P("Failed to fetch metadata");return i.data.filter((t,n)=>e.itemId?i.ids[n]===e.itemId:i.ids[n]!==_.PW_BACKUP_ITEM_ID).map((n,r)=>{const s=new Uint8Array(t.from(n,"base64"));return{itemId:i.ids[r],data:b(this,a,"m",T).call(this,s,e.encKey)}}).filter(e=>e.data.length>0)}catch(e){const t=e.message||"Unknown error";throw new P(`failed to fetch metadata: ${t}`)}},u=async function(e,t){try{const n=b(this,a,"m",f).call(this,t),r=`${e}/acquireLock`,s=await fetch(r,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(n)});if(!s.ok){const e=await s.json();throw new Error(`HTTP error message: ${e.error}`)}const i=await s.json();return{status:i.status,id:i.id}}catch(e){const t=e.message||"Unknown error";throw new P(`failed to acquire metadata lock: ${t}`)}},d=async function(e,t,n){try{const r=b(this,a,"m",f).call(this,t,n),s=`${e}/releaseLock`,i=await fetch(s,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(r)});if(!i.ok){const e=await i.json();throw new Error(`HTTP error message: ${e.error}`)}return(await i.json()).status}catch(e){const t=e.message||"Unknown error";throw new P(`failed to release metadata lock: ${t}`)}},h=async function(e,n){const s=Date.now().toString(),o=b(this,r,"f"),{metadataAccessToken:c}=await b(this,i,"f").call(this),l={timestamp:s,feature:o,authToken:c};Array.isArray(e)?l.data=e.map(e=>{const n=e.data;return{data:t.from(n).toString("base64"),itemId:e.itemId}}):(l.data=t.from(e.data).toString("base64"),l.itemId=e.itemId);const{pk:u,sk:d}=n,h=b(this,a,"m",p).call(this,l,d),m=(0,A.bytesToHex)(u);return{...l,signature:h,pubKey:m}},m=async function(e,t){const n=Date.now().toString(),s=b(this,r,"f"),{pk:o,sk:c}=e,{metadataAccessToken:l}=await b(this,i,"f").call(this),u={feature:s,timestamp:n,itemId:t,authToken:l},d=b(this,a,"m",p).call(this,u,c),h=(0,A.bytesToHex)(o);return{...u,pubKey:h,signature:d}},f=function(e,t){const{pk:n,sk:r}=e,s={timestamp:Date.now()};return{data:s,signature:b(this,a,"m",p).call(this,s,r,!0),key:(0,A.bytesToHex)(n),id:t}},p=function(e,t,n=!1){const a=(0,E.safeStringify)(e),r=(0,I.keccak_256)(a),s=k.secp256k1.sign(r,t);return n?s.toDERHex():s.toCompactHex()},g=function(e,t){return(0,S.managedNonce)(y.gcm)(t).encrypt(e)},T=function(e,t){return(0,S.managedNonce)(y.gcm)(t).decrypt(e)}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/metadata.cjs"}],[3056,{"@noble/curves/abstract/modular":3253,"@noble/curves/abstract/utils":3255,"@noble/curves/secp256k1":3258},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OPRF=n.generateRandomScalar=void 0;const a=e("@noble/curves/abstract/modular"),r=e("@noble/curves/abstract/utils"),s=e("@noble/curves/secp256k1");function i(){return(0,r.bytesToNumberBE)(s.secp256k1.utils.randomPrivateKey())}n.generateRandomScalar=i;const o=(0,a.Field)(s.secp256k1.CURVE.n);n.OPRF=class{static blind(e){const t=i(),n=(0,s.hashToCurve)(e).multiply(t);return{a:s.secp256k1.ProjectivePoint.fromAffine(n.toAffine()),r:t}}static blindEval(e,t){return t.multiply(e)}static async unblindAndHash(e,t,n,a){const r=o.inv(n),i=t.multiply(r);let c=s.secp256k1.CURVE.hash(new Uint8Array([...e,...i.toRawBytes()]));if(a){const e=c.length;c=await a.deriveKey(c.slice(0,e/2),c.slice(e/2))}return c}static async localEval(e,t,n){const{a:a,r:r}=this.blind(t),s=a.multiply(e);return this.unblindAndHash(t,s,r,n)}}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/oprf.cjs"}],[3057,{"./constants.cjs":3050,"./errors.cjs":3051,"./utils.cjs":3061,"@metamask/auth-network-utils":3066,"@noble/hashes/sha3":3272,"@toruslabs/http-helpers":3071},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.resetRateLimits=n.validateThresholdResetRateLimitResponses=n.sendResetRateLimitRequest=void 0;const a=e("@metamask/auth-network-utils"),r=e("@noble/hashes/sha3"),s=e("@toruslabs/http-helpers"),i=e("./constants.cjs"),o=e("./errors.cjs"),c=e("./utils.cjs");n.sendResetRateLimitRequest=async(e,t)=>{const n=(0,s.generateJsonRPCObject)(i.JRPC_METHODS.RESET_RATE_LIMIT_REQUEST,t);return(0,c.postJRPCRequest)(e,n)};n.validateThresholdResetRateLimitResponses=(e,t)=>{const n=(0,c.checkAuthTokenErrors)(e);if(n)throw n;const r=(0,a.filterCompletedRequests)(e);if(r.length<t)throw o.TOPRFError.insufficientValidResponses(`invalid reset rate limit results, expected ${t} but got ${r.length}`);return!0};n.resetRateLimits=async e=>{const{authTokens:t,nodeEndpointsMap:s,authConnectionId:i,groupedAuthConnectionId:o,userId:l,authPrivKey:u}=e,d=(0,c.mergeEndpointsWithAuthTokens)(t,s).map(async({endpoint:e,authToken:t})=>{const s=(0,a.toSnakeCaseKeys)({timestamp:Date.now(),nodeIndex:t.nodeIndex,action:"reset_ratelimit"}),d=(0,a.safeStringify)(s,{cmp:c.preserveKeyOrder}),h=(0,r.keccak_256)(d),m=(0,c.createEthereumSignature)(h,u),f=((e,t,n,a,r,s)=>({authToken:e,signature:t,signedData:n,verifier:s??a,verifierId:r}))(t.authToken,m,d,i,l,o);return(0,n.sendResetRateLimitRequest)(e,f)});return(0,a.Some)(d,async e=>(0,n.validateThresholdResetRateLimitResponses)(e,t.length))}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/resetRateLimits.cjs"}],[3058,{"./constants.cjs":3050,"./utils.cjs":3061,"@metamask/auth-network-utils":3066,"@toruslabs/http-helpers":3071},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.changeKeyShares=n.createKeyChangeRequestParams=n.storeKeyShares=n.sendStoreKeySharesRequest=n.createStoreKeySharesRequestParams=void 0;const a=e("@metamask/auth-network-utils"),r=e("@toruslabs/http-helpers"),s=e("./constants.cjs"),i=e("./utils.cjs");n.createStoreKeySharesRequestParams=async e=>{const{nodeEndpointsMap:t,authTokens:n,authConnectionId:r,groupedAuthConnectionId:s,userId:o,keyShareIndex:c,oprfKey:l,authPubKey:u}=e,d=await(0,i.generateShareImportItems)(t,n,l,c);return{verifier:s??r,verifierId:o,pubKey:(0,a.uint8ArrayToHex)(u),shareImportItems:d}};n.sendStoreKeySharesRequest=async(e,t)=>{const n=(0,r.generateJsonRPCObject)(s.JRPC_METHODS.STORE_KEY_SHARES_REQUEST,(0,a.toSnakeCaseKeys)(t));return(0,i.postJRPCRequest)(e,n)};n.storeKeyShares=async e=>{const{authTokens:t,nodeEndpointsMap:r,authConnectionId:s,groupedAuthConnectionId:o,userId:c,keyShareIndex:l,oprfKey:u,authPubKey:d}=e,h=await(0,n.createStoreKeySharesRequestParams)({nodeEndpointsMap:r,authTokens:t,authConnectionId:s,groupedAuthConnectionId:o,userId:c,keyShareIndex:l,oprfKey:u,authPubKey:d}),m=r[(0,a.getProxyCoordinatorNodeIndex)(t.map(e=>e.nodeIndex),o??s,c)],f=await(0,n.sendStoreKeySharesRequest)(m,h);if((0,a.isJSONRPCError)(f.error)){throw(0,i.parseJsonRpcError)(f.error)}return f};n.createKeyChangeRequestParams=async e=>{const{nodeEndpointsMap:t,authTokens:n,keyShareIndex:r,newOprfKey:s,newAuthPubKey:o,oldAuthPrivKey:c,authConnectionId:l,groupedAuthConnectionId:u,userId:d}=e,h=await(0,i.generateShareImportItems)(t,n,s,r,c);return{pubKey:(0,a.uint8ArrayToHex)(o),shareImportItems:h,verifier:u??l,verifierId:d}};n.changeKeyShares=async e=>{const{nodeEndpointsMap:t,authTokens:r,keyShareIndex:s,newOprfKey:o,newAuthPubKey:c,oldAuthPrivKey:l,authConnectionId:u,groupedAuthConnectionId:d,userId:h}=e,m=await(0,n.createKeyChangeRequestParams)({nodeEndpointsMap:t,authTokens:r,keyShareIndex:s,newOprfKey:o,newAuthPubKey:c,oldAuthPrivKey:l,authConnectionId:u,groupedAuthConnectionId:d,userId:h}),f=t[(0,a.getProxyCoordinatorNodeIndex)(r.map(e=>e.nodeIndex),u,h)],p=await(0,n.sendStoreKeySharesRequest)(f,m);if((0,a.isJSONRPCError)(p.error)){throw(0,i.parseJsonRpcError)(p.error)}return p}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/storeSharesRequest.cjs"}],[3059,{"./constants.cjs":3050,"./errors.cjs":3051,"./keyDerivation.cjs":3054,"./oprf.cjs":3056,"./utils.cjs":3061,"@metamask/auth-network-utils":3066,"@noble/curves/secp256k1":3258,"@toruslabs/http-helpers":3071},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.recoverTOPRFSeed=n.validateSeed=void 0;const a=e("@metamask/auth-network-utils"),r=e("@noble/curves/secp256k1"),s=e("@toruslabs/http-helpers"),i=e("./constants.cjs"),o=e("./errors.cjs"),c=e("./keyDerivation.cjs"),l=e("./oprf.cjs"),u=e("./utils.cjs");n.validateSeed=async(e,t,n,s)=>{const d=(0,u.checkAuthTokenErrors)(n);if(d)throw d;let h=(0,u.checkRateLimitErrors)(n);if(h)throw o.TOPRFError.rateLimitExceeded(h);const m=(0,a.filterCompletedRequests)(n);if(m.length<i.TOPRF_EVAL_THRESHOLD)throw o.TOPRFError.insufficientValidResponses(`Insufficient toprf eval request results, expected ${i.TOPRF_EVAL_THRESHOLD} but got ${m.length}`);const f=(0,a.thresholdSame)(m.map(e=>e.result?.pubKey),i.TOPRF_EVAL_THRESHOLD);if(!f)throw o.TOPRFError.couldNotDeriveThresholdAuthPubKey();const p=m.reduce((e,t)=>{const n=t.result;if(!("object"==typeof(a=n)&&null!==a&&"blindedOutputX"in a&&"string"==typeof a.blindedOutputX&&"blindedOutputY"in a&&"string"==typeof a.blindedOutputY&&"nodeIndex"in a&&"number"==typeof a.nodeIndex&&"keyShareIndex"in a&&"number"==typeof a.keyShareIndex&&"pubKey"in a&&"string"==typeof a.pubKey))return e;var a;const{blindedOutputX:s,blindedOutputY:i,nodeIndex:o,keyShareIndex:c}=n;return e.push({blindedOutput:r.secp256k1.ProjectivePoint.fromAffine({x:BigInt(`0x${s}`),y:BigInt(`0x${i}`)}),nodeIndex:o,keyShareIndex:c}),e},[]);if(p.length<i.TOPRF_EVAL_THRESHOLD)throw o.TOPRFError.insufficientValidResponses(`Insufficient valid blinded outputs, expected: ${i.TOPRF_EVAL_THRESHOLD}, received: ${p.length}`);const g=await(async(e,t,n,s,o)=>{const u=(0,a.kCombinations)(e.length,i.TOPRF_EVAL_THRESHOLD);for(const i of u){const u=e.filter((e,t)=>i.includes(t)),d=u.map(e=>e.blindedOutput),h=u.map(e=>BigInt(e.nodeIndex)),m=(0,a.lagrangeInterpolationForPoints)(r.secp256k1.CURVE.n,d,h),f=await l.OPRF.unblindAndHash(t,m,n,o),{pk:p}=(0,c.deriveAuthenticationKeyPair)(f),g=r.secp256k1.ProjectivePoint.fromHex(p),T=r.secp256k1.ProjectivePoint.fromHex(s);if(g.equals(T))return{seed:f,keyShareIndex:u[0].keyShareIndex}}return null})(p,e,t,f,s);if(!g){if(h=(0,u.extractRateLimitErrorFromResults)(n),h)throw o.TOPRFError.rateLimitExceeded(h);throw o.TOPRFError.couldNotDeriveEncryptionKey()}return g};n.recoverTOPRFSeed=async e=>{const{authTokens:t,nodeEndpointsMap:r,authConnectionId:c,groupedAuthConnectionId:d,userId:h,userInput:m,keyDeriver:f}=e;if(t.length<i.TOPRF_EVAL_THRESHOLD)throw o.TOPRFError.insufficientAuthTokens(`At least ${i.TOPRF_EVAL_THRESHOLD} auth tokens are required.`);const{a:p,r:g}=l.OPRF.blind(m),T=(0,u.mergeEndpointsWithAuthTokens)(t,r).map(async({endpoint:e,authToken:t})=>{const n=((e,t,n,a,r,s)=>({authToken:e,shareCoefficient:"1",blindedInputX:t,blindedInputY:n,verifier:s??a,verifierId:r}))(t.authToken,p.x.toString(16),p.y.toString(16),c,h,d);return(async(e,t)=>{const n=(0,s.generateJsonRPCObject)(i.JRPC_METHODS.TOPRF_EVAL_REQUEST,t);return(0,u.postJRPCRequest)(e,n)})(e,n)});try{return await(0,a.Some)(T,async e=>(0,n.validateSeed)(m,g,e,f))}catch(e){throw(0,u.getTOPRFError)(e)}}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/toprfEvalRequest.cjs"}],[3060,{"./authenticateRequest.cjs":3048,"./commitRequest.cjs":3049,"./constants.cjs":3050,"./errors.cjs":3051,"./getPubKeyRequest.cjs":3052,"./keyDerivation.cjs":3054,"./metadata.cjs":3055,"./oprf.cjs":3056,"./resetRateLimits.cjs":3057,"./storeSharesRequest.cjs":3058,"./toprfEvalRequest.cjs":3059,"./utils.cjs":3061,"@metamask/auth-network-utils":3066,"@noble/ciphers/utils":3247,"@noble/curves/abstract/utils":3255,"@noble/curves/secp256k1":3258,"@noble/hashes/utils":3274,"@toruslabs/fetch-node-details":3321,buffer:4137},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var a,r,s,i,o,c,l,u,d,h,m,f,p=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},g=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.ToprfSecureBackup=void 0;const T=e("@metamask/auth-network-utils"),w=e("@noble/ciphers/utils"),b=e("@noble/curves/abstract/utils"),E=e("@noble/curves/secp256k1"),y=e("@noble/hashes/utils"),S=e("@toruslabs/fetch-node-details"),k=e("./authenticateRequest.cjs"),I=e("./commitRequest.cjs"),A=e("./constants.cjs"),_=e("./errors.cjs"),C=e("./getPubKeyRequest.cjs"),P=e("./keyDerivation.cjs"),v=e("./metadata.cjs"),N=e("./oprf.cjs"),R=e("./resetRateLimits.cjs"),j=e("./storeSharesRequest.cjs"),O=e("./toprfEvalRequest.cjs"),x=e("./utils.cjs");class L{constructor(e){a.add(this),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),p(this,s,new S.NodeDetailManager({network:e.network}),"f"),p(this,i,e.nodeDetailsOverride,"f"),p(this,o,e.keyDeriver,"f"),p(this,c,e.fetchMetadataAccessCreds,"f")}async authenticate(e){const{nodeEndpoints:n,nodeEndpointsMap:r}=await g(this,a,"m",u).call(this);let s=E.secp256k1.utils.randomPrivateKey();try{const a=E.secp256k1.ProjectivePoint.fromPrivateKey(s),i=a.x.toString(16),o=a.y.toString(16);let c;e.groupedAuthConnectionId&&(c=(0,T.remove0x)((0,T.keccak256AndHexify)(t.from(e.idTokens[0],"utf8"))));const l=await(0,I.commitIdToken)({idToken:c??e.idTokens[0],authConnectionId:e.groupedAuthConnectionId??e.authConnectionId,sessionPubKeyX:i,sessionPubKeyY:o,endpoints:n}),u=l.reduce((e,t)=>(e[t.nodeIndex]=r[t.nodeIndex],e),{}),{authTokensData:d,isNewUser:h}=await(0,k.authenticateUser)({idToken:e.idTokens[0],authConnectionId:e.authConnectionId,userId:e.userId,sessionPrivateKey:s,nodeEndpointsMap:u,commitmentSignatures:l,groupedAuthConnectionId:e.groupedAuthConnectionId,hashedIdToken:c});return{nodeAuthTokens:d.map(e=>({authToken:e.authToken,nodeIndex:e.nodeIndex,nodePubKey:e.nodePubKey})),isNewUser:h}}finally{s.fill(0),s=null}}async createLocalKey(e){const{password:t,oprfKey:n=(0,N.generateRandomScalar)()}=e;let a=null;try{a=(0,b.utf8ToBytes)(t);const e=await N.OPRF.localEval(n,a,g(this,o,"f")),r=(0,P.deriveAuthenticationKeyPair)(e),s=(0,P.deriveEncryptionKey)(e);return{oprfKey:n,seed:e,authKeyPair:r,encKey:s,pwEncKey:(0,P.derivePwEncKey)(e)}}finally{a&&(a.fill(0),a=null)}}async persistLocalKey(e){const{nodeAuthTokens:t,oprfKey:n,authPubKey:r,authConnectionId:s,groupedAuthConnectionId:i,userId:o,keyShareIndex:c=A.FIRST_KEY_INDEX,oldAuthKeyPair:l}=e,{nodeEndpointsMap:d}=await g(this,a,"m",u).call(this),h=t.reduce((e,t)=>(e[t.nodeIndex]=d[t.nodeIndex],e),{});l?await(0,j.changeKeyShares)({nodeEndpointsMap:h,authConnectionId:s,groupedAuthConnectionId:i,userId:o,authTokens:t,keyShareIndex:c,newOprfKey:n,newAuthPubKey:r,oldAuthPrivKey:l.sk}):await(0,j.storeKeyShares)({nodeEndpointsMap:h,authConnectionId:s,groupedAuthConnectionId:i,userId:o,authTokens:t,keyShareIndex:c,oprfKey:n,authPubKey:r})}async createAndPersistEncKey(e){const{nodeAuthTokens:t,password:n,authConnectionId:a,userId:r}=e,{oprfKey:s,authKeyPair:i,encKey:o,pwEncKey:c}=await this.createLocalKey({password:n});return await this.persistLocalKey({nodeAuthTokens:t,oprfKey:s,authPubKey:i.pk,authConnectionId:a,userId:r}),{authKeyPair:{sk:i.sk,pk:i.pk},encKey:o,pwEncKey:c}}async recoverEncKey(e){const{nodeAuthTokens:t,password:n,authConnectionId:r,groupedAuthConnectionId:s,userId:i}=e;let c=null,l=null;try{const{nodeEndpointsMap:e}=await g(this,a,"m",u).call(this);c=(0,b.utf8ToBytes)(n);const{seed:d,keyShareIndex:h}=await(0,O.recoverTOPRFSeed)({authTokens:t,nodeEndpointsMap:e,authConnectionId:r,groupedAuthConnectionId:s,userId:i,userInput:c,keyDeriver:g(this,o,"f")});l=d;const m=(0,P.deriveAuthenticationKeyPair)(l),f=(0,P.deriveEncryptionKey)(l),p=(0,P.derivePwEncKey)(l),T=new Promise((n,a)=>{(0,R.resetRateLimits)({authTokens:t,nodeEndpointsMap:e,authConnectionId:r,groupedAuthConnectionId:s,userId:i,authPrivKey:m.sk}).then(()=>n()).catch(e=>{a(e)})});return{authKeyPair:m,encKey:f,pwEncKey:p,keyShareIndex:h,rateLimitResetResult:T}}finally{c&&(c.fill(0),c=null),l&&(l.fill(0),l=null)}}async changeEncKey(e){const{nodeAuthTokens:t,authConnectionId:n,groupedAuthConnectionId:r,userId:s,oldEncKey:i,oldPwEncKey:o,oldAuthKeyPair:c,newPassword:l,newKeyShareIndex:u,pregeneratedOprfKey:h}=e;if(!h&&!l)throw new Error("Either newPassword or pregeneratedOprfKey is required");if(h&&l)throw new Error("Only one of newPassword or pregeneratedOprfKey is allowed");const{oprfKey:m,authKeyPair:f,encKey:p,pwEncKey:T}=l?await this.createLocalKey({password:l}):h;let w,b,E;try{w=await g(this,a,"m",d).call(this),[b,E]=await Promise.all([w.acquireMetadataLock(c),w.acquireMetadataLock(f)]);const e=(await w.fetchAllSecretDataItems(i,c)).map(e=>({data:e.data}));if(!e||0===e.length)throw new Error("No existing data found to change key");const l=[{data:M("",o,c),itemId:A.PW_BACKUP_ITEM_ID},...e],h=[T,...e.map(()=>p)];return await w.batchAddSecretData({secretData:l,encKey:h,authKeyPair:f}),await this.persistLocalKey({nodeAuthTokens:t,oprfKey:m,authPubKey:f.pk,authConnectionId:n,groupedAuthConnectionId:r,userId:s,keyShareIndex:u,oldAuthKeyPair:c}),{authKeyPair:f,encKey:p,pwEncKey:T}}finally{if(w&&b&&E)try{await Promise.all([w.releaseMetadataLock(c,b),w.releaseMetadataLock(f,E)])}catch(e){console.error("Failed to release metadata lock:",e)}}}async addSecretDataItem(e){const t=await g(this,a,"m",d).call(this);await t.addSecretDataItem({...e,secretData:{data:e.secretData}})}async batchAddSecretDataItems(e){const t=await g(this,a,"m",d).call(this);let n;try{n=await t.acquireMetadataLock(e.authKeyPair),await t.batchAddSecretData({...e,secretData:e.secretData.map(e=>({data:e}))})}finally{if(n)try{await t.releaseMetadataLock(e.authKeyPair,n)}catch(e){console.error("Failed to release metadata lock:",e)}}}async fetchAllSecretDataItems(e){const t=await g(this,a,"m",d).call(this);return(await t.fetchAllSecretDataItems(e.decKey,e.authKeyPair)).map(e=>e.data)}async fetchAuthPubKey(e){const{nodeAuthTokens:t,authConnectionId:n,userId:r,groupedAuthConnectionId:s}=e,{nodeEndpointsMap:i}=await g(this,a,"m",u).call(this);return(0,C.getPubKey)({authTokens:t,nodeEndpointsMap:i,authConnectionId:n,userId:r,groupedAuthConnectionId:s})}async recoverPwEncKey(e){const{targetAuthPubKey:t,curPwEncKey:n,curAuthKeyPair:r,maxPwChainLength:s=A.MAX_PASSWORD_CHAIN_LENGTH}=e;let i={password:"",encKey:n,authKeyPair:r};for(let e=0;e<s;e++)try{if(i=await g(this,a,"m",m).call(this,{encKey:i.encKey,authKeyPair:i.authKeyPair}),(0,w.equalBytes)(i.authKeyPair.pk,t))return{pwEncKey:i.encKey}}catch(e){throw _.TOPRFError.couldNotFetchPassword(e.message)}throw _.TOPRFError.maxKeyChainLengthExceeded()}async getNodeDetails(){return g(this,a,"m",u).call(this)}}function M(e,t,n){return(0,b.utf8ToBytes)(JSON.stringify({pw:e,encKey:(0,y.bytesToHex)(t),authKeyPair:{sk:n.sk.toString(),pk:(0,y.bytesToHex)(n.pk)}}))}n.ToprfSecureBackup=L,r=L,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,a=new WeakSet,u=async function(){let e=g(this,i,"f")?.indexes,t=g(this,i,"f")?.pubKeys,n=g(this,i,"f")?.endpoints;if(e&&t&&Array.isArray(n))return g(r,r,"m",f).call(r,e,t,n),{nodeEndpoints:n,nodeEndpointsMap:(0,x.createNodeEndpointsMap)(n,e),nodeIndexes:e,nodePubkeys:t};const{torusNodeSSSEndpoints:a,torusIndexes:o,torusNodePub:c}=await g(this,s,"f").getNodeDetails({verifier:"auth-connection-id",verifierId:"user-id"});if(e??(e=o),t??(t=c),!Array.isArray(n)){if(!a){throw new Error("Failed to get node details")}n=n?a.map(e=>{const t=new URL(e);return t.pathname=n,t.href}):a}return g(r,r,"m",f).call(r,e,t,n),{nodeEndpoints:n,nodeEndpointsMap:(0,x.createNodeEndpointsMap)(n,e),nodeIndexes:e,nodePubkeys:t}},d=async function(){if(g(this,l,"f"))return g(this,l,"f");const{nodeEndpointsMap:e}=await g(this,a,"m",u).call(this),t=(await g(this,a,"m",h).call(this,e))[1],n=new v.MetadataStore({metadataEndpoint:t,fetchMetadataAccessCreds:g(this,c,"f")});return p(this,l,n,"f"),n},h=async function(e){const t={};return Object.entries(e).forEach(([e,n])=>{const a=new URL(n);t[e]=`${a.origin}/metadata`}),t},m=async function(e){const t=await g(this,a,"m",d).call(this),n=await t.fetchAllSecretDataItems(e.encKey,e.authKeyPair,A.PW_BACKUP_ITEM_ID);if(0===n.length)throw new Error("Failed to get previous password and keys");const r=function(e){const t=JSON.parse((0,w.bytesToUtf8)(e));return{pw:t.pw,encKey:(0,y.hexToBytes)(t.encKey),authKeyPair:{sk:BigInt(t.authKeyPair.sk),pk:(0,y.hexToBytes)(t.authKeyPair.pk)}}}(n[0].data);return{password:r.pw,encKey:r.encKey,authKeyPair:r.authKeyPair}},f=function(e,t,n){if(e.length!==t.length||e.length!==n.length){throw new Error("Node details arrays (indexes, pubKeys, endpoints) must have equal lengths")}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/toprfSecureBackup.cjs"}],[3061,{"./constants.cjs":3050,"./errors.cjs":3051,"@metamask/auth-network-utils":3066,"@noble/curves/secp256k1":3258,"@noble/hashes/sha3":3272,"@toruslabs/eccrypto":3320,"@toruslabs/http-helpers":3071,"bn.js":4076,buffer:4137},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.preserveKeyOrder=n.getTOPRFError=n.parseJsonRpcError=n.mergeEndpointsWithAuthTokens=n.checkAuthTokenErrors=n.checkRateLimitErrors=n.extractRateLimitErrorFromResults=n.getMaxRateLimitError=n.createNodeEndpointsMap=n.generateShareImportItems=n.createKeyChangeShareImportItems=n.createNewUserShareImportItems=n.createKeyChangeProof=n.createEthereumSignature=n.prepareNodeShares=n.decryptAuthToken=n.postJRPCRequest=n.bigIntToBN=void 0;const r=e("@metamask/auth-network-utils"),s=e("@noble/curves/secp256k1"),i=e("@noble/hashes/sha3"),o=e("@toruslabs/eccrypto"),c=e("@toruslabs/http-helpers"),l=a(e("bn.js")),u=e("./constants.cjs"),d=e("./errors.cjs");n.bigIntToBN=e=>new l.default(e.toString());n.postJRPCRequest=async(e,t)=>{const n={...t};return n.params=(0,r.toSnakeCaseKeys)(t.params),(0,c.post)(e,n,{},{logTracingHeader:!1}).then(e=>(e.result&&(e.result=(0,r.toCamelCaseKeys)(e.result)),e)).catch(e=>({id:t.id,jsonrpc:"2.0",error:{code:-32e3,message:"Internal error",data:e}}))};n.decryptAuthToken=async(e,n)=>{const a=JSON.parse(e),s=(0,r.encParamsHexToBuf)(a.metadata),i=await(0,o.decrypt)(t.from(n),{...s,ciphertext:t.from(a.data,"hex")});return t.from(i).toString("base64")};const h=async(e,n)=>{const a=await(0,o.encrypt)(n,e,{padding:!0}),s=(0,r.encryptedParamsBufToHex)(a);return{data:t.from(a.ciphertext).toString("hex"),metadata:{...s}}};n.prepareNodeShares=(e,t)=>{const a=(0,n.bigIntToBN)(t),s=(0,r.getSecp256K1Curve)(),i=Object.keys(e).map(e=>parseInt(e,10)),o=((e,t,n,a)=>{const s=t.map(e=>new l.default(e)),i=a-1;return(0,r.generateRandomPolynomial)(e,i,n).generateShares(s)})(s,i,a,u.GENERATE_SHARE_THRESHOLD);return{shares:o,nodeIndexes:i}};n.createEthereumSignature=(e,t)=>{const n=t.toString(16).padStart(64,"0"),a=s.secp256k1.sign(e,n);return a.toCompactHex()+(a.recovery+27).toString(16).padStart(2,"0")};n.createKeyChangeProof=(e,a,s,o)=>{const c=Math.floor(Date.now()/1e3),l=(e=>e.toArrayLike(t,"be",32).toString("base64"))(e),u=(0,r.toSnakeCaseKeys)({shareData:l,keyShareIndex:a,nodeIndex:s,timestamp:c}),d=JSON.stringify(u),h=(0,i.keccak_256)(d);return{oldKeySignature:(0,n.createEthereumSignature)(h,o),signatureTimestamp:c}};n.createNewUserShareImportItems=async(e,n,a,r)=>Promise.all(a.map(async a=>{const{nodePubKey:s,nodeIndex:i,authToken:o}=a,c=new l.default(i).toString("hex",64),u=e[c].toJSON(),d=await h(t.from(u.share,"hex"),t.from(s,"hex")),m=await h(t.from(o,"base64"),t.from(s,"hex"));return{encryptedShare:JSON.stringify(d),encryptedAuthToken:JSON.stringify(m),keyShareIndex:r,nodeIndex:i,sssEndpoint:n[i]}}));n.createKeyChangeShareImportItems=async(e,a,r,s,i)=>Promise.all(r.map(async r=>{const{nodePubKey:o,nodeIndex:c,authToken:u}=r,d=new l.default(c).toString("hex",64),m=e[d].toJSON(),f=new l.default(m.share,16),p=(0,n.createKeyChangeProof)(f,s,c,i),g=await h(t.from(m.share,"hex"),t.from(o,"hex")),T=await h(t.from(u,"base64"),t.from(o,"hex"));return{encryptedShare:JSON.stringify(g),encryptedAuthToken:JSON.stringify(T),keyShareIndex:s,nodeIndex:c,sssEndpoint:a[c],...p}}));n.generateShareImportItems=async(e,t,a,r,...s)=>{const{shares:i}=(0,n.prepareNodeShares)(e,a),o=s[0];return o!==undefined?(0,n.createKeyChangeShareImportItems)(i,e,t,r,o):(0,n.createNewUserShareImportItems)(i,e,t,r)};function m(e,t){return e.remainingTime>t.remainingTime?e:t}function f(e){if(!(0,r.isJSONRPCError)(e)||-32602!==e.code||"Rate limit exceeded"!==e.message||!e.data)return undefined;const t=(0,r.toCamelCaseKeys)(e.data);return"string"!=typeof t?.message||"number"!=typeof t?.remainingTime||"number"!=typeof t?.lockTime||"number"!=typeof t?.guessCount?undefined:{message:t.message,remainingTime:t.remainingTime,lockTime:t.lockTime,guessCount:t.guessCount}}function p(e){if(e.code===u.JsonRpcErrorCodes.ErrorCodeInvalidParams){if(e.message.toLowerCase().includes("auth token expired"))return d.TOPRFError.authTokenExpired();if(e.message.toLowerCase().includes("invalid auth token"))return d.TOPRFError.invalidAuthToken();let t=e.message;if("string"==typeof e.data)t=e.data;else if(e.data){const n=(0,r.toCamelCaseKeys)(e.data);t=JSON.stringify(n)}return d.TOPRFError.jsonRpcError(t)}if(e.code===u.JsonRpcErrorCodes.ErrorCodeInternal){const t=e.data??e.message;return d.TOPRFError.jsonRpcError(t)}return d.TOPRFError.default(e.message)}n.createNodeEndpointsMap=(e,t)=>t.reduce((t,n)=>(t[n]=e[n-1],t),{}),n.getMaxRateLimitError=m,n.extractRateLimitErrorFromResults=function(e){let t;for(const n of e)if(n.result?.lockTimeSeconds&&n.result.lockTimeSeconds>0&&n.result.guessCount){const e={remainingTime:n.result.lockTimeSeconds,message:"Rate limit exceeded",lockTime:n.result.lockTimeSeconds,guessCount:n.result.guessCount};t=t?m(t,e):e}return t},n.checkRateLimitErrors=function(e){const t=(0,r.filterErrorResponses)(e);let n;for(const e of t){const t=f(e.error);t&&(n=n?m(n,t):t)}return n},n.checkAuthTokenErrors=function(e){const t=(0,r.filterErrorResponses)(e);for(const e of t)if((0,r.isJSONRPCError)(e.error)){const t=p(e.error);if(t.code===d.TOPRFErrorCode.AuthTokenExpired||t.code===d.TOPRFErrorCode.InvalidAuthToken)return t}return undefined},n.mergeEndpointsWithAuthTokens=function(e,t){return e.map(e=>{const n=t[e.nodeIndex];if(!n)throw d.TOPRFError.endpointNotFound(`Endpoint not found for node index ${e.nodeIndex}`);return{endpoint:n,authToken:e}})},n.parseJsonRpcError=p,n.getTOPRFError=function(e){return e instanceof r.SomeError&&e.predicate&&e.predicate instanceof d.TOPRFError?e.predicate:e},n.preserveKeyOrder=function(e,t){return 0}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup",file:"node_modules/@metamask/toprf-secure-backup/dist/utils.cjs"}],[3062,{"./errors.cjs":3064,"@noble/hashes/sha3":3272,"bn.js":4076,buffer:4137,"json-stable-stringify-without-jsonify":4717},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.toSnakeCaseKeys=n.toCamelCaseKeys=n.convertKeys=n.toSnake=n.toCamel=n.isJSONRPCError=n.filterErrorResponses=n.filterCompletedRequests=n.Some=n.getProxyCoordinatorNodeIndex=n.kCombinations=n.thresholdSame=n.safeStringify=n.add0x=n.remove0x=n.keccak256AndHexify=void 0;const r=e("@noble/hashes/sha3"),s=a(e("bn.js")),i=a(e("json-stable-stringify-without-jsonify")),o=e("./errors.cjs");function c(e){return`0x${t.from((0,r.keccak_256)(e)).toString("hex")}`}n.keccak256AndHexify=c,n.remove0x=function(e){return e.startsWith("0x")?e.slice(2):e},n.add0x=function(e){return e.startsWith("0x")?e:`0x${e}`},n.safeStringify=function(e,t){const n=(0,i.default)(e,t);if(!n)throw new Error("Failed to stringify");return n},n.thresholdSame=function(e,t){const n={};for(const a of e){const e=(0,i.default)(a);if(e&&(n[e]=n[e]?n[e]+1:1,n[e]===t))return a}return undefined},n.kCombinations=function*e(t,n){let a=t;if("number"==typeof a&&(a=Array.from({length:a},(e,t)=>t)),n>a.length||n<=0)return;if(n===a.length)return void(yield a);if(1===n){for(const e of a)yield[e];return}const r=Array.from({length:a.length-n+2},(e,t)=>t);for(const t of r)for(const r of e(a.slice(t+1),n-1))yield[a[t],...r]};function l(e){return e.replace(/_([a-z])/gu,(e,t)=>t.toUpperCase())}function u(e){return e.replace(/([A-Z])/gu,"_$1").toLowerCase()}function d(e,t){if(Array.isArray(e))return e.map(e=>d(e,t));if(null!==e&&"object"==typeof e){const n={};for(const[a,r]of Object.entries(e))n[t(a)]=d(r,t);return n}return e}n.getProxyCoordinatorNodeIndex=(e,n,a)=>{const r=`${n}${a}`,i=c(t.from(r,"utf8")).slice(2);return e[new s.default(i,"hex").mod(new s.default(e.length)).toNumber()]},n.Some=async function(e,t){let n;const a=new Array(e.length).fill(undefined),r=new Array(e.length).fill(undefined);for(const[s,i]of e.entries()){let e;try{const t=new Promise((t,n)=>{e=setTimeout(()=>n(new Error("Promise timed out")),1e4)});a[s]=await Promise.race([i,t])}catch(e){r[s]=e}finally{e&&clearTimeout(e)}try{const e=a.every(e=>e!==undefined),n=await t(a,{allSettled:e});if(n)return n}catch(e){n=e}}!function(e,t,n){let a=e.some(e=>e!==undefined);if(a)throw new o.SomeError({errors:e,responses:t,predicate:n});if(a=t.some(e=>Boolean(e?.error)),a){const e=t.map(e=>{const{error:t}=e;return t?.data&&t.data.length>0?new Error(t.data):undefined});throw new o.SomeError({errors:e,responses:t,predicate:n})}throw new o.SomeError({errors:e,responses:t,predicate:n})}(r,a,n)},n.filterCompletedRequests=function(e){return e.filter(e=>{const t=e&&"object"==typeof e,n=e,a=!n?.error,r=Boolean(n?.result);return t&&a&&r})},n.filterErrorResponses=function(e){return e.filter(e=>{const t=e&&"object"==typeof e,n=e,a=Boolean(n?.error);return t&&a})},n.isJSONRPCError=function(e){const t=e;return Boolean(e&&"object"==typeof e)&&"number"==typeof t?.code&&"string"==typeof t?.message},n.toCamel=l,n.toSnake=u,n.convertKeys=d;n.toCamelCaseKeys=e=>d(e,l);n.toSnakeCaseKeys=e=>d(e,u)}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/common.cjs"}],[3063,{"./common.cjs":3062,buffer:4137,elliptic:4310},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){Object.defineProperty(n,"__esModule",{value:!0}),n.uint8ArrayToHex=n.derivePubKey=n.toChecksumAddress=n.encParamsHexToBuf=n.encryptedParamsBufToHex=n.generatePrivateKey=n.getSecp256K1Curve=void 0;const a=e("elliptic"),r=e("./common.cjs");let s=null;n.getSecp256K1Curve=function(){return s=s??new a.ec("secp256k1"),s},n.generatePrivateKey=function(e){return e.genKeyPair().getPrivate()},n.encryptedParamsBufToHex=function(e){return{iv:t.from(e.iv).toString("hex"),ephemPublicKey:t.from(e.ephemPublicKey).toString("hex"),mac:t.from(e.mac).toString("hex"),mode:"AES256"}},n.encParamsHexToBuf=function(e){return{iv:t.from(e.iv,"hex"),ephemPublicKey:t.from(e.ephemPublicKey,"hex"),mac:t.from(e.mac,"hex")}},n.toChecksumAddress=function(e){const n=(a=e,a.startsWith("0x")||a.startsWith("0X")?a.slice(2):a).toLowerCase();var a;const s=t.from(n,"utf8"),i=(0,r.keccak256AndHexify)(s).slice(2);let o="0x";for(let e=0;e<n.length;e++)parseInt(i[e],16)>=8?o+=n[e].toUpperCase():o+=n[e];return o},n.derivePubKey=function(e,t){const n=t.toString(16,64);return e.keyFromPrivate(n,"hex").getPublic()},n.uint8ArrayToHex=function(e){return Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join("")}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/cryptoUtils.cjs"}],[3064,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SomeError=void 0;class a extends Error{constructor({errors:e,responses:t,predicate:n}){const r=n?.message??"unknown error";super(`Unable to resolve enough promises. \n      errors: ${e.map(e=>e?.message??e).join(", ")}, \n      predicate error: ${r},\n      ${t.length} responses,\n      responses: ${JSON.stringify(t)}`),this.errors=e,this.responses=t,this.predicate=n,Object.setPrototypeOf(this,a.prototype)}toString(){return this.message}}n.SomeError=a}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/errors.cjs"}],[3065,{"bn.js":4076},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.waitFor=n.capitalizeFirstLetter=n.generateEmptyBNArray=void 0;const r=a(e("bn.js"));n.generateEmptyBNArray=function(e){return Array.from({length:e},()=>new r.default(0))},n.capitalizeFirstLetter=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},n.waitFor=async function(e=2e3){return new Promise(t=>{setTimeout(t,e)})}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/helpers.cjs"}],[3066,{"./common.cjs":3062,"./cryptoUtils.cjs":3063,"./errors.cjs":3064,"./helpers.cjs":3065,"./lagrangeInterpolation.cjs":3067,"./point.cjs":3068,"./polynomial.cjs":3069,"./share.cjs":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){a===undefined&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){a===undefined&&(a=n),e[a]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||a(t,e,n)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.Share=n.Polynomial=n.Point=void 0;var i=e("./point.cjs");Object.defineProperty(n,"Point",{enumerable:!0,get:function(){return s(i).default}});var o=e("./polynomial.cjs");Object.defineProperty(n,"Polynomial",{enumerable:!0,get:function(){return s(o).default}});var c=e("./share.cjs");Object.defineProperty(n,"Share",{enumerable:!0,get:function(){return s(c).default}}),r(e("./errors.cjs"),n),r(e("./common.cjs"),n),r(e("./lagrangeInterpolation.cjs"),n),r(e("./cryptoUtils.cjs"),n),r(e("./helpers.cjs"),n)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/index.cjs"}],[3067,{"./cryptoUtils.cjs":3063,"./helpers.cjs":3065,"./point.cjs":3068,"./polynomial.cjs":3069,"@noble/curves/abstract/modular":3253,"@noble/curves/abstract/utils":3255,"@noble/curves/secp256k1":3258,"@noble/hashes/utils":3274,"bn.js":4076},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){a===undefined&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){a===undefined&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.lagrangeInterpolation=n.lagrangeInterpolationForScalars=n.lagrangeInterpolationForPoints=n.lagrangeInterpolationNoble=n.generateRandomScalar=n.generateRandomPolynomialNoble=n.generateRandomPolynomial=n.lagrangeInterpolatePolynomial=void 0;const o=e("@noble/curves/abstract/modular"),c=e("@noble/curves/abstract/utils"),l=e("@noble/curves/secp256k1"),u=e("@noble/hashes/utils"),d=i(e("bn.js")),h=e("./cryptoUtils.cjs"),m=e("./helpers.cjs"),f=i(e("./point.cjs")),p=s(e("./polynomial.cjs"));function g(e,t){const n=(0,h.generatePrivateKey)(t);return e.find(e=>e.eq(n))?g(e,t):n}function T(e,t,n){const a=(0,m.generateEmptyBNArray)(e.length+t.length-1);for(let r=0;r<e.length;r++)for(let s=0;s<t.length;s++)a[r+s]=a[r+s].add(e[r].mul(t[s])).umod(n);return a}function w(e,t){const n=t.length,a=(0,m.generateEmptyBNArray)(n);if(!e.n)throw new Error("Curve is not set");for(let r=0;r<n;r++){let s=[new d.default(1)];for(let a=0;a<n;a++){if(a===r)continue;const n=t[r].xCoordinate.sub(t[a].xCoordinate).umod(e.n).invm(e.n);s=T(s,[t[a].xCoordinate.neg().umod(e.n).mul(n).umod(e.n),n],e.n)}for(let n=0;n<s.length;n++)a[n]=a[n].add(s[n].mul(t[r].yCoordinate)).umod(e.n)}return new p.default(a,e)}function b(e=l.secp256k1.CURVE.n){const t=(0,o.getMinHashLength)(e),n=(0,u.randomBytes)(t);return(0,c.bytesToNumberBE)(n)%e}function E(e,t,n){if(t.length!==n.length)throw new Error("Values and nodeIndex arrays must have the same length");if(0===t.length)throw new Error("Cannot interpolate with empty arrays");const a=(0,o.Field)(e),r="bigint"==typeof t[0];let s=r?0n:l.secp256k1.ProjectivePoint.ZERO;for(let e=0;e<t.length;e++){let i=1n,o=1n;for(let t=0;t<n.length;t++){if(e===t)continue;const r=n[e],s=n[t],c=a.neg(s),l=a.sub(r,s);i=a.mul(i,c),o=a.mul(o,l)}const c=a.mul(i,a.inv(o));if(r){const n=t[e],r=a.mul(n,c);s=a.add(s,r)}else{const n=t[e].multiply(c);s=s.add(n)}}return s}n.lagrangeInterpolatePolynomial=w,n.generateRandomPolynomial=function(e,t,n,a){let r;if(r=n||g([new d.default(0)],e),!a){const n=[r];for(let a=0;a<t;a+=1){const t=g(n,e);n.push(t)}return new p.default(n,e)}if(!Array.isArray(a))throw new Error("deterministic shares in generateRandomPolynomial should be an array");if(a.length>t)throw new Error("deterministicShares in generateRandomPolynomial should be less or equal than degree to ensure an element of randomness");const s={};a.forEach(t=>{s[t.shareIndex.toString("hex",64)]=new f.default(t.shareIndex,t.share,e)});for(let n=0;n<t-a.length;n+=1){const t=[new d.default(0)];Object.keys(s).forEach(e=>{t.push(new d.default(e,"hex"))});const n=g(t,e);s[n.toString("hex",64)]=new f.default(n,(0,h.generatePrivateKey)(e),e)}return s[0]=new f.default(new d.default(0),r,e),w(e,Object.values(s))},n.generateRandomPolynomialNoble=function(e,t,n){const a=[n??b(e)];for(let n=1;n<=t;n++)a[n]=b(e);return new p.PolynomialNoble(a,e)},n.generateRandomScalar=b,n.lagrangeInterpolationNoble=E,n.lagrangeInterpolationForPoints=function(e,t,n){return E(e,t,n)},n.lagrangeInterpolationForScalars=function(e,t,n){return E(e,t,n)},n.lagrangeInterpolation=function(e,t,n){if(t.length!==n.length)throw new Error("shares not equal to nodeIndex length in lagrangeInterpolation");const a=t.map((t,a)=>new f.default(n[a],t,e));return w(e,a).polynomial[0]}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/lagrangeInterpolation.cjs"}],[3068,{"bn.js":4076,buffer:4137},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const r=a(e("bn.js"));n.default=class{constructor(e,t,n){this.xCoordinate=new r.default(e,"hex"),this.yCoordinate=new r.default(t,"hex"),this.ecCurve=n}encode(e){switch(e){case"arr":return t.concat([t.from("04","hex"),t.from(this.xCoordinate.toString("hex",64),"hex"),t.from(this.yCoordinate.toString("hex",64),"hex")]);case"elliptic-compressed":{const e=this.ecCurve.keyFromPublic({x:this.xCoordinate.toString("hex",64),y:this.yCoordinate.toString("hex",64)},"hex");return t.from(e.getPublic(!0,"hex"),"hex")}default:throw new Error("encoding doesn't exist in Point")}}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/point.cjs"}],[3069,{"./share.cjs":3070,"@noble/curves/abstract/modular":3253,"bn.js":4076,elliptic:4310},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},i=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.PolynomialNoble=void 0;const c=e("@noble/curves/abstract/modular"),l=o(e("bn.js")),u=e("elliptic"),d=o(e("./share.cjs"));class h{constructor(e,t,n){a.set(this,void 0),r.set(this,void 0),n?(s(this,a,e,"f"),s(this,r,(0,c.Field)(n.curveN),"f"),this.polynomial=i(this,a,"f").map(e=>new l.default(e.toString()))):this.polynomial=e,this.ecCurve=t}getThreshold(){return this.polynomial.length}polyEval(e){const t=new l.default(e,"hex");let n=new l.default(t),a=new l.default(0);a=a.add(this.polynomial[0]);const{n:r}=this.ecCurve;if(!r)throw new Error("Curve is not set");for(const e of this.polynomial.slice(1)){const s=n.mul(e);a=a.add(s),a=a.umod(r),n=n.mul(new l.default(t)),n=n.umod(r)}return a}polyEvalNoble(e){if(!i(this,a,"f")||!i(this,r,"f"))throw new Error("Noble implementation not initialized");if(0===i(this,a,"f").length)return 0n;let t=i(this,a,"f")[0],n=e;for(let s=1;s<i(this,a,"f").length;s++)t=i(this,r,"f").add(t,i(this,r,"f").mul(i(this,a,"f")[s],n)),n=i(this,r,"f").mul(n,e);return t}generateShares(e){const t=e.map(e=>{if("bigint"==typeof e)return new l.default(e.toString());if("number"==typeof e)return new l.default(e);if(e instanceof l.default)return e;if("string"==typeof e)return new l.default(e,"hex");throw new Error("Invalid share index")}),n={};for(const e of t)n[e.toString("hex",64)]=new d.default(e,this.polyEval(e));return n}}a=new WeakMap,r=new WeakMap,n.default=h;n.PolynomialNoble=class extends h{constructor(e,t){super(e,new u.ec("secp256k1"),{curveN:t})}}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/polynomial.cjs"}],[3070,{"bn.js":4076},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const r=a(e("bn.js"));class s{constructor(e,t){this.share=new r.default(t,"hex"),this.shareIndex=new r.default(e,"hex")}static fromJSON(e){const{share:t,shareIndex:n}=e;return new s(n,t)}toJSON(){return{share:this.share.toString("hex",64),shareIndex:this.shareIndex.toString("hex",64)}}}n.default=s}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@metamask/auth-network-utils",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@metamask/auth-network-utils/dist/share.cjs"}],[3071,{"@babel/runtime/helpers/objectSpread2":634,deepmerge:4290,loglevel:4909},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a=e("@babel/runtime/helpers/objectSpread2"),r=e("deepmerge"),s=e("loglevel");const i=s.getLogger("http-helpers");i.setLevel(s.levels.INFO);let o="torus-default",c="";const l="x-api-key",u="x-embed-host";let d=null;const h=[],m=[];async function f(e,t){let n=null;try{n=new URL(e)}catch{}if(d&&n&&(h.includes(n.origin)||m.includes(n.pathname))){return await d.startSpan({name:e,op:"http.client"},async()=>await fetch(e,t))}return fetch(e,t)}function p(){const e={};return o&&(e[l]=o),c&&(e[u]=c),e}function g(e){i.info(`Response: ${e.status} ${e.statusText}`),i.info(`Url: ${e.url}`)}const T=async(e,t)=>{let n=null;try{const a=new Promise((t,a)=>{n=setTimeout(()=>{a(new Error(`Timed out in ${e}ms`))},e)}),r=await Promise.race([t,a]);return null!=n&&clearTimeout(n),r}catch(e){throw null!=n&&clearTimeout(n),e}},w=async(e,t={},n={})=>{const s={mode:"cors",headers:{}};n.useAPIKey&&(s.headers=a(a({},s.headers),p())),t.method="GET";const i=r(s,t),o=await f(e,i);if(o.ok){const e=o.headers.get("content-type");return null!=e&&e.includes("application/json")?o.json():o.text()}throw g(o),o};n.clearAPIKey=function(){o="torus-default"},n.clearEmbedHost=function(){c=""},n.enableSentryTracing=function(e,t,n){d=e,h.push(...t),m.push(...n)},n.gatewayAuthHeader=l,n.gatewayEmbedHostHeader=u,n.generateJsonRPCObject=(e,t)=>({jsonrpc:"2.0",method:e,id:10,params:t}),n.get=w,n.getAPIKey=function(){return o},n.getEmbedHost=function(){return c},n.patch=async(e,t={},n={},s={})=>{const i={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};s.useAPIKey&&(i.headers=a(a({},i.headers),p())),n.method="PATCH";const o=r(i,n);s.isUrlEncodedData?(o.body=t,"application/json; charset=utf-8"===o.headers["Content-Type"]&&delete o.headers["Content-Type"]):o.body=JSON.stringify(t);const c=await f(e,o);if(c.ok){const e=c.headers.get("content-type");return null!=e&&e.includes("application/json")?c.json():c.text()}throw g(c),c},n.post=(e,t={},n={},s={})=>{const o={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};s.useAPIKey&&(o.headers=a(a({},o.headers),p())),n.method="POST";const c=r(o,n);return s.isUrlEncodedData?(c.body=t,"application/json; charset=utf-8"===c.headers["Content-Type"]&&delete c.headers["Content-Type"]):c.body=JSON.stringify(t),T(s.timeout||6e4,f(e,c).then(e=>{if(s.logTracingHeader&&function(e){const t=e.headers.get("x-web3-correlation-id");t&&i.info(`Request tracing with traceID = ${t}`)}(e),e.ok){const t=e.headers.get("content-type");return null!=t&&t.includes("application/json")?e.json():e.text()}throw g(e),e}))},n.promiseRace=(e,t,n=6e4)=>Promise.race([w(e,t),new Promise((e,t)=>{setTimeout(()=>{t(new Error("timed out"))},n)})]),n.promiseTimeout=T,n.put=async(e,t={},n={},s={})=>{const i={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};s.useAPIKey&&(i.headers=a(a({},i.headers),p())),n.method="PUT";const o=r(i,n);s.isUrlEncodedData?(o.body=t,"application/json; charset=utf-8"===o.headers["Content-Type"]&&delete o.headers["Content-Type"]):o.body=JSON.stringify(t);const c=await f(e,o);if(c.ok){const e=c.headers.get("content-type");return null!=e&&e.includes("application/json")?c.json():c.text()}throw g(c),c},n.remove=async(e,t={},n={},s={})=>{const i={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};s.useAPIKey&&(i.headers=a(a({},i.headers),p())),n.method="DELETE";const o=r(i,n);s.isUrlEncodedData?(o.body=t,"application/json; charset=utf-8"===o.headers["Content-Type"]&&delete o.headers["Content-Type"]):o.body=JSON.stringify(t);const c=await f(e,o);if(c.ok){const e=c.headers.get("content-type");return null!=e&&e.includes("application/json")?c.json():c.text()}throw g(c),c},n.setAPIKey=function(e){o=e},n.setEmbedHost=function(e){c=e},n.setLogLevel=function(e){i.setLevel(e)}}}},{package:"@metamask/seedless-onboarding-controller>@metamask/toprf-secure-backup>@toruslabs/http-helpers",file:"node_modules/@metamask/toprf-secure-backup/node_modules/@toruslabs/http-helpers/dist/lib.cjs/index.js"}],[3072,{"./gas-flows/DefaultGasFeeFlow.cjs":3077,"./gas-flows/LineaGasFeeFlow.cjs":3078,"./gas-flows/OptimismLayer1GasFeeFlow.cjs":3079,"./gas-flows/RandomisedEstimationsGasFeeFlow.cjs":3081,"./gas-flows/ScrollLayer1GasFeeFlow.cjs":3082,"./gas-flows/TestGasFeeFlow.cjs":3083,"./helpers/AccountsApiRemoteTransactionSource.cjs":3084,"./helpers/GasFeePoller.cjs":3085,"./helpers/IncomingTransactionHelper.cjs":3086,"./helpers/MethodDataHelper.cjs":3087,"./helpers/MultichainTrackingHelper.cjs":3088,"./helpers/PendingTransactionTracker.cjs":3089,"./helpers/ResimulateHelper.cjs":3090,"./hooks/ExtraTransactionsPublishHook.cjs":3093,"./logger.cjs":3096,"./types.cjs":3097,"./utils/balance-changes.cjs":3098,"./utils/batch.cjs":3100,"./utils/eip7702.cjs":3101,"./utils/external-transactions.cjs":3102,"./utils/first-time-interaction.cjs":3104,"./utils/gas-fee-tokens.cjs":3105,"./utils/gas-fees.cjs":3106,"./utils/gas-flow.cjs":3107,"./utils/gas.cjs":3108,"./utils/layer1-gas-fee-flow.cjs":3109,"./utils/nonce.cjs":3110,"./utils/prepare.cjs":3111,"./utils/retry.cjs":3112,"./utils/swaps.cjs":3114,"./utils/transaction-type.cjs":3115,"./utils/utils.cjs":3116,"./utils/validation.cjs":3117,"@metamask/base-controller":1407,"@metamask/controller-utils":1494,"@metamask/eth-query":2079,"@metamask/network-controller":2432,"@metamask/nonce-tracker":2443,"@metamask/rpc-errors":2698,"@metamask/utils":3217,events:4433,lodash:4901,uuid:5796},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l,u,d,h,m,f,p,g,T,w,b,E,y,S,k,I,A,_,C,P,v,N,R,j,O,x,L,M,F,D,B,G,U,H,q,K,W,$,V,Y,Q,z,J,X,Z,ee,te,ne,ae,re,se,ie,oe,ce,le,ue,de,he,me,fe,pe,ge,Te,we,be,Ee,ye,Se,ke,Ie,Ae,_e,Ce,Pe,ve,Ne,Re,je,Oe,xe,Le,Me,Fe,De,Be,Ge,Ue,He,qe,Ke,We,$e,Ve,Ye,Qe,ze,Je,Xe,Ze,et,tt,nt=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},at=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)},rt=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionController=n.ApprovalState=n.SPEED_UP_RATE=n.CANCEL_RATE=void 0;const st=e("@metamask/base-controller"),it=e("@metamask/controller-utils"),ot=rt(e("@metamask/eth-query")),ct=e("@metamask/network-controller"),lt=e("@metamask/nonce-tracker"),ut=e("@metamask/rpc-errors"),dt=e("@metamask/utils"),ht=e("events"),mt=e("lodash"),ft=e("uuid"),pt=e("./gas-flows/DefaultGasFeeFlow.cjs"),gt=e("./gas-flows/LineaGasFeeFlow.cjs"),Tt=e("./gas-flows/OptimismLayer1GasFeeFlow.cjs"),wt=e("./gas-flows/RandomisedEstimationsGasFeeFlow.cjs"),bt=e("./gas-flows/ScrollLayer1GasFeeFlow.cjs"),Et=e("./gas-flows/TestGasFeeFlow.cjs"),yt=e("./helpers/AccountsApiRemoteTransactionSource.cjs"),St=e("./helpers/GasFeePoller.cjs"),kt=e("./helpers/IncomingTransactionHelper.cjs"),It=e("./helpers/MethodDataHelper.cjs"),At=e("./helpers/MultichainTrackingHelper.cjs"),_t=e("./helpers/PendingTransactionTracker.cjs"),Ct=e("./helpers/ResimulateHelper.cjs"),Pt=e("./hooks/ExtraTransactionsPublishHook.cjs"),vt=e("./logger.cjs"),Nt=e("./types.cjs"),Rt=e("./utils/balance-changes.cjs"),jt=e("./utils/batch.cjs"),Ot=e("./utils/eip7702.cjs"),xt=e("./utils/external-transactions.cjs"),Lt=e("./utils/first-time-interaction.cjs"),Mt=e("./utils/gas.cjs"),Ft=e("./utils/gas-fee-tokens.cjs"),Dt=e("./utils/gas-fees.cjs"),Bt=e("./utils/gas-flow.cjs"),Gt=e("./utils/layer1-gas-fee-flow.cjs"),Ut=e("./utils/nonce.cjs"),Ht=e("./utils/prepare.cjs"),qt=e("./utils/retry.cjs"),Kt=e("./utils/swaps.cjs"),Wt=e("./utils/transaction-type.cjs"),$t=e("./utils/utils.cjs"),Vt=e("./utils/validation.cjs"),Yt={transactions:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},transactionBatches:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},methodData:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},lastFetchedBlockNumbers:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1},submitHistory:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1}};n.CANCEL_RATE=1.1,n.SPEED_UP_RATE=1.1;const Qt="TransactionController";var zt;!function(e){e.Approved="approved",e.NotApproved="not-approved",e.SkippedViaBeforePublishHook="skipped-via-before-publish-hook"}(zt||(n.ApprovalState=zt={}));class Jt extends st.BaseController{constructor(e){const{disableSwaps:t,getCurrentAccountEIP1559Compatibility:n,getCurrentNetworkEIP1559Compatibility:K,getExternalPendingTransactions:W,getGasFeeEstimates:$,getNetworkClientRegistry:V,getNetworkState:Q,getPermittedAccounts:z,getSavedGasFees:J,getSimulationConfig:X,hooks:Z,incomingTransactions:te={},isAutomaticGasFeeUpdateEnabled:ne,isEIP7702GasFeeTokensEnabled:ae,isFirstTimeInteractionEnabled:re,isSimulationEnabled:se,messenger:ie,pendingTransactions:oe={},publicKeyEIP7702:ce,securityProviderRequest:le,sign:ue,state:he,testGasFeeFlows:me,trace:fe,transactionHistoryLimit:pe=40}=e;super({name:Qt,metadata:Yt,messenger:ie,state:{methodData:{},transactions:[],transactionBatches:[],lastFetchedBlockNumbers:{},submitHistory:[],...he}}),a.add(this),r.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,new Set),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,void 0),h.set(this,void 0),m.set(this,void 0),f.set(this,void 0),p.set(this,void 0),g.set(this,void 0),T.set(this,void 0),w.set(this,void 0),b.set(this,void 0),E.set(this,void 0),y.set(this,void 0),S.set(this,void 0),k.set(this,new ht.EventEmitter),I.set(this,void 0),A.set(this,void 0),_.set(this,void 0),C.set(this,void 0),P.set(this,void 0),v.set(this,void 0),N.set(this,void 0),R.set(this,void 0),j.set(this,void 0),O.set(this,void 0),x.set(this,void 0),L.set(this,void 0),M.set(this,void 0),F.set(this,void 0),D.set(this,void 0),B.set(this,new Map),G.set(this,new Set),U.set(this,void 0),H.set(this,void 0),q.set(this,void 0),Pe.set(this,()=>{at(this,j,"f").checkForPendingTransactionAndStartPolling()}),this.messenger=ie,nt(this,r,Z?.afterAdd??(()=>Promise.resolve({})),"f"),nt(this,s,Z?.afterSign??(()=>!0),"f"),nt(this,i,Z?.afterSimulate??(()=>Promise.resolve({})),"f"),nt(this,c,Z?.beforeCheckPendingTransaction??(()=>Promise.resolve(!0)),"f"),nt(this,l,Z?.beforePublish??(()=>Promise.resolve(!0)),"f"),nt(this,u,Z?.beforeSign??(()=>Promise.resolve({})),"f"),nt(this,h,Z?.getAdditionalSignArguments??(()=>[]),"f"),nt(this,m,n??(()=>Promise.resolve(!0)),"f"),nt(this,f,K,"f"),nt(this,p,W??(()=>[]),"f"),nt(this,g,$??(()=>Promise.resolve({})),"f"),nt(this,T,Q,"f"),nt(this,w,z,"f"),nt(this,b,J??(e=>undefined),"f"),nt(this,E,X??(()=>Promise.resolve({})),"f"),nt(this,S,te,"f"),nt(this,I,ne??(e=>!1),"f"),nt(this,A,ae??(()=>Promise.resolve(!1)),"f"),nt(this,_,re??(()=>!0),"f"),nt(this,C,se??(()=>!0),"f"),nt(this,P,t??!1,"f"),nt(this,v,Z?.isTimeoutEnabled??(()=>!0),"f"),nt(this,O,oe,"f"),nt(this,x,ce,"f"),nt(this,L,Z?.publish??(()=>Promise.resolve({transactionHash:undefined})),"f"),nt(this,M,Z?.publishBatch,"f"),nt(this,F,le,"f"),nt(this,D,ue,"f"),nt(this,U,!0===me,"f"),nt(this,H,fe??((e,t)=>t?.()),"f"),nt(this,q,pe,"f");const ge=e=>this.messenger.call("NetworkController:findNetworkClientIdByChainId",e);nt(this,j,new At.MultichainTrackingHelper({findNetworkClientIdByChainId:ge,getNetworkClientById:e=>this.messenger.call("NetworkController:getNetworkClientById",e),getNetworkClientRegistry:V,removePendingTransactionTrackerListeners:at(this,a,"m",Re).bind(this),createNonceTracker:at(this,a,"m",_e).bind(this),createPendingTransactionTracker:at(this,a,"m",Ce).bind(this),onNetworkStateChange:e=>{this.messenger.subscribe("NetworkController:stateChange",e)}}),"f"),at(this,j,"f").initialize(),nt(this,d,at(this,a,"m",Me).call(this),"f"),nt(this,N,at(this,a,"m",Fe).call(this),"f");const Te=new St.GasFeePoller({findNetworkClientIdByChainId:ge,gasFeeFlows:at(this,d,"f"),getGasFeeControllerEstimates:at(this,g,"f"),getProvider:e=>at(this,a,"m",de).call(this,{networkClientId:e}),getTransactions:()=>this.state.transactions,getTransactionBatches:()=>this.state.transactionBatches,layer1GasFeeFlows:at(this,N,"f"),messenger:this.messenger,onStateChange:e=>{this.messenger.subscribe("TransactionController:stateChange",e)}});Te.hub.on("transaction-updated",at(this,a,"m",Ge).bind(this)),Te.hub.on("transaction-batch-updated",at(this,a,"m",Ue).bind(this)),nt(this,R,new It.MethodDataHelper({getProvider:e=>at(this,a,"m",de).call(this,{networkClientId:e}),getState:()=>this.state.methodData}),"f"),at(this,R,"f").hub.on("update",({fourBytePrefix:e,methodData:t})=>{this.update(n=>{n.methodData[e]=t})}),nt(this,y,new kt.IncomingTransactionHelper({client:at(this,S,"f").client,getCurrentAccount:()=>at(this,a,"m",qe).call(this),getLocalTransactions:()=>this.state.transactions,includeTokenTransfers:at(this,S,"f").includeTokenTransfers,isEnabled:at(this,S,"f").isEnabled,messenger:this.messenger,remoteTransactionSource:new yt.AccountsApiRemoteTransactionSource,trimTransactions:at(this,a,"m",ee).bind(this),updateTransactions:at(this,S,"f").updateTransactions}),"f"),at(this,a,"m",Ne).call(this,at(this,y,"f")),this.messenger.subscribe("TransactionController:stateChange",at(this,Pe,"f")),new Ct.ResimulateHelper({simulateTransaction:at(this,a,"m",Be).bind(this),onTransactionsUpdate:e=>{this.messenger.subscribe("TransactionController:stateChange",e,e=>e.transactions)},getTransactions:()=>this.state.transactions}),at(this,a,"m",Y).call(this),at(this,Pe,"f").call(this),at(this,a,"m",Ve).call(this)}destroy(){at(this,a,"m",ve).call(this)}async handleMethodData(e,t){return at(this,R,"f").lookup(e,t)}async addTransactionBatch(e){const{blockTracker:t}=this.messenger.call("NetworkController:getNetworkClientById",e.networkClientId);return await(0,jt.addTransactionBatch)({addTransaction:this.addTransaction.bind(this),estimateGas:this.estimateGas.bind(this),getChainId:at(this,a,"m",ce).bind(this),getEthQuery:e=>at(this,a,"m",ue).call(this,{networkClientId:e}),getGasFeeEstimates:at(this,g,"f"),getInternalAccounts:at(this,a,"m",Ke).bind(this),getSimulationConfig:at(this,E,"f").bind(this),getPendingTransactionTracker:e=>at(this,a,"m",Ce).call(this,{provider:at(this,a,"m",de).call(this,{networkClientId:e}),blockTracker:t,chainId:at(this,a,"m",ce).call(this,e),networkClientId:e}),getTransaction:e=>at(this,a,"m",se).call(this,e),isSimulationEnabled:at(this,C,"f"),messenger:this.messenger,publishBatchHook:at(this,M,"f"),publicKeyEIP7702:at(this,x,"f"),publishTransaction:(e,t)=>at(this,a,"m",X).call(this,e,t),request:e,signTransaction:at(this,a,"m",ye).bind(this),update:this.update.bind(this),updateTransaction:at(this,a,"m",De).bind(this)})}async isAtomicBatchSupported(e){return(0,jt.isAtomicBatchSupported)({...e,getEthQuery:e=>at(this,a,"m",ue).call(this,{chainId:e}),messenger:this.messenger,publicKeyEIP7702:at(this,x,"f")})}async addTransaction(e,t){(0,vt.projectLogger)("Adding transaction",e,t);const{actionId:n,assetsFiatValues:s,batchId:i,deviceConfirmedOn:o,disableGasBuffer:c,gasFeeToken:l,isGasFeeIncluded:u,isGasFeeSponsored:d,isStateOnly:h,method:m,nestedTransactions:f,networkClientId:p,origin:g,publishHook:T,requestId:b,requireApproval:E,securityAlertResponse:y,skipInitialGasEstimate:S,swaps:k={},traceContext:I,type:A}=t;if(e=(0,$t.normalizeTransactionParams)(e),!at(this,j,"f").has(p))throw new Error(`Network client not found - ${p}`);const C=at(this,a,"m",ce).call(this,p),v=at(this,a,"m",ue).call(this,{networkClientId:p}),N=g===undefined?undefined:await(at(this,w,"f")?.call(this,g)),R=at(this,a,"m",Ke).call(this);await(0,Vt.validateTransactionOrigin)({data:e.data,from:e.from,internalAccounts:R,origin:g,permittedAddresses:N,txParams:e,type:A});const O=(0,Ot.getDelegationAddress)(e.from,v).catch(()=>undefined),x=await at(this,a,"m",Ee).call(this,p);(0,Vt.validateTxParams)(e,x,C),e.type||(0,$t.setEnvelopeType)(e,x);if(i?.length&&this.state.transactions.some(e=>e.batchId?.toLowerCase()===i?.toLowerCase())&&g&&g!==it.ORIGIN_METAMASK)throw new ut.JsonRpcError(Vt.ErrorCode.DuplicateBundleId,"Batch ID already exists");const L=at(this,a,"m",me).call(this,e,g),M=A??(await(0,Wt.determineTransactionType)(e,v)).type,D=at(this,a,"m",Te).call(this,n);let B=D?(0,mt.cloneDeep)(D):{actionId:n,assetsFiatValues:s,batchId:i,chainId:C,dappSuggestedGasFees:L,deviceConfirmedOn:o,disableGasBuffer:c,id:(0,ft.v1)(),isGasFeeTokenIgnoredIfBalance:Boolean(l),isGasFeeIncluded:u,isGasFeeSponsored:d,isFirstTimeInteraction:undefined,isStateOnly:h,nestedTransactions:f,networkClientId:p,origin:g,requestId:b,securityAlertResponse:y,selectedGasFeeToken:l,status:Nt.TransactionStatus.unapproved,time:Date.now(),txParams:e,type:M,userEditedGasLimit:!1,verifiedOnBlockchain:!1};const{updateTransaction:G}=await at(this,r,"f").call(this,{transactionMeta:B});if(G&&((0,vt.projectLogger)("Updating transaction using afterAdd hook"),B.txParamsOriginal=(0,mt.cloneDeep)(B.txParams),G(B)),S){const e=(0,mt.cloneDeep)(B);at(this,a,"m",V).call(this,e).then(()=>(at(this,a,"m",De).call(this,{transactionId:e.id,skipResimulateCheck:!0,skipValidation:!0},t=>{t.txParams.gas=e.txParams.gas,t.txParams.gasPrice=e.txParams.gasPrice,t.txParams.maxFeePerGas=e.txParams.maxFeePerGas,t.txParams.maxPriorityFeePerGas=e.txParams.maxPriorityFeePerGas}),undefined)).catch(mt.noop)}else await at(this,H,"f").call(this,{name:"Estimate Gas Properties",parentContext:I},e=>at(this,a,"m",V).call(this,B,{traceContext:e}));if(!D){if(m&&at(this,F,"f")){const e=await at(this,F,"f").call(this,B,m);B.securityProviderResponse=e}B=(0,Kt.updateSwapsTransaction)(B,M,k,{isSwapsDisabled:at(this,P,"f"),cancelTransaction:at(this,a,"m",Z).bind(this),messenger:this.messenger}),at(this,a,"m",$).call(this,B),O.then(e=>(at(this,a,"m",De).call(this,{transactionId:B.id,skipResimulateCheck:!0,skipValidation:!0},t=>{t.delegationAddress=e}),undefined)).catch(mt.noop),!1===E||h?(0,vt.projectLogger)("Skipping simulation & first interaction update as approval not required"):(at(this,a,"m",Be).call(this,B,{traceContext:I}).catch(e=>{throw(0,vt.projectLogger)("Error while updating simulation data",e),e}),(0,Lt.updateFirstTimeInteraction)({existingTransactions:this.state.transactions,getTransaction:e=>at(this,a,"m",re).call(this,e),isFirstTimeInteractionEnabled:at(this,_,"f"),trace:at(this,H,"f"),traceContext:I,transactionMeta:B,updateTransaction:at(this,a,"m",De).bind(this)}).catch(e=>{(0,vt.projectLogger)("Error while updating first interaction properties",e)})),this.messenger.publish(`${Qt}:unapprovedTransactionAdded`,B)}return{result:at(this,a,"m",z).call(this,B,{actionId:n,isExisting:Boolean(D),publishHook:T,requireApproval:E,traceContext:I}),transactionMeta:B}}startIncomingTransactionPolling(){at(this,y,"f").start()}stopIncomingTransactionPolling(){at(this,y,"f").stop()}async updateIncomingTransactions({tags:e}={}){await at(this,y,"f").update({tags:e})}async stopTransaction(e,t,{estimatedBaseFee:r,actionId:s}={}){await at(this,a,"m",K).call(this,{actionId:s,estimatedBaseFee:r,gasValues:t,label:"cancel",rate:n.CANCEL_RATE,transactionId:e,transactionType:Nt.TransactionType.cancel,prepareTransactionParams:e=>{delete e.data,e.to=e.from,e.value="0x0"},afterSubmit:e=>{this.messenger.publish(`${Qt}:transactionFinished`,e),at(this,k,"f").emit(`${e.id}:finished`,e)}})}async speedUpTransaction(e,t,{actionId:r,estimatedBaseFee:s}={}){await at(this,a,"m",K).call(this,{actionId:r,estimatedBaseFee:s,gasValues:t,label:"speed up",rate:n.SPEED_UP_RATE,transactionId:e,transactionType:Nt.TransactionType.retry,afterSubmit:e=>{this.messenger.publish(`${Qt}:speedupTransactionAdded`,e)}})}async estimateGas(e,t,{ignoreDelegationSignatures:n}={}){const r=at(this,a,"m",ue).call(this,{networkClientId:t}),{estimatedGas:s,simulationFails:i}=await(0,Mt.estimateGas)({chainId:at(this,a,"m",ce).call(this,t),ethQuery:r,ignoreDelegationSignatures:n,isSimulationEnabled:at(this,C,"f").call(this),getSimulationConfig:at(this,E,"f"),messenger:this.messenger,txParams:e});return{gas:s,simulationFails:i}}async estimateGasBatch({chainId:e,from:t,transactions:n}){const r=at(this,a,"m",ue).call(this,{chainId:e});return(0,Mt.estimateGasBatch)({chainId:e,ethQuery:r,from:t,getSimulationConfig:at(this,E,"f"),isAtomicBatchSupported:this.isAtomicBatchSupported.bind(this),messenger:this.messenger,transactions:n})}async estimateGasBuffered(e,t,n){const r=at(this,a,"m",ue).call(this,{networkClientId:n}),{blockGasLimit:s,estimatedGas:i,simulationFails:o}=await(0,Mt.estimateGas)({chainId:at(this,a,"m",ce).call(this,n),ethQuery:r,isSimulationEnabled:at(this,C,"f").call(this),getSimulationConfig:at(this,E,"f"),messenger:this.messenger,txParams:e});return{gas:(0,Mt.addGasBuffer)(i,s,t),simulationFails:o}}updateTransaction(e,t){const{id:n}=e;at(this,a,"m",De).call(this,{transactionId:n},()=>({...e})),(0,vt.projectLogger)("Transaction updated",{transactionId:n,note:t})}updateSecurityAlertResponse(e,t){if(!t)throw new Error("updateSecurityAlertResponse: securityAlertResponse should not be null");const n=at(this,a,"m",re).call(this,e);if(!n)throw new Error("Cannot update security alert response as no transaction metadata found");const r={...n,securityAlertResponse:t};this.updateTransaction(r,`${Qt}:updatesecurityAlertResponse - securityAlertResponse updated`)}wipeTransactions({address:e,chainId:t}={}){if(!t&&!e)return void this.update(e=>{e.transactions=[]});const n=this.state.transactions.filter(({chainId:n,txParams:a,type:r})=>{if(!(!t||t===n))return!0;return!(!e||a.from?.toLowerCase()===e.toLowerCase()||r===Nt.TransactionType.incoming&&a.to?.toLowerCase()===e.toLowerCase())});this.update(e=>{e.transactions=at(this,a,"m",ee).call(this,n)})}updateTransactionSendFlowHistory(e,t,n){return at(this,a,"m",se).call(this,e)}async confirmExternalTransaction(e,t,n){const r=at(this,a,"m",fe).call(this,e);try{const e=r.id,s={...r,status:Nt.TransactionStatus.confirmed,txReceipt:t};n&&(s.baseFeePerGas=n),at(this,a,"m",pe).call(this,e),this.updateTransaction(s,`${Qt}:confirmExternalTransaction - Add external transaction`),at(this,a,"m",Se).call(this,s),at(this,a,"m",Ae).call(this,s).catch(e=>{throw(0,vt.projectLogger)("Error while updating post balance",e),e}),this.messenger.publish(`${Qt}:transactionConfirmed`,s)}catch(e){console.error("Failed to confirm external transaction",e)}}updateTransactionGasFees(e,{defaultGasEstimates:t,estimateUsed:n,estimateSuggested:r,gas:s,gasLimit:i,gasPrice:o,maxPriorityFeePerGas:c,maxFeePerGas:l,originalGasEstimate:u,userEditedGasLimit:d,userFeeLevel:h}){const m=at(this,a,"m",re).call(this,e);if(!m)throw new Error("Cannot update transaction as no transaction metadata found");(0,$t.validateIfTransactionUnapproved)(m,"updateTransactionGasFees");const f=(0,mt.cloneDeep)(m),p=m.gasFeeEstimates,g=at(this,I,"f").call(this,m),T=h,w=Object.values(Nt.GasFeeEstimateLevel).includes(T),b=p&&g&&w;b&&(0,St.updateTransactionGasEstimates)({txMeta:f,userFeeLevel:T});const E={gas:s,gasLimit:i};b?Object.assign(E,{gasPrice:f.txParams.gasPrice,maxPriorityFeePerGas:f.txParams.maxPriorityFeePerGas,maxFeePerGas:f.txParams.maxFeePerGas}):Object.assign(E,{gasPrice:o,maxPriorityFeePerGas:c,maxFeePerGas:l});const y={txParams:(0,mt.pickBy)(E),defaultGasEstimates:t,estimateUsed:n,estimateSuggested:r,originalGasEstimate:u,userEditedGasLimit:d,userFeeLevel:T},S=(0,mt.pickBy)(y);return at(this,a,"m",De).call(this,{transactionId:e,skipResimulateCheck:!0},e=>{const{txParams:t,...n}=S;Object.assign(e,n),t&&Object.assign(e.txParams,t)}),at(this,a,"m",re).call(this,e)}updatePreviousGasParams(e,{gasLimit:t,maxFeePerGas:n,maxPriorityFeePerGas:r}){const s=at(this,a,"m",re).call(this,e);if(!s)throw new Error("Cannot update transaction as no transaction metadata found");(0,$t.validateIfTransactionUnapproved)(s,"updatePreviousGasParams");const i={previousGas:{gasLimit:t,maxFeePerGas:n,maxPriorityFeePerGas:r}};i.previousGas=(0,mt.pickBy)(i.previousGas);const o=(0,mt.merge)({},s,i);return this.updateTransaction(o,`${Qt}:updatePreviousGasParams - Previous gas values updated`),at(this,a,"m",re).call(this,e)}async getNonceLock(e,t){return at(this,j,"f").getNonceLock(e,t)}async updateEditableParams(e,{containerTypes:t,data:n,from:r,gas:s,gasPrice:i,maxFeePerGas:o,maxPriorityFeePerGas:c,to:l,updateType:u,value:d}){const h=at(this,a,"m",re).call(this,e);if(!h)throw new Error("Cannot update editable params as no transaction metadata found");(0,$t.validateIfTransactionUnapproved)(h,"updateEditableParams");const m={txParams:{data:n,from:r,to:l,value:d,gas:s,gasPrice:i,maxFeePerGas:o,maxPriorityFeePerGas:c}};m.txParams=(0,mt.pickBy)(m.txParams);const f=(0,mt.merge)({},h,m),{networkClientId:p}=h,g=at(this,a,"m",de).call(this,{networkClientId:p}),T=new ot.default(g);if(!1!==u){const{type:e}=await(0,Wt.determineTransactionType)(f.txParams,T);f.type=e}return t&&(f.containerTypes=t),await(0,Gt.updateTransactionLayer1GasFee)({layer1GasFeeFlows:at(this,N,"f"),messenger:this.messenger,provider:g,transactionMeta:f}),this.updateTransaction(f,`Update Editable Params for ${e}`),at(this,a,"m",re).call(this,e)}setTransactionActive(e,t){if(!at(this,a,"m",re).call(this,e))throw new Error(`Transaction with id ${e} not found`);at(this,a,"m",De).call(this,{transactionId:e,skipValidation:!0,skipResimulateCheck:!0},e=>{e.isActive=t})}async approveTransactionsWithSameNonce(e=[],{hasNonce:t}={}){if((0,vt.projectLogger)("Approving transactions with same nonce",{transactions:e}),0===e.length)return"";const n=e[0],{chainId:r}=n,s=at(this,a,"m",le).call(this,{chainId:r}),i=(0,Ht.prepareTransaction)(r,n),c=(0,Ht.serializeTransaction)(i);if(at(this,o,"f").has(c))return"";let l,u;at(this,o,"f").add(c);try{const r=n.from;u=!0!==t?await this.getNonceLock(r,s):undefined;const i=u?(0,dt.add0x)(u.nextNonce.toString(16)):n.nonce;u&&(0,vt.projectLogger)("Using nonce from nonce tracker",i,u.nonceDetails),l=await Promise.all(e.map(e=>(e.nonce=i,at(this,a,"m",W).call(this,e.chainId,e))))}catch(e){throw(0,vt.projectLogger)("Error while signing transactions with same nonce",e),e}finally{u?.releaseLock(),at(this,o,"f").delete(c)}return l}updateCustodialTransaction(e){const{transactionId:t,errorMessage:n,hash:r,status:s,gasLimit:i,gasPrice:o,maxFeePerGas:c,maxPriorityFeePerGas:l,nonce:u,type:d}=e,h=at(this,a,"m",re).call(this,t);if(!h)throw new Error("Cannot update custodial transaction as no transaction metadata found");if(s&&![Nt.TransactionStatus.submitted,Nt.TransactionStatus.signed,Nt.TransactionStatus.failed].includes(s))throw new Error(`Cannot update custodial transaction with status: ${s}`);const m=(0,mt.merge)({},h,(0,mt.pickBy)({hash:r,status:s}));return m.status===Nt.TransactionStatus.submitted&&(m.submittedTime=(new Date).getTime()),m.status===Nt.TransactionStatus.failed&&(m.error=(0,$t.normalizeTxError)(new Error(n))),m.txParams=(0,mt.merge)({},m.txParams,(0,mt.pickBy)({gasLimit:i,gasPrice:o,maxFeePerGas:c,maxPriorityFeePerGas:l,nonce:u,type:d})),d===Nt.TransactionEnvelopeType.legacy&&(delete m.txParams.maxFeePerGas,delete m.txParams.maxPriorityFeePerGas),this.updateTransaction(m,`${Qt}:updateCustodialTransaction - Custodial transaction updated`),s&&[Nt.TransactionStatus.submitted,Nt.TransactionStatus.failed].includes(s)&&(this.messenger.publish(`${Qt}:transactionFinished`,m),at(this,k,"f").emit(`${m.id}:finished`,m)),m}getTransactions({initialList:e,limit:t,searchCriteria:n={}}={}){const a=(0,mt.mapValues)(n,e=>"function"==typeof e?e:t=>t===e),r=e??this.state.transactions,s=(0,mt.sortBy)((0,mt.pickBy)(r,e=>{for(const[t,n]of Object.entries(a))if(t in e.txParams){if(!1===n(e.txParams[t]))return!1}else if(!1===n(e[t]))return!1;return!0}),"time");if(t!==undefined){const e=new Set,n=[];for(let a=s.length-1;a>-1;a--){const r=s[a],{nonce:i}=r.txParams;if(!e.has(i)){if(!(e.size<t))continue;e.add(i)}n.unshift(r)}return n}return s}async estimateGasFee({transactionParams:e,chainId:t,networkClientId:n}){const{id:a,provider:r}=at(this,j,"f").getNetworkClient({chainId:t,networkClientId:n}),s={txParams:e,chainId:t,networkClientId:a},i=(0,Bt.getGasFeeFlow)(s,at(this,d,"f"),this.messenger),o=new ot.default(r),c=await at(this,g,"f").call(this,{networkClientId:a});return i.getGasFees({ethQuery:o,gasFeeControllerData:c,messenger:this.messenger,transactionMeta:s})}async getLayer1GasFee({transactionParams:e,chainId:t,networkClientId:n}){const r=at(this,a,"m",de).call(this,{chainId:t,networkClientId:n});return await(0,Gt.getTransactionLayer1GasFee)({layer1GasFeeFlows:at(this,N,"f"),messenger:this.messenger,provider:r,transactionMeta:{txParams:e,chainId:t}})}clearUnapprovedTransactions(){const e=this.state.transactions.filter(({status:e})=>e!==Nt.TransactionStatus.unapproved);this.update(t=>{t.transactions=at(this,a,"m",ee).call(this,e)})}abortTransactionSigning(e){if(!at(this,a,"m",re).call(this,e))throw new Error("Cannot abort signing as no transaction metadata found");const t=at(this,B,"f").get(e);if(!t)throw new Error("Cannot abort signing as transaction is not waiting for signing");t(),at(this,B,"f").delete(e)}async updateAtomicBatchData({transactionId:e,transactionIndex:t,transactionData:n}){(0,vt.projectLogger)("Updating atomic batch data",{transactionId:e,transactionIndex:t,transactionData:n});const r=at(this,a,"m",De).call(this,{transactionId:e},e=>{const{nestedTransactions:a,txParams:r}=e,s=r.from,i=a?.[t];if(!i)throw new Error(`Nested transaction not found with index - ${t}`);i.data=n;const o=(0,Ot.generateEIP7702BatchTransaction)(s,a);e.txParams.data=o.data}),s=(0,mt.cloneDeep)({...r,txParams:{...r.txParams,gas:undefined}});return await at(this,a,"m",$e).call(this,s),at(this,a,"m",De).call(this,{transactionId:e},e=>{e.txParams.gas=s.txParams.gas,e.simulationFails=s.simulationFails,e.gasLimitNoBuffer=s.gasLimitNoBuffer}),r.txParams.data}updateBatchTransactions({transactionId:e,batchTransactions:t}){(0,vt.projectLogger)("Updating batch transactions",{transactionId:e,batchTransactions:t}),at(this,a,"m",De).call(this,{transactionId:e},e=>{e.batchTransactions=t})}updateSelectedGasFeeToken(e,t){at(this,a,"m",De).call(this,{transactionId:e},e=>{const n=e.gasFeeTokens?.some(e=>e.tokenAddress.toLowerCase()===t?.toLowerCase());if(t&&!n)throw new Error(`No matching gas fee token found with address - ${t}`);e.selectedGasFeeToken=t})}updateRequiredTransactionIds({transactionId:e,requiredTransactionIds:t,append:n}){at(this,a,"m",De).call(this,{transactionId:e},e=>{const{requiredTransactionIds:a}=e;e.requiredTransactionIds=[...a&&!1!==n?a:[],...t]})}emulateNewTransaction(e){const t=this.state.transactions.find(t=>t.id===e);t&&(t.type===Nt.TransactionType.swap?this.messenger.publish("TransactionController:transactionNewSwap",{transactionMeta:t}):t.type===Nt.TransactionType.swapApproval&&this.messenger.publish("TransactionController:transactionNewSwapApproval",{transactionMeta:t}))}emulateTransactionUpdate(e){const t={...e,txParams:{...e.txParams,from:this.messenger.call("AccountsController:getSelectedAccount").address}};this.state.transactions.some(e=>e.id===t.id)||this.update(e=>{e.transactions.push(t)}),this.updateTransaction(t,"Generated from user operation"),this.messenger.publish("TransactionController:transactionStatusUpdated",{transactionMeta:t})}}n.TransactionController=Jt,r=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,m=new WeakMap,f=new WeakMap,p=new WeakMap,g=new WeakMap,T=new WeakMap,w=new WeakMap,b=new WeakMap,E=new WeakMap,y=new WeakMap,S=new WeakMap,k=new WeakMap,I=new WeakMap,A=new WeakMap,_=new WeakMap,C=new WeakMap,P=new WeakMap,v=new WeakMap,N=new WeakMap,R=new WeakMap,j=new WeakMap,O=new WeakMap,x=new WeakMap,L=new WeakMap,M=new WeakMap,F=new WeakMap,D=new WeakMap,B=new WeakMap,G=new WeakMap,U=new WeakMap,H=new WeakMap,q=new WeakMap,Pe=new WeakMap,a=new WeakSet,K=async function({actionId:e,afterSubmit:t,estimatedBaseFee:n,gasValues:r,label:s,prepareTransactionParams:i,rate:o,transactionId:c,transactionType:l}){if(at(this,a,"m",Te).call(this,e))return;r&&(r=(0,$t.normalizeGasFeeValues)(r),(0,$t.validateGasValues)(r)),(0,vt.projectLogger)(`Creating ${s} transaction`,c,r);const u=at(this,a,"m",re).call(this,c);if(!u)return;if(!at(this,D,"f"))throw new Error("No sign method defined.");const d=(0,qt.getTransactionParamsWithIncreasedGasFee)(u.txParams,o,r);i?.(d);const h=(0,Ht.prepareTransaction)(u.chainId,d),m=await at(this,D,"f").call(this,h,u.txParams.from),f=at(this,a,"m",be).call(this,u,m),p=(0,Ht.serializeTransaction)(m),g=d.maxFeePerGas??d.gasPrice,T=d.maxFeePerGas?f.txParams.maxFeePerGas:f.txParams.gasPrice;(0,vt.projectLogger)(`Submitting ${s} transaction`,{oldFee:T,newFee:g,txParams:d});const{networkClientId:w}=u,b=at(this,a,"m",ue).call(this,{networkClientId:w}),E={...f,actionId:e,estimatedBaseFee:n,id:(0,ft.v1)(),originalGasEstimate:u.txParams.gas,originalType:u.type,rawTx:p,time:Date.now(),txParams:d,type:l},y=await at(this,a,"m",xe).call(this,b,{...E,origin:s});E.hash=y,at(this,a,"m",$).call(this,E),this.messenger.publish(`${Qt}:transactionApproved`,{transactionMeta:E,actionId:e}),this.messenger.publish(`${Qt}:transactionSubmitted`,{transactionMeta:E,actionId:e}),t?.(E)},W=async function(e,t){if(!at(this,D,"f"))throw new Error("No sign method defined.");const n=(0,$t.normalizeTransactionParams)(t),a=(0,$t.isEIP1559Transaction)(n)?Nt.TransactionEnvelopeType.feeMarket:Nt.TransactionEnvelopeType.legacy,r={...n,type:a,gasLimit:n.gas,chainId:e},{from:s}=r,i=(0,Ht.prepareTransaction)(e,r),o=await at(this,D,"f").call(this,i,s);return(0,Ht.serializeTransaction)(o)},$=function(e){(0,Vt.validateTxParams)(e.txParams),this.update(t=>{t.transactions=at(this,a,"m",ee).call(this,[...t.transactions,e])})},V=async function(e,{traceContext:t}={}){const n=e.txParams.type!==Nt.TransactionEnvelopeType.legacy&&await at(this,a,"m",Ee).call(this,e.networkClientId),{networkClientId:r}=e,s=at(this,a,"m",ue).call(this,{networkClientId:r}),i=at(this,a,"m",de).call(this,{networkClientId:r});await at(this,H,"f").call(this,{name:"Update Gas",parentContext:t},async()=>{await at(this,a,"m",$e).call(this,e)}),await at(this,H,"f").call(this,{name:"Update Gas Fees",parentContext:t},async()=>await(0,Dt.updateGasFees)({eip1559:n,ethQuery:s,gasFeeFlows:at(this,d,"f"),getGasFeeEstimates:at(this,g,"f"),getSavedGasFees:at(this,b,"f").bind(this),messenger:this.messenger,txMeta:e})),await at(this,H,"f").call(this,{name:"Update Layer 1 Gas Fees",parentContext:t},async()=>await(0,Gt.updateTransactionLayer1GasFee)({layer1GasFeeFlows:at(this,N,"f"),messenger:this.messenger,provider:i,transactionMeta:e}))},Y=function(){this.clearUnapprovedTransactions(),at(this,a,"m",Q).call(this)},Q=function(){const e=this.state.transactions.filter(e=>[Nt.TransactionStatus.approved,Nt.TransactionStatus.signed].includes(e.status));for(const t of e){at(this,a,"m",Je).call(this,t,new Error("Transaction incomplete at startup"));const e=t.requiredTransactionIds??[];for(const t of e){const e=at(this,a,"m",re).call(this,t);e&&!at(this,a,"m",te).call(this,e.status)&&at(this,a,"m",Je).call(this,e,new Error("Parent transaction incomplete at startup"))}}},z=async function(e,{actionId:t,isExisting:n=!1,publishHook:r,requireApproval:s,shouldShowRequest:i=!0,traceContext:o}){const{id:c,isStateOnly:l}=e;if(l)return at(this,a,"m",De).call(this,{transactionId:c,skipValidation:!0},e=>{e.status=Nt.TransactionStatus.submitted,e.submittedTime=(new Date).getTime()}),"";let u;const{meta:d,isCompleted:h}=at(this,a,"m",oe).call(this,c),m=h?Promise.resolve(d):at(this,a,"m",we).call(this,c);if(d&&!n&&!h)try{if(!1!==s){const t=await at(this,H,"f").call(this,{name:"Await Approval",parentContext:o},t=>at(this,a,"m",ae).call(this,e,{shouldShowRequest:i,traceContext:t}));u=t.resultCallbacks;const n=t.value,r=n?.txMeta;r&&((0,vt.projectLogger)("Updating transaction with approval data",{customNonce:r.customNonceValue,params:r.txParams}),this.updateTransaction(r,"TransactionController#processApproval - Updated with approval data"))}const{isCompleted:n}=at(this,a,"m",oe).call(this,c);if(!n){const e=await at(this,a,"m",J).call(this,c,o,r);e===zt.SkippedViaBeforePublishHook&&u&&u.success();const n=at(this,a,"m",re).call(this,c);e===zt.Approved&&this.messenger.publish(`${Qt}:transactionApproved`,{transactionMeta:n,actionId:t})}}catch(e){const n=e,{isCompleted:r}=at(this,a,"m",oe).call(this,c);r||(at(this,a,"m",Qe).call(this,n)?at(this,a,"m",ze).call(this,c,t,n):at(this,a,"m",Je).call(this,d,n,t))}finally{at(this,G,"f").delete(c)}const f=await m;switch(f?.status){case Nt.TransactionStatus.failed:{const e=f.error;throw u?.error(e),ut.rpcErrors.internal(e.message)}case Nt.TransactionStatus.submitted:return u?.success(),f.hash;default:{const e=ut.rpcErrors.internal(`MetaMask Tx Signature: Unknown problem: ${JSON.stringify(f??c)}`);throw u?.error(e),e}}},J=async function(e,t,n){let r,s,i=at(this,a,"m",se).call(this,e);(0,vt.projectLogger)("Approving transaction",i);try{if(!at(this,D,"f"))return at(this,a,"m",Je).call(this,i,new Error("No sign method defined.")),zt.NotApproved;if(!i.chainId)return at(this,a,"m",Je).call(this,i,new Error("No chainId defined.")),zt.NotApproved;if(at(this,o,"f").has(e))return(0,vt.projectLogger)("Skipping approval as signing in progress",e),zt.NotApproved;at(this,o,"f").add(e),r=()=>at(this,o,"f").delete(e);const{networkClientId:c}=i,u=at(this,a,"m",ue).call(this,{networkClientId:c}),[d,h]=await(0,Ut.getNextNonce)(i,e=>at(this,j,"f").getNonceLock(e,i.networkClientId));s=h,i=at(this,a,"m",De).call(this,{transactionId:e},e=>{const{chainId:t,txParams:n}=e,{gas:a,type:r}=n;e.status=Nt.TransactionStatus.approved,e.txParams.chainId=t,e.txParams.gasLimit=a,e.txParams.nonce=d,!r&&(0,$t.isEIP1559Transaction)(n)&&(e.txParams.type=Nt.TransactionEnvelopeType.feeMarket)}),at(this,a,"m",Se).call(this,i);const m=await at(this,H,"f").call(this,{name:"Sign",parentContext:t},()=>at(this,a,"m",ye).call(this,i));if(i=at(this,a,"m",se).call(this,e),!await at(this,l,"f").call(this,i))return(0,vt.projectLogger)("Skipping publishing transaction based on hook"),this.messenger.publish(`${Qt}:transactionPublishingSkipped`,i),zt.SkippedViaBeforePublishHook;if(!m&&!i.isExternalSign)return zt.NotApproved;let f;const p=i.type===Nt.TransactionType.swap;p&&((0,vt.projectLogger)("Determining pre-transaction balance"),f=await(0,it.query)(u,"getBalance",[i.txParams.from])),(0,vt.projectLogger)("Publishing transaction",i.txParams),s?.(),s=undefined;let g=at(this,a,"m",Ze).bind(this,{ethQuery:u,publishHookOverride:n,traceContext:t});if(i.batchTransactions?.length){(0,vt.projectLogger)("Found batch transactions",i.batchTransactions);g=new Pt.ExtraTransactionsPublishHook({addTransactionBatch:this.addTransactionBatch.bind(this),getTransaction:at(this,a,"m",se).bind(this),originalPublishHook:g}).getHook()}const{transactionHash:T}=await g(i,m??"0x");return i=at(this,a,"m",De).call(this,{transactionId:e},e=>{e.hash=T,e.status=Nt.TransactionStatus.submitted,e.submittedTime=(new Date).getTime(),p&&(e.preTxBalance=f,(0,vt.projectLogger)("Updated pre-transaction balance",f))}),this.messenger.publish(`${Qt}:transactionSubmitted`,{transactionMeta:i}),this.messenger.publish(`${Qt}:transactionFinished`,i),at(this,k,"f").emit(`${e}:finished`,i),at(this,a,"m",Se).call(this,i),zt.Approved}catch(e){return at(this,a,"m",Je).call(this,i,e),zt.NotApproved}finally{r?.(),s?.()}},X=async function(e,t,{skipSubmitHistory:n}={}){try{const r=await(0,it.query)(e,"sendRawTransaction",[t.rawTx]);return!0!==n&&at(this,a,"m",We).call(this,t,r),r}catch(e){const t=e,n=t?.data?.message??t?.message??String(e);throw new Error(n)}},Z=function(e,t,n){const r=at(this,a,"m",re).call(this,e);if(!r)return;at(this,a,"m",Ye).call(this,e);const s={...r,status:Nt.TransactionStatus.rejected,error:(0,$t.normalizeTxError)(n??ut.providerErrors.userRejectedRequest())};this.messenger.publish(`${Qt}:transactionFinished`,s),at(this,k,"f").emit(`${r.id}:finished`,s),this.messenger.publish(`${Qt}:transactionRejected`,{transactionMeta:s,actionId:t}),at(this,a,"m",Se).call(this,s)},ee=function(e){const t=new Set,n=[...e].sort((e,t)=>e.time>t.time?-1:1).filter(e=>{const{chainId:n,status:r,txParams:s,time:i}=e;if(s){const e=`${String(s.nonce)}-${(0,it.convertHexToDecimal)(n)}-${new Date(i).toDateString()}`;if(t.has(e))return!0;if(t.size<at(this,q,"f")||!at(this,a,"m",te).call(this,r))return t.add(e),!0}return!1});return n.reverse(),n},te=function(e){return e===Nt.TransactionStatus.rejected||e===Nt.TransactionStatus.confirmed||e===Nt.TransactionStatus.failed||e===Nt.TransactionStatus.dropped},ne=function(e){return[Nt.TransactionStatus.confirmed,Nt.TransactionStatus.failed,Nt.TransactionStatus.rejected,Nt.TransactionStatus.submitted].includes(e)},ae=async function(e,{shouldShowRequest:t,traceContext:n}){const r=at(this,a,"m",ie).call(this,e),{origin:s}=e,i=it.ApprovalType.Transaction,o={txId:e.id};return await at(this,H,"f").call(this,{name:"Notification Display",id:r,parentContext:n}),await this.messenger.call("ApprovalController:addRequest",{id:r,origin:s??it.ORIGIN_METAMASK,type:i,requestData:o,expectsResult:!0},t)},re=function(e){const{transactions:t}=this.state;return t.find(({id:t})=>t===e)},se=function(e,t="TransactionController"){const n=at(this,a,"m",re).call(this,e);if(!n)throw new Error(`${t}: No transaction found with id ${e}`);return n},ie=function(e){return String(e.id)},oe=function(e){const t=at(this,a,"m",re).call(this,e);if(!t)return{meta:undefined,isCompleted:!1};return{meta:t,isCompleted:at(this,a,"m",ne).call(this,t.status)}},ce=function(e){return at(this,j,"f").getNetworkClient({networkClientId:e}).configuration.chainId},le=function({chainId:e,networkClientId:t}){return t||at(this,j,"f").getNetworkClient({chainId:e}).id},ue=function({chainId:e,networkClientId:t}){return new ot.default(at(this,a,"m",de).call(this,{chainId:e,networkClientId:t}))},de=function({chainId:e,networkClientId:t}){return at(this,j,"f").getNetworkClient({chainId:e,networkClientId:t}).provider},he=function(e){if(!e.length)return;const t=[];for(const n of e){const{chainId:e}=n;try{const r=at(this,a,"m",le).call(this,{chainId:e});t.push({...n,networkClientId:r})}catch(t){(0,vt.projectLogger)("Failed to get network client ID for incoming transaction",{chainId:e,error:t})}}this.update(e=>{const{transactions:n}=e;e.transactions=at(this,a,"m",ee).call(this,[...t,...n]),(0,vt.projectLogger)("Added incoming transactions to state",t.length,t)}),this.messenger.publish(`${Qt}:incomingTransactionsReceived`,t)},me=function(e,t){if(!t||t===it.ORIGIN_METAMASK)return undefined;const{gasPrice:n,maxFeePerGas:a,maxPriorityFeePerGas:r,gas:s}=e;if(n===undefined&&a===undefined&&r===undefined&&s===undefined)return undefined;const i={};return n!==undefined?i.gasPrice=n:a===undefined&&r===undefined||(i.maxFeePerGas=a,i.maxPriorityFeePerGas=r),s!==undefined&&(i.gas=s),i},fe=function(e){const{chainId:t}=e,{transactions:n}=this.state,r=e?.txParams?.from,s=n.filter(e=>e.txParams.from===r&&e.chainId===t),i=s.filter(e=>e.status===Nt.TransactionStatus.confirmed),o=s.filter(e=>e.status===Nt.TransactionStatus.submitted);return(0,xt.validateConfirmedExternalTransaction)(e,i,o),this.update(t=>{t.transactions=at(this,a,"m",ee).call(this,[...t.transactions,e])}),e},pe=function(e){const t=at(this,a,"m",re).call(this,e);if(!t)return;const n=t.txParams?.nonce,r=t.txParams?.from,{chainId:s}=t,i=this.state.transactions.filter(t=>t.id!==e&&t.txParams.from===r&&n&&t.txParams.nonce===n&&t.chainId===s&&t.type!==Nt.TransactionType.incoming&&t.isTransfer===undefined),o=i.map(e=>e.id);if(0!==i.length){this.update(e=>{for(const n of e.transactions)o.includes(n.id)&&(n.replacedBy=t?.hash,n.replacedById=t?.id)});for(const e of this.state.transactions)o.includes(e.id)&&e.status!==Nt.TransactionStatus.failed&&at(this,a,"m",ge).call(this,e)}},ge=function(e){const t={...e,status:Nt.TransactionStatus.dropped};this.messenger.publish(`${Qt}:transactionDropped`,{transactionMeta:t}),this.updateTransaction(t,"TransactionController#setTransactionStatusDropped - Transaction dropped"),at(this,a,"m",Se).call(this,t)},Te=function(e){return this.state.transactions.find(t=>e&&t.actionId===e)},we=async function(e){return new Promise(t=>{at(this,k,"f").once(`${e}:finished`,e=>{t(e)})})},be=function(e,t){const n=(0,mt.cloneDeep)(e);for(const e of["r","s","v"]){const a=t[e];a!==undefined&&null!==a&&(n[e]=(0,dt.add0x)(a.toString(16)))}return n},Ee=async function(e){const t=await at(this,f,"f").call(this,e),n=await at(this,m,"f").call(this);return t&&n},ye=async function(e){let t=e;const{id:n}=t;(0,vt.projectLogger)("Calling before sign hook",t);const{updateTransaction:r}=await at(this,u,"f").call(this,{transactionMeta:t})??{};r&&(at(this,a,"m",De).call(this,{transactionId:n,skipResimulateCheck:!0},r),(0,vt.projectLogger)("Updated transaction after before sign hook")),t=at(this,a,"m",se).call(this,n);const{networkClientId:i}=t,c=at(this,a,"m",ue).call(this,{networkClientId:i});await(0,Ft.checkGasFeeTokenBeforePublish)({ethQuery:c,fetchGasFeeTokens:async e=>(await at(this,a,"m",et).call(this,e)).gasFeeTokens,transaction:t,updateTransaction:(e,t)=>at(this,a,"m",De).call(this,{transactionId:e},t)}),t=at(this,a,"m",se).call(this,n);const{chainId:l,isExternalSign:d,txParams:m}=t;if(d)return(0,vt.projectLogger)("Skipping sign as signed externally"),undefined;const{authorizationList:f,from:p}=m,g=await(0,Ot.signAuthorizationList)({authorizationList:f,messenger:this.messenger,transactionMeta:t});g&&at(this,a,"m",De).call(this,{transactionId:n},e=>{e.txParams.authorizationList=g}),t=at(this,a,"m",se).call(this,n);const T=at(this,a,"m",se).call(this,n),{txParams:w}=T,b=(0,Ht.prepareTransaction)(l,w);at(this,o,"f").add(n),(0,vt.projectLogger)("Signing transaction",w);const E=await new Promise((e,t)=>{at(this,D,"f")?.call(this,b,p,...at(this,h,"f").call(this,T)).then(e,t),at(this,B,"f").set(n,()=>t(new Error("Signing aborted by user")))});if(at(this,B,"f").delete(n),!E)return(0,vt.projectLogger)("Skipping signed status as no signed transaction"),undefined;const y=(0,mt.cloneDeep)(T);if(!at(this,s,"f").call(this,y,E))return this.updateTransaction(y,"TransactionController#signTransaction - Update after sign"),(0,vt.projectLogger)("Skipping signed status based on hook"),undefined;const S={...at(this,a,"m",be).call(this,y,E),status:Nt.TransactionStatus.signed,txParams:w};this.updateTransaction(S,"TransactionController#approveTransaction - Transaction signed"),at(this,a,"m",Se).call(this,S);const k=(0,Ht.serializeTransaction)(E),I=(0,mt.merge)({},S,{rawTx:k});return this.updateTransaction(I,"TransactionController#approveTransaction - RawTransaction added"),k},Se=function(e){this.messenger.publish(`${Qt}:transactionStatusUpdated`,{transactionMeta:e})},ke=function(e,t,n){return(0,Ut.getAndFormatTransactionsForNonceTracker)(n,t,e,this.state.transactions)},Ie=function(e){(0,vt.projectLogger)("Processing confirmed transaction",e.id),at(this,a,"m",pe).call(this,e.id),this.messenger.publish(`${Qt}:transactionConfirmed`,e),at(this,a,"m",Se).call(this,e),at(this,a,"m",Ae).call(this,e).catch(e=>{throw(0,vt.projectLogger)("Error while updating post balance",e),e})},Ae=async function(e){try{const{networkClientId:t,type:n}=e;if(n!==Nt.TransactionType.swap)return;const r=at(this,a,"m",ue).call(this,{networkClientId:t}),{updatedTransactionMeta:s,approvalTransactionMeta:i}=await(0,Kt.updatePostTransactionBalance)(e,{ethQuery:r,getTransaction:at(this,a,"m",re).bind(this),updateTransaction:this.updateTransaction.bind(this)});this.messenger.publish(`${Qt}:postTransactionBalanceUpdated`,{transactionMeta:s,approvalTransactionMeta:i})}catch(e){(0,vt.projectLogger)("Error while updating post transaction balance",e)}},_e=function({provider:e,blockTracker:t,chainId:n}){return new lt.NonceTracker({provider:e,blockTracker:t,getPendingTransactions:at(this,a,"m",Oe).bind(this,n),getConfirmedTransactions:at(this,a,"m",ke).bind(this,[Nt.TransactionStatus.confirmed],n)})},Ce=function({provider:e,blockTracker:t,chainId:n,networkClientId:r}){const s=new ot.default(e),i=new _t.PendingTransactionTracker({blockTracker:t,getChainId:()=>n,getEthQuery:()=>s,getGlobalLock:()=>at(this,j,"f").acquireNonceLockForChainIdKey({chainId:n}),getNetworkClientId:()=>r,getTransactions:()=>this.state.transactions,hooks:{beforeCheckPendingTransaction:at(this,c,"f").bind(this)},isResubmitEnabled:at(this,O,"f").isResubmitEnabled,isTimeoutEnabled:at(this,v,"f"),messenger:this.messenger,publishTransaction:(e,t)=>at(this,a,"m",X).call(this,e,t,{skipSubmitHistory:!0})});return at(this,a,"m",je).call(this,i),i},ve=function(){at(this,j,"f").stopAllTracking()},Ne=function(e){e.hub.on("transactions",at(this,a,"m",he).bind(this))},Re=function(e){e.hub.removeAllListeners("transaction-confirmed"),e.hub.removeAllListeners("transaction-dropped"),e.hub.removeAllListeners("transaction-failed"),e.hub.removeAllListeners("transaction-updated")},je=function(e){e.hub.on("transaction-confirmed",at(this,a,"m",Ie).bind(this)),e.hub.on("transaction-dropped",at(this,a,"m",ge).bind(this)),e.hub.on("transaction-failed",at(this,a,"m",Je).bind(this)),e.hub.on("transaction-updated",this.updateTransaction.bind(this))},Oe=function(e,t){return[...at(this,a,"m",ke).call(this,[Nt.TransactionStatus.approved,Nt.TransactionStatus.signed,Nt.TransactionStatus.submitted],t,e),...at(this,p,"f").call(this,t,e)]},xe=async function(e,t){try{return await at(this,a,"m",X).call(this,e,t)}catch(e){if(at(this,a,"m",Le).call(this,e))throw new Error("Previous transaction is already confirmed");throw e}},Le=function(e){return Boolean(e?.message?.includes("nonce too low"))||Boolean(e?.data?.message?.includes("nonce too low"))},Me=function(){return at(this,U,"f")?[new Et.TestGasFeeFlow]:[new wt.RandomisedEstimationsGasFeeFlow,new gt.LineaGasFeeFlow,new pt.DefaultGasFeeFlow]},Fe=function(){return[new Tt.OptimismLayer1GasFeeFlow,new bt.ScrollLayer1GasFeeFlow]},De=function({transactionId:e,skipValidation:t,skipResimulateCheck:n},r){let s;this.update(a=>{const i=a.transactions.findIndex(({id:t})=>t===e);if(-1===i)throw new Error(`Cannot update transaction as ID not found - ${e}`);let o=a.transactions[i];const c=(0,mt.cloneDeep)(o);o=r(o)??o,!0!==t&&(o.txParams=(0,$t.normalizeTransactionParams)(o.txParams),(0,Vt.validateTxParams)(o.txParams)),!n&&at(this,C,"f").call(this)&&(s=(0,Ct.shouldResimulate)(c,o)),a.transactions[i]=o});const i=at(this,a,"m",re).call(this,e);return s?.resimulate&&at(this,a,"m",Be).call(this,i,{blockTime:s.blockTime}).catch(e=>{throw(0,vt.projectLogger)("Error during re-simulation",e),e}),i},Be=async function(e,{blockTime:t,traceContext:n}={}){const{chainId:r,id:s,nestedTransactions:i,networkClientId:o,simulationData:c,txParams:l}=e;let u,d={error:{code:Nt.SimulationErrorCode.Disabled,message:"Simulation disabled"},tokenBalanceChanges:[]},h=[],m=!1;const f=at(this,G,"f").has(s);if(at(this,C,"f").call(this)&&!f){const s=await at(this,H,"f").call(this,{name:"Simulate",parentContext:n},()=>(0,Rt.getBalanceChanges)({blockTime:t,chainId:r,ethQuery:at(this,a,"m",ue).call(this,{networkClientId:o}),getSimulationConfig:(t,n)=>at(this,E,"f").call(this,t,{txMeta:e,...n}),nestedTransactions:i,txParams:l}));d=s.simulationData,u=s.gasUsed,t&&c&&(0,Ct.hasSimulationDataChanged)(c,d)&&(d={...d,isUpdatedAfterSecurityCheck:!0});const f=await at(this,a,"m",et).call(this,e);h=f?.gasFeeTokens??[],m=f?.isGasFeeSponsored??!1}if(!at(this,a,"m",re).call(this,s))return void(0,vt.projectLogger)("Cannot update simulation data as transaction not found",s,d);const p=at(this,a,"m",De).call(this,{transactionId:s,skipResimulateCheck:Boolean(t)},e=>{e.gasFeeTokens=h,e.isGasFeeSponsored=m,e.gasUsed=u,f||(e.simulationData=d)});(0,vt.projectLogger)("Updated simulation data",s,p),await at(this,a,"m",Xe).call(this,p)},Ge=function({transactionId:e,gasFeeEstimates:t,gasFeeEstimatesLoaded:n,layer1GasFee:r}){at(this,a,"m",De).call(this,{transactionId:e},e=>{(0,St.updateTransactionGasProperties)({txMeta:e,gasFeeEstimates:t,gasFeeEstimatesLoaded:n,isTxParamsGasFeeUpdatesEnabled:at(this,I,"f"),layer1GasFee:r})})},Ue=function({transactionBatchId:e,gasFeeEstimates:t}){at(this,a,"m",He).call(this,e,e=>({...e,gasFeeEstimates:t}))},He=function(e,t){this.update(n=>{const a=n.transactionBatches.findIndex(t=>t.id===e);if(-1===a)throw new Error(`Cannot update batch, ID not found - ${e}`);const r=n.transactionBatches[a],s=t(r);n.transactionBatches[a]=s??r})},qe=function(){return this.messenger.call("AccountsController:getSelectedAccount")},Ke=function(){const e=this.messenger.call("AccountsController:getState");return Object.values(e.internalAccounts?.accounts??{}).filter(e=>"eip155:eoa"===e.type).map(e=>e.address)},We=function(e,t){const{chainId:n,networkClientId:a,origin:r,rawTx:s,txParams:i}=e,{networkConfigurationsByChainId:o}=at(this,T,"f").call(this),c=o[n],l=c?.rpcEndpoints.find(e=>e.networkClientId===a),u=l?.url,d={chainId:n,hash:t,networkType:l?.name??a,networkUrl:u,origin:r,rawTransaction:s,time:Date.now(),transaction:i};(0,vt.projectLogger)("Updating submit history",d),this.update(e=>{const{submitHistory:t}=e;100===t.length&&t.pop(),t.unshift(d)})},$e=async function(e){const{chainId:t,networkClientId:n}=e,r=at(this,j,"f").getNetworkClient({networkClientId:n}).configuration.type===ct.NetworkClientType.Custom,s=at(this,a,"m",ue).call(this,{networkClientId:n});await(0,Mt.updateGas)({chainId:t,ethQuery:s,isCustomNetwork:r,isSimulationEnabled:at(this,C,"f").call(this),getSimulationConfig:at(this,E,"f"),messenger:this.messenger,txMeta:e})},Ve=function(){this.messenger.registerActionHandler(`${Qt}:addTransaction`,this.addTransaction.bind(this)),this.messenger.registerActionHandler(`${Qt}:addTransactionBatch`,this.addTransactionBatch.bind(this)),this.messenger.registerActionHandler(`${Qt}:confirmExternalTransaction`,this.confirmExternalTransaction.bind(this)),this.messenger.registerActionHandler(`${Qt}:emulateNewTransaction`,this.emulateNewTransaction.bind(this)),this.messenger.registerActionHandler(`${Qt}:emulateTransactionUpdate`,this.emulateTransactionUpdate.bind(this)),this.messenger.registerActionHandler(`${Qt}:estimateGas`,this.estimateGas.bind(this)),this.messenger.registerActionHandler(`${Qt}:estimateGasBatch`,this.estimateGasBatch.bind(this)),this.messenger.registerActionHandler(`${Qt}:getGasFeeTokens`,at(this,a,"m",tt).bind(this)),this.messenger.registerActionHandler(`${Qt}:getNonceLock`,this.getNonceLock.bind(this)),this.messenger.registerActionHandler(`${Qt}:getTransactions`,this.getTransactions.bind(this)),this.messenger.registerActionHandler(`${Qt}:updateCustodialTransaction`,this.updateCustodialTransaction.bind(this)),this.messenger.registerActionHandler(`${Qt}:updateTransaction`,this.updateTransaction.bind(this))},Ye=function(e){this.update(t=>{const n=t.transactions.filter(({id:t})=>t!==e);t.transactions=at(this,a,"m",ee).call(this,n)})},Qe=function(e){return[ut.errorCodes.provider.userRejectedRequest,Vt.ErrorCode.RejectedUpgrade].includes(e.code)},ze=function(e,t,n){if(at(this,a,"m",Z).call(this,e,t,n),n.code===ut.errorCodes.provider.userRejectedRequest)throw ut.providerErrors.userRejectedRequest({message:"MetaMask Tx Signature: User denied transaction signature.",data:n?.data});throw n},Je=function(e,t,n){let r;try{r=at(this,a,"m",De).call(this,{transactionId:e.id,skipValidation:!0},e=>{e.status=Nt.TransactionStatus.failed,e.error=(0,$t.normalizeTxError)(t)})}catch(n){(0,vt.projectLogger)("Failed to mark transaction as failed",n),r={...e,status:Nt.TransactionStatus.failed,error:(0,$t.normalizeTxError)(t)}}this.messenger.publish(`${Qt}:transactionFailed`,{actionId:n,error:t.message,transactionMeta:r}),at(this,a,"m",Se).call(this,r),this.messenger.publish(`${Qt}:transactionFinished`,r),at(this,k,"f").emit(`${e.id}:finished`,r)},Xe=async function(e){(0,vt.projectLogger)("Calling afterSimulate hook",e);const{id:t}=e,n=await at(this,i,"f").call(this,{transactionMeta:e}),{skipSimulation:r,updateTransaction:s}=n??{};if(r?at(this,G,"f").add(t):!1===r&&at(this,G,"f").delete(t),!s)return;const o=at(this,a,"m",De).call(this,{transactionId:t,skipResimulateCheck:!0},e=>{e.txParamsOriginal=(0,mt.cloneDeep)(e.txParams),s(e)});(0,vt.projectLogger)("Updated transaction with afterSimulate data",o)},Ze=async function({ethQuery:e,publishHookOverride:t,traceContext:n},r,s){let i;return await at(this,H,"f").call(this,{name:"Publish",parentContext:n},async()=>{const n=t??at(this,L,"f");({transactionHash:i}=await n(r,s)),i??(i=await at(this,a,"m",X).call(this,e,{...r,rawTx:s}))}),(0,vt.projectLogger)("Publish successful",i),{transactionHash:i}},et=async function(e){const{chainId:t}=e;return await(0,Ft.getGasFeeTokens)({chainId:t,getSimulationConfig:at(this,E,"f"),isEIP7702GasFeeTokensEnabled:at(this,A,"f"),messenger:this.messenger,publicKeyEIP7702:at(this,x,"f"),transactionMeta:e})},tt=async function(e){const{chainId:t,data:n,from:r,to:s,value:i}=e,o=at(this,a,"m",ue).call(this,{chainId:t}),c={chainId:t,delegationAddress:await(0,Ot.getDelegationAddress)(r,o),isExternalSign:!0,txParams:{data:n,from:r,to:s,value:i}};return(await at(this,a,"m",et).call(this,c)).gasFeeTokens}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/TransactionController.cjs"}],[3073,{"../errors.cjs":3076,"../logger.cjs":3096,"@metamask/controller-utils":1494,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getAccountTransactions=n.getAccountAddressRelationship=void 0;const a=e("@metamask/controller-utils"),r=e("@metamask/utils"),s=e("../errors.cjs"),i=e("../logger.cjs"),o="https://accounts.api.cx.metamask.io",c=`${o}/v1/accounts/`,l="x-metamask-clientproduct",u="metamask-transaction-controller",d=[1,10,56,137,8453,42161,59144,534352,1329,143],h=(0,r.createModuleLogger)(i.projectLogger,"accounts-api");n.getAccountAddressRelationship=async function(e){const{chainId:t,from:n,to:r}=e;if(!d.includes(t))throw h("Unsupported chain ID for account relationship API",t),new s.FirstTimeInteractionError("Unsupported chain ID");const i=`${o}/v1/networks/${t}/accounts/${n}/relationships/${r}`;h("Getting account address relationship",{request:e,url:i});const c={[l]:u},m=await(0,a.successfulFetch)(i,{headers:c});if(204===m.status)return{count:0};const f=await m.json();if(h("Retrieved account address relationship",f),f.error){const{code:e,message:t}=f.error;throw new s.FirstTimeInteractionError(t,e)}return f},n.getAccountTransactions=async function(e){const{address:t,chainIds:n,cursor:r,endTimestamp:s,sortDirection:i,startTimestamp:o,tags:d}=e;let m=`${c}${t}/transactions`;const f=[];if(n){const e=n.join(",");f.push(`networks=${e}`)}o&&f.push(`startTimestamp=${o}`),s&&f.push(`endTimestamp=${s}`),r&&f.push(`cursor=${r}`),i&&f.push(`sortDirection=${i}`),f.length&&(m+=`?${f.join("&")}`),h("Getting account transactions",{request:e,url:m});const p=[u,...d??[]].join("__"),g={[l]:p},T=await(0,a.successfulFetch)(m,{headers:g}),w=await T.json();return h("Retrieved account transactions",w),w}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/api/accounts-api.cjs"}],[3074,{"../constants.cjs":3075,"../errors.cjs":3076,"../logger.cjs":3096,"@metamask/controller-utils":1494,"@metamask/utils":3217,lodash:4901},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.simulateTransactions=void 0;const a=e("@metamask/controller-utils"),r=e("@metamask/utils"),s=e("lodash"),i=e("../constants.cjs"),o=e("../errors.cjs"),c=e("../logger.cjs"),l=(0,r.createModuleLogger)(c.projectLogger,"simulation-api"),u="networks";let d=0;function h(e){return"https://tx-sentinel-{0}.api.cx.metamask.io/".replace("{0}",e)}n.simulateTransactions=async function(e,t){let n=await async function(e){const t=await async function(){const e=`${h("ethereum-mainnet")}${u}`,t=await fetch(e);return t.json()}(),n=(0,a.convertHexToDecimal)(e),r=t[n];if(!r?.confirmations)throw l("Chain is not supported",e),new o.SimulationChainNotSupportedError(e);return h(r.network)}(e);const{newUrl:r,authorization:c}=await t.getSimulationConfig(n)||{};r&&(n=r);const m=d;d+=1;const f=function(e){const t=(0,s.cloneDeep)(e);for(const e of t.transactions){const n=e.to?.toLowerCase();i.DELEGATION_MANAGER_ADDRESSES.includes(n)&&(t.overrides=t.overrides??{},t.overrides[n]={code:i.CODE_DELEGATION_MANAGER_NO_SIGNATURE_ERRORS})}return t}(t);l("Sending request",n,t);const p={"Content-Type":"application/json"};c&&(p.Authorization=c);const g=await fetch(n,{method:"POST",headers:p,body:JSON.stringify({id:String(m),jsonrpc:"2.0",method:"infura_simulateTransactions",params:[f]})}),T=await g.json();if(l("Received response",T),T.error){const{code:e,message:t}=T.error;throw new o.SimulationError(t,e)}return T?.result}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/api/simulation-api.cjs"}],[3075,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.CODE_DELEGATION_MANAGER_NO_SIGNATURE_ERRORS=n.DELEGATION_MANAGER_ADDRESSES=n.ABI_IERC7821=n.ABI_SIMULATION_ERC721_LEGACY=n.ABI_SIMULATION_ERC20_WRAPPED=n.CHAIN_IDS=void 0,n.CHAIN_IDS={MAINNET:"0x1",GOERLI:"0x5",BASE:"0x2105",BASE_TESTNET:"0x14a33",BSC:"0x38",BSC_TESTNET:"0x61",OPTIMISM:"0xa",OPTIMISM_TESTNET:"0x1a4",OPBNB:"0xcc",OPBNB_TESTNET:"0x15eb",OPTIMISM_SEPOLIA:"0xaa37dc",POLYGON:"0x89",POLYGON_TESTNET:"0x13881",AVALANCHE:"0xa86a",AVALANCHE_TESTNET:"0xa869",FANTOM:"0xfa",FANTOM_TESTNET:"0xfa2",SEPOLIA:"0xaa36a7",LINEA_GOERLI:"0xe704",LINEA_SEPOLIA:"0xe705",LINEA_MAINNET:"0xe708",MOONBEAM:"0x504",MOONBEAM_TESTNET:"0x507",MOONRIVER:"0x505",MONAD:"0x8f",GNOSIS:"0x64",ARBITRUM:"0xa4b1",ZKSYNC_ERA:"0x144",ZORA:"0x76adf1",SCROLL:"0x82750",SCROLL_SEPOLIA:"0x8274f",MEGAETH_TESTNET:"0x18c6",SEI:"0x531"},n.ABI_SIMULATION_ERC20_WRAPPED=[{anonymous:!1,inputs:[{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"wad",type:"uint256"}],name:"Deposit",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!1,name:"wad",type:"uint256"}],name:"Withdrawal",type:"event"}],n.ABI_SIMULATION_ERC721_LEGACY=[{anonymous:!1,inputs:[{indexed:!1,name:"_from",type:"address"},{indexed:!1,name:"_to",type:"address"},{indexed:!1,name:"_tokenId",type:"uint256"}],name:"Transfer",type:"event"}],n.ABI_IERC7821=[{type:"function",name:"execute",inputs:[{name:"mode",type:"bytes32",internalType:"ModeCode"},{name:"executionData",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"payable"},{type:"function",name:"supportsExecutionMode",inputs:[{name:"mode",type:"bytes32",internalType:"ModeCode"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"}],n.DELEGATION_MANAGER_ADDRESSES=["0xdb9b1e94b5b69df7e401ddbede43491141047db3"],n.CODE_DELEGATION_MANAGER_NO_SIGNATURE_ERRORS="0x608060405234801561001057600080fd5b506004361061012c5760003560e01c806383ebb771116100ad578063acb8cc4911610071578063acb8cc491461027f578063cef6d2091461029f578063e30c3978146102b2578063f2fde38b146102c3578063ffa1ad74146102d657600080fd5b806383ebb771146102065780638456cb591461020e57806384b0196e146102165780638da5cb5b14610231578063a3f4df7e1461024257600080fd5b806358909ebc116100f457806358909ebc146101b05780635c975abb146101d157806366134607146101e3578063715018a6146101f657806379ba5097146101fe57600080fd5b80631b13cac2146101315780632d40d0521461014d5780633ed01015146101805780633f4ba83a14610195578063499340471461019d575b600080fd5b61013a60001981565b6040519081526020015b60405180910390f35b61017061015b36600461207e565b60046020526000908152604090205460ff1681565b6040519015158152602001610144565b61019361018e366004612097565b6102fa565b005b6101936103f4565b6101936101ab366004612097565b610406565b6101b9610a1181565b6040516001600160a01b039091168152602001610144565b600154600160a01b900460ff16610170565b61013a6101f1366004612097565b6104f6565b61019361050f565b610193610521565b61013a61056a565b610193610579565b61021e610589565b6040516101449796959493929190612128565b6000546001600160a01b03166101b9565b610272604051806040016040528060118152602001702232b632b3b0ba34b7b726b0b730b3b2b960791b81525081565b60405161014491906121c1565b610272604051806040016040528060018152602001603160f81b81525081565b6101936102ad36600461221f565b6105cf565b6001546001600160a01b03166101b9565b6101936102d13660046122d4565b611829565b610272604051806040016040528060058152602001640312e332e360dc1b81525081565b61030a60408201602083016122d4565b6001600160a01b03811633146103335760405163b9f0f17160e01b815260040160405180910390fd5b600061033e836104f6565b60008181526004602052604090205490915060ff1661037057604051637952fbad60e11b815260040160405180910390fd5b6000818152600460209081526040909120805460ff19169055610395908401846122d4565b6001600160a01b03166103ae60408501602086016122d4565b6001600160a01b0316827f3feadce88fc1b49db633a56fd5307ed6ee18734df83bcc4011daa720c9cd95f1866040516103e7919061241c565b60405180910390a4505050565b6103fc61189a565b6104046118c7565b565b61041660408201602083016122d4565b6001600160a01b038116331461043f5760405163b9f0f17160e01b815260040160405180910390fd5b600061044a836104f6565b60008181526004602052604090205490915060ff161561047c57604051625ecddb60e01b815260040160405180910390fd5b6000818152600460209081526040909120805460ff191660011790556104a4908401846122d4565b6001600160a01b03166104bd60408501602086016122d4565b6001600160a01b0316827fea589ba9473ee1fe77d352c7ed919747715a5d22931b972de9b02a907c66d5dd866040516103e7919061241c565b6000610509610504836127bb565b61191c565b92915050565b61051761189a565b61040460006119b7565b60015433906001600160a01b0316811461055e5760405163118cdaa760e01b81526001600160a01b03821660048201526024015b60405180910390fd5b610567816119b7565b50565b60006105746119d0565b905090565b61058161189a565b610404611afb565b60006060806000806000606061059d611b3e565b6105a5611b6b565b60408051600080825260208201909252600f60f81b9b939a50919850469750309650945092509050565b6105d7611b98565b8481811415806105e75750808414155b1561060557604051631bcaf69f60e01b815260040160405180910390fd5b6000816001600160401b0381111561061f5761061f6124ed565b60405190808252806020026020018201604052801561065257816020015b606081526020019060019003908161063d5790505b5090506000826001600160401b0381111561066f5761066f6124ed565b6040519080825280602002602001820160405280156106a257816020015b606081526020019060019003908161068d5790505b50905060005b83811015610c195760008a8a838181106106c4576106c46127c7565b90506020028101906106d691906127dd565b8101906106e39190612823565b905080516000036107d1576040805160008082526020820190925290610765565b6107526040518060c0016040528060006001600160a01b0316815260200160006001600160a01b03168152602001600080191681526020016060815260200160008152602001606081525090565b8152602001906001900390816107045790505b50848381518110610778576107786127c7565b602090810291909101015260006040519080825280602002602001820160405280156107ae578160200160208202803683370190505b508383815181106107c1576107c16127c7565b6020026020010181905250610c10565b808483815181106107e4576107e46127c7565b6020026020010181905250600081516001600160401b0381111561080a5761080a6124ed565b604051908082528060200260200182016040528015610833578160200160208202803683370190505b50905080848481518110610849576108496127c7565b6020026020010181905250336001600160a01b031682600081518110610871576108716127c7565b6020026020010151600001516001600160a01b0316141580156108c65750610a116001600160a01b0316826000815181106108ae576108ae6127c7565b6020026020010151600001516001600160a01b031614155b156108e457604051632d618d8160e21b815260040160405180910390fd5b60005b8251811015610a4d576000838281518110610904576109046127c7565b602002602001015190506109178161191c565b838381518110610929576109296127c7565b60200260200101818152505080602001516001600160a01b03163b6000036109a657600061099e61099461095b61056a565b86868151811061096d5761096d6127c7565b602002602001015160405161190160f01b8152600281019290925260228201526042902090565b8360a00151611bc3565b905050610a44565b60006109c56109b361056a565b85858151811061096d5761096d6127c7565b9050600082602001516001600160a01b0316631626ba7e838560a001516040518363ffffffff1660e01b81526004016109ff9291906128d3565b602060405180830381865afa158015610a1c573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610a4091906128f4565b5050505b506001016108e7565b5060005b8251811015610c0d5760046000838381518110610a7057610a706127c7565b60209081029190910181015182528101919091526040016000205460ff1615610aac576040516302dd502960e11b815260040160405180910390fd5b60018351610aba9190612934565b8114610bc35781610acc826001612947565b81518110610adc57610adc6127c7565b6020026020010151838281518110610af657610af66127c7565b60200260200101516040015114610b2057604051636f6a1b8760e11b815260040160405180910390fd5b600083610b2e836001612947565b81518110610b3e57610b3e6127c7565b6020026020010151600001519050610a116001600160a01b0316816001600160a01b031614158015610b9f5750806001600160a01b0316848381518110610b8757610b876127c7565b6020026020010151602001516001600160a01b031614155b15610bbd57604051632d618d8160e21b815260040160405180910390fd5b50610c05565b60001960001b838281518110610bdb57610bdb6127c7565b60200260200101516040015114610c0557604051636f6a1b8760e11b815260040160405180910390fd5b600101610a51565b50505b506001016106a8565b5060005b83811015610e3e576000838281518110610c3957610c396127c7565b6020026020010151511115610e365760005b838281518110610c5d57610c5d6127c7565b602002602001015151811015610e34576000848381518110610c8157610c816127c7565b60200260200101518281518110610c9a57610c9a6127c7565b602002602001015160600151905060005b8151811015610e2a576000828281518110610cc857610cc86127c7565b6020026020010151600001519050806001600160a01b031663414c3e33848481518110610cf757610cf76127c7565b602002602001015160200151858581518110610d1557610d156127c7565b6020026020010151604001518f8f8a818110610d3357610d336127c7565b905060200201358e8e8b818110610d4c57610d4c6127c7565b9050602002810190610d5e91906127dd565b8c8c81518110610d7057610d706127c7565b60200260200101518b81518110610d8957610d896127c7565b60200260200101518e8d81518110610da357610da36127c7565b60200260200101518c81518110610dbc57610dbc6127c7565b602002602001015160200151336040518963ffffffff1660e01b8152600401610dec98979695949392919061295a565b600060405180830381600087803b158015610e0657600080fd5b505af1158015610e1a573d6000803e3d6000fd5b5050505050806001019050610cab565b5050600101610c4b565b505b600101610c1d565b5060005b8381101561146257828181518110610e5c57610e5c6127c7565b602002602001015151600003610f1a573363d691c964898984818110610e8457610e846127c7565b90506020020135888885818110610e9d57610e9d6127c7565b9050602002810190610eaf91906127dd565b6040518463ffffffff1660e01b8152600401610ecd939291906129c5565b6000604051808303816000875af1158015610eec573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052610f1491908101906129e8565b5061145a565b60005b838281518110610f2f57610f2f6127c7565b602002602001015151811015611106576000848381518110610f5357610f536127c7565b60200260200101518281518110610f6c57610f6c6127c7565b602002602001015160600151905060005b81518110156110fc576000828281518110610f9a57610f9a6127c7565b6020026020010151600001519050806001600160a01b031663a145832a848481518110610fc957610fc96127c7565b602002602001015160200151858581518110610fe757610fe76127c7565b6020026020010151604001518f8f8a818110611005576110056127c7565b905060200201358e8e8b81811061101e5761101e6127c7565b905060200281019061103091906127dd565b8c8c81518110611042576110426127c7565b60200260200101518b8151811061105b5761105b6127c7565b60200260200101518e8d81518110611075576110756127c7565b60200260200101518c8151811061108e5761108e6127c7565b602002602001015160200151336040518963ffffffff1660e01b81526004016110be98979695949392919061295a565b600060405180830381600087803b1580156110d857600080fd5b505af11580156110ec573d6000803e3d6000fd5b5050505050806001019050610f7d565b5050600101610f1d565b50828181518110611119576111196127c7565b60200260200101516001848381518110611135576111356127c7565b6020026020010151516111489190612934565b81518110611158576111586127c7565b6020026020010151602001516001600160a01b031663d691c964898984818110611184576111846127c7565b9050602002013588888581811061119d5761119d6127c7565b90506020028101906111af91906127dd565b6040518463ffffffff1660e01b81526004016111cd939291906129c5565b6000604051808303816000875af11580156111ec573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f1916820160405261121491908101906129e8565b506000838281518110611229576112296127c7565b60200260200101515190505b801561145857600084838151811061124f5761124f6127c7565b60200260200101516001836112649190612934565b81518110611274576112746127c7565b60200260200101516060015190506000815190505b80156114455760008261129d600184612934565b815181106112ad576112ad6127c7565b6020026020010151600001519050806001600160a01b031663d3eddcc5846001856112d89190612934565b815181106112e8576112e86127c7565b602002602001015160200151856001866113029190612934565b81518110611312576113126127c7565b6020026020010151604001518f8f8a818110611330576113306127c7565b905060200201358e8e8b818110611349576113496127c7565b905060200281019061135b91906127dd565b8c8c8151811061136d5761136d6127c7565b602002602001015160018c6113829190612934565b81518110611392576113926127c7565b60200260200101518e8d815181106113ac576113ac6127c7565b602002602001015160018d6113c19190612934565b815181106113d1576113d16127c7565b602002602001015160200151336040518963ffffffff1660e01b815260040161140198979695949392919061295a565b600060405180830381600087803b15801561141b57600080fd5b505af115801561142f573d6000803e3d6000fd5b50505050508061143e90612ac7565b9050611289565b50508061145190612ac7565b9050611235565b505b600101610e42565b5060005b838110156116de576000838281518110611482576114826127c7565b60200260200101515111156116d65760008382815181106114a5576114a56127c7565b60200260200101515190505b80156116d45760008483815181106114cb576114cb6127c7565b60200260200101516001836114e09190612934565b815181106114f0576114f06127c7565b60200260200101516060015190506000815190505b80156116c157600082611519600184612934565b81518110611529576115296127c7565b6020026020010151600001519050806001600160a01b031663ed463367846001856115549190612934565b81518110611564576115646127c7565b6020026020010151602001518560018661157e9190612934565b8151811061158e5761158e6127c7565b6020026020010151604001518f8f8a8181106115ac576115ac6127c7565b905060200201358e8e8b8181106115c5576115c56127c7565b90506020028101906115d791906127dd565b8c8c815181106115e9576115e96127c7565b602002602001015160018c6115fe9190612934565b8151811061160e5761160e6127c7565b60200260200101518e8d81518110611628576116286127c7565b602002602001015160018d61163d9190612934565b8151811061164d5761164d6127c7565b602002602001015160200151336040518963ffffffff1660e01b815260040161167d98979695949392919061295a565b600060405180830381600087803b15801561169757600080fd5b505af11580156116ab573d6000803e3d6000fd5b5050505050806116ba90612ac7565b9050611505565b5050806116cd90612ac7565b90506114b1565b505b600101611466565b5060005b8381101561181d5760008382815181106116fe576116fe6127c7565b60200260200101515111156118155760005b838281518110611722576117226127c7565b60200260200101515181101561181357336001600160a01b031684838151811061174e5761174e6127c7565b6020026020010151600186858151811061176a5761176a6127c7565b60200260200101515161177d9190612934565b8151811061178d5761178d6127c7565b6020026020010151602001516001600160a01b03167f40dadaa36c6c2e3d7317e24757451ffb2d603d875f0ad5e92c5dd156573b18738685815181106117d5576117d56127c7565b602002602001015184815181106117ee576117ee6127c7565b60200260200101516040516118039190612ade565b60405180910390a3600101611710565b505b6001016116e2565b50505050505050505050565b61183161189a565b600180546001600160a01b0383166001600160a01b031990911681179091556118626000546001600160a01b031690565b6001600160a01b03167f38d16b8cac22d99fc7c124b9cd0de2d3fa1faef420bfe791d8c362d765e2270060405160405180910390a350565b6000546001600160a01b031633146104045760405163118cdaa760e01b8152336004820152602401610555565b6118cf611bed565b6001805460ff60a01b191690557f5db9ee0a495bf2e6ff9c91a7834c1ba4fdd244a5e8aa4e537bd38aeae4b073aa335b6040516001600160a01b03909116815260200160405180910390a1565b6000807f88c1d2ecf185adf710588203a5f263f0ff61be0d33da39792cde19ba9aa4331e83600001518460200151856040015161195c8760600151611c17565b6080808901516040805160208101989098526001600160a01b03968716908801529490931660608601529184015260a083015260c082015260e0015b60408051601f1981840301815291905280516020909101209392505050565b600180546001600160a01b031916905561056781611ce2565b6000306001600160a01b037f000000000000000000000000000000000000000000000000000000000000000016148015611a2957507f000000000000000000000000000000000000000000000000000000000000000046145b15611a5357507f000000000000000000000000000000000000000000000000000000000000000090565b610574604080517f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f60208201527f0000000000000000000000000000000000000000000000000000000000000000918101919091527f000000000000000000000000000000000000000000000000000000000000000060608201524660808201523060a082015260009060c00160405160208183030381529060405280519060200120905090565b611b03611b98565b6001805460ff60a01b1916600160a01b1790557f62e78cea01bee320cd4e420270b5ea74000d11b0c9f74754ebdbfc544b05a2586118ff3390565b60606105747f00000000000000000000000000000000000000000000000000000000000000006002611d32565b60606105747f00000000000000000000000000000000000000000000000000000000000000006003611d32565b600154600160a01b900460ff16156104045760405163d93c066560e01b815260040160405180910390fd5b600080600080611bd38686611ddd565b925092509250611be38282611e2a565b5090949350505050565b600154600160a01b900460ff1661040457604051638dfc202b60e01b815260040160405180910390fd5b60008082516001600160401b03811115611c3357611c336124ed565b604051908082528060200260200182016040528015611c5c578160200160208202803683370190505b50905060005b8351811015611cb257611c8d848281518110611c8057611c806127c7565b6020026020010151611ee7565b828281518110611c9f57611c9f6127c7565b6020908102919091010152600101611c62565b5080604051602001611cc49190612bcb565b60405160208183030381529060405280519060200120915050919050565b600080546001600160a01b038381166001600160a01b0319831681178455604051919092169283917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e09190a35050565b606060ff8314611d4c57611d4583611f48565b9050610509565b818054611d5890612c01565b80601f0160208091040260200160405190810160405280929190818152602001828054611d8490612c01565b8015611dd15780601f10611da657610100808354040283529160200191611dd1565b820191906000526020600020905b815481529060010190602001808311611db457829003601f168201915b50505050509050610509565b60008060008351604103611e175760208401516040850151606086015160001a611e0988828585611f87565b955095509550505050611e23565b50508151600091506002905b9250925092565b6000826003811115611e3e57611e3e612c3b565b03611e47575050565b6001826003811115611e5b57611e5b612c3b565b03611e795760405163f645eedf60e01b815260040160405180910390fd5b6002826003811115611e8d57611e8d612c3b565b03611eae5760405163fce698f760e01b815260048101829052602401610555565b6003826003811115611ec257611ec2612c3b565b03611ee3576040516335e2f38360e21b815260048101829052602401610555565b5050565b6000807f80ad7e1b04ee6d994a125f4714ca0720908bd80ed16063ec8aee4b88e9253e2d8360000151846020015180519060200120604051602001611998939291909283526001600160a01b03919091166020830152604082015260600190565b60606000611f5583612056565b604080516020808252818301909252919250600091906020820181803683375050509182525060208101929092525090565b600080807f7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a0841115611fc2575060009150600390508261204c565b604080516000808252602082018084528a905260ff891692820192909252606081018790526080810186905260019060a0016020604051602081039080840390855afa158015612016573d6000803e3d6000fd5b5050604051601f1901519150506001600160a01b0381166120425750600092506001915082905061204c565b9250600091508190505b9450945094915050565b600060ff8216601f81111561050957604051632cd44ac360e21b815260040160405180910390fd5b60006020828403121561209057600080fd5b5035919050565b6000602082840312156120a957600080fd5b81356001600160401b038111156120bf57600080fd5b820160c081850312156120d157600080fd5b9392505050565b60005b838110156120f35781810151838201526020016120db565b50506000910152565b600081518084526121148160208601602086016120d8565b601f01601f19169290920160200192915050565b60ff60f81b881681526000602060e0602084015261214960e084018a6120fc565b838103604085015261215b818a6120fc565b606085018990526001600160a01b038816608086015260a0850187905284810360c08601528551808252602080880193509091019060005b818110156121af57835183529284019291840191600101612193565b50909c9b505050505050505050505050565b6020815260006120d160208301846120fc565b60008083601f8401126121e657600080fd5b5081356001600160401b038111156121fd57600080fd5b6020830191508360208260051b850101111561221857600080fd5b9250929050565b6000806000806000806060878903121561223857600080fd5b86356001600160401b038082111561224f57600080fd5b61225b8a838b016121d4565b9098509650602089013591508082111561227457600080fd5b6122808a838b016121d4565b9096509450604089013591508082111561229957600080fd5b506122a689828a016121d4565b979a9699509497509295939492505050565b80356001600160a01b03811681146122cf57600080fd5b919050565b6000602082840312156122e657600080fd5b6120d1826122b8565b6000808335601e1984360301811261230657600080fd5b83016020810192503590506001600160401b0381111561232557600080fd5b80360382131561221857600080fd5b81835281816020850137506000828201602090810191909152601f909101601f19169091010190565b60008383855260208086019550808560051b830101846000805b8881101561240e57858403601f19018a52823536899003605e1901811261239c578283fd5b880160606001600160a01b036123b1836122b8565b1686526123c0878301836122ef565b82898901526123d28389018284612334565b9250505060406123e4818401846122ef565b9350878303828901526123f8838583612334565b9d89019d97505050938601935050600101612377565b509198975050505050505050565b6020815260006001600160a01b0380612434856122b8565b16602084015280612447602086016122b8565b16604084015250604083013560608301526060830135601e1984360301811261246f57600080fd5b83016020810190356001600160401b0381111561248b57600080fd5b8060051b360382131561249d57600080fd5b60c060808501526124b260e08501828461235d565b915050608084013560a08401526124cc60a08501856122ef565b848303601f190160c08601526124e3838284612334565b9695505050505050565b634e487b7160e01b600052604160045260246000fd5b604051606081016001600160401b0381118282101715612525576125256124ed565b60405290565b60405160c081016001600160401b0381118282101715612525576125256124ed565b604051601f8201601f191681016001600160401b0381118282101715612575576125756124ed565b604052919050565b60006001600160401b03821115612596576125966124ed565b5060051b60200190565b60006001600160401b038211156125b9576125b96124ed565b50601f01601f191660200190565b600082601f8301126125d857600080fd5b81356125eb6125e6826125a0565b61254d565b81815284602083860101111561260057600080fd5b816020850160208301376000918101602001919091529392505050565b600082601f83011261262e57600080fd5b8135602061263e6125e68361257d565b82815260059290921b8401810191818101908684111561265d57600080fd5b8286015b8481101561270c5780356001600160401b03808211156126815760008081fd5b908801906060828b03601f190181131561269b5760008081fd5b6126a3612503565b6126ae8885016122b8565b8152604080850135848111156126c45760008081fd5b6126d28e8b838901016125c7565b838b0152509184013591838311156126ea5760008081fd5b6126f88d8a858801016125c7565b908201528652505050918301918301612661565b509695505050505050565b600060c0828403121561272957600080fd5b61273161252b565b905061273c826122b8565b815261274a602083016122b8565b60208201526040820135604082015260608201356001600160401b038082111561277357600080fd5b61277f8583860161261d565b60608401526080840135608084015260a08401359150808211156127a257600080fd5b506127af848285016125c7565b60a08301525092915050565b60006105093683612717565b634e487b7160e01b600052603260045260246000fd5b6000808335601e198436030181126127f457600080fd5b8301803591506001600160401b0382111561280e57600080fd5b60200191503681900382131561221857600080fd5b6000602080838503121561283657600080fd5b82356001600160401b038082111561284d57600080fd5b818501915085601f83011261286157600080fd5b813561286f6125e68261257d565b81815260059190911b8301840190848101908883111561288e57600080fd5b8585015b838110156128c6578035858111156128aa5760008081fd5b6128b88b89838a0101612717565b845250918601918601612892565b5098975050505050505050565b8281526040602082015260006128ec60408301846120fc565b949350505050565b60006020828403121561290657600080fd5b81516001600160e01b0319811681146120d157600080fd5b634e487b7160e01b600052601160045260246000fd5b818103818111156105095761050961291e565b808201808211156105095761050961291e565b60e08152600061296d60e083018b6120fc565b828103602084015261297f818b6120fc565b9050886040840152828103606084015261299a81888a612334565b608084019690965250506001600160a01b0392831660a0820152911660c09091015295945050505050565b8381526040602082015260006129df604083018486612334565b95945050505050565b600060208083850312156129fb57600080fd5b82516001600160401b0380821115612a1257600080fd5b818501915085601f830112612a2657600080fd5b8151612a346125e68261257d565b81815260059190911b83018401908481019088831115612a5357600080fd5b8585015b838110156128c657805185811115612a6f5760008081fd5b8601603f81018b13612a815760008081fd5b878101516040612a936125e6836125a0565b8281528d82848601011115612aa85760008081fd5b612ab7838c83018487016120d8565b8652505050918601918601612a57565b600081612ad657612ad661291e565b506000190190565b602080825282516001600160a01b0390811683830152838201518116604080850191909152808501516060808601919091528086015160c06080870152805160e0870181905260009594610100600583901b8901810195919493870193919290890190885b81811015612b9d5760ff198b8903018352855187815116895289810151858b8b0152612b71868b01826120fc565b918701518a83038b890152919050612b8981836120fc565b995050509488019491880191600101612b43565b50505050505050608085015160a085015260a08501519150601f198482030160c08501526129df81836120fc565b815160009082906020808601845b83811015612bf557815185529382019390820190600101612bd9565b50929695505050505050565b600181811c90821680612c1557607f821691505b602082108103612c3557634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052602160045260246000fdfea264697066735822122073f8fd2b36b643aff6f988638bc7c8ab2f41546c01a777524170b479e36618c564736f6c63430008170033"}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/constants.cjs"}],[3076,{"./types.cjs":3097},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SimulationRevertedError=n.SimulationInvalidResponseError=n.SimulationChainNotSupportedError=n.FirstTimeInteractionError=n.SimulationError=void 0;const a=e("./types.cjs");class r extends Error{constructor(e,t){super(e??"Simulation failed"),this.code=t}}n.SimulationError=r;class s extends Error{constructor(e,t){super(e??"Error checking first time interaction"),this.code=t}}n.FirstTimeInteractionError=s;n.SimulationChainNotSupportedError=class extends r{constructor(e){super(`Chain is not supported: ${e}`,a.SimulationErrorCode.ChainNotSupported)}};n.SimulationInvalidResponseError=class extends r{constructor(){super("Invalid response from simulation API",a.SimulationErrorCode.InvalidResponse)}};n.SimulationRevertedError=class extends r{constructor(){super("Transaction was reverted",a.SimulationErrorCode.Reverted)}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/errors.cjs"}],[3077,{"../logger.cjs":3096,"../types.cjs":3097,"../utils/gas-fees.cjs":3106,"@metamask/gas-fee-controller":3121,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.DefaultGasFeeFlow=void 0;const u=e("@metamask/gas-fee-controller"),d=e("@metamask/utils"),h=e("../logger.cjs"),m=e("../types.cjs"),f=e("../utils/gas-fees.cjs"),p=(0,d.createModuleLogger)(h.projectLogger,"default-gas-fee-flow");n.DefaultGasFeeFlow=class{constructor(){a.add(this)}matchesTransaction(){return!0}async getGasFees(e){const{gasFeeControllerData:t}=e,{gasEstimateType:n,gasFeeEstimates:o}=t;let c;switch(n){case u.GAS_ESTIMATE_TYPES.FEE_MARKET:p("Using fee market estimates",o),c=l(this,a,"m",r).call(this,o);break;case u.GAS_ESTIMATE_TYPES.LEGACY:p("Using legacy estimates",o),c=l(this,a,"m",s).call(this,o);break;case u.GAS_ESTIMATE_TYPES.ETH_GASPRICE:p("Using eth_gasPrice estimates",o),c=l(this,a,"m",i).call(this,o);break;default:throw new Error(`Unsupported gas estimate type: ${n}`)}return{estimates:c}}},a=new WeakSet,r=function(e){const t=Object.values(m.GasFeeEstimateLevel).reduce((t,n)=>({...t,[n]:l(this,a,"m",o).call(this,e,n)}),{});return{type:m.GasFeeEstimateType.FeeMarket,...t}},s=function(e){const t=Object.values(m.GasFeeEstimateLevel).reduce((t,n)=>({...t,[n]:l(this,a,"m",c).call(this,e,n)}),{});return{type:m.GasFeeEstimateType.Legacy,...t}},i=function(e){return{type:m.GasFeeEstimateType.GasPrice,gasPrice:(0,f.gweiDecimalToWeiHex)(e.gasPrice)}},o=function(e,t){return{maxFeePerGas:(0,f.gweiDecimalToWeiHex)(e[t].suggestedMaxFeePerGas),maxPriorityFeePerGas:(0,f.gweiDecimalToWeiHex)(e[t].suggestedMaxPriorityFeePerGas)}},c=function(e,t){return(0,f.gweiDecimalToWeiHex)(e[t])}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/DefaultGasFeeFlow.cjs"}],[3078,{"../logger.cjs":3096,"../types.cjs":3097,"./DefaultGasFeeFlow.cjs":3077,"@metamask/controller-utils":1494,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.LineaGasFeeFlow=void 0;const u=e("@metamask/controller-utils"),d=e("@metamask/utils"),h=e("./DefaultGasFeeFlow.cjs"),m=e("../logger.cjs"),f=e("../types.cjs"),p=(0,d.createModuleLogger)(m.projectLogger,"linea-gas-fee-flow"),g=[u.ChainId["linea-mainnet"],u.ChainId["linea-goerli"],u.ChainId["linea-sepolia"]],T={low:1,medium:1.35,high:1.7},w={low:1,medium:1.05,high:1.1};n.LineaGasFeeFlow=class{constructor(){a.add(this)}matchesTransaction({transactionMeta:e}){return g.includes(e.chainId)}async getGasFees(e){try{return await l(this,a,"m",r).call(this,e)}catch(t){return p("Using default flow as fallback due to error",t),(new h.DefaultGasFeeFlow).getGasFees(e)}}},a=new WeakSet,r=async function(e){const{ethQuery:t,transactionMeta:n}=e,r=await l(this,a,"m",s).call(this,n,t);p("Received Linea response",r);const d=l(this,a,"m",i).call(this,r.baseFeePerGas,T);p("Generated base fees",l(this,a,"m",c).call(this,d));const h=l(this,a,"m",i).call(this,r.priorityFeePerGas,w);p("Generated priority fees",l(this,a,"m",c).call(this,h));const m=l(this,a,"m",o).call(this,d,h);p("Generated max fees",l(this,a,"m",c).call(this,m));return{estimates:Object.values(f.GasFeeEstimateLevel).reduce((e,t)=>({...e,[t]:{maxFeePerGas:(0,u.toHex)(m[t]),maxPriorityFeePerGas:(0,u.toHex)(h[t])}}),{type:f.GasFeeEstimateType.FeeMarket})}},s=function(e,t){return(0,u.query)(t,"linea_estimateGas",[{from:e.txParams.from,to:e.txParams.to,value:e.txParams.value,input:e.txParams.data}])},i=function(e,t){const n=(0,u.hexToBN)(e);return{low:n.muln(t.low),medium:n.muln(t.medium),high:n.muln(t.high)}},o=function(e,t){return{low:e.low.add(t.low),medium:e.medium.add(t.medium),high:e.high.add(t.high)}},c=function(e){return Object.values(f.GasFeeEstimateLevel).map(t=>e[t].toString(10))}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/LineaGasFeeFlow.cjs"}],[3079,{"../constants.cjs":3075,"./OracleLayer1GasFeeFlow.cjs":3080,"@metamask/controller-utils":1494,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.OptimismLayer1GasFeeFlow=void 0;const i=e("@metamask/controller-utils"),o=e("@metamask/utils"),c=e("./OracleLayer1GasFeeFlow.cjs"),l=e("../constants.cjs"),u=[l.CHAIN_IDS.OPTIMISM,l.CHAIN_IDS.OPTIMISM_TESTNET,l.CHAIN_IDS.BASE,l.CHAIN_IDS.BASE_TESTNET,l.CHAIN_IDS.OPBNB,l.CHAIN_IDS.OPBNB_TESTNET,l.CHAIN_IDS.ZORA];class d extends c.OracleLayer1GasFeeFlow{constructor(){super(...arguments),a.add(this)}async matchesTransaction({transactionMeta:e}){const t=(0,o.hexToNumber)(e.chainId),n=await s(this,a,"m",r).call(this);return!!n?.has(t)||u.includes(e.chainId)}}n.OptimismLayer1GasFeeFlow=d,a=new WeakSet,r=async function(){try{const e=await(0,i.handleFetch)("https://gas.api.cx.metamask.io/v1/supportedNetworks");return new Set(e?.partialSupport?.optimism??[])}catch{return null}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/OptimismLayer1GasFeeFlow.cjs"}],[3080,{"../logger.cjs":3096,"../utils/prepare.cjs":3111,"../utils/utils.cjs":3116,"@ethersproject/contracts":777,"@ethersproject/providers":815,"@metamask/utils":3217,"bn.js":4076,buffer:4137},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var a,r,s,i,o,c,l=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.OracleLayer1GasFeeFlow=void 0;const d=e("@ethersproject/contracts"),h=e("@ethersproject/providers"),m=e("@metamask/utils"),f=u(e("bn.js")),p=e("../logger.cjs"),g=e("../utils/prepare.cjs"),T=e("../utils/utils.cjs"),w=(0,m.createModuleLogger)(p.projectLogger,"oracle-layer1-gas-fee-flow"),b=new f.default(0),E=[{inputs:[{internalType:"bytes",name:"_data",type:"bytes"}],name:"getL1Fee",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_gasUsed",type:"uint256"}],name:"getOperatorFee",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"}];n.OracleLayer1GasFeeFlow=class{constructor(){a.add(this)}getOracleAddressForChain(e){return"0x420000000000000000000000000000000000000F"}shouldSignTransaction(){return!1}async getLayer1Fee(e){try{const{provider:t,transactionMeta:n}=e,i=l(this,a,"m",c).call(this,t,n.chainId),o=await l(this,a,"m",r).call(this,i,n),u=await l(this,a,"m",s).call(this,i,n);return{layer1Fee:(0,m.add0x)((0,T.padHexToEvenLength)(o.add(u).toString(16)))}}catch(e){throw w("Failed to get oracle layer 1 gas fee",e),new Error("Failed to get oracle layer 1 gas fee")}}},a=new WeakSet,r=async function(e,t){const n=l(this,a,"m",i).call(this,t,this.shouldSignTransaction()).serialize(),r=await e.getL1Fee(n);if(r===undefined)throw new Error("No value returned from oracle contract");return(0,T.toBN)(r)},s=async function(e,t){const{gasUsed:n}=t;if(!n)return b;try{const t=await e.getOperatorFee(n);return t===undefined?b:(0,T.toBN)(t)}catch(e){return w("Failed to get operator layer 1 gas fee",e),b}},i=function(e,n){const r=l(this,a,"m",o).call(this,e),{chainId:s}=e;let i=(0,g.prepareTransaction)(s,r);if(n){const e=t.from("abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789","hex"),n=Uint8Array.from(e);i=i.sign(n)}return i},o=function(e){return{...e.txParams,gasLimit:e.txParams.gas}},c=function(e,t){return new d.Contract(this.getOracleAddressForChain(t),E,new h.Web3Provider(e))}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/OracleLayer1GasFeeFlow.cjs"}],[3081,{"../logger.cjs":3096,"../types.cjs":3097,"../utils/feature-flags.cjs":3103,"../utils/gas-fees.cjs":3106,"./DefaultGasFeeFlow.cjs":3077,"@metamask/gas-fee-controller":3121,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.randomiseDecimalGWEIAndConvertToHex=n.RandomisedEstimationsGasFeeFlow=void 0;const l=e("@metamask/gas-fee-controller"),u=e("@metamask/utils"),d=e("./DefaultGasFeeFlow.cjs"),h=e("../logger.cjs"),m=e("../types.cjs"),f=e("../utils/feature-flags.cjs"),p=e("../utils/gas-fees.cjs"),g=(0,u.createModuleLogger)(h.projectLogger,"randomised-estimation-gas-fee-flow");function T(e,t,n){const a=(0,p.gweiDecimalToWeiDecimal)(e),r=a.length,s=Math.min(t,r-n);if(0===Number(a)||s<=0)return`0x${Number(a).toString(16)}`;const i=r-s,o=a.slice(0,i),c=a.slice(-s),l=function(e,t){const n=10**e;return t+Math.floor(Math.random()*(n-t))}(s,Number(c)),d=`0x${(BigInt(o+"0".repeat(s))+BigInt(l)).toString(16)}`;return(0,u.add0x)(d)}n.RandomisedEstimationsGasFeeFlow=class{constructor(){a.add(this)}matchesTransaction({transactionMeta:e,messenger:t}){const{chainId:n}=e;return(0,f.getGasFeeRandomisation)(t).randomisedGasFeeDigits[n]!==undefined}async getGasFees(e){try{return await c(this,a,"m",s).call(this,e)}catch(t){return g("Using default flow as fallback due to error",t),await c(this,a,"m",r).call(this,e)}}},a=new WeakSet,r=async function(e){return(new d.DefaultGasFeeFlow).getGasFees(e)},s=async function(e){const{messenger:t,gasFeeControllerData:n,transactionMeta:s}=e,{gasEstimateType:o,gasFeeEstimates:u}=n,d=(0,f.getGasFeeRandomisation)(t),h=d.randomisedGasFeeDigits[s.chainId],m=d.preservedNumberOfDigits??2;if(o===l.GAS_ESTIMATE_TYPES.FEE_MARKET){g("Randomising fee market estimates",u);const e=c(this,a,"m",i).call(this,u,h,m);return g("Added randomised fee market estimates",e),{estimates:e}}return await c(this,a,"m",r).call(this,e)},i=function(e,t,n){const r=Object.values(m.GasFeeEstimateLevel).reduce((r,s)=>({...r,[s]:c(this,a,"m",o).call(this,e,s,t,n)}),{});return{type:m.GasFeeEstimateType.FeeMarket,...r}},o=function(e,t,n,a){return{maxFeePerGas:(0,p.gweiDecimalToWeiHex)(e[t].suggestedMaxFeePerGas),maxPriorityFeePerGas:T(e[t].suggestedMaxPriorityFeePerGas,n,a)}},n.randomiseDecimalGWEIAndConvertToHex=T}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/RandomisedEstimationsGasFeeFlow.cjs"}],[3082,{"../constants.cjs":3075,"./OracleLayer1GasFeeFlow.cjs":3080},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ScrollLayer1GasFeeFlow=void 0;const a=e("./OracleLayer1GasFeeFlow.cjs"),r=e("../constants.cjs"),s=[r.CHAIN_IDS.SCROLL,r.CHAIN_IDS.SCROLL_SEPOLIA];class i extends a.OracleLayer1GasFeeFlow{getOracleAddressForChain(e){return"0x5300000000000000000000000000000000000002"}shouldSignTransaction(){return!0}async matchesTransaction({transactionMeta:e}){return s.includes(e.chainId)}}n.ScrollLayer1GasFeeFlow=i}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/ScrollLayer1GasFeeFlow.cjs"}],[3083,{"../types.cjs":3097,"@metamask/controller-utils":1494},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)},o=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n};Object.defineProperty(n,"__esModule",{value:!0}),n.TestGasFeeFlow=void 0;const c=e("@metamask/controller-utils"),l=e("../types.cjs"),u=1e15;n.TestGasFeeFlow=class{constructor(){a.add(this),r.set(this,1)}matchesTransaction(){return!0}async getGasFees(e){const{transactionMeta:t}=e,{txParams:n}=t,{gas:c}=n;if(!c)throw new Error("Cannot estimate fee without gas value");const d=parseInt(c,16),h=.5*u,m=(i(this,r,"f")+1)*u,f=i(this,r,"f")*u,p=m-h,g=f-h,T=m+h,w=f+h;return o(this,r,i(this,r,"f")+1,"f"),{estimates:{type:l.GasFeeEstimateType.FeeMarket,low:{maxFeePerGas:i(this,a,"m",s).call(this,p,d),maxPriorityFeePerGas:i(this,a,"m",s).call(this,g,d)},medium:{maxFeePerGas:i(this,a,"m",s).call(this,m,d),maxPriorityFeePerGas:i(this,a,"m",s).call(this,f,d)},high:{maxFeePerGas:i(this,a,"m",s).call(this,T,d),maxPriorityFeePerGas:i(this,a,"m",s).call(this,w,d)}}}}},r=new WeakMap,a=new WeakSet,s=function(e,t){const n=Math.ceil(e/t);return(0,c.toHex)(n)}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/gas-flows/TestGasFeeFlow.cjs"}],[3084,{"../api/accounts-api.cjs":3073,"../constants.cjs":3075,"../index.cjs":3095,"../logger.cjs":3096,"../types.cjs":3097,"@metamask/controller-utils":1494,"bn.js":4076,uuid:5796},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.AccountsApiRemoteTransactionSource=n.SUPPORTED_CHAIN_IDS=void 0;const l=e("@metamask/controller-utils"),u=c(e("bn.js")),d=e("uuid"),h=e("../index.cjs"),m=e("../api/accounts-api.cjs"),f=e("../constants.cjs"),p=e("../logger.cjs"),g=e("../types.cjs");n.SUPPORTED_CHAIN_IDS=[f.CHAIN_IDS.MAINNET,f.CHAIN_IDS.POLYGON,f.CHAIN_IDS.BSC,f.CHAIN_IDS.LINEA_MAINNET,f.CHAIN_IDS.BASE,f.CHAIN_IDS.OPTIMISM,f.CHAIN_IDS.ARBITRUM,f.CHAIN_IDS.SCROLL,f.CHAIN_IDS.SEI,f.CHAIN_IDS.MONAD];const T=(0,p.createModuleLogger)(p.incomingTransactionsLogger,"accounts-api-source");n.AccountsApiRemoteTransactionSource=class{constructor(){a.add(this)}getSupportedChains(){return n.SUPPORTED_CHAIN_IDS}async fetchTransactions(e){const{address:t}=e,c=await o(this,a,"m",r).call(this,e,n.SUPPORTED_CHAIN_IDS);T("Fetched transactions",c.length,c);const l=await Promise.all(c.map(e=>o(this,a,"m",i).call(this,t,e)));T("Normalized transactions",l);const u=o(this,a,"m",s).call(this,e,l);return T("Filtered transactions",u.length,u),u}},a=new WeakSet,r=async function(e,t){const{address:n,tags:a}=e,r=[];try{const e=await(0,m.getAccountTransactions)({address:n,chainIds:t,sortDirection:"DESC",tags:a});e?.data&&r.push(...e.data)}catch(e){T("Error while fetching transactions",e)}return r},s=function(e,t){const{address:n,includeTokenTransfers:a,updateTransactions:r}=e;let s=t;return r||(s=s.filter(e=>e.txParams.to===n)),a||(s=s.filter(e=>!e.isTransfer)),s},i=async function(e,t){const n=String(t.blockNumber),a=`0x${t.chainId.toString(16)}`,{hash:r}=t,s=new Date(t.timestamp).getTime(),i=(0,d.v1)({msecs:s}),{from:o}=t,c=(0,l.BNToHex)(new u.default(t.gas)),m=(0,l.BNToHex)(new u.default(t.gasPrice)),f=(0,l.BNToHex)(new u.default(t.gasUsed)),p=(0,l.BNToHex)(new u.default(t.nonce)),T=t.methodId,w=g.TransactionType.incoming,b=t.isError?g.TransactionStatus.failed:g.TransactionStatus.confirmed,E=t.valueTransfers.find(t=>(t.to.toLowerCase()===e.toLowerCase()||t.from.toLowerCase()===e.toLowerCase())&&t.contractAddress),y=E?.to.toLowerCase()===e.toLowerCase()&&o.toLowerCase()!==e.toLowerCase(),S=o.toLowerCase()===e.toLowerCase(),k=E?.amount,I=E?.contractAddress,A=E?.decimal,_=E?.symbol,C=(0,l.BNToHex)(new u.default(y?E?.amount??t.value:t.value)),P=y?e:t.to,v={blockNumber:n,chainId:a,error:b===g.TransactionStatus.failed?new Error("Transaction failed"):undefined,hash:r,id:i,isTransfer:y,networkClientId:"",status:b,time:s,toSmartContract:!1,transferInformation:E?{amount:k,contractAddress:I,decimals:A,symbol:_}:undefined,txParams:{chainId:a,data:T,from:o,gas:c,gasPrice:m,gasUsed:f,nonce:p,to:P,value:C},type:w,verifiedOnBlockchain:!1};return S&&(v.type=(await(0,h.determineTransactionType)(v.txParams)).type),v}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/AccountsApiRemoteTransactionSource.cjs"}],[3085,{"../gas-flows/DefaultGasFeeFlow.cjs":3077,"../logger.cjs":3096,"../types.cjs":3097,"../utils/gas-flow.cjs":3107,"../utils/layer1-gas-fee-flow.cjs":3109,"@metamask/eth-query":2079,"@metamask/utils":3217,events:4433},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l,u,d,h,m,f,p,g,T,w,b,E,y,S,k,I,A,_=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},C=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)},P=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.updateTransactionGasEstimates=n.updateTransactionGasProperties=n.GasFeePoller=void 0;const v=P(e("@metamask/eth-query")),N=e("@metamask/utils"),R=P(e("events")),j=e("../gas-flows/DefaultGasFeeFlow.cjs"),O=e("../logger.cjs"),x=e("../types.cjs"),L=e("../utils/gas-flow.cjs"),M=e("../utils/layer1-gas-fee-flow.cjs"),F=(0,N.createModuleLogger)(O.projectLogger,"gas-fee-poller");function D(e,t,n,a){const{type:r}=t;if(a){if(r===x.GasFeeEstimateType.FeeMarket){const a=t;e.maxFeePerGas=a[n]?.maxFeePerGas,e.maxPriorityFeePerGas=a[n]?.maxPriorityFeePerGas}if(r===x.GasFeeEstimateType.GasPrice){const n=t;e.maxFeePerGas=n.gasPrice,e.maxPriorityFeePerGas=n.gasPrice}if(r===x.GasFeeEstimateType.Legacy){const a=t[n];e.maxFeePerGas=a,e.maxPriorityFeePerGas=a}delete e.gasPrice}else{if(r===x.GasFeeEstimateType.FeeMarket){const a=t;e.gasPrice=a[n]?.maxFeePerGas}if(r===x.GasFeeEstimateType.GasPrice){const n=t;e.gasPrice=n.gasPrice}if(r===x.GasFeeEstimateType.Legacy){const a=t;e.gasPrice=a[n]}delete e.maxFeePerGas,delete e.maxPriorityFeePerGas}}n.GasFeePoller=class{constructor({findNetworkClientIdByChainId:e,gasFeeFlows:t,getGasFeeControllerEstimates:n,getProvider:g,getTransactions:T,getTransactionBatches:w,layer1GasFeeFlows:b,messenger:E,onStateChange:y}){a.add(this),this.hub=new R.default,r.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,void 0),h.set(this,void 0),m.set(this,!1),_(this,r,e,"f"),_(this,s,t,"f"),_(this,u,b,"f"),_(this,i,n,"f"),_(this,o,g,"f"),_(this,c,T,"f"),_(this,l,w,"f"),_(this,d,E,"f"),y(()=>{const e=C(this,a,"m",k).call(this),t=C(this,a,"m",I).call(this);e.length||t.length?C(this,a,"m",f).call(this):C(this,a,"m",p).call(this)})}},r=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,m=new WeakMap,a=new WeakSet,f=function(){C(this,m,"f")||(C(this,a,"m",g).call(this),_(this,m,!0,"f"),F("Started polling"))},p=function(){C(this,m,"f")&&(clearTimeout(C(this,h,"f")),_(this,h,undefined,"f"),_(this,m,!1,"f"),F("Stopped polling"))},g=async function e(){await C(this,a,"m",T).call(this),await C(this,a,"m",w).call(this),_(this,h,setTimeout(()=>C(this,a,"m",e).call(this),1e4),"f")},T=async function(){const e=C(this,a,"m",k).call(this);if(!e.length)return;F("Found unapproved transactions",e.length);const t=await C(this,a,"m",A).call(this,e);F("Retrieved gas fee controller data",t),await Promise.all(e.flatMap(e=>{const{chainId:n}=e,r=t.get(n);return C(this,a,"m",b).call(this,e,r)}))},w=async function(){const e=C(this,a,"m",I).call(this);if(!e.length)return;F("Found unapproved transaction batches",e.length);const t=await C(this,a,"m",A).call(this,e);F("Retrieved gas fee controller data",t),await Promise.all(e.flatMap(e=>{const{chainId:n}=e,r=t.get(n);return C(this,a,"m",E).call(this,e,r)}))},b=async function(e,t){const{id:n}=e,[r,s]=await Promise.all([C(this,a,"m",y).call(this,e,t),C(this,a,"m",S).call(this,e)]);(r||s)&&this.hub.emit("transaction-updated",{transactionId:n,gasFeeEstimates:r?.gasFeeEstimates,gasFeeEstimatesLoaded:r?.gasFeeEstimatesLoaded,layer1GasFee:s})},E=async function(e,t){const{id:n}=e,a=new v.default(C(this,o,"f").call(this,e.networkClientId)),r=new j.DefaultGasFeeFlow,s={ethQuery:a,gasFeeControllerData:t,messenger:C(this,d,"f"),transactionMeta:{...e,txParams:{...e.transactions?.[0],from:e.from,gas:e.gas},time:Date.now()}};let i;try{i=(await r.getGasFees(s)).estimates}catch(t){F("Failed to get gas fees for batch",e.id,t)}i&&this.hub.emit("transaction-batch-updated",{transactionBatchId:n,gasFeeEstimates:i,gasFeeEstimatesLoaded:!0})},y=async function(e,t){const{networkClientId:n}=e,a=new v.default(C(this,o,"f").call(this,n)),r=(0,L.getGasFeeFlow)(e,C(this,s,"f"),C(this,d,"f"));r&&F("Found gas fee flow",r.constructor.name,e.id);const i={ethQuery:a,gasFeeControllerData:t,messenger:C(this,d,"f"),transactionMeta:e};let c;if(r)try{c=(await r.getGasFees(i)).estimates}catch(t){F("Failed to get suggested gas fees",e.id,t)}return!c&&e.gasFeeEstimatesLoaded?undefined:(F("Updated gas fee estimates",{gasFeeEstimates:c,transaction:e.id}),{gasFeeEstimates:c,gasFeeEstimatesLoaded:!0})},S=async function(e){const{networkClientId:t}=e,n=C(this,o,"f").call(this,t),a=await(0,M.getTransactionLayer1GasFee)({layer1GasFeeFlows:C(this,u,"f"),messenger:C(this,d,"f"),provider:n,transactionMeta:e});return a&&F("Updated layer 1 gas fee",a,e.id),a},k=function(){return C(this,c,"f").call(this).filter(e=>e.status===x.TransactionStatus.unapproved)},I=function(){return C(this,l,"f").call(this).filter(e=>e.status===x.TransactionStatus.unapproved)},A=async function(e){const t=new Map;for(const n of e){const{chainId:e,networkClientId:a}=n;if(t.has(e))continue;const s=a??C(this,r,"f").call(this,e);t.set(e,s)}F("Extracted network client IDs by chain ID",t);const n=Array.from(t.entries()).map(async([e,t])=>[e,await C(this,i,"f").call(this,{networkClientId:t})]);return new Map(await Promise.all(n))},n.updateTransactionGasProperties=function({gasFeeEstimates:e,gasFeeEstimatesLoaded:t,isTxParamsGasFeeUpdatesEnabled:n,layer1GasFee:a,txMeta:r}){const s=r.userFeeLevel,i=Object.values(x.GasFeeEstimateLevel).includes(s);if(n(r)&&i&&e){const t=r.txParams.type!==x.TransactionEnvelopeType.legacy;D(r.txParams,e,s,t)}e&&(r.gasFeeEstimates=e),t!==undefined&&(r.gasFeeEstimatesLoaded=t),a&&(r.layer1GasFee=a)},n.updateTransactionGasEstimates=function({txMeta:e,userFeeLevel:t}){const{txParams:n,gasFeeEstimates:a}=e;if(!a)return;D(n,a,t,e.txParams.type!==x.TransactionEnvelopeType.legacy)}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/GasFeePoller.cjs"}],[3086,{"../logger.cjs":3096,"../utils/feature-flags.cjs":3103,events:4433},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l,u,d,h,m,f,p,g,T,w,b,E,y=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},S=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)},k=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.IncomingTransactionHelper=void 0;const I=k(e("events")),A=e("../logger.cjs"),_=e("../utils/feature-flags.cjs");n.IncomingTransactionHelper=class{constructor({client:e,getCurrentAccount:t,getLocalTransactions:n,includeTokenTransfers:g,isEnabled:T,messenger:w,remoteTransactionSource:b,trimTransactions:E,updateTransactions:S}){a.add(this),r.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,void 0),h.set(this,void 0),m.set(this,void 0),f.set(this,void 0),p.set(this,void 0),this.hub=new I.default,y(this,r,e,"f"),y(this,s,t,"f"),y(this,i,n,"f"),y(this,o,g,"f"),y(this,c,T??(()=>!0),"f"),y(this,l,!1,"f"),y(this,u,!1,"f"),y(this,d,w,"f"),y(this,h,b,"f"),y(this,f,E,"f"),y(this,p,S,"f")}start(){if(S(this,l,"f"))return;if(!S(this,a,"m",w).call(this))return;const e=S(this,a,"m",b).call(this);(0,A.incomingTransactionsLogger)("Started polling",{interval:e}),y(this,l,!0,"f"),S(this,u,"f")||S(this,a,"m",g).call(this).catch(e=>{(0,A.incomingTransactionsLogger)("Initial polling failed",e)})}stop(){S(this,m,"f")&&clearTimeout(S(this,m,"f")),S(this,l,"f")&&(y(this,l,!1,"f"),(0,A.incomingTransactionsLogger)("Stopped polling"))}async update({isInterval:e,tags:t}={}){const n=S(this,a,"m",E).call(this,t,e);if((0,A.incomingTransactionsLogger)("Checking for incoming transactions",{isInterval:Boolean(e),tags:n}),!S(this,a,"m",w).call(this))return;const r=S(this,s,"f").call(this),c=S(this,o,"f")??!0,l=S(this,p,"f")??!1;let u=[];try{u=await S(this,h,"f").fetchTransactions({address:r.address,includeTokenTransfers:c,tags:n,updateTransactions:l})}catch(e){return void(0,A.incomingTransactionsLogger)("Error while fetching remote transactions",e)}if(!u.length)return;S(this,a,"m",T).call(this,u),(0,A.incomingTransactionsLogger)("Found potential transactions",u.length,u);const d=S(this,i,"f").call(this),m=u.filter(e=>!d.some(t=>t.hash?.toLowerCase()===e.hash?.toLowerCase()&&t.txParams.from?.toLowerCase()===e.txParams.from?.toLowerCase()&&t.type===e.type));if(!m.length)return void(0,A.incomingTransactionsLogger)("All transactions are already known");(0,A.incomingTransactionsLogger)("Found unique transactions",m.length,m);const g=S(this,f,"f").call(this,[...m,...d]),b=m.map(e=>e.id),y=g.filter(e=>b.includes(e.id));y.length?((0,A.incomingTransactionsLogger)("Adding new transactions",y.length,y),this.hub.emit("transactions",y)):(0,A.incomingTransactionsLogger)("All unique transactions truncated due to limit")}},r=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,m=new WeakMap,f=new WeakMap,p=new WeakMap,a=new WeakSet,g=async function e(){y(this,u,!0,"f");try{await this.update({isInterval:!0})}catch(e){console.error("Error while checking incoming transactions",e)}y(this,u,!1,"f"),S(this,l,"f")&&(S(this,m,"f")&&clearTimeout(S(this,m,"f")),y(this,m,setTimeout(()=>S(this,a,"m",e).call(this),S(this,a,"m",b).call(this)),"f"))},T=function(e){e.sort((e,t)=>e.time<t.time?-1:1)},w=function(){return S(this,c,"f").call(this)},b=function(){return(0,_.getIncomingTransactionsPollingInterval)(S(this,d,"f"))},E=function(e,t){const n=[];return S(this,r,"f")&&n.push(S(this,r,"f")),e?.length?n.push(...e):t&&n.push("automatic-polling"),n?.length?n:undefined}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/IncomingTransactionHelper.cjs"}],[3087,{"../logger.cjs":3096,"@metamask/utils":3217,"async-mutex":4008,"eth-method-registry":4379,events:4433},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},u=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.MethodDataHelper=void 0;const h=e("@metamask/utils"),m=e("async-mutex"),f=e("eth-method-registry"),p=d(e("events")),g=e("../logger.cjs"),T=(0,h.createModuleLogger)(g.projectLogger,"method-data");n.MethodDataHelper=class{constructor({getProvider:e,getState:t}){a.add(this),r.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,new m.Mutex),this.hub=new p.default,l(this,r,e,"f"),l(this,s,t,"f"),l(this,i,new Map,"f")}async lookup(e,t){T("lookup",e,t);const n=await u(this,o,"f").acquire();try{const n=u(this,s,"f").call(this)[e];if(n)return T("Cached",n),n;let o=u(this,i,"f").get(t);if(!o){const e=u(this,r,"f").call(this,t);o=new f.MethodRegistry({provider:e}),u(this,i,"f").set(t,o),T("Created registry",t)}const l=await u(this,a,"m",c).call(this,e,o);return T("Result",l),this.hub.emit("update",{fourBytePrefix:e,methodData:l}),l}finally{n()}}},r=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,a=new WeakSet,c=async function(e,t){const n=await t.lookup(e);if(!n)return T("No method found",e),{registryMethod:"",parsedRegistryMethod:{name:undefined,args:undefined}};T("Parsing",n);return{registryMethod:n,parsedRegistryMethod:t.parse(n)}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/MethodDataHelper.cjs"}],[3088,{"../logger.cjs":3096,"async-mutex":4008},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l,u,d,h,m,f,p=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},g=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainTrackingHelper=void 0;const T=e("async-mutex"),w=e("../logger.cjs"),b=(0,w.createModuleLogger)(w.projectLogger,"multichain-tracking");n.MultichainTrackingHelper=class{constructor({findNetworkClientIdByChainId:e,getNetworkClientById:t,getNetworkClientRegistry:n,removePendingTransactionTrackerListeners:T,createNonceTracker:w,createPendingTransactionTracker:E,onNetworkStateChange:y}){a.add(this),r.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,new Map),d.set(this,new Map),this.checkForPendingTransactionAndStartPolling=()=>{for(const[,e]of g(this,d,"f"))e.pendingTransactionTracker.startIfPendingTransactions()},h.set(this,e=>{const t=Object.keys(e),n=Array.from(g(this,d,"f").keys()),r=n.filter(e=>!t.includes(e));r.forEach(e=>{g(this,a,"m",m).call(this,e)});const s=t.filter(e=>!n.includes(e));s.forEach(e=>{g(this,a,"m",f).call(this,e)}),s.length&&b("Added trackers",s),r.length&&b("Removed trackers",r)}),p(this,r,e,"f"),p(this,s,t,"f"),p(this,i,n,"f"),p(this,o,T,"f"),p(this,c,w,"f"),p(this,l,E,"f"),y((e,t)=>{const n=g(this,i,"f").call(this);t.forEach(({op:e,path:t})=>{if("remove"===e&&"networkConfigurations"===t[0]){const e=t[1];delete n[e]}}),g(this,h,"f").call(this,n)})}initialize(){const e=g(this,i,"f").call(this);g(this,h,"f").call(this,e),b("Initialized")}has(e){return g(this,d,"f").has(e)}async acquireNonceLockForChainIdKey({chainId:e,key:t="global"}){let n=g(this,u,"f").get(e);n||(n=new Map,g(this,u,"f").set(e,n));let a=n.get(t);return a||(a=new T.Mutex,n.set(t,a)),await a.acquire()}async getNonceLock(e,t){const n=g(this,s,"f").call(this,t),a=await this.acquireNonceLockForChainIdKey({chainId:n.configuration.chainId,key:e}),r=g(this,d,"f").get(t)?.nonceTracker;if(!r)throw new Error(`Missing nonce tracker for network client ID - ${t}`);try{const t=await r.getNonceLock(e),n=()=>{t.releaseLock(),a?.()};return{...t,releaseLock:n}}catch(e){throw a?.(),e}}stopAllTracking(){for(const[e]of g(this,d,"f"))g(this,a,"m",m).call(this,e)}getNetworkClient({chainId:e,networkClientId:t}){if(!t&&!e)throw new Error("Cannot locate network client without networkClientId or chainId");let n,a=t;try{t&&(n=g(this,s,"f").call(this,t))}catch(n){if(b("No network client found with ID",t),!e)throw n}return!n&&e&&(a=g(this,r,"f").call(this,e),n=g(this,s,"f").call(this,a)),{...n,id:a}}},r=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,a=new WeakSet,m=function(e){const t=g(this,d,"f").get(e);t&&(t.pendingTransactionTracker.stop(),g(this,o,"f").call(this,t.pendingTransactionTracker),g(this,d,"f").delete(e))},f=function(e){if(g(this,d,"f").get(e))return;const{provider:t,blockTracker:n,configuration:{chainId:a}}=g(this,s,"f").call(this,e),r=g(this,c,"f").call(this,{provider:t,blockTracker:n,chainId:a}),i=g(this,l,"f").call(this,{provider:t,blockTracker:n,chainId:a,networkClientId:e});g(this,d,"f").set(e,{nonceTracker:r,pendingTransactionTracker:i})}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/MultichainTrackingHelper.cjs"}],[3089,{"../logger.cjs":3096,"../types.cjs":3097,"../utils/feature-flags.cjs":3103,"./TransactionPoller.cjs":3091,"@metamask/controller-utils":1494,events:4433,lodash:4901},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l,u,d,h,m,f,p,g,T,w,b,E,y,S,k,I,A,_,C,P,v,N,R,j,O,x,L,M,F,D,B,G,U,H,q,K,W=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},$=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)},V=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.PendingTransactionTracker=void 0;const Y=e("@metamask/controller-utils"),Q=V(e("events")),z=e("lodash"),J=e("./TransactionPoller.cjs"),X=e("../logger.cjs"),Z=e("../types.cjs"),ee=e("../utils/feature-flags.cjs"),te=["replacement transaction underpriced","known transaction","gas price too low to replace","transaction with the same hash was already imported","gateway timeout","nonce too low"],ne=(0,X.createModuleLogger)(X.projectLogger,"pending-transactions");n.PendingTransactionTracker=class{constructor({blockTracker:e,getChainId:t,getEthQuery:n,getGlobalLock:k,getNetworkClientId:I,getTransactions:A,isTimeoutEnabled:_,hooks:C,isResubmitEnabled:P,messenger:v,publishTransaction:N}){a.add(this),r.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,void 0),h.set(this,void 0),m.set(this,void 0),f.set(this,void 0),p.set(this,void 0),g.set(this,void 0),T.set(this,void 0),w.set(this,void 0),b.set(this,void 0),E.set(this,void 0),this.startIfPendingTransactions=()=>{const e=$(this,a,"m",x).call(this);e.length?$(this,a,"m",y).call(this,e):this.stop()},this.hub=new Q.default,W(this,s,new Map,"f"),W(this,o,t,"f"),W(this,c,n,"f"),W(this,l,k,"f"),W(this,u,I,"f"),W(this,d,A,"f"),W(this,h,P??(()=>!0),"f"),W(this,m,new Map,"f"),W(this,f,$(this,a,"m",S).bind(this),"f"),W(this,g,v,"f"),W(this,T,N,"f"),W(this,w,!1,"f"),W(this,E,undefined,"f"),W(this,b,new J.TransactionPoller({blockTracker:e,chainId:t(),messenger:v}),"f"),W(this,r,C?.beforeCheckPendingTransaction??(()=>Promise.resolve(!0)),"f"),W(this,i,_,"f"),W(this,p,(0,X.createModuleLogger)(ne,`${t()}:${I()}`),"f")}addTransactionToPoll(e){$(this,a,"m",y).call(this,[e]),W(this,E,e,"f")}async forceCheckTransaction(e){const t=await $(this,l,"f").call(this);try{await $(this,a,"m",v).call(this,e)}catch(e){$(this,p,"f").call(this,"Failed to check transaction",e)}finally{t()}}stop(){$(this,w,"f")&&($(this,b,"f").stop(),W(this,w,!1,"f"),$(this,p,"f").call(this,"Stopped polling"))}},r=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,m=new WeakMap,f=new WeakMap,p=new WeakMap,g=new WeakMap,T=new WeakMap,w=new WeakMap,b=new WeakMap,E=new WeakMap,a=new WeakSet,y=function(e){$(this,b,"f").setPendingTransactions(e),$(this,w,"f")||($(this,b,"f").start($(this,f,"f")),W(this,w,!0,"f"),$(this,p,"f").call(this,"Started polling"))},S=async function(e){const t=await $(this,l,"f").call(this);try{await $(this,a,"m",k).call(this)}catch(e){$(this,p,"f").call(this,"Failed to check transactions",e)}finally{t()}try{await $(this,a,"m",I).call(this,e)}catch(e){$(this,p,"f").call(this,"Failed to resubmit transactions",e)}},k=async function(){$(this,p,"f").call(this,"Checking transactions");const e=[...$(this,a,"m",x).call(this),...$(this,E,"f")?[$(this,E,"f")]:[]];e.length?($(this,p,"f").call(this,"Found pending transactions to check",{count:e.length,ids:e.map(e=>e.id)}),await Promise.all(e.map(e=>$(this,a,"m",v).call(this,e)))):$(this,p,"f").call(this,"No pending transactions to check")},I=async function(e){if(!$(this,h,"f").call(this)||!$(this,w,"f"))return;$(this,p,"f").call(this,"Resubmitting transactions");const t=$(this,a,"m",x).call(this);if(t.length){$(this,p,"f").call(this,"Found pending transactions to resubmit",{count:t.length,ids:t.map(e=>e.id)});for(const n of t)try{await $(this,a,"m",_).call(this,n,e)}catch(e){const t=e.value?.message?.toLowerCase()??e.message?.toLowerCase()??String(e);if($(this,a,"m",A).call(this,t)){$(this,p,"f").call(this,"Ignoring known transaction error",t);continue}$(this,a,"m",L).call(this,n,e.message,"There was an error when resubmitting this transaction.")}}else $(this,p,"f").call(this,"No pending transactions to resubmit")},A=function(e){return te.some(t=>e.includes(t))},_=async function(e,t){if(!$(this,a,"m",C).call(this,e,t))return;if(!await $(this,r,"f").call(this,e))return;const n=$(this,c,"f").call(this,e.networkClientId);await $(this,T,"f").call(this,n,e);const s=(e.retryCount??0)+1;$(this,a,"m",D).call(this,(0,z.merge)({},e,{retryCount:s}),"PendingTransactionTracker:transaction-retry - Retry count increased")},C=function(e,t){const n=(0,z.cloneDeep)(e);n.firstRetryBlockNumber||(n.firstRetryBlockNumber=t,$(this,a,"m",D).call(this,n,"PendingTransactionTracker:#isResubmitDue - First retry block number set"));const{firstRetryBlockNumber:r}=n,s=Number.parseInt(t,16)-Number.parseInt(r,16),i=e.retryCount??0;return s>=Math.min(50,Math.pow(2,i))},P=function(e){const{hash:t,id:n}=e;$(this,E,"f")?.id===n&&W(this,E,undefined,"f"),t&&$(this,m,"f").delete(t)},v=async function(e){const{hash:t,id:n,isIntentComplete:s,txParams:{from:i}}=e;if(s)await $(this,a,"m",N).call(this,e);else{if(!t&&await $(this,r,"f").call(this,e)){const t=new Error("We had an error while submitting this transaction, please try again.");return t.name="NoTxHashError",void $(this,a,"m",M).call(this,e,t)}if($(this,a,"m",O).call(this,e))return $(this,p,"f").call(this,"Nonce already taken",n),void $(this,a,"m",F).call(this,e);try{const n=await $(this,a,"m",B).call(this,t),r="0x1"===n?.status;if("0x0"===n?.status)return $(this,p,"f").call(this,"Transaction receipt has failed status"),void $(this,a,"m",M).call(this,e,new Error("Transaction failed on-chain"));const{blockNumber:s,blockHash:o}=n??{};if(r&&s&&o)return void await $(this,a,"m",N).call(this,e,{...n,blockNumber:s,blockHash:o});$(this,p,"f").call(this,"No receipt status",{hash:t,receipt:n});const c=await $(this,a,"m",H).call(this,i),l=parseInt(c,16);if(!n&&await $(this,a,"m",R).call(this,e,l))return;await $(this,a,"m",j).call(this,e,l)&&$(this,a,"m",F).call(this,e)}catch(t){$(this,p,"f").call(this,"Failed to check transaction",n,t),$(this,a,"m",L).call(this,e,t.message,"There was a problem loading this transaction.")}}},N=async function(e,t){const{id:n}=e,{blockHash:r}=t??{};$(this,p,"f").call(this,"Transaction confirmed",n);const s=$(this,E,"f")?.id===n;if($(this,a,"m",P).call(this,e),s)return void this.hub.emit("transaction-confirmed",e);const i=(0,z.cloneDeep)(e);if(t&&r){const{baseFeePerGas:e,timestamp:n}=await $(this,a,"m",U).call(this,r,!1);i.baseFeePerGas=e,i.blockTimestamp=n,i.txParams={...i.txParams,gasUsed:t.gasUsed},i.txReceipt=t,i.verifiedOnBlockchain=!0}i.status=Z.TransactionStatus.confirmed,$(this,a,"m",D).call(this,i,"PendingTransactionTracker:#onTransactionConfirmed - Transaction confirmed"),this.hub.emit("transaction-confirmed",i)},R=async function(e,t){const{chainId:n,hash:r,id:s,submittedTime:o,txParams:{nonce:c}}=e;if(!r||!c)return!1;if(!$(this,i,"f").call(this,e))return $(this,p,"f").call(this,"Timeout disabled for transaction",e),!1;const l=(0,ee.getTimeoutAttempts)(n,$(this,g,"f"));if(l===undefined||0===l)return $(this,p,"f").call(this,"Timeout disabled due to threshold",{chainId:n,threshold:l}),!1;const u=parseInt(c,16);if(u>t)return $(this,p,"f").call(this,"Skipping timeout as queued transaction",{transactionNonce:u,nextNonce:t}),!1;try{if(null!==await $(this,a,"m",G).call(this,r)){const e=Date.now();return $(this,p,"f").call(this,"Transaction found on network, recording timestamp",s),$(this,m,"f").set(r,e),!1}const t=$(this,m,"f").get(r)??o;if(t===undefined)return $(this,p,"f").call(this,"Transaction not yet seen on network and has no submitted time, skipping timeout check",s),!1;const{blockTime:i}=(0,ee.getAcceleratedPollingParams)(n,$(this,g,"f")),c=Date.now()-t,u=i*l;return $(this,p,"f").call(this,"Checking timeout duration",{transactionId:s,durationSinceLastSeen:c,timeoutDuration:u,threshold:l,blockTime:i}),c<u?!1:($(this,p,"f").call(this,"Hit timeout duration threshold",s),$(this,m,"f").delete(r),$(this,a,"m",M).call(this,e,new Error("Transaction not found on network after timeout")),!0)}catch(e){return $(this,p,"f").call(this,"Failed to check transaction by hash",s,e),!1}},j=async function(e,t){const{hash:n,id:a,txParams:{nonce:r}}=e;if(!r||!n)return!1;if(parseInt(r,16)>=t)return!1;let i=$(this,s,"f").get(n);return i===undefined&&(i=0,$(this,s,"f").set(n,i)),i<3?($(this,p,"f").call(this,"Incrementing dropped block count",{id:a,droppedBlockCount:i}),$(this,s,"f").set(n,i+1),!1):($(this,p,"f").call(this,"Hit dropped block count",a),$(this,s,"f").delete(n),!0)},O=function(e){const{id:t,txParams:n}=e;return $(this,a,"m",q).call(this).some(e=>e.id!==t&&e.txParams.from===n.from&&e.status===Z.TransactionStatus.confirmed&&e.txParams.nonce&&e.txParams.nonce===n.nonce&&e.type!==Z.TransactionType.incoming&&e.isTransfer===undefined)},x=function(){return $(this,a,"m",K).call(this).filter(e=>e.status===Z.TransactionStatus.submitted&&!e.verifiedOnBlockchain&&!e.isUserOperation&&!e.isStateOnly)},L=function(e,t,n){$(this,a,"m",D).call(this,{...e,warning:{error:t,message:n}},"PendingTransactionTracker:#warnTransaction - Warning added")},M=function(e,t){$(this,p,"f").call(this,"Transaction failed",e.id,t),$(this,a,"m",P).call(this,e),this.hub.emit("transaction-failed",e,t)},F=function(e){$(this,p,"f").call(this,"Transaction dropped",e.id),$(this,a,"m",P).call(this,e),this.hub.emit("transaction-dropped",e)},D=function(e,t){this.hub.emit("transaction-updated",e,t)},B=async function(e){return await(0,Y.query)($(this,c,"f").call(this),"getTransactionReceipt",[e])},G=async function(e){return await(0,Y.query)($(this,c,"f").call(this),"getTransactionByHash",[e])},U=async function(e,t){return await(0,Y.query)($(this,c,"f").call(this),"getBlockByHash",[e,t])},H=async function(e){return await(0,Y.query)($(this,c,"f").call(this),"getTransactionCount",[e])},q=function(){const e=$(this,o,"f").call(this);return $(this,d,"f").call(this).filter(t=>t.chainId===e)},K=function(){const e=$(this,u,"f").call(this);return $(this,d,"f").call(this).filter(t=>t.networkClientId===e)}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/PendingTransactionTracker.cjs"}],[3090,{"../logger.cjs":3096,"../types.cjs":3097,"../utils/utils.cjs":3116,"@metamask/utils":3217,"bn.js":4076,lodash:4901},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l,u,d,h=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},m=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.hasSimulationDataChanged=n.shouldResimulate=n.ResimulateHelper=n.RESIMULATE_INTERVAL_MS=n.BLOCK_TIME_ADDITIONAL_SECONDS=n.VALUE_COMPARISON_PERCENT_THRESHOLD=n.BLOCKAID_RESULT_TYPE_MALICIOUS=n.RESIMULATE_PARAMS=void 0;const f=e("@metamask/utils"),p=e("bn.js"),g=e("lodash"),T=e("../logger.cjs"),w=e("../types.cjs"),b=e("../utils/utils.cjs"),E=(0,T.createModuleLogger)(T.projectLogger,"resimulate-helper");n.RESIMULATE_PARAMS=["to","value","data"],n.BLOCKAID_RESULT_TYPE_MALICIOUS="Malicious",n.VALUE_COMPARISON_PERCENT_THRESHOLD=5,n.BLOCK_TIME_ADDITIONAL_SECONDS=60,n.RESIMULATE_INTERVAL_MS=3e3;function y(e,t){return!S(e?.difference??"0x0",t?.difference??"0x0",!1===e?.isDecrease,!1===t?.isDecrease)}function S(e,t,a,r){let s=new p.BN((0,f.remove0x)(e),"hex"),i=new p.BN((0,f.remove0x)(t),"hex");return a&&(s=s.neg()),r&&(i=i.neg()),(0,b.getPercentageChange)(s,i)<=n.VALUE_COMPARISON_PERCENT_THRESHOLD}n.ResimulateHelper=class{constructor({getTransactions:e,simulateTransaction:t,onTransactionsUpdate:n}){a.add(this),r.set(this,new Map),s.set(this,void 0),i.set(this,void 0),h(this,s,e,"f"),h(this,i,t,"f"),n(m(this,a,"m",o).bind(this))}},r=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakSet,o=function(){const e=m(this,s,"f").call(this).filter(e=>e.status===w.TransactionStatus.unapproved),t=new Set(e.map(e=>e.id));new Set([...t,...m(this,r,"f").keys()]).forEach(t=>{const n=e.find(e=>e.id===t);n?.isActive?m(this,a,"m",c).call(this,n):m(this,a,"m",u).call(this,t)})},c=function(e){const{id:t}=e;if(m(this,r,"f").has(t))return;const s=()=>{m(this,i,"f").call(this,e).catch(e=>{E("Error during transaction resimulation",e)}).finally(()=>{m(this,r,"f").has(t)&&m(this,a,"m",l).call(this,t,s)})};m(this,a,"m",l).call(this,t,s),E(`Started resimulating transaction ${t} every ${n.RESIMULATE_INTERVAL_MS} milliseconds`)},l=function(e,t){const a=setTimeout(t,n.RESIMULATE_INTERVAL_MS);m(this,r,"f").set(e,a)},u=function(e){m(this,r,"f").has(e)&&(m(this,a,"m",d).call(this,e),E(`Stopped resimulating transaction ${e} every ${n.RESIMULATE_INTERVAL_MS} milliseconds`))},d=function(e){const t=m(this,r,"f").get(e);t&&(clearTimeout(t),m(this,r,"f").delete(e))},n.shouldResimulate=function(e,t){const{id:a}=t,r=function(e,t){const{id:a,txParams:r}=t,{txParams:s}=e;if(!s||(0,g.isEqual)(s,r))return!1;const i=Object.keys(r).filter(e=>r[e]!==s[e]);return E("Transaction parameters updated",{transactionId:a,updatedProperties:i,originalParams:s,newParams:r}),n.RESIMULATE_PARAMS.some(e=>i.includes(e))}(e,t),s=function(e,t){const{securityAlertResponse:a}=e,{id:r,securityAlertResponse:s}=t;if((0,g.isEqual)(a,s))return!1;return E("Security alert updated",{transactionId:r,originalSecurityAlertResponse:a,newSecurityAlertResponse:s}),s?.result_type===n.BLOCKAID_RESULT_TYPE_MALICIOUS}(e,t),i=function(e,t){const{simulationData:n}=e,{simulationData:a,txParams:r}=t;if(!a||(0,g.isEqual)(n,a))return!1;return!S(r?.value??"0x0",a?.nativeBalanceChange?.difference??"0x0",!1,!1===a?.nativeBalanceChange?.isDecrease)}(e,t),o=r||s||i;let c;if(s||i){c=Math.floor(Date.now()/1e3)+n.BLOCK_TIME_ADDITIONAL_SECONDS}return o&&E("Transaction should be resimulated",{transactionId:a,blockTime:c,parametersUpdated:r,securityAlert:s,valueAndNativeBalanceMismatch:i}),{blockTime:c,resimulate:o}},n.hasSimulationDataChanged=function(e,t){if((0,g.isEqual)(e,t))return!1;if(y(e?.nativeBalanceChange,t?.nativeBalanceChange))return E("Simulation data native balance changed"),!0;if(e.tokenBalanceChanges.length!==t.tokenBalanceChanges.length)return!0;for(const n of e.tokenBalanceChanges){const e=t.tokenBalanceChanges.find(({address:e,id:t})=>e===n.address&&t===n.id);if(!e)return E("Missing new token balance",{address:n.address,id:n.id}),!0;if(y(n,e))return E("Simulation data token balance changed",{originalTokenBalanceChange:n,newTokenBalanceChange:e}),!0}return!1}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/ResimulateHelper.cjs"}],[3091,{"../logger.cjs":3096,"../utils/feature-flags.cjs":3103,"@metamask/utils":3217,lodash:4901},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l,u,d,h,m,f,p,g,T=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},w=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPoller=void 0;const b=e("@metamask/utils"),E=e("lodash"),y=e("../logger.cjs"),S=e("../utils/feature-flags.cjs"),k=(0,b.createModuleLogger)(y.projectLogger,"transaction-poller");n.TransactionPoller=class{constructor({blockTracker:e,chainId:t,messenger:n}){a.add(this),r.set(this,0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,!1),h.set(this,void 0),T(this,s,e,"f"),T(this,i,t,"f"),T(this,o,n,"f")}start(e){w(this,d,"f")||(T(this,l,e,"f"),T(this,d,!0,"f"),w(this,a,"m",m).call(this),k("Started"))}stop(){w(this,d,"f")&&(T(this,d,!1,"f"),T(this,l,undefined,"f"),T(this,r,0,"f"),T(this,u,undefined,"f"),w(this,a,"m",p).call(this),w(this,a,"m",g).call(this),k("Stopped"))}setPendingTransactions(e){const t=(w(this,u,"f")??[]).map(e=>e.id);T(this,u,e,"f");const n=e.map(e=>e.id),s=!(0,E.isEqual)(t,n);w(this,d,"f")&&s&&(k("Detected new pending transactions",n),T(this,r,0,"f"),w(this,c,"f")&&(w(this,a,"m",g).call(this),w(this,a,"m",m).call(this)))}},r=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,a=new WeakSet,m=function e(){if(!w(this,d,"f"))return;const{countMax:t,intervalMs:n}=(0,S.getAcceleratedPollingParams)(w(this,i,"f"),w(this,o,"f"));if(w(this,r,"f")>=t)return T(this,c,e=>w(this,a,"m",f).call(this,!1,e),"f"),w(this,s,"f").on("latest",w(this,c,"f")),void k("Added block tracker listener");w(this,a,"m",p).call(this),T(this,h,setTimeout(async()=>{await w(this,a,"m",f).call(this,!0),w(this,a,"m",e).call(this)},n),"f")},f=async function(e,t){e?k("Accelerated interval",w(this,r,"f")+1):k("Block tracker interval",t);const n=t??await w(this,s,"f").getLatestBlock();await(w(this,l,"f")?.call(this,n)),e&&w(this,d,"f")&&T(this,r,w(this,r,"f")+1,"f")},p=function(){w(this,h,"f")&&(clearTimeout(w(this,h,"f")),T(this,h,undefined,"f"))},g=function(){w(this,c,"f")&&(w(this,s,"f").removeListener("latest",w(this,c,"f")),T(this,c,undefined,"f"))}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/helpers/TransactionPoller.cjs"}],[3092,{"../logger.cjs":3096,"@metamask/utils":3217,lodash:4901},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.CollectPublishHook=void 0;const u=e("@metamask/utils"),d=e("lodash"),h=e("../logger.cjs"),m=(0,u.createModuleLogger)(h.projectLogger,"collect-publish-hook");n.CollectPublishHook=class{constructor(e){a.add(this),r.set(this,void 0),s.set(this,void 0),i.set(this,void 0),c(this,i,(0,u.createDeferredPromise)(),"f"),c(this,r,[],"f"),c(this,s,e,"f")}getHook(){return l(this,a,"m",o).bind(this)}ready(){return l(this,i,"f").promise}success(e){if(m("Success",{transactionHashes:e}),e.length!==l(this,s,"f"))throw new Error("Transaction hash count mismatch");for(let t=0;t<l(this,r,"f").length;t++){const n=l(this,r,"f")[t],a=e[t];n.promise.resolve({transactionHash:a})}}error(e){m("Error",{error:e});for(const t of l(this,r,"f"))t.promise.reject(e)}},r=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakSet,o=function(e,t){const n=e.txParams.nonce??"0x0",a=parseInt(n,16);m("Processing transaction",{nonce:a,signedTx:t,transactionMeta:e});const o=(0,u.createDeferredPromise)();if(l(this,r,"f").push({nonce:a,promise:o,signedTransaction:t}),c(this,r,(0,d.sortBy)(l(this,r,"f"),e=>e.nonce),"f"),l(this,r,"f").length===l(this,s,"f")){m("All transactions signed");const e=l(this,r,"f").map(e=>e.signedTransaction);l(this,i,"f").resolve({signedTransactions:e})}return o.promise}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/hooks/CollectPublishHook.cjs"}],[3093,{"../logger.cjs":3096,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.ExtraTransactionsPublishHook=void 0;const u=e("@metamask/utils"),d=e("../logger.cjs"),h=(0,u.createModuleLogger)(d.projectLogger,"extra-transactions-publish-hook");n.ExtraTransactionsPublishHook=class{constructor({addTransactionBatch:e,getTransaction:t,originalPublishHook:n}){a.add(this),r.set(this,void 0),s.set(this,void 0),i.set(this,void 0),c(this,r,e,"f"),c(this,s,t,"f"),c(this,i,n,"f")}getHook(){return l(this,a,"m",o).bind(this)}},r=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakSet,o=async function(e,t){h("Publishing transaction as batch",{transactionMeta:e,signedTx:t});const{batchTransactions:n,batchTransactionsOptions:a,id:o,networkClientId:c,txParams:d}=e,m=d.from,f=d.to,p=d.data,g=d.value,T=d.gas,w=d.maxFeePerGas,b=d.maxPriorityFeePerGas,E=t,y=(0,u.createDeferredPromise)(),S={existingTransaction:{id:o,onPublish:({newSignature:e,transactionHash:t})=>{if(e){const t=l(this,s,"f").call(this,o);return h("Calling original publish hook with new signature",{latestTransactionMeta:t,newSignature:e}),void l(this,i,"f").call(this,t,e).then(y.resolve).catch(y.reject)}y.resolve({transactionHash:t})},signedTransaction:E},params:{data:p,gas:T,maxFeePerGas:w,maxPriorityFeePerGas:b,to:f,value:g}},k=(n??[]).map(e=>{const{isAfter:t,type:n,...a}=e;return{isAfter:t,params:a,type:n}}),I=[...k.filter(e=>!1===e.isAfter).map(({isAfter:e,...t})=>({...t})),S,...k.filter(e=>e.isAfter===undefined||e.isAfter).map(({isAfter:e,...t})=>({...t}))];h("Adding transaction batch",{from:m,networkClientId:c,transactions:I});const A=a??{disable7702:!0,disableHook:!1,disableSequential:!0};return await l(this,r,"f").call(this,{from:m,networkClientId:c,requireApproval:!1,transactions:I,...A}),y.promise}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/hooks/ExtraTransactionsPublishHook.cjs"}],[3094,{"../logger.cjs":3096,"@metamask/rpc-errors":2698,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l,u,d,h,m,f=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},p=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.SequentialPublishBatchHook=void 0;const g=e("@metamask/rpc-errors"),T=e("@metamask/utils"),w=e("../logger.cjs"),b=(0,T.createModuleLogger)(w.projectLogger,"sequential-publish-batch-hook");n.SequentialPublishBatchHook=class{constructor({publishTransaction:e,getTransaction:t,getPendingTransactionTracker:n,getEthQuery:l}){a.add(this),r.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,{}),f(this,r,e,"f"),f(this,s,t,"f"),f(this,i,l,"f"),f(this,o,n,"f")}getHook(){return p(this,a,"m",l).bind(this)}},r=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,a=new WeakSet,l=async function({from:e,networkClientId:t,transactions:n}){b("Starting sequential publish batch hook",{from:e,networkClientId:t});const c=p(this,o,"f").call(this,t),l=[];for(const e of n)try{const n=p(this,s,"f").call(this,String(e.id)),o=await p(this,r,"f").call(this,p(this,i,"f").call(this,t),n);b("Transaction published",{transactionHash:o});const d={...n,hash:o},h=p(this,a,"m",u).call(this,c,d.id,d.hash);c.addTransactionToPoll(d),await h,l.push({transactionHash:o})}catch(t){throw b("Batch transaction failed",{transaction:e,error:t}),c.stop(),g.rpcErrors.internal("Failed to publish batch transaction")}return b("Sequential publish batch hook completed",{results:l}),c.stop(),{results:l}},u=async function(e,t,n){return new Promise((r,s)=>{const i=p(this,a,"m",d).bind(this,t,n,r,e),o=p(this,a,"m",h).bind(this,t,n,s,e);p(this,c,"f")[t]={onConfirmed:i,onFailedOrDropped:o},e.hub.on("transaction-confirmed",i),e.hub.on("transaction-failed",o),e.hub.on("transaction-dropped",o)})},d=function(e,t,n,r,s){s.id===e&&(b("Transaction confirmed",{transactionHash:t}),p(this,a,"m",m).call(this,r,e),n(s))},h=function(e,t,n,r,s,i){s.id===e&&(b("Transaction failed or dropped",{transactionHash:t,error:i}),p(this,a,"m",m).call(this,r,e),n(new Error(`Transaction ${t} failed or dropped.`)))},m=function(e,t){const n=p(this,c,"f")[t];e.hub.off("transaction-confirmed",n.onConfirmed),e.hub.off("transaction-failed",n.onFailedOrDropped),e.hub.off("transaction-dropped",n.onFailedOrDropped),delete p(this,c,"f")[t]}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/hooks/SequentialPublishBatchHook.cjs"}],[3095,{"./TransactionController.cjs":3072,"./constants.cjs":3075,"./helpers/AccountsApiRemoteTransactionSource.cjs":3084,"./types.cjs":3097,"./utils/gas-flow.cjs":3107,"./utils/prepare.cjs":3111,"./utils/transaction-type.cjs":3115,"./utils/utils.cjs":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.HARDFORK=n.INCOMING_TRANSACTIONS_SUPPORTED_CHAIN_IDS=n.CHAIN_IDS=n.normalizeTransactionParams=n.isEIP1559Transaction=n.mergeGasFeeEstimates=n.determineTransactionType=n.WalletDevice=n.UserFeeLevel=n.TransactionType=n.TransactionStatus=n.TransactionEnvelopeType=n.TransactionContainerType=n.SimulationTokenStandard=n.SimulationErrorCode=n.GasFeeEstimateType=n.GasFeeEstimateLevel=n.TransactionController=n.SPEED_UP_RATE=n.CANCEL_RATE=void 0;var a=e("./TransactionController.cjs");Object.defineProperty(n,"CANCEL_RATE",{enumerable:!0,get:function(){return a.CANCEL_RATE}}),Object.defineProperty(n,"SPEED_UP_RATE",{enumerable:!0,get:function(){return a.SPEED_UP_RATE}}),Object.defineProperty(n,"TransactionController",{enumerable:!0,get:function(){return a.TransactionController}});var r=e("./types.cjs");Object.defineProperty(n,"GasFeeEstimateLevel",{enumerable:!0,get:function(){return r.GasFeeEstimateLevel}}),Object.defineProperty(n,"GasFeeEstimateType",{enumerable:!0,get:function(){return r.GasFeeEstimateType}}),Object.defineProperty(n,"SimulationErrorCode",{enumerable:!0,get:function(){return r.SimulationErrorCode}}),Object.defineProperty(n,"SimulationTokenStandard",{enumerable:!0,get:function(){return r.SimulationTokenStandard}}),Object.defineProperty(n,"TransactionContainerType",{enumerable:!0,get:function(){return r.TransactionContainerType}}),Object.defineProperty(n,"TransactionEnvelopeType",{enumerable:!0,get:function(){return r.TransactionEnvelopeType}}),Object.defineProperty(n,"TransactionStatus",{enumerable:!0,get:function(){return r.TransactionStatus}}),Object.defineProperty(n,"TransactionType",{enumerable:!0,get:function(){return r.TransactionType}}),Object.defineProperty(n,"UserFeeLevel",{enumerable:!0,get:function(){return r.UserFeeLevel}}),Object.defineProperty(n,"WalletDevice",{enumerable:!0,get:function(){return r.WalletDevice}});var s=e("./utils/transaction-type.cjs");Object.defineProperty(n,"determineTransactionType",{enumerable:!0,get:function(){return s.determineTransactionType}});var i=e("./utils/gas-flow.cjs");Object.defineProperty(n,"mergeGasFeeEstimates",{enumerable:!0,get:function(){return i.mergeGasFeeEstimates}});var o=e("./utils/utils.cjs");Object.defineProperty(n,"isEIP1559Transaction",{enumerable:!0,get:function(){return o.isEIP1559Transaction}}),Object.defineProperty(n,"normalizeTransactionParams",{enumerable:!0,get:function(){return o.normalizeTransactionParams}});var c=e("./constants.cjs");Object.defineProperty(n,"CHAIN_IDS",{enumerable:!0,get:function(){return c.CHAIN_IDS}});var l=e("./helpers/AccountsApiRemoteTransactionSource.cjs");Object.defineProperty(n,"INCOMING_TRANSACTIONS_SUPPORTED_CHAIN_IDS",{enumerable:!0,get:function(){return l.SUPPORTED_CHAIN_IDS}});var u=e("./utils/prepare.cjs");Object.defineProperty(n,"HARDFORK",{enumerable:!0,get:function(){return u.HARDFORK}})}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/index.cjs"}],[3096,{"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.incomingTransactionsLogger=n.projectLogger=void 0;const a=e("@metamask/utils");Object.defineProperty(n,"createModuleLogger",{enumerable:!0,get:function(){return a.createModuleLogger}}),n.projectLogger=(0,a.createProjectLogger)("transaction-controller"),n.incomingTransactionsLogger=(0,a.createModuleLogger)(n.projectLogger,"incoming-transactions")}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/logger.cjs"}],[3097,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l,u,d,h;Object.defineProperty(n,"__esModule",{value:!0}),n.SimulationErrorCode=n.SimulationTokenStandard=n.GasFeeEstimateType=n.GasFeeEstimateLevel=n.UserFeeLevel=n.TransactionEnvelopeType=n.TransactionContainerType=n.TransactionType=n.WalletDevice=n.TransactionStatus=void 0,function(e){e.unapproved="unapproved",e.approved="approved",e.signed="signed",e.submitted="submitted",e.confirmed="confirmed",e.failed="failed",e.dropped="dropped",e.rejected="rejected",e.cancelled="cancelled"}(a||(n.TransactionStatus=a={})),function(e){e.MM_MOBILE="metamask_mobile",e.MM_EXTENSION="metamask_extension",e.OTHER="other_device"}(r||(n.WalletDevice=r={})),function(e){e.batch="batch",e.bridge="bridge",e.bridgeApproval="bridgeApproval",e.cancel="cancel",e.contractInteraction="contractInteraction",e.deployContract="contractDeployment",e.ethDecrypt="eth_decrypt",e.ethGetEncryptionPublicKey="eth_getEncryptionPublicKey",e.gasPayment="gas_payment",e.incoming="incoming",e.lendingDeposit="lendingDeposit",e.lendingWithdraw="lendingWithdraw",e.musdConversion="musdConversion",e.perpsDeposit="perpsDeposit",e.personalSign="personal_sign",e.predictBuy="predictBuy",e.predictClaim="predictClaim",e.predictDeposit="predictDeposit",e.predictSell="predictSell",e.predictWithdraw="predictWithdraw",e.relayDeposit="relayDeposit",e.retry="retry",e.revokeDelegation="revokeDelegation",e.simpleSend="simpleSend",e.signTypedData="eth_signTypedData",e.smart="smart",e.stakingClaim="stakingClaim",e.stakingDeposit="stakingDeposit",e.stakingUnstake="stakingUnstake",e.swap="swap",e.swapAndSend="swapAndSend",e.swapApproval="swapApproval",e.tokenMethodApprove="approve",e.tokenMethodSafeTransferFrom="safetransferfrom",e.tokenMethodTransfer="transfer",e.tokenMethodTransferFrom="transferfrom",e.tokenMethodSetApprovalForAll="setapprovalforall",e.tokenMethodIncreaseAllowance="increaseAllowance",e.shieldSubscriptionApprove="shieldSubscriptionApprove"}(s||(n.TransactionType=s={})),function(e){e.EnforcedSimulations="enforcedSimulations"}(i||(n.TransactionContainerType=i={})),function(e){e.legacy="0x0",e.accessList="0x1",e.feeMarket="0x2",e.setCode="0x4"}(o||(n.TransactionEnvelopeType=o={})),function(e){e.CUSTOM="custom",e.DAPP_SUGGESTED="dappSuggested",e.MEDIUM="medium"}(c||(n.UserFeeLevel=c={})),function(e){e.Low="low",e.Medium="medium",e.High="high"}(l||(n.GasFeeEstimateLevel=l={})),function(e){e.FeeMarket="fee-market",e.Legacy="legacy",e.GasPrice="eth_gasPrice"}(u||(n.GasFeeEstimateType=u={})),function(e){e.erc20="erc20",e.erc721="erc721",e.erc1155="erc1155"}(d||(n.SimulationTokenStandard=d={})),function(e){e.ChainNotSupported="chain-not-supported",e.Disabled="disabled",e.InvalidResponse="invalid-response",e.Reverted="reverted"}(h||(n.SimulationErrorCode=h={}))}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/types.cjs"}],[3098,{"../api/simulation-api.cjs":3074,"../constants.cjs":3075,"../errors.cjs":3076,"../logger.cjs":3096,"../types.cjs":3097,"./balance.cjs":3099,"@ethersproject/abi":754,"@metamask/controller-utils":1494,"@metamask/metamask-eth-abis":2376,"@metamask/utils":3217,"bn.js":4076},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getBalanceChanges=n.SupportedToken=void 0;const r=e("@ethersproject/abi"),s=e("@metamask/controller-utils"),i=e("@metamask/metamask-eth-abis"),o=e("@metamask/utils"),c=a(e("bn.js")),l=e("./balance.cjs"),u=e("../api/simulation-api.cjs"),d=e("../constants.cjs"),h=e("../errors.cjs"),m=e("../logger.cjs"),f=e("../types.cjs");var p;!function(e){e.ERC20="erc20",e.ERC721="erc721",e.ERC1155="erc1155",e.ERC20_WRAPPED="erc20Wrapped",e.ERC721_LEGACY="erc721Legacy"}(p||(n.SupportedToken=p={}));const g=(0,o.createModuleLogger)(m.projectLogger,"balance-changes"),T=["Transfer","TransferSingle","TransferBatch","Deposit","Withdrawal"],w={[p.ERC20]:{abi:i.abiERC20,standard:f.SimulationTokenStandard.erc20},[p.ERC721]:{abi:i.abiERC721,standard:f.SimulationTokenStandard.erc721},[p.ERC1155]:{abi:i.abiERC1155,standard:f.SimulationTokenStandard.erc1155},[p.ERC20_WRAPPED]:{abi:d.ABI_SIMULATION_ERC20_WRAPPED,standard:f.SimulationTokenStandard.erc20},[p.ERC721_LEGACY]:{abi:d.ABI_SIMULATION_ERC721_LEGACY,standard:f.SimulationTokenStandard.erc721}},b=["execution reverted","insufficient funds for gas"];function E(e){if(Array.isArray(e))return e.map(E);let t=e;return t=t.toHexString?.()??t,t=t.toLowerCase?.()??t,t}function y(e){return"Transfer"===e.name&&e.tokenStandard===f.SimulationTokenStandard.erc721&&0===parseInt(e.args.from,16)}function S(e){return e.tokenStandard===f.SimulationTokenStandard.erc721?[e.args.tokenId]:e.tokenStandard===f.SimulationTokenStandard.erc1155&&"TransferSingle"===e.name?[e.args.id]:e.tokenStandard===f.SimulationTokenStandard.erc1155&&"TransferBatch"===e.name?e.args.ids:[undefined]}function k(e){switch(e){case f.SimulationTokenStandard.erc721:return new r.Interface(i.abiERC721);case f.SimulationTokenStandard.erc1155:return new r.Interface(i.abiERC1155);default:return new r.Interface(i.abiERC20)}}function I(e,t,n){const a=k(t.standard);try{if(t.standard===f.SimulationTokenStandard.erc721){const t=a.decodeFunctionResult("ownerOf",n.return);return t[0].toLowerCase()===e.toLowerCase()?"0x1":"0x0"}const r=a.decodeFunctionResult("balanceOf",n.return);return(0,s.toHex)(r[0])}catch(e){throw g("Failed to decode balance transaction",e,{token:t,response:n}),new h.SimulationError(`Failed to decode balance transaction for token ${t.address}: ${String(e)}`)}}function A(e,t,n){const a=k(e);switch(e){case f.SimulationTokenStandard.erc721:return a.encodeFunctionData("ownerOf",[n]);case f.SimulationTokenStandard.erc1155:return a.encodeFunctionData("balanceOf",[t,n]);default:return a.encodeFunctionData("balanceOf",[t])}}function _(e){return[...e.logs??[],...(e.calls??[]).map(e=>_(e)).flat()]}function C(e,t,n=0){const a=(0,s.hexToBN)(t).add(new c.default(n)),r=(0,s.hexToBN)(e),i=a.sub(r),o=i.isNeg(),l=(0,s.toHex)(i.abs());return i.isZero()?(g("Balance change is zero"),undefined):{previousBalance:e,newBalance:(0,s.toHex)(a),difference:l,isDecrease:o}}async function P({request:e,params:t,before:n=[],after:a=[]}){const{blockTime:r,chainId:i,ethQuery:o,getSimulationConfig:d,txParams:h}=e,{authorizationList:m}=h,f=h.from,p=m?.map(e=>({address:e.address,from:f})),T=[...n,{authorizationList:p,data:h.data,from:h.from,gas:h.gas,maxFeePerGas:h.maxFeePerGas??h.gasPrice,maxPriorityFeePerGas:h.maxPriorityFeePerGas??h.gasPrice,to:h.to,value:h.value},...a],w=function(e){const{txParams:t}=e,n=(0,s.hexToBN)(t.gas??"0x0"),a=(0,s.hexToBN)(t.maxFeePerGas??t.gasPrice??"0x0"),r=(0,s.hexToBN)(t.value??"0x0"),i=(e.nestedTransactions??[]).map(e=>(0,s.hexToBN)(e.value??"0x0")).reduce((e,t)=>e.add(t),new c.default(0));return n.mul(a).add(r).add(i)}(e),b=(0,s.toHex)(w);g("Required balance",b);const{balanceRaw:E}=await(0,l.getNativeBalance)(f,o),y=(0,s.toHex)(E),S=(0,s.hexToBN)(y);g("Current balance",y);const k=S.lt(w);return await(0,u.simulateTransactions)(i,{...t,getSimulationConfig:d,transactions:T,withGas:!0,withDefaultBlockOverrides:!0,...r&&{blockOverrides:{...t?.blockOverrides,time:(0,s.toHex)(r)}},...k&&{overrides:{...t?.overrides,[f]:{...t?.overrides?.[f],balance:b}}}})}n.getBalanceChanges=async function(e){g("Request",e);try{const t=await P({request:e,params:{withCallTrace:!0,withLogs:!0}}),n=t.transactions?.[0]?.error;if(n)throw new h.SimulationError(n);const a=function(e,t){const n=t.transactions[0];if(!n)return undefined;const{txParams:a}=e,r=a.from,{stateDiff:s}=n,i=s?.pre?.[r]?.balance,o=s?.post?.[r]?.balance;if(!i||!o)return undefined;return C(i,o,n.gasCost)}(e,t),s=function(e){const t=_(e.transactions[0]?.callTrace??{});g("Extracted logs",t);const n=function(){const e=Object.values(p);return new Map(e.map(e=>{const{abi:t}=w[e];return[e,new r.Interface(t)]}))}();return t.map(e=>{const t=function(e,t){const n=Object.values(p);for(const a of n)try{const n=t.get(a),{abi:r,standard:s}=w[a];return{...n.parseLog(e),abi:r,standard:s}}catch{continue}return undefined}(e,n);if(!t)return g("Failed to parse log",e),undefined;const a=t.abi.find(e=>e.name===t.name)?.inputs;if(!a)return g("Failed to find inputs for event",t),undefined;if(!T.includes(t.name))return g("Ignoring unsupported event",t.name,t),undefined;g("Normalizing event args",t.name,t);const r=function(e,t){return e.reduce((e,n,a)=>{const r=t[a].name.replace("_",""),s=E(n);return e[r]=s,e},{})}(t.args,a);return{contractAddress:e.address,tokenStandard:t.standard,name:t.name,args:r,abi:t.abi}}).filter(e=>e!==undefined)}(t);g("Parsed events",s);const i=await async function(e,t){const{txParams:n}=e,a=n.from,r=function(e,t){const n=new Set,a=new Map,r=new Map,s=e.txParams.from,i=t.filter(e=>[e.args.from,e.args.to].includes(s));g("Filtered user events",i);for(const e of i){const t=S(e);g("Extracted token IDs",t);for(const i of t){const t={address:e.contractAddress,standard:e.tokenStandard,id:i},o=JSON.stringify(t);if(n.has(o)){g("Ignoring additional event with same contract and token ID",t);continue}n.add(o);const c=A(e.tokenStandard,s,i),l={from:s,to:e.contractAddress,data:c};y(e)||a.set(t,l),r.set(t,l)}}return{before:a,after:r}}(e,t);g("Generated balance transactions",[...r.after.values()]);const s=r.before.size+r.after.size+1;if(1===s)return[];const i=await P({request:e,before:[...r.before.values()],after:[...r.after.values()]});if(g("Balance simulation response",i),i.transactions.length!==s)throw new h.SimulationInvalidResponseError;let o=0;return[...r.after.keys()].map((e,t)=>{const n=C(!r.before.get(e)?"0x0":I(a,e,i.transactions[o++]),I(a,e,i.transactions[t+r.before.size+1]));return n?{...e,...n}:undefined}).filter(e=>e!==undefined)}(e,s),o=t.transactions?.[0]?.gasUsed;return{simulationData:{nativeBalanceChange:a,tokenBalanceChanges:i},gasUsed:o}}catch(t){g("Failed to get balance changes",t,e);let n=t;b.some(e=>n.message?.includes(e))&&(n=new h.SimulationRevertedError);const{code:a,message:r}=n;return{simulationData:{tokenBalanceChanges:[],error:{code:a,message:r}},gasUsed:undefined}}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/balance-changes.cjs"}],[3099,{"@metamask/controller-utils":1494,"bignumber.js":3122},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isNativeBalanceSufficientForGas=n.getNativeBalance=void 0;const a=e("@metamask/controller-utils"),r=e("bignumber.js");async function s(e,t){const n=await(0,a.query)(t,"getBalance",[e,"latest"]),s=new r.BigNumber(n).toString(10);return{balanceHuman:new r.BigNumber(s).shiftedBy(-18).toString(10),balanceRaw:s}}n.getNativeBalance=s,n.isNativeBalanceSufficientForGas=async function(e,t){const n=e.txParams.from,a=new r.BigNumber(e.txParams.gas??"0x0").multipliedBy(e.txParams.maxFeePerGas??e.txParams.gasPrice??"0x0"),{balanceRaw:i}=await s(n,t);return a.isLessThanOrEqualTo(i)}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/balance.cjs"}],[310,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isSecurityAlertsAPIEnabled=function(){const e="true";return"true"===e.toString()},n.validateWithSecurityAlertsAPI=async function(e,t,n){let r=function(e){const t="https://security-alerts.api.cx.metamask.io";if(!t)throw new Error("Security alerts API URL is not set");return`${t}/${e}`}(`${a}/${e}`);const{newUrl:s,authorization:i}=await(null==n?void 0:n(r))||{};s&&(r=s);const o={"Content-Type":"application/json"};i&&(o.Authorization=i);return async function(e,t){const n=await fetch(e,t);if(!n.ok)throw new Error(`Security alerts API request failed with status: ${n.status}`);return await n.json()}(r,{method:"POST",body:JSON.stringify(t),headers:o})};const a="validate"}}},{package:"$root$",file:"app/scripts/lib/ppom/security-alerts-api.ts"}],[3100,{"../gas-flows/DefaultGasFeeFlow.cjs":3077,"../helpers/GasFeePoller.cjs":3085,"../hooks/CollectPublishHook.cjs":3092,"../hooks/SequentialPublishBatchHook.cjs":3094,"../index.cjs":3095,"../logger.cjs":3096,"../types.cjs":3097,"./eip7702.cjs":3101,"./feature-flags.cjs":3103,"./gas.cjs":3108,"./validation.cjs":3117,"@metamask/controller-utils":1494,"@metamask/rpc-errors":2698,"@metamask/utils":3217,uuid:5796},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isAtomicBatchSupported=n.addTransactionBatch=n.ERROR_MESSAGE_NO_UPGRADE_CONTRACT=void 0;const a=e("@metamask/controller-utils"),r=e("@metamask/rpc-errors"),s=e("@metamask/utils"),i=e("uuid"),o=e("./eip7702.cjs"),c=e("./feature-flags.cjs"),l=e("./gas.cjs"),u=e("./validation.cjs"),d=e("../index.cjs"),h=e("../gas-flows/DefaultGasFeeFlow.cjs"),m=e("../helpers/GasFeePoller.cjs"),f=e("../hooks/CollectPublishHook.cjs"),p=e("../hooks/SequentialPublishBatchHook.cjs"),g=e("../logger.cjs"),T=e("../types.cjs"),w=(0,s.createModuleLogger)(g.projectLogger,"batch");function b(){const e=(0,i.v4)(),t=new Uint8Array((0,i.parse)(e));return(0,s.bytesToHex)(t)}async function E(e,t,n,r,s,i){const{assetsFiatValues:o,existingTransaction:c,params:l,type:u}=t,{addTransaction:h,getTransaction:f,request:p,updateTransaction:g}=r,{from:T,networkClientId:b,origin:E}=p;if(c){const{id:t,onPublish:s}=c;let o=f(t);const u=o.txParams.nonce;let{signedTransaction:d}=c;const h=u?parseInt(u,16):undefined,m=i>0&&h!==undefined?h+i:undefined;if(g({transactionId:t},t=>{t.batchId=e,m&&(t.txParams.nonce=(0,a.toHex)(m))}),m){const e=await y({transactionId:t,request:r});d=e.newSignature,o=e.transactionMeta}return n(o,d).then(s).catch(()=>{}),w("Processed existing transaction with hook",{id:t,params:l}),{id:t,params:l}}const S={...s,txParams:{...l,from:T,gas:s?.gas??l.gas}};s&&(0,m.updateTransactionGasEstimates)({txMeta:S,userFeeLevel:d.GasFeeEstimateLevel.Medium});const{transactionMeta:k}=await h(S.txParams,{assetsFiatValues:o,batchId:e,disableGasBuffer:!0,networkClientId:b,origin:E,publishHook:n,requireApproval:!1,type:u}),{id:I,txParams:A}=k,_={data:A.data,gas:A.gas,maxFeePerGas:A.maxFeePerGas,maxPriorityFeePerGas:A.maxPriorityFeePerGas,to:A.to,value:A.value};return w("Processed new transaction with hook",{id:I,params:_,type:u}),{id:I,params:_,type:u}}async function y({request:e,transactionId:t}){const{getTransaction:n,signTransaction:a}=e,r=n(t);w("Re-signing existing transaction",{transactionId:t,txParams:r.txParams});const s=await a(r);if(!s)throw new Error("Failed to re-sign transaction");const i=n(t);return w("New signature",s),{newSignature:s,transactionMeta:i}}n.ERROR_MESSAGE_NO_UPGRADE_CONTRACT="Upgrade contract address not found",n.addTransactionBatch=async function(e){const{getInternalAccounts:t,messenger:s,request:i}=e,m=(0,c.getBatchSizeLimit)(s);if((0,u.validateBatchRequest)({internalAccounts:t(),request:i,sizeLimit:m}),w("Adding",i),!i.disable7702)try{return await async function(e){const{addTransaction:t,getChainId:a,messenger:s,publicKeyEIP7702:i,request:l}=e,{batchId:u,disableUpgrade:h,from:m,gasFeeToken:f,gasLimit7702:p,networkClientId:g,origin:E,overwriteUpgrade:S,requestId:k,requireApproval:I,securityAlertId:A,skipInitialGasEstimate:_,transactions:C,validateSecurity:P}=l,v=a(g),N=e.getEthQuery(g),R=(0,o.doesChainSupportEIP7702)(v,s);if(!R)throw w("Chain does not support EIP-7702",v),r.rpcErrors.internal("Chain does not support EIP-7702");if(!i)throw r.rpcErrors.internal(o.ERROR_MESSGE_PUBLIC_KEY);let j=!1;if(!h){const{delegationAddress:e,isSupported:t}=await(0,o.isAccountUpgradedToEIP7702)(m,v,i,s,N);if(w("Account",{delegationAddress:e,isSupported:t}),!t&&e&&!S)throw w("Account upgraded to unsupported contract",m,e),r.rpcErrors.internal("Account upgraded to unsupported contract");j=!t,j&&e&&w("Overwriting authorization as already upgraded",{current:e})}const O=await Promise.all(C.map(e=>async function(e,t,n){const{from:a}=e,{params:r,type:s}=t;if(s)return{...r,type:s};const{type:i}=await(0,d.determineTransactionType)({from:a,...r},n);return{...r,type:i}}(l,e,N))),x={...(0,o.generateEIP7702BatchTransaction)(m,O),from:m,gas:p,maxFeePerGas:O[0]?.maxFeePerGas,maxPriorityFeePerGas:O[0]?.maxPriorityFeePerGas};if(j){const e=(0,c.getEIP7702UpgradeContractAddress)(v,s,i);if(!e)throw r.rpcErrors.internal(n.ERROR_MESSAGE_NO_UPGRADE_CONTRACT);x.type=T.TransactionEnvelopeType.setCode,x.authorizationList=[{address:e}]}if(P){const e={method:"eth_sendTransaction",params:[{...x,authorizationList:undefined,type:T.TransactionEnvelopeType.feeMarket}],delegationMock:x.authorizationList?.[0]?.address,origin:E};w("Security request",e),P(e,v).catch(e=>{w("Security validation failed",e)})}w("Adding batch transaction",x,g);const L=u??b(),M=A?{securityAlertId:A}:undefined,F=C.find(e=>e.existingTransaction)?.existingTransaction;if(F)return await async function({batchId:e,existingTransaction:t,nestedTransactions:n,request:a,txParams:r}){const{getTransaction:s,estimateGas:i,updateTransaction:o}=a,c=s(t.id);if(!c)throw new Error("Existing transaction not found");w("Converting existing transaction to 7702",{batchId:e,txParams:r});const{networkClientId:l}=c,u=await i(r,l);w("Estimated gas for converted EIP-7702 transaction",u),o({transactionId:c.id},t=>{var a;t.batchId=e,t.nestedTransactions=n,t.txParams=r,t.txParams.gas=u.gas,t.txParams.gasLimit=u.gas,t.txParams.maxFeePerGas=c.txParams.maxFeePerGas,t.txParams.maxPriorityFeePerGas=c.txParams.maxPriorityFeePerGas,t.txParams.nonce=c.txParams.nonce,(a=t.txParams).type??(a.type=T.TransactionEnvelopeType.feeMarket)});const{newSignature:d}=await y({request:a,transactionId:c.id});t.onPublish?.({transactionHash:undefined,newSignature:d}),w("Transaction updated to EIP-7702",{batchId:e,txParams:r,newSignature:d})}({batchId:L,existingTransaction:F,nestedTransactions:O,request:e,txParams:x}),{batchId:L};const{result:D}=await t(x,{batchId:L,gasFeeToken:f,isGasFeeIncluded:l.isGasFeeIncluded,isGasFeeSponsored:l.isGasFeeSponsored,nestedTransactions:O,networkClientId:g,origin:E,requestId:k,requireApproval:I,securityAlertResponse:M,skipInitialGasEstimate:_,type:T.TransactionType.batch}),B=await D;return w("Batch transaction added",{batchId:L,transactionHash:B}),{batchId:L}}(e)}catch(e){if(!(e instanceof r.JsonRpcError&&"Chain does not support EIP-7702"===e.message))throw e}return await async function(e){const{messenger:t,publishBatchHook:n,request:s,update:i}=e,{from:o,networkClientId:c,origin:u,requireApproval:m,transactions:g}=s;let T,y=!1;w("Adding transaction batch using hook",s);const S=new p.SequentialPublishBatchHook({publishTransaction:e.publishTransaction,getTransaction:e.getTransaction,getEthQuery:e.getEthQuery,getPendingTransactionTracker:e.getPendingTransactionTracker});let{disable7702:k,disableSequential:I}=s;const{disableHook:A,useHook:_}=s;_&&(k=!0,I=!0);let C,P=null;!A&&n?P=n:I||(P=S.getHook(),y=!0);if(!P)throw w("No supported batch methods found",{disable7702:k,disableHook:A,disableSequential:I}),r.rpcErrors.internal("Can't process batch");const v=b(),N=g.map(e=>({...e,origin:u})),R=N.length,j=new f.CollectPublishHook(R);try{m&&(C=await async function({batchId:e,request:t}){const{messenger:n,request:a,isSimulationEnabled:r,getChainId:s,getEthQuery:i,getGasFeeEstimates:o,getSimulationConfig:c,update:u}=t,{from:m,origin:f,networkClientId:p,transactions:g}=a,T=i(p);if(!r())throw new Error("Cannot create transaction batch as simulation not supported");w("Preparing approval data for batch");const b=s(p),{totalGasLimit:E}=await(0,l.simulateGasBatch)({chainId:b,from:m,getSimulationConfig:c,transactions:g}),y=(A={chainId:b,from:m,gas:E,id:e,networkClientId:p,origin:f,transactions:g},{...A,status:d.TransactionStatus.unapproved}),S=new h.DefaultGasFeeFlow,k=await o({networkClientId:p}),I=await S.getGasFees({ethQuery:T,gasFeeControllerData:k,messenger:n,transactionMeta:{...y,txParams:{from:m,gas:E},time:Date.now()}});var A;return y.gasFeeEstimates=I.estimates,w("Saving transaction batch metadata",y),function(e,t){t(t=>{t.transactionBatches=[...t.transactionBatches,e]})}(y,u),y}({batchId:v,request:e}),T=(await async function(e,t){const n=String(e.id),{origin:r}=e,s=a.ApprovalType.TransactionBatch,i={txBatchId:n};return w("Requesting approval for transaction batch",n),await t.call("ApprovalController:addRequest",{id:n,origin:r??a.ORIGIN_METAMASK,requestData:i,expectsResult:!0,type:s},!0)}(C,t)).resultCallbacks);const n=j.getHook(),r=[];let s=0;for(const t of N){const a=await E(v,t,n,e,C,s);r.push(a),s+=1}const{signedTransactions:i}=await j.ready(),u={from:o,networkClientId:c,transactions:r.map((e,t)=>({...e,signedTx:i[t]}))};w("Calling publish batch hook",u);let f=await P(u);if(w("Publish batch hook result",f),!f&&!y&&!I){w("Fallback to sequential publish batch hook due to empty results");const e=S.getHook();f=await e(u)}if(!f?.results?.length)throw new Error("Publish batch hook did not return a result");const p=f.results.map(({transactionHash:e})=>e);return j.success(p),T?.success(),w("Completed batch transaction with hook",p),{batchId:v}}catch(e){throw w("Publish batch hook failed",e),j.error(e),T?.error(e),e}finally{w("Cleaning up publish batch hook",v),function(e,t){e(e=>{e.transactionBatches=e.transactionBatches.filter(e=>e.id!==t)})}(i,v)}}(e)},n.isAtomicBatchSupported=async function(e){const{address:t,chainIds:n,getEthQuery:a,messenger:s,publicKeyEIP7702:i}=e;if(!i)throw r.rpcErrors.internal(o.ERROR_MESSGE_PUBLIC_KEY);const l=(0,c.getEIP7702SupportedChains)(s).filter(e=>!n||n.includes(e)),u=(await Promise.all(l.map(async e=>{try{const n=a(e),{isSupported:r,delegationAddress:l}=await(0,o.isAccountUpgradedToEIP7702)(t,e,i,s,n);return{chainId:e,delegationAddress:l,isSupported:r,upgradeContractAddress:(0,c.getEIP7702UpgradeContractAddress)(e,s,i)}}catch(t){return w("Error checking atomic batch support",e,t),undefined}}))).filter(e=>Boolean(e));return w("Atomic batch supported results",u),u}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/batch.cjs"}],[3101,{"../constants.cjs":3075,"../logger.cjs":3096,"./feature-flags.cjs":3103,"@ethersproject/abi":754,"@ethersproject/contracts":777,"@metamask/controller-utils":1494,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.signAuthorizationList=n.generateEIP7702BatchTransaction=n.isAccountUpgradedToEIP7702=n.getDelegationAddress=n.doesChainSupportEIP7702=n.ERROR_MESSGE_PUBLIC_KEY=n.CALLS_SIGNATURE=n.BATCH_FUNCTION_NAME=n.DELEGATION_PREFIX=void 0;const a=e("@ethersproject/abi"),r=e("@ethersproject/contracts"),s=e("@metamask/controller-utils"),i=e("@metamask/utils"),o=e("./feature-flags.cjs"),c=e("../constants.cjs"),l=e("../logger.cjs");n.DELEGATION_PREFIX="0xef0100",n.BATCH_FUNCTION_NAME="execute",n.CALLS_SIGNATURE="(address,uint256,bytes)[]",n.ERROR_MESSGE_PUBLIC_KEY="EIP-7702 public key not specified";const u=(0,i.createModuleLogger)(l.projectLogger,"eip-7702");async function d(e,t){const a=await(0,s.query)(t,"eth_getCode",[e]),r=(0,i.add0x)(a?.toLowerCase?.()??"");return 48===a?.length&&r.startsWith(n.DELEGATION_PREFIX)?(0,i.add0x)(r.slice(n.DELEGATION_PREFIX.length)):undefined}async function h(e,t,n,a){const r=function(e,t,n){const{chainId:a,nonce:r}=e,{txParams:i,chainId:o}=t,{nonce:c}=i,l=a??o;let d=r;d??(d=(0,s.toHex)(parseInt(c,16)+1+n));const h={...e,chainId:l,nonce:d};return u("Prepared authorization",h),h}(e,t,a),{txParams:o}=t,{from:c}=o,{address:l,chainId:d,nonce:h}=r,m=parseInt(d,16),f=parseInt(h,16),p=await n.call("KeyringController:signEip7702Authorization",{chainId:m,contractAddress:l,from:c,nonce:f}),g=p.slice(0,66),T=(0,i.add0x)(p.slice(66,130)),w=parseInt(p.slice(130,132),16),b={address:l,chainId:d,nonce:h,r:g,s:T,yParity:(0,s.toHex)(w-27==0?0:1)};return u("Signed authorization",b),b}n.doesChainSupportEIP7702=function(e,t){return(0,o.getEIP7702SupportedChains)(t).some(t=>t.toLowerCase()===e.toLowerCase())},n.getDelegationAddress=d,n.isAccountUpgradedToEIP7702=async function(e,t,n,a,r){const s=(0,o.getEIP7702ContractAddresses)(t,a,n),i=await d(e,r),c=Boolean(i&&s.some(e=>e.toLowerCase()===i.toLowerCase()));return{delegationAddress:i,isSupported:c}},n.generateEIP7702BatchTransaction=function(e,t){const s=r.Contract.getInterface(c.ABI_IERC7821),i=t.map(e=>{const{data:t,to:n,value:a}=e;return[n??"0x0000000000000000000000000000000000000000",a??"0x0",t??"0x"]}),o="0x01".padEnd(66,"0"),l=a.defaultAbiCoder.encode([n.CALLS_SIGNATURE],[i]),d=s.encodeFunctionData(n.BATCH_FUNCTION_NAME,[o,l]);return u("Transaction data",d),{data:d,to:e}},n.signAuthorizationList=async function({authorizationList:e,messenger:t,transactionMeta:n}){if(!e)return undefined;const a=[];let r=0;for(const s of e){const e=await h(s,n,t,r);a.push(e),r+=1}return a}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/eip7702.cjs"}],[3102,{"../types.cjs":3097,"@metamask/rpc-errors":2698},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateConfirmedExternalTransaction=void 0;const a=e("@metamask/rpc-errors"),r=e("../types.cjs");n.validateConfirmedExternalTransaction=function(e,t,n){if(!e?.txParams)throw a.rpcErrors.invalidParams('"transactionMeta" or "transactionMeta.txParams" is missing');if(e.status!==r.TransactionStatus.confirmed)throw a.rpcErrors.invalidParams('External transaction status should be "confirmed"');const s=e.txParams.nonce;if(n&&n.length>0){if(n.find(e=>e.txParams?.nonce===s))throw a.rpcErrors.invalidParams("External transaction nonce should not be in pending txs")}if(t&&t.length>0){if(t.find(e=>e.txParams?.nonce===s))throw a.rpcErrors.invalidParams("External transaction nonce should not be in confirmed txs")}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/external-transactions.cjs"}],[3103,{"../logger.cjs":3096,"./signature.cjs":3113,"./utils.cjs":3116,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getTimeoutAttempts=n.getIncomingTransactionsPollingInterval=n.getGasEstimateBuffer=n.getGasEstimateFallback=n.getGasFeeRandomisation=n.getAcceleratedPollingParams=n.getBatchSizeLimit=n.getEIP7702UpgradeContractAddress=n.getEIP7702ContractAddresses=n.getEIP7702SupportedChains=n.FeatureFlag=void 0;const a=e("@metamask/utils"),r=e("./signature.cjs"),s=e("./utils.cjs"),i=e("../logger.cjs");var o;!function(e){e.EIP7702="confirmations_eip_7702",e.GasBuffer="confirmations_gas_buffer",e.IncomingTransactions="confirmations_incoming_transactions",e.Transactions="confirmations_transactions"}(o||(n.FeatureFlag=o={}));const c=(0,a.createModuleLogger)(i.projectLogger,"feature-flags");function l(e,t,n){const a=u(t);return(a?.[o.EIP7702]?.contracts?.[e.toLowerCase()]??[]).filter(t=>(0,r.isValidSignature)([t.address,(0,s.padHexToEvenLength)(e)],t.signature,n)).map(e=>e.address)}function u(e){const t=e.call("RemoteFeatureFlagController:getState").remoteFeatureFlags;return c("Retrieved feature flags",t),t}n.getEIP7702SupportedChains=function(e){const t=u(e);return t?.[o.EIP7702]?.supportedChains??[]},n.getEIP7702ContractAddresses=l,n.getEIP7702UpgradeContractAddress=function(e,t,n){return l(e,t,n)?.[0]},n.getBatchSizeLimit=function(e){const t=u(e);return t?.[o.Transactions]?.batchSizeLimit??10},n.getAcceleratedPollingParams=function(e,t){const n=u(t),a=n?.[o.Transactions]?.acceleratedPolling,r=a?.perChainConfig?.[e]?.countMax??a?.defaultCountMax??10,s=a?.perChainConfig?.[e]?.intervalMs??a?.defaultIntervalMs??3e3;return{blockTime:a?.perChainConfig?.[e]?.blockTime??12e3,countMax:r,intervalMs:s}},n.getGasFeeRandomisation=function(e){const t=u(e),n=t?.[o.Transactions]?.gasFeeRandomisation??{};return{randomisedGasFeeDigits:n.randomisedGasFeeDigits??{},preservedNumberOfDigits:n.preservedNumberOfDigits}},n.getGasEstimateFallback=function(e,t){const n=u(t),a=n?.[o.Transactions]?.gasEstimateFallback,r=a?.perChainConfig?.[e],s=r?.percentage??a?.default?.percentage??35;return{fixed:r?.fixed??a?.default?.fixed,percentage:s}},n.getGasEstimateBuffer=function({chainId:e,isCustomRPC:t,isUpgradeWithDataToSelf:n,messenger:a}){const r=u(a),s=r?.[o.GasBuffer],i=s?.perChainConfig?.[e],c=t?undefined:i?.included,l=t?undefined:s?.included;return(n?i?.eip7702:undefined)??c??i?.base??l??s?.default??1},n.getIncomingTransactionsPollingInterval=function(e){const t=u(e);return t?.[o.IncomingTransactions]?.pollingIntervalMs??24e4},n.getTimeoutAttempts=function(e,t){const n=u(t),a=n?.[o.Transactions]?.timeoutAttempts;return a?.perChainConfig?.[e]??a?.default}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/feature-flags.cjs"}],[3104,{"../api/accounts-api.cjs":3073,"../logger.cjs":3096,"../types.cjs":3097,"./transaction-type.cjs":3115,"./validation.cjs":3117,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.updateFirstTimeInteraction=void 0;const a=e("@metamask/utils"),r=e("./transaction-type.cjs"),s=e("./validation.cjs"),i=e("../api/accounts-api.cjs"),o=e("../logger.cjs"),c=e("../types.cjs");n.updateFirstTimeInteraction=async function({existingTransactions:e,getTransaction:t,isFirstTimeInteractionEnabled:n,trace:l,traceContext:u,transactionMeta:d,updateTransaction:h}){if(!n())return;const{chainId:m,id:f,txParams:{data:p,from:g,to:T},type:w}=d;let b;if(p&&[c.TransactionType.tokenMethodTransfer,c.TransactionType.tokenMethodTransferFrom].includes(w)){const e=(0,r.decodeTransactionData)(p);b=e?.args?._to??e?.args?.to}b??(b=T);const E={chainId:(0,a.hexToNumber)(m),to:b,from:g};if((0,s.validateParamTo)(b),!e.find(e=>e.chainId===m&&e.txParams.from.toLowerCase()===g.toLowerCase()&&e.txParams.to?.toLowerCase()===T?.toLowerCase()&&e.id!==f))try{const{count:e}=await l({name:"Account Address Relationship",parentContext:u},()=>(0,i.getAccountAddressRelationship)(E)),n=e===undefined?undefined:0===e;if(!t(f))return void(0,o.projectLogger)("Cannot update first time interaction as transaction not found",f);h({transactionId:f,note:"TransactionController#updateFirstInteraction - Update first time interaction"},e=>{e.isFirstTimeInteraction=n}),(0,o.projectLogger)("Updated first time interaction",f,{isFirstTimeInteraction:n})}catch(e){(0,o.projectLogger)("Error fetching account address relationship, skipping first time interaction update",e)}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/first-time-interaction.cjs"}],[3105,{"../api/simulation-api.cjs":3074,"../logger.cjs":3096,"./balance.cjs":3099,"./batch.cjs":3100,"./eip7702.cjs":3101,"./feature-flags.cjs":3103,"@metamask/rpc-errors":2698,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.checkGasFeeTokenBeforePublish=n.getGasFeeTokens=void 0;const a=e("@metamask/rpc-errors"),r=e("@metamask/utils"),s=e("./balance.cjs"),i=e("./batch.cjs"),o=e("./eip7702.cjs"),c=e("./feature-flags.cjs"),l=e("../api/simulation-api.cjs"),u=e("../logger.cjs"),d=(0,r.createModuleLogger)(u.projectLogger,"gas-fee-tokens");n.getGasFeeTokens=async function({chainId:e,isEIP7702GasFeeTokensEnabled:t,messenger:n,publicKeyEIP7702:r,transactionMeta:s,getSimulationConfig:u}){const{delegationAddress:h,txParams:m}=s,{authorizationList:f}=m,p=m.data,g=m.from,T=m.to,w=m.value;d("Request",{chainId:e,txParams:m});const b=await t(s)&&(0,o.doesChainSupportEIP7702)(e,n);let E=f?.map(e=>({address:e.address,from:g}));!b||h||E||(E=function({chainId:e,from:t,messenger:n,publicKeyEIP7702:r}){if(!r)throw a.rpcErrors.internal(o.ERROR_MESSGE_PUBLIC_KEY);const s=(0,c.getEIP7702UpgradeContractAddress)(e,n,r);if(!s)throw a.rpcErrors.internal(i.ERROR_MESSAGE_NO_UPGRADE_CONTRACT);return[{address:s,from:t}]}({chainId:e,from:g,messenger:n,publicKeyEIP7702:r}));try{const t=await(0,l.simulateTransactions)(e,{getSimulationConfig:u,transactions:[{authorizationList:E,data:p,from:g,to:T,value:w}],suggestFees:{withTransfer:!0,withFeeTransfer:!0,with7702:b}});d("Response",t);const n=function(e){const t=e.transactions?.[0]?.fees?.[0],n=e.sponsorship?.isSponsored??!1;return{gasFeeTokens:(t?.tokenFees??[]).map(e=>({amount:e.balanceNeededToken,balance:e.currentBalanceToken,decimals:e.token.decimals,fee:e.serviceFee,gas:t.gas,gasTransfer:e.transferEstimate,maxFeePerGas:t.maxFeePerGas,maxPriorityFeePerGas:t.maxPriorityFeePerGas,rateWei:e.rateWei,recipient:e.feeRecipient,symbol:e.token.symbol,tokenAddress:e.token.address})),isGasFeeSponsored:n}}(t);return d("Gas fee tokens",n),n}catch(e){return d("Failed to gas fee tokens",e),{gasFeeTokens:[],isGasFeeSponsored:!1}}},n.checkGasFeeTokenBeforePublish=async function({ethQuery:e,fetchGasFeeTokens:t,transaction:n,updateTransaction:a}){const{isGasFeeTokenIgnoredIfBalance:r,selectedGasFeeToken:i}=n;if(!i||!r)return;if(d("Checking gas fee token before publish",{selectedGasFeeToken:i}),await(0,s.isNativeBalanceSufficientForGas)(n,e))return d("Ignoring gas fee token before publish due to sufficient native balance"),void a(n.id,e=>{e.isExternalSign=!1,e.selectedGasFeeToken=undefined});const o=await t({...n,isExternalSign:!0});if(a(n.id,e=>{e.gasFeeTokens=o,e.isExternalSign=!0,e.txParams.nonce=undefined}),d("Updated gas fee tokens before publish",o),!o?.some(e=>e.tokenAddress.toLowerCase()===i.toLowerCase()))throw new Error("Gas fee token not found and insufficient native balance");d("Publishing with selected gas fee token",{selectedGasFeeToken:i})}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/gas-fee-tokens.cjs"}],[3106,{"../logger.cjs":3096,"../types.cjs":3097,"./gas-flow.cjs":3107,"./swaps.cjs":3114,"@metamask/controller-utils":1494,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.gweiDecimalToWeiDecimal=n.gweiDecimalToWeiHex=n.updateGasFees=void 0;const a=e("@metamask/controller-utils"),r=e("@metamask/utils"),s=e("./gas-flow.cjs"),i=e("./swaps.cjs"),o=e("../logger.cjs"),c=e("../types.cjs"),l=(0,r.createModuleLogger)(o.projectLogger,"gas-fees");function u(e){return(0,a.toHex)((0,a.gweiDecToWEIBN)(e))}n.updateGasFees=async function(e){const{txMeta:t}=e,n={...t.txParams},o=i.SWAP_TRANSACTION_TYPES.includes(t.type)?undefined:e.getSavedGasFees(t.chainId),d=await async function(e){const{eip1559:t,ethQuery:n,gasFeeFlows:i,getGasFeeEstimates:o,messenger:u,txMeta:d}=e,{networkClientId:h}=d;if(!t&&d.txParams.gasPrice||t&&d.txParams.maxFeePerGas&&d.txParams.maxPriorityFeePerGas)return{};const m=(0,s.getGasFeeFlow)(d,i,u);try{const e=await o({networkClientId:h}),t=await m.getGasFees({ethQuery:n,gasFeeControllerData:e,messenger:u,transactionMeta:d}),a=t.estimates?.type;switch(a){case c.GasFeeEstimateType.FeeMarket:return t.estimates.medium;case c.GasFeeEstimateType.Legacy:return{gasPrice:t.estimates.medium};case c.GasFeeEstimateType.GasPrice:return{gasPrice:t.estimates.gasPrice};default:throw new Error(`Unsupported gas fee estimate type returned from flow: ${a}`)}}catch(e){l("Failed to get suggested gas fees",e)}const f=await(0,a.query)(n,"gasPrice");return{gasPrice:f?(0,r.add0x)(f.toString(16)):undefined}}(e);l("Suggested gas fees",d);const h={...e,initialParams:n,savedGasFees:o,suggestedGasFees:d};t.txParams.maxFeePerGas=function(e){const{savedGasFees:t,eip1559:n,initialParams:a,suggestedGasFees:r}=e;if(!n)return undefined;if(t){const e=u(t.maxBaseFee);return l("Using maxFeePerGas from savedGasFees",e),e}if(a.maxFeePerGas)return l("Using maxFeePerGas from request",a.maxFeePerGas),a.maxFeePerGas;if(a.gasPrice&&!a.maxPriorityFeePerGas)return l("Setting maxFeePerGas to gasPrice from request",a.gasPrice),a.gasPrice;if(r.maxFeePerGas)return l("Using suggested maxFeePerGas",r.maxFeePerGas),r.maxFeePerGas;if(r.gasPrice)return l("Setting maxFeePerGas to suggested gasPrice",r.gasPrice),r.gasPrice;return l("maxFeePerGas not set"),undefined}(h),t.txParams.maxPriorityFeePerGas=function(e){const{eip1559:t,initialParams:n,savedGasFees:a,suggestedGasFees:r,txMeta:s}=e;if(!t)return undefined;if(a){const e=u(a.priorityFee);return l("Using maxPriorityFeePerGas from savedGasFees.priorityFee",e),e}if(n.maxPriorityFeePerGas)return l("Using maxPriorityFeePerGas from request",n.maxPriorityFeePerGas),n.maxPriorityFeePerGas;if(n.gasPrice&&!n.maxFeePerGas)return l("Setting maxPriorityFeePerGas to gasPrice from request",n.gasPrice),n.gasPrice;if(r.maxPriorityFeePerGas)return l("Using suggested maxPriorityFeePerGas",r.maxPriorityFeePerGas),r.maxPriorityFeePerGas;if(s.txParams.maxFeePerGas)return l("Setting maxPriorityFeePerGas to maxFeePerGas",s.txParams.maxFeePerGas),s.txParams.maxFeePerGas;return l("maxPriorityFeePerGas not set"),undefined}(h),t.txParams.gasPrice=function(e){const{eip1559:t,initialParams:n,suggestedGasFees:a}=e;if(t)return undefined;if(n.gasPrice)return l("Using gasPrice from request",n.gasPrice),n.gasPrice;if(a.maxFeePerGas)return l("Using suggested maxFeePerGas",a.maxFeePerGas),a.maxFeePerGas;if(a.gasPrice)return l("Using suggested gasPrice",a.gasPrice),a.gasPrice;return l("gasPrice not set"),undefined}(h),t.userFeeLevel=function(e){const{initialParams:t,savedGasFees:n,suggestedGasFees:r,txMeta:s}=e;if(n)return c.UserFeeLevel.CUSTOM;if(!t.maxFeePerGas&&!t.maxPriorityFeePerGas&&t.gasPrice)return s.origin===a.ORIGIN_METAMASK?c.UserFeeLevel.CUSTOM:c.UserFeeLevel.DAPP_SUGGESTED;if(!t.maxFeePerGas&&!t.maxPriorityFeePerGas&&r.maxFeePerGas&&r.maxPriorityFeePerGas)return c.UserFeeLevel.MEDIUM;if(!t.maxFeePerGas&&!t.maxPriorityFeePerGas&&r.gasPrice)return c.UserFeeLevel.MEDIUM;if(s.origin===a.ORIGIN_METAMASK)return c.UserFeeLevel.MEDIUM;return c.UserFeeLevel.DAPP_SUGGESTED}(h),l("Updated gas fee properties",{maxFeePerGas:t.txParams.maxFeePerGas,maxPriorityFeePerGas:t.txParams.maxPriorityFeePerGas,gasPrice:t.txParams.gasPrice}),(t.txParams.maxFeePerGas||t.txParams.maxPriorityFeePerGas)&&delete t.txParams.gasPrice,t.txParams.gasPrice&&(delete t.txParams.maxFeePerGas,delete t.txParams.maxPriorityFeePerGas),function(e){e.defaultGasEstimates??(e.defaultGasEstimates={}),e.defaultGasEstimates.maxFeePerGas=e.txParams.maxFeePerGas,e.defaultGasEstimates.maxPriorityFeePerGas=e.txParams.maxPriorityFeePerGas,e.defaultGasEstimates.gasPrice=e.txParams.gasPrice,e.defaultGasEstimates.estimateType=e.userFeeLevel}(t)},n.gweiDecimalToWeiHex=u,n.gweiDecimalToWeiDecimal=function(e){return(1e9*Number(e)).toString().split(".")[0]}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/gas-fees.cjs"}],[3107,{"../types.cjs":3097,"@metamask/controller-utils":1494},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.mergeGasFeeEstimates=n.getGasFeeFlow=void 0;const a=e("@metamask/controller-utils"),r=e("../types.cjs");function s(e,t){return(0,a.weiHexToGweiDec)(e[t])}n.getGasFeeFlow=function(e,t,n){return t.find(t=>t.matchesTransaction({transactionMeta:e,messenger:n}))},n.mergeGasFeeEstimates=function({gasFeeControllerEstimates:e,transactionGasFeeEstimates:t}){const n=t.type;return n===r.GasFeeEstimateType.FeeMarket?Object.values(r.GasFeeEstimateLevel).reduce((n,r)=>{return{...n,[r]:(s=e?.[r],i=t[r],{...s,suggestedMaxFeePerGas:(0,a.weiHexToGweiDec)(i.maxFeePerGas),suggestedMaxPriorityFeePerGas:(0,a.weiHexToGweiDec)(i.maxPriorityFeePerGas)})};var s,i},{...e}):n===r.GasFeeEstimateType.Legacy?Object.values(r.GasFeeEstimateLevel).reduce((e,n)=>({...e,[n]:s(t,n)}),{}):n===r.GasFeeEstimateType.GasPrice?{gasPrice:(i=t,(0,a.weiHexToGweiDec)(i.gasPrice))}:e;var i}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/gas-flow.cjs"}],[3108,{"../api/simulation-api.cjs":3074,"../logger.cjs":3096,"../types.cjs":3097,"./eip7702.cjs":3101,"./feature-flags.cjs":3103,"@metamask/controller-utils":1494,"@metamask/utils":3217,"bignumber.js":3122},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.simulateGasBatch=n.addGasBuffer=n.estimateGasBatch=n.estimateGas=n.updateGas=n.DUMMY_AUTHORIZATION_SIGNATURE=n.INTRINSIC_GAS=n.MAX_GAS_BLOCK_PERCENT=n.DEFAULT_GAS_MULTIPLIER=n.FIXED_GAS=n.log=void 0;const a=e("@metamask/controller-utils"),r=e("@metamask/utils"),s=e("bignumber.js"),i=e("./eip7702.cjs"),o=e("./feature-flags.cjs"),c=e("../api/simulation-api.cjs"),l=e("../logger.cjs"),u=e("../types.cjs");async function d({chainId:e,ethQuery:t,ignoreDelegationSignatures:s,isSimulationEnabled:i,getSimulationConfig:c,messenger:l,txParams:d}){const h={...d},{authorizationList:m,data:g,from:T,value:w,to:b}=h;if(s&&!i)throw new Error("Gas estimation with ignored delegation signatures is not supported as simulation disabled");const{gasLimit:E,number:y}=await async function(e){return await(0,a.query)(e,"getBlockByNumber",["latest",!1])}(t),S=(0,a.hexToBN)(E),{percentage:k,fixed:I}=(0,o.getGasEstimateFallback)(e,l),A=I?(0,a.toHex)(I):(0,a.BNToHex)((0,a.fractionBN)(S,k,100));(0,n.log)("Estimation fallback values",A),h.data=g?(0,r.add0x)(g):g,h.value=w??"0x0",h.authorizationList=function(e,t){return e?.map(e=>({...e,chainId:e.chainId??t,nonce:e.nonce??"0x1",r:e.r??n.DUMMY_AUTHORIZATION_SIGNATURE,s:e.s??n.DUMMY_AUTHORIZATION_SIGNATURE,yParity:e.yParity??"0x1"}))}(h.authorizationList,e),delete h.gasPrice,delete h.maxFeePerGas,delete h.maxPriorityFeePerGas;let _,C=A;const P=d.type===u.TransactionEnvelopeType.setCode&&Boolean(m?.length)&&Boolean(g)&&"0x"!==g&&T?.toLowerCase()===b?.toLowerCase();try{C=i&&P?await async function(e,t,r,s){const i=await(0,a.query)(t,"estimateGas",[{...e,data:"0x"}]);(0,n.log)("Upgrade only gas",i);const o=e.authorizationList?.[0].address;let c;try{c=await f({chainId:r,delegationAddress:o,getSimulationConfig:s,transaction:e})}catch(e){(0,n.log)("Error while simulating data portion of upgrade",e)}if(c===undefined){try{c=await p(t,{...e,authorizationList:undefined,type:undefined},o)}catch(e){throw(0,n.log)("Error while estimating data portion of upgrade",e),e}(0,n.log)("Success estimating data portion of upgrade",c)}(0,n.log)("Execute gas",c);const l=(0,a.BNToHex)((0,a.hexToBN)(i).add((0,a.hexToBN)(c)).subn(n.INTRINSIC_GAS));return(0,n.log)("Total type 4 gas",l),l}(h,t,e,c):s&&i?await f({chainId:e,getSimulationConfig:c,transaction:h}):await p(t,h)}catch(e){_={reason:e.message,errorKey:e.errorKey,debug:{blockNumber:y,blockGasLimit:E}},(0,n.log)("Estimation failed",{..._,fallback:A})}return{blockGasLimit:E,estimatedGas:C,isUpgradeWithDataToSelf:P,simulationFails:_}}function h(e,t,s){const i=(0,a.hexToBN)(e),o=(0,a.fractionBN)((0,a.hexToBN)(t),n.MAX_GAS_BLOCK_PERCENT,100),c=(0,a.fractionBN)(i,100*s,100);if(i.gt(o)){const t=(0,r.add0x)(e);return(0,n.log)("Using estimated value",t),t}if(c.lt(o)){const e=(0,r.add0x)((0,a.BNToHex)(c));return(0,n.log)("Using padded estimate",e,s),e}const l=(0,r.add0x)((0,a.BNToHex)(o));return(0,n.log)("Using 90% of block gas limit",l),l}async function m({chainId:e,from:t,getSimulationConfig:r,transactions:s}){try{const n=await(0,c.simulateTransactions)(e,{getSimulationConfig:r,transactions:s.map(e=>({...e.params,from:t}))});if(!n?.transactions||n.transactions.length!==s.length)throw new Error("Simulation response does not match transaction count");return n.transactions.reduce((e,t)=>{const n=t?.gasLimit;if(!n)throw new Error("No simulated gas returned for one of the transactions");return e.gasLimits.push(n),e.totalGasLimit=(0,a.BNToHex)((0,a.hexToBN)(e.totalGasLimit).add((0,a.hexToBN)(n))),e},{totalGasLimit:"0x0",gasLimits:[]})}catch(e){throw(0,n.log)("Error while simulating gas batch",e),new Error("Cannot estimate transaction batch total gas as simulation failed")}}async function f({chainId:e,delegationAddress:t,getSimulationConfig:n,transaction:a}){const s=await(0,c.simulateTransactions)(e,{getSimulationConfig:n,transactions:[{to:a.to,from:a.from,data:a.data,value:a.value}],overrides:{[a.from]:{code:t&&i.DELEGATION_PREFIX+(0,r.remove0x)(t)}}}),o=s?.transactions?.[0].gasLimit;if(!o)throw new Error("No simulated gas returned");return o}function p(e,t,n){const{from:s}=t,o=[t];return n&&(o.push("latest"),o.push({[s]:{code:i.DELEGATION_PREFIX+(0,r.remove0x)(n)}})),(0,a.query)(e,"estimateGas",o)}n.log=(0,r.createModuleLogger)(l.projectLogger,"gas"),n.FIXED_GAS="0x5208",n.DEFAULT_GAS_MULTIPLIER=1.5,n.MAX_GAS_BLOCK_PERCENT=90,n.INTRINSIC_GAS=21e3,n.DUMMY_AUTHORIZATION_SIGNATURE="0x1111111111111111111111111111111111111111111111111111111111111111",n.updateGas=async function(e){const{txMeta:t}=e,r={...t.txParams},[s,i,c]=await async function(e){const{chainId:t,isCustomNetwork:r,isSimulationEnabled:s,getSimulationConfig:i,messenger:c,txMeta:l}=e,{disableGasBuffer:m}=l;if(l.txParams.gas)return(0,n.log)("Using value from request",l.txParams.gas),[l.txParams.gas,undefined,l.txParams.gas];if(await async function({ethQuery:e,txMeta:t,isCustomNetwork:n}){const{txParams:{to:r,data:s,type:i}}=t;if(n||!r||s||i===u.TransactionEnvelopeType.setCode)return!1;const o=await async function(e,t){return await(0,a.query)(e,"getCode",[t])}(e,r);return!o||"0x"===o}(e))return(0,n.log)("Using fixed value",n.FIXED_GAS),[n.FIXED_GAS,undefined,n.FIXED_GAS];const{blockGasLimit:f,estimatedGas:p,isUpgradeWithDataToSelf:g,simulationFails:T}=await d({chainId:t,ethQuery:e.ethQuery,isSimulationEnabled:s,getSimulationConfig:i,messenger:c,txParams:l.txParams});(0,n.log)("Original estimated gas",p),T&&(0,n.log)("Using original fallback estimate as simulation failed");m&&(0,n.log)("Gas buffer disabled");if(T||m)return[p,T,p];const w=(0,o.getGasEstimateBuffer)({chainId:t,isCustomRPC:r,isUpgradeWithDataToSelf:g,messenger:c});(0,n.log)("Buffer",w);const b=h(p,f,w);return(0,n.log)("Buffered gas",b),[b,T,p]}(e);t.txParams.gas=s,t.simulationFails=i,t.gasLimitNoBuffer=c,r.gas||(t.originalGasEstimate=t.txParams.gas),t.defaultGasEstimates??(t.defaultGasEstimates={}),t.defaultGasEstimates.gas=t.txParams.gas},n.estimateGas=d,n.estimateGasBatch=async function({chainId:e,ethQuery:t,from:a,getSimulationConfig:r,isAtomicBatchSupported:o,messenger:c,transactions:l}){const h=(await o({address:a,chainIds:[e]})).find(t=>t.chainId===e),f=Boolean(h&&!h.isSupported);if(f&&!h?.upgradeContractAddress)throw new Error("Upgrade contract address not found");if(h){const o=f?[{address:h.upgradeContractAddress}]:undefined,m=f?u.TransactionEnvelopeType.setCode:undefined,p={...(0,i.generateEIP7702BatchTransaction)(a,l),authorizationList:o,from:a,type:m},{estimatedGas:g}=await d({chainId:e,ethQuery:t,isSimulationEnabled:!0,getSimulationConfig:r,messenger:c,txParams:p}),T=new s.BigNumber(g).toNumber();return(0,n.log)("Estimated EIP-7702 gas limit",T),{totalGasLimit:T,gasLimits:[T]}}if(l.every(e=>e.gas!==undefined)){const e=l.map(e=>new s.BigNumber(e.gas).toNumber()),t=e.reduce((e,t)=>e+t,0);return(0,n.log)("Using batch parameter gas limits",{gasLimits:e,total:t}),{totalGasLimit:t,gasLimits:e}}const{gasLimits:p}=await m({chainId:e,from:a,getSimulationConfig:r,transactions:l.map(e=>({params:e}))}),g=l.map((e,t)=>e.gas?new s.BigNumber(e.gas).toNumber():new s.BigNumber(p[t]).toNumber()),T=g.reduce((e,t)=>e+t,0);return(0,n.log)("Simulated batch gas limits",{totalGasLimit:T,gasLimits:g}),{totalGasLimit:T,gasLimits:g}},n.addGasBuffer=h,n.simulateGasBatch=m}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/gas.cjs"}],[3109,{"../logger.cjs":3096,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getTransactionLayer1GasFee=n.updateTransactionLayer1GasFee=void 0;const a=e("@metamask/utils"),r=e("../logger.cjs"),s=(0,a.createModuleLogger)(r.projectLogger,"layer-1-gas-fee-flow");async function i({layer1GasFeeFlows:e,messenger:t,provider:n,transactionMeta:a}){const r=await async function(e,t,n){for(const a of t)if(await a.matchesTransaction({transactionMeta:e,messenger:n}))return a;return undefined}(a,e,t);if(!r)return undefined;s("Found layer 1 gas fee flow",r.constructor.name,a.id);try{const{layer1Fee:e}=await r.getLayer1Fee({provider:n,transactionMeta:a});return e}catch(e){return s("Failed to get layer 1 gas fee",a.id,e),undefined}}n.updateTransactionLayer1GasFee=async function(e){const t=await i(e);if(!t)return;const{transactionMeta:n}=e;n.layer1GasFee=t,s("Updated layer 1 gas fee",t,n.id)},n.getTransactionLayer1GasFee=i}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/layer1-gas-fee-flow.cjs"}],[3110,{"../logger.cjs":3096,"@metamask/controller-utils":1494},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getAndFormatTransactionsForNonceTracker=n.getNextNonce=void 0;const a=e("@metamask/controller-utils"),r=e("../logger.cjs"),s=(0,r.createModuleLogger)(r.projectLogger,"nonce");n.getNextNonce=async function(e,t){const{customNonceValue:n,isExternalSign:r,txParams:{from:i,nonce:o}}=e;if(r)return s("Skipping nonce as signed externally"),[undefined,undefined];const c=n?(0,a.toHex)(n):undefined;if(c)return s("Using custom nonce",c),[c,undefined];if(o)return s("Using existing nonce",o),[o,undefined];const l=await t(i),u=(0,a.toHex)(l.nextNonce),d=l.releaseLock.bind(l);return s("Using nonce from nonce tracker",u,l.nonceDetails),[u,d]},n.getAndFormatTransactionsForNonceTracker=function(e,t,n,a){return a.filter(({chainId:a,isTransfer:r,isUserOperation:s,status:i,txParams:{from:o,nonce:c}})=>!r&&!s&&a===e&&n.includes(i)&&o.toLowerCase()===t.toLowerCase()&&c).flatMap(({status:e,txParams:{authorizationList:t,from:n,gas:a,value:r,nonce:s}})=>[s,...(t??[]).map(e=>e.nonce).filter(e=>e!==undefined)].map(t=>({status:e,history:[{}],txParams:{from:n??"",gas:a??"",value:r??"",nonce:t??""}})))}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/nonce.cjs"}],[3111,{"@ethereumjs/common":670,"@ethereumjs/tx":687,"@metamask/utils":3217,lodash:4901},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.serializeTransaction=n.prepareTransaction=n.HARDFORK=void 0;const a=e("@ethereumjs/common"),r=e("@ethereumjs/tx"),s=e("@metamask/utils"),i=e("lodash");function o(e){const t={chainId:parseInt(e,16),defaultHardfork:n.HARDFORK};return a.Common.custom(t,{eips:[7702]})}function c(e){return e?"0x0"===e?"0x":e.replace?.(/^0x(00)+/u,"0x")??e:e}n.HARDFORK=a.Hardfork.Prague,n.prepareTransaction=function(e,t){const n=function(e){const t=(0,i.cloneDeep)(e);return function(e){if(!e)return;for(const t of e)t.nonce=c(t.nonce),t.r=c(t.r),t.s=c(t.s),t.yParity=c(t.yParity)}(t.authorizationList),t}(t);return r.TransactionFactory.fromTxData(n,{freeze:!1,common:o(e)})},n.serializeTransaction=function(e){return(0,s.bytesToHex)(e.serialize())}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/prepare.cjs"}],[3112,{"@metamask/controller-utils":1494,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getTransactionParamsWithIncreasedGasFee=void 0;const a=e("@metamask/controller-utils"),r=e("@metamask/utils");function s(e,t){const n=(0,a.convertHexToDecimal)(e),s=parseInt(""+n*t,10);return(0,r.add0x)(s.toString(16))}n.getTransactionParamsWithIncreasedGasFee=function(e,t,n){const a=function(e,t,n){if(n&&"gasPrice"in n)return n.gasPrice;const a=e.gasPrice;if(!a||"0x0"===a)return undefined;return s(a,t)}(e,t,n),r=function(e,t,n){if(n&&"maxFeePerGas"in n&&"maxPriorityFeePerGas"in n)return n;const a=e.maxFeePerGas,r=e.maxPriorityFeePerGas;if(!a||!r||"0x0"===a||"0x0"===r)return undefined;const i=s(a,t),o=s(r,t);return{maxFeePerGas:i,maxPriorityFeePerGas:o}}(e,t,n);if(r){const t={...e,...r};return delete t.gasPrice,t}if(a){const t={...e,gasPrice:a};return delete t.maxFeePerGas,delete t.maxPriorityFeePerGas,t}throw new Error("Cannot increase gas fee as no current values and no new values were provided")}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/retry.cjs"}],[3113,{"@ethersproject/wallet":851,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isValidSignature=void 0;const a=e("@ethersproject/wallet"),r=e("@metamask/utils");n.isValidSignature=function(e,t,n){try{const s=(0,r.add0x)(e.map(r.remove0x).join("")),i=(0,r.hexToBytes)(s);return(0,a.verifyMessage)(i,t).toLowerCase()===n.toLowerCase()}catch{return!1}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/signature.cjs"}],[3114,{"../constants.cjs":3075,"../logger.cjs":3096,"../types.cjs":3097,"./utils.cjs":3116,"@metamask/controller-utils":1494,lodash:4901},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.updatePostTransactionBalance=n.updateSwapsTransaction=n.SWAP_TRANSACTION_TYPES=n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP=n.DEFAULT_TOKEN_ADDRESS=n.UPDATE_POST_TX_BALANCE_ATTEMPTS=n.UPDATE_POST_TX_BALANCE_TIMEOUT=void 0;const a=e("@metamask/controller-utils"),r=e("lodash"),s=e("./utils.cjs"),i=e("../constants.cjs"),o=e("../logger.cjs"),c=e("../types.cjs"),l=(0,o.createModuleLogger)(o.projectLogger,"swaps");n.UPDATE_POST_TX_BALANCE_TIMEOUT=5e3,n.UPDATE_POST_TX_BALANCE_ATTEMPTS=6;const u="0x539";n.DEFAULT_TOKEN_ADDRESS="0x0000000000000000000000000000000000000000";const d={name:"Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},h={name:"Binance Coin",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},m={name:"Matic",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},f={name:"Avalanche",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},p={name:"Test Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},g={name:"Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},T={...d},w={...d},b={...d},E={name:"Sei",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},y={name:"Mon",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18};function S(e,t){return!(!e||!t)&&e===n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP[t]?.address}function k(e){return new Promise(t=>setTimeout(t,e))}n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP={[i.CHAIN_IDS.MAINNET]:d,[u]:p,[i.CHAIN_IDS.BSC]:h,[i.CHAIN_IDS.POLYGON]:m,[i.CHAIN_IDS.GOERLI]:g,[i.CHAIN_IDS.AVALANCHE]:f,[i.CHAIN_IDS.OPTIMISM]:w,[i.CHAIN_IDS.ARBITRUM]:T,[i.CHAIN_IDS.ZKSYNC_ERA]:b,[i.CHAIN_IDS.SEI]:E,[i.CHAIN_IDS.MONAD]:y},n.SWAP_TRANSACTION_TYPES=[c.TransactionType.swap,c.TransactionType.swapAndSend,c.TransactionType.swapApproval],n.updateSwapsTransaction=function(e,t,a,{isSwapsDisabled:i,cancelTransaction:o,messenger:l}){if(i||!n.SWAP_TRANSACTION_TYPES.includes(t))return e;if(t===c.TransactionType.swap&&!1===a?.hasApproveTx&&e.simulationFails)throw o(e.id),new Error("Simulation failed");const u=a?.meta;if(!u)return e;let d=e;return t===c.TransactionType.swapApproval&&(d=function(e,{type:t,sourceTokenSymbol:n}){(0,s.validateIfTransactionUnapproved)(e,"updateSwapApprovalTransaction");let a={type:t,sourceTokenSymbol:n};return a=(0,r.pickBy)({type:t,sourceTokenSymbol:n}),(0,r.merge)({},e,a)}(e,u),l.publish("TransactionController:transactionNewSwapApproval",{transactionMeta:d})),t===c.TransactionType.swapAndSend&&(d=function(e,{approvalTxId:t,destinationTokenAddress:n,destinationTokenAmount:a,destinationTokenDecimals:i,destinationTokenSymbol:o,estimatedBaseFee:c,sourceTokenAddress:l,sourceTokenAmount:u,sourceTokenDecimals:d,sourceTokenSymbol:h,swapAndSendRecipient:m,swapMetaData:f,swapTokenValue:p,type:g}){(0,s.validateIfTransactionUnapproved)(e,"updateSwapTransaction");let T={approvalTxId:t,destinationTokenAddress:n,destinationTokenAmount:a,destinationTokenDecimals:i,destinationTokenSymbol:o,estimatedBaseFee:c,sourceTokenAddress:l,sourceTokenAmount:u,sourceTokenDecimals:d,sourceTokenSymbol:h,swapAndSendRecipient:m,swapMetaData:f,swapTokenValue:p,type:g};return T=(0,r.pickBy)(T),(0,r.merge)({},e,T)}(e,u),l.publish("TransactionController:transactionNewSwapAndSend",{transactionMeta:d})),t===c.TransactionType.swap&&(d=function(e,{sourceTokenSymbol:t,destinationTokenSymbol:n,type:a,destinationTokenDecimals:i,destinationTokenAddress:o,swapMetaData:c,swapTokenValue:l,estimatedBaseFee:u,approvalTxId:d}){(0,s.validateIfTransactionUnapproved)(e,"updateSwapTransaction");let h={sourceTokenSymbol:t,destinationTokenSymbol:n,type:a,destinationTokenDecimals:i,destinationTokenAddress:o,swapMetaData:c,swapTokenValue:l,estimatedBaseFee:u,approvalTxId:d};return h=(0,r.pickBy)(h),(0,r.merge)({},e,h)}(e,u),l.publish("TransactionController:transactionNewSwap",{transactionMeta:d})),d},n.updatePostTransactionBalance=async function(e,{ethQuery:t,getTransaction:r,updateTransaction:s}){l("Updating post transaction balance",e.id);const i=e.id;let o,c;for(let s=0;s<n.UPDATE_POST_TX_BALANCE_ATTEMPTS;s++){l("Querying balance",{attempt:s});const u=await(0,a.query)(t,"getBalance",[e.txParams.from]);o={...r(i)??{}},c=o.approvalTxId?r(o.approvalTxId):undefined,o.postTxBalance=u.toString(16);const d=S(e.destinationTokenAddress,e.chainId);if(!d||e.preTxBalance!==o.postTxBalance){l("Finishing post balance update",{isDefaultTokenAddress:d,preTxBalance:e.preTxBalance,postTxBalance:o.postTxBalance});break}l("Waiting for balance to update",{delay:n.UPDATE_POST_TX_BALANCE_TIMEOUT}),await k(n.UPDATE_POST_TX_BALANCE_TIMEOUT)}return s(o,"TransactionController#updatePostTransactionBalance - Add post transaction balance"),l("Completed post balance update",o?.postTxBalance),{updatedTransactionMeta:o,approvalTransactionMeta:c}}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/swaps.cjs"}],[3115,{"../types.cjs":3097,"./eip7702.cjs":3101,"@ethersproject/abi":754,"@metamask/controller-utils":1494,"@metamask/metamask-eth-abis":2376},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.decodeTransactionData=n.determineTransactionType=n.ESTIMATE_GAS_ERROR=void 0;const a=e("@ethersproject/abi"),r=e("@metamask/controller-utils"),s=e("@metamask/metamask-eth-abis"),i=e("./eip7702.cjs"),o=e("../types.cjs");n.ESTIMATE_GAS_ERROR="eth_estimateGas rpc method error";const c=new a.Interface(s.abiERC20),l=new a.Interface(s.abiERC721),u=new a.Interface(s.abiERC1155),d=new a.Interface(s.abiFiatTokenV2);function h(e,t){if(!e||e.length<10)return undefined;const n=e.substring(0,10).toLowerCase();for(const a of[c,l,u,d])try{return t?.getMethodName?a.getFunction(n)?.name:a.parseTransaction({data:e})}catch{}return undefined}n.determineTransactionType=async function(e,t){const{data:n,to:a}=e;if(n&&!a)return{type:o.TransactionType.deployContract,getCodeResponse:undefined};let s,c=Boolean(n?.length);if(t){const e=await async function(e,t){let n;try{n=await(0,r.query)(e,"getCode",[t])}catch(e){n=null}const a=!!n&&("0x"!==n&&"0x0"!==n&&!n.startsWith(i.DELEGATION_PREFIX));return{contractCode:n,isContractAddress:a}}(t,a);s=e.contractCode,c=e.isContractAddress}if(!c)return{type:o.TransactionType.simpleSend,getCodeResponse:s};const l=0!==Number(e.value??"0"),u={type:o.TransactionType.contractInteraction,getCodeResponse:s};if(!n||l)return u;const d=function(e){return h(e,{getMethodName:!0})}(n);if(!d)return u;const m=[o.TransactionType.tokenMethodApprove,o.TransactionType.tokenMethodSetApprovalForAll,o.TransactionType.tokenMethodTransfer,o.TransactionType.tokenMethodTransferFrom,o.TransactionType.tokenMethodSafeTransferFrom,o.TransactionType.tokenMethodIncreaseAllowance].find(e=>e.toLowerCase()===d.toLowerCase());return m?{type:m,getCodeResponse:s}:u},n.decodeTransactionData=h}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/transaction-type.cjs"}],[3116,{"../types.cjs":3097,"@metamask/utils":3217,"bn.js":4076},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.setEnvelopeType=n.getPercentageChange=n.toBN=n.bnFromHex=n.padHexToEvenLength=n.normalizeGasFeeValues=n.normalizeTxError=n.validateIfTransactionUnapproved=n.validateGasValues=n.isEIP1559Transaction=n.normalizeTransactionParams=n.ESTIMATE_GAS_ERROR=void 0;const r=e("@metamask/utils"),s=a(e("bn.js")),i=e("../types.cjs");n.ESTIMATE_GAS_ERROR="eth_estimateGas rpc method error";const o={accessList:e=>e,authorizationList:e=>e,data:e=>(0,r.add0x)(l(e)),from:e=>(0,r.add0x)(e).toLowerCase(),gas:e=>(0,r.add0x)(e),gasLimit:e=>(0,r.add0x)(e),gasPrice:e=>(0,r.add0x)(e),nonce:e=>(0,r.add0x)(e),to:e=>(0,r.add0x)(e).toLowerCase(),value:e=>(0,r.add0x)(e),maxFeePerGas:e=>(0,r.add0x)(e),maxPriorityFeePerGas:e=>(0,r.add0x)(e),estimatedBaseFee:e=>(0,r.add0x)(e),type:e=>(0,r.add0x)(e)};n.normalizeTransactionParams=function(e){const t={from:""};for(const n of(0,r.getKnownPropertyNames)(o))e[n]&&(t[n]=o[n](e[n]));return t.value??(t.value="0x0"),t.gasLimit&&!t.gas&&(t.gas=t.gasLimit),t},n.isEIP1559Transaction=function(e){const t=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);return t(e,"maxFeePerGas")&&t(e,"maxPriorityFeePerGas")};function c(e){try{return JSON.parse(JSON.stringify(e)),!0}catch{return!1}}function l(e){const t=e.toLowerCase().startsWith("0x")?e.slice(0,2):"",n=t?e.slice(2):e;return t+(n.length%2==0?n:`0${n}`)}function u(e){const t=e,n=t.startsWith("0x")||t.startsWith("0X")?t.slice(2):t;return 0===n.length?new s.default(0):new s.default(n,16)}n.validateGasValues=e=>{Object.keys(e).forEach(t=>{const n=e[t];if("string"!=typeof n||!(0,r.isStrictHexString)(n))throw new TypeError(`expected hex string for ${t} but received: ${n}`)})},n.validateIfTransactionUnapproved=function(e,t){if(e?.status!==i.TransactionStatus.unapproved)throw new Error(`TransactionsController: Can only call ${t} on an unapproved transaction.\n      Current tx status: ${e?.status}`)},n.normalizeTxError=function(e){return{name:e.name,message:e.message,stack:e.stack,code:e.code,rpc:c(e.value)?e.value:undefined}},n.normalizeGasFeeValues=function(e){const t=e=>"string"==typeof e?(0,r.add0x)(e):e;return"gasPrice"in e?{gasPrice:t(e.gasPrice)}:{maxFeePerGas:t(e.maxFeePerGas),maxPriorityFeePerGas:t(e.maxPriorityFeePerGas)}},n.padHexToEvenLength=l,n.bnFromHex=u,n.toBN=function(e){if(e instanceof s.default)return e;if("function"==typeof s.default.isBN&&s.default.isBN(e))return e;if(null!==e&&"object"==typeof e&&"function"==typeof e.toHexString)return u(e.toHexString());if(null!==e&&"object"==typeof e&&"string"==typeof e._hex)return u(e._hex);if("string"==typeof e)return u(e);if("bigint"==typeof e)return new s.default(e.toString());if("number"==typeof e)return new s.default(e);throw new Error("Unexpected value returned from oracle contract")},n.getPercentageChange=function(e,t){const n=new s.default(10).pow(new s.default(18)),a=e.mul(n),r=t.mul(n),i=r.sub(a);return i.isZero()?0:a.isZero()&&!r.isZero()?100:i.muln(100).div(a).abs().toNumber()},n.setEnvelopeType=function(e,t){e.accessList?e.type=i.TransactionEnvelopeType.accessList:e.authorizationList?e.type=i.TransactionEnvelopeType.setCode:e.type=t?i.TransactionEnvelopeType.feeMarket:i.TransactionEnvelopeType.legacy}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/utils.cjs"}],[3117,{"../types.cjs":3097,"./utils.cjs":3116,"@ethersproject/abi":754,"@metamask/controller-utils":1494,"@metamask/metamask-eth-abis":2376,"@metamask/rpc-errors":2698,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateBatchRequest=n.validateParamTo=n.validateTxParams=n.validateTransactionOrigin=n.ErrorCode=void 0;const a=e("@ethersproject/abi"),r=e("@metamask/controller-utils"),s=e("@metamask/metamask-eth-abis"),i=e("@metamask/rpc-errors"),o=e("@metamask/utils"),c=e("./utils.cjs"),l=e("../types.cjs");var u;!function(e){e[e.DuplicateBundleId=5720]="DuplicateBundleId",e[e.BundleTooLarge=5740]="BundleTooLarge",e[e.RejectedUpgrade=5750]="RejectedUpgrade"}(u||(n.ErrorCode=u={}));const d=[l.TransactionEnvelopeType.feeMarket,l.TransactionEnvelopeType.setCode];function h(e,t){const n=e.type;switch(t){case"authorizationList":if(n&&n!==l.TransactionEnvelopeType.setCode)throw i.rpcErrors.invalidParams(`Invalid transaction envelope type: specified type "${n}" but including authorizationList requires type: "${l.TransactionEnvelopeType.setCode}"`);break;case"maxFeePerGas":case"maxPriorityFeePerGas":if(n&&!d.includes(n))throw i.rpcErrors.invalidParams(`Invalid transaction envelope type: specified type "${n}" but including maxFeePerGas and maxPriorityFeePerGas requires type: "${d.join(", ")}"`);break;default:if(n&&d.includes(n))throw i.rpcErrors.invalidParams(`Invalid transaction envelope type: specified type "${n}" but included a gasPrice instead of maxFeePerGas and maxPriorityFeePerGas`)}}function m(e,t,n){if(void 0!==e[n])throw i.rpcErrors.invalidParams(`Invalid transaction params: specified ${t} but also included ${n}, these cannot be mixed`)}function f(e,t){const n=e[t];if("string"!=typeof n||!(0,o.isStrictHexString)(n))throw i.rpcErrors.invalidParams(`Invalid transaction params: ${String(t)} is not a valid hexadecimal string. got: (${String(n)})`)}function p(e){f(e,"address"),function(e,t,n){const a=(0,o.remove0x)(e).length/2;if(a!==t)throw i.rpcErrors.invalidParams(`Invalid transaction params: ${n} must be ${t} bytes. got: ${a} bytes`)}(e.address,20,"address");for(const t of["chainId","nonce","r","s"])e[t]&&f(e,t);const{yParity:t}=e;if(t&&!["0x0","0x1"].includes(t))throw i.rpcErrors.invalidParams(`Invalid transaction params: yParity must be '0x0' or '0x1'. got: ${t}`)}n.validateTransactionOrigin=async function({data:e,from:t,internalAccounts:n,origin:a,permittedAddresses:s,txParams:o,type:c}){if(!a||a===r.ORIGIN_METAMASK)return;const{authorizationList:u,to:d,type:h}=o;if(s&&!s.includes(t))throw i.providerErrors.unauthorized({data:{origin:a}});if(c===l.TransactionType.batch)return;if(u||h===l.TransactionEnvelopeType.setCode)throw i.rpcErrors.invalidParams("External EIP-7702 transactions are not supported");if(Boolean(e&&"0x"!==e)&&n?.some(e=>e.toLowerCase()===d?.toLowerCase()))throw i.rpcErrors.invalidParams("External transactions to internal accounts cannot include data")},n.validateTxParams=function(e,t=!0,n){!function(e){if(e&&!Object.values(l.TransactionEnvelopeType).includes(e))throw i.rpcErrors.invalidParams(`Invalid transaction envelope type: "${e}". Must be one of: ${Object.values(l.TransactionEnvelopeType).join(", ")}`)}(e.type),function(e,t){if((0,c.isEIP1559Transaction)(e)&&!t)throw i.rpcErrors.invalidParams("Invalid transaction params: params specify an EIP-1559 transaction but the current network does not support EIP-1559")}(e,t),function(e){if(!e||"string"!=typeof e)throw i.rpcErrors.invalidParams(`Invalid "from" address ${e}: not a string.`);if(!(0,r.isValidHexAddress)(e))throw i.rpcErrors.invalidParams('Invalid "from" address.')}(e.from),function(e){if("0x"===e.to||e.to===undefined){if(!e.data)throw i.rpcErrors.invalidParams('Invalid "to" address.');delete e.to}else if(e.to!==undefined&&!(0,r.isValidHexAddress)(e.to))throw i.rpcErrors.invalidParams('Invalid "to" address.')}(e),function(e){if(e!==undefined){if(e.includes("-"))throw i.rpcErrors.invalidParams(`Invalid transaction value "${e}": not a positive number.`);if(e.includes("."))throw i.rpcErrors.invalidParams(`Invalid transaction value "${e}": number must be in wei.`);const t=parseInt(e,10);if(!(Number.isFinite(t)&&!Number.isNaN(t)&&!isNaN(Number(e))&&Number.isSafeInteger(t)))throw i.rpcErrors.invalidParams(`Invalid transaction value ${e}: number must be a valid number.`)}}(e.value),function(e){if(e){const t=new a.Interface(s.abiERC20);try{t.parseTransaction({data:e})}catch(e){if(e.message.match(/BUFFER_OVERRUN/u))throw i.rpcErrors.invalidParams("Invalid transaction params: data out-of-bounds, BUFFER_OVERRUN.")}}}(e.data),function(e,t){if(e&&t&&e.toLowerCase?.()!==t.toLowerCase())throw i.rpcErrors.invalidParams(`Invalid transaction params: chainId must match the network client, got: ${e}, expected: ${t}`)}(e.chainId,n),function(e){e.gasPrice&&(h(e,"gasPrice"),m(e,"gasPrice","maxFeePerGas"),m(e,"gasPrice","maxPriorityFeePerGas"),f(e,"gasPrice"));e.maxFeePerGas&&(h(e,"maxFeePerGas"),m(e,"maxFeePerGas","gasPrice"),f(e,"maxFeePerGas"));e.maxPriorityFeePerGas&&(h(e,"maxPriorityFeePerGas"),m(e,"maxPriorityFeePerGas","gasPrice"),f(e,"maxPriorityFeePerGas"));e.gasLimit&&f(e,"gasLimit");e.gas&&f(e,"gas")}(e),function(e){const{authorizationList:t}=e;if(!t)return;if(h(e,"authorizationList"),!Array.isArray(t))throw i.rpcErrors.invalidParams("Invalid transaction params: authorizationList must be an array");for(const e of t)p(e)}(e)},n.validateParamTo=function(e){if(!e||"string"!=typeof e)throw i.rpcErrors.invalidParams('Invalid "to" address')},n.validateBatchRequest=function({internalAccounts:e,request:t,sizeLimit:n}){const{origin:a}=t,s=a&&a!==r.ORIGIN_METAMASK,o=e.map(e=>e.toLowerCase());if(s&&t.transactions.some(e=>{const t=e.params.to?.toLowerCase(),n=e.params.data,a=o.includes(t),r=Boolean(n&&"0x"!==n);return a&&r}))throw i.rpcErrors.invalidParams("External calls to internal accounts cannot include data");if(s&&t.transactions.length>n)throw new i.JsonRpcError(u.BundleTooLarge,`Batch size cannot exceed ${n}. got: ${t.transactions.length}`)}}}},{package:"@metamask/transaction-controller",file:"node_modules/@metamask/transaction-controller/dist/utils/validation.cjs"}],[3118,{"./determineGasFeeCalculations.cjs":3119,"./gas-util.cjs":3120,"@metamask/controller-utils":1494,"@metamask/eth-query":2079,"@metamask/polling-controller":2561,uuid:5796},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},o=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.GasFeeController=n.GAS_ESTIMATE_TYPES=n.LEGACY_GAS_PRICES_API_URL=void 0;const l=e("@metamask/controller-utils"),u=c(e("@metamask/eth-query")),d=e("@metamask/polling-controller"),h=e("uuid"),m=c(e("./determineGasFeeCalculations.cjs")),f=e("./gas-util.cjs");n.LEGACY_GAS_PRICES_API_URL="https://api.metaswap.codefi.network/gasPrices",n.GAS_ESTIMATE_TYPES={FEE_MARKET:"fee-market",LEGACY:"legacy",ETH_GASPRICE:"eth_gasPrice",NONE:"none"};const p={gasFeeEstimatesByChainId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},gasFeeEstimates:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},estimatedGasFeeTimeBounds:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},gasEstimateType:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},nonRPCGasFeeApisDisabled:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1}},g={gasFeeEstimatesByChainId:{},gasFeeEstimates:{},estimatedGasFeeTimeBounds:{},gasEstimateType:n.GAS_ESTIMATE_TYPES.NONE,nonRPCGasFeeApisDisabled:!1};class T extends((0,d.StaticIntervalPollingController)()){constructor({interval:e=15e3,messenger:t,state:c,getCurrentNetworkEIP1559Compatibility:l,getCurrentAccountEIP1559Compatibility:d,getChainId:h,getCurrentNetworkLegacyGasAPICompatibility:m,getProvider:f,onNetworkDidChange:T,legacyAPIEndpoint:w=n.LEGACY_GAS_PRICES_API_URL,EIP1559APIEndpoint:b,clientId:E}){if(super({name:"GasFeeController",metadata:p,messenger:t,state:{...g,...c}}),a.add(this),r.set(this,void 0),this.intervalDelay=e,this.setIntervalLength(e),this.pollTokens=new Set,this.getCurrentNetworkEIP1559Compatibility=l,this.getCurrentNetworkLegacyGasAPICompatibility=m,this.getCurrentAccountEIP1559Compatibility=d,i(this,r,f,"f"),this.EIP1559APIEndpoint=b,this.legacyAPIEndpoint=w,this.clientId=E,this.ethQuery=new u.default(o(this,r,"f").call(this)),T&&h)this.currentChainId=h(),T(async e=>{await o(this,a,"m",s).call(this,e)});else{const{selectedNetworkClientId:e}=this.messenger.call("NetworkController:getState");this.currentChainId=this.messenger.call("NetworkController:getNetworkClientById",e).configuration.chainId,this.messenger.subscribe("NetworkController:networkDidChange",async e=>{await o(this,a,"m",s).call(this,e)})}}async resetPolling(){if(0!==this.pollTokens.size){const e=Array.from(this.pollTokens);this.stopPolling(),await this.getGasFeeEstimatesAndStartPolling(e[0]),e.slice(1).forEach(e=>{this.pollTokens.add(e)})}}async fetchGasFeeEstimates(e){return await this._fetchGasFeeEstimateData(e)}async getGasFeeEstimatesAndStartPolling(e){const t=e||(0,h.v1)();return this.pollTokens.add(t),1===this.pollTokens.size&&(await this._fetchGasFeeEstimateData(),this._poll()),t}async _fetchGasFeeEstimateData(e={}){const{shouldUpdateState:t=!0,networkClientId:n}=e;let a,r,s,i;if(n!==undefined){const e=this.messenger.call("NetworkController:getNetworkClientById",n);s="0x38"===e.configuration.chainId,i=(0,l.convertHexToDecimal)(e.configuration.chainId);try{r=await this.messenger.call("NetworkController:getEIP1559Compatibility",n)||!1}catch{r=!1}a=new u.default(e.provider)}a??(a=this.ethQuery),s??(s=this.getCurrentNetworkLegacyGasAPICompatibility()),i??(i=(0,l.convertHexToDecimal)(this.currentChainId));try{r??(r=await this.getEIP1559Compatibility())}catch(e){console.error(e),r??(r=!1)}const o=await(0,m.default)({isEIP1559Compatible:r,isLegacyGasAPICompatible:s,fetchGasEstimates:f.fetchGasEstimates,fetchGasEstimatesUrl:this.EIP1559APIEndpoint.replace("<chain_id>",`${i}`),fetchLegacyGasPriceEstimates:f.fetchLegacyGasPriceEstimates,fetchLegacyGasPriceEstimatesUrl:this.legacyAPIEndpoint.replace("<chain_id>",`${i}`),fetchEthGasPriceEstimate:f.fetchEthGasPriceEstimate,calculateTimeEstimate:f.calculateTimeEstimate,clientId:this.clientId,ethQuery:a,nonRPCGasFeeApisDisabled:this.state.nonRPCGasFeeApisDisabled});if(t){const e=(0,l.toHex)(i);this.update(t=>{this.currentChainId===e&&(t.gasFeeEstimates=o.gasFeeEstimates,t.estimatedGasFeeTimeBounds=o.estimatedGasFeeTimeBounds,t.gasEstimateType=o.gasEstimateType),t.gasFeeEstimatesByChainId??(t.gasFeeEstimatesByChainId={}),t.gasFeeEstimatesByChainId[e]={gasFeeEstimates:o.gasFeeEstimates,estimatedGasFeeTimeBounds:o.estimatedGasFeeTimeBounds,gasEstimateType:o.gasEstimateType}})}return o}disconnectPoller(e){this.pollTokens.delete(e),0===this.pollTokens.size&&this.stopPolling()}stopPolling(){this.intervalId&&clearInterval(this.intervalId),this.pollTokens.clear(),this.resetState()}destroy(){super.destroy(),this.stopPolling()}_poll(){this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval(async()=>{await(0,l.safelyExecute)(()=>this._fetchGasFeeEstimateData())},this.intervalDelay)}async _executePoll({networkClientId:e}){await this._fetchGasFeeEstimateData({networkClientId:e})}resetState(){this.update(()=>g)}async getEIP1559Compatibility(){const e=await this.getCurrentNetworkEIP1559Compatibility(),t=this.getCurrentAccountEIP1559Compatibility?.()??!0;return e&&t}getTimeEstimate(e,t){return this.state.gasFeeEstimates&&this.state.gasEstimateType===n.GAS_ESTIMATE_TYPES.FEE_MARKET?(0,f.calculateTimeEstimate)(e,t,this.state.gasFeeEstimates):{}}enableNonRPCGasFeeApis(){this.update(e=>{e.nonRPCGasFeeApisDisabled=!1})}disableNonRPCGasFeeApis(){this.update(e=>{e.nonRPCGasFeeApisDisabled=!0})}}n.GasFeeController=T,r=new WeakMap,a=new WeakSet,s=async function({selectedNetworkClientId:e}){const t=this.messenger.call("NetworkController:getNetworkClientById",e).configuration.chainId;t!==this.currentChainId&&(this.ethQuery=new u.default(o(this,r,"f").call(this)),await this.resetPolling(),this.currentChainId=t)},n.default=T}}},{package:"@metamask/transaction-controller>@metamask/gas-fee-controller",file:"node_modules/@metamask/transaction-controller/node_modules/@metamask/gas-fee-controller/dist/GasFeeController.cjs"}],[3119,{"./GasFeeController.cjs":3118},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});const a=e("./GasFeeController.cjs");n.default=async function(e){try{return await async function(e){const{isEIP1559Compatible:t,isLegacyGasAPICompatible:n,nonRPCGasFeeApisDisabled:r}=e;try{if(t&&!r)return await async function(e){const{fetchGasEstimates:t,fetchGasEstimatesUrl:n,clientId:r,calculateTimeEstimate:s}=e,i=await t(n,r),{suggestedMaxPriorityFeePerGas:o,suggestedMaxFeePerGas:c}=i.medium,l=s(o,c,i);return{gasFeeEstimates:i,estimatedGasFeeTimeBounds:l,gasEstimateType:a.GAS_ESTIMATE_TYPES.FEE_MARKET}}(e);if(n&&!r)return await async function(e){const{fetchLegacyGasPriceEstimates:t,fetchLegacyGasPriceEstimatesUrl:n,clientId:r}=e;return{gasFeeEstimates:await t(n,r),estimatedGasFeeTimeBounds:{},gasEstimateType:a.GAS_ESTIMATE_TYPES.LEGACY}}(e);throw new Error("Main gas fee/price estimation failed. Use fallback")}catch{return await async function(e){const{ethQuery:t,fetchEthGasPriceEstimate:n}=e;return{gasFeeEstimates:await n(t),estimatedGasFeeTimeBounds:{},gasEstimateType:a.GAS_ESTIMATE_TYPES.ETH_GASPRICE}}(e)}}(e)}catch(e){if(e instanceof Error)throw new Error(`Gas fee/price estimation failed. Message: ${e.message}`);throw e}}}}},{package:"@metamask/transaction-controller>@metamask/gas-fee-controller",file:"node_modules/@metamask/transaction-controller/node_modules/@metamask/gas-fee-controller/dist/determineGasFeeCalculations.cjs"}],[3120,{"@metamask/controller-utils":1494,"bn.js":4076},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.calculateTimeEstimate=n.fetchEthGasPriceEstimate=n.fetchLegacyGasPriceEstimates=n.fetchGasEstimates=n.normalizeGWEIDecimalNumbers=void 0;const r=e("@metamask/controller-utils"),s=a(e("bn.js")),i=e=>({"X-Client-Id":e});function o(e){const t=(0,r.gweiDecToWEIBN)(e).toString(16);return(0,r.weiHexToGweiDec)(t)}n.normalizeGWEIDecimalNumbers=o,n.fetchGasEstimates=async function(e,t){const n=await(0,r.handleFetch)(e,t?{headers:i(t)}:undefined);return{low:{...n.low,suggestedMaxPriorityFeePerGas:o(n.low.suggestedMaxPriorityFeePerGas),suggestedMaxFeePerGas:o(n.low.suggestedMaxFeePerGas)},medium:{...n.medium,suggestedMaxPriorityFeePerGas:o(n.medium.suggestedMaxPriorityFeePerGas),suggestedMaxFeePerGas:o(n.medium.suggestedMaxFeePerGas)},high:{...n.high,suggestedMaxPriorityFeePerGas:o(n.high.suggestedMaxPriorityFeePerGas),suggestedMaxFeePerGas:o(n.high.suggestedMaxFeePerGas)},estimatedBaseFee:o(n.estimatedBaseFee),historicalBaseFeeRange:n.historicalBaseFeeRange,baseFeeTrend:n.baseFeeTrend,latestPriorityFeeRange:n.latestPriorityFeeRange,historicalPriorityFeeRange:n.historicalPriorityFeeRange,priorityFeeTrend:n.priorityFeeTrend,networkCongestion:n.networkCongestion}},n.fetchLegacyGasPriceEstimates=async function(e,t){const n=await(0,r.handleFetch)(e,{referrer:e,referrerPolicy:"no-referrer-when-downgrade",method:"GET",mode:"cors",headers:{"Content-Type":"application/json",...t&&i(t)}});return{low:n.SafeGasPrice,medium:n.ProposeGasPrice,high:n.FastGasPrice}},n.fetchEthGasPriceEstimate=async function(e){const t=await(0,r.query)(e,"gasPrice");return{gasPrice:(0,r.weiHexToGweiDec)(t).toString()}},n.calculateTimeEstimate=function(e,t,n){const{low:a,medium:i,high:o,estimatedBaseFee:c}=n,l=(0,r.gweiDecToWEIBN)(e),u=(0,r.gweiDecToWEIBN)(t),d=(0,r.gweiDecToWEIBN)(c),h=s.default.min(l,u.sub(d)),m=(0,r.gweiDecToWEIBN)(a.suggestedMaxPriorityFeePerGas),f=(0,r.gweiDecToWEIBN)(i.suggestedMaxPriorityFeePerGas),p=(0,r.gweiDecToWEIBN)(o.suggestedMaxPriorityFeePerGas);let g,T;return h.lt(m)?(g=null,T="unknown"):h.gte(m)&&h.lt(f)?(g=a.minWaitTimeEstimate,T=a.maxWaitTimeEstimate):h.gte(f)&&h.lt(p)?(g=i.minWaitTimeEstimate,T=i.maxWaitTimeEstimate):h.eq(p)?(g=o.minWaitTimeEstimate,T=o.maxWaitTimeEstimate):(g=0,T=o.maxWaitTimeEstimate),{lowerTimeBound:g,upperTimeBound:T}}}}},{package:"@metamask/transaction-controller>@metamask/gas-fee-controller",file:"node_modules/@metamask/transaction-controller/node_modules/@metamask/gas-fee-controller/dist/gas-util.cjs"}],[3121,{"./GasFeeController.cjs":3118},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){a===undefined&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){a===undefined&&(a=n),e[a]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||a(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./GasFeeController.cjs"),n)}}},{package:"@metamask/transaction-controller>@metamask/gas-fee-controller",file:"node_modules/@metamask/transaction-controller/node_modules/@metamask/gas-fee-controller/dist/index.cjs"}],[3122,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){!function(e){var n,a=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,r=Math.ceil,s=Math.floor,i="[BigNumber Error] ",o=i+"Number primitive has more than 15 significant digits: ",c=1e14,l=14,u=9007199254740991,d=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],h=1e7,m=1e9;function f(e){var t=0|e;return e>0||e===t?t:t-1}function p(e){for(var t,n,a=1,r=e.length,s=e[0]+"";a<r;){for(t=e[a++]+"",n=l-t.length;n--;t="0"+t);s+=t}for(r=s.length;48===s.charCodeAt(--r););return s.slice(0,r+1||1)}function g(e,t){var n,a,r=e.c,s=t.c,i=e.s,o=t.s,c=e.e,l=t.e;if(!i||!o)return null;if(n=r&&!r[0],a=s&&!s[0],n||a)return n?a?0:-o:i;if(i!=o)return i;if(n=i<0,a=c==l,!r||!s)return a?0:!r^n?1:-1;if(!a)return c>l^n?1:-1;for(o=(c=r.length)<(l=s.length)?c:l,i=0;i<o;i++)if(r[i]!=s[i])return r[i]>s[i]^n?1:-1;return c==l?0:c>l^n?1:-1}function T(e,t,n,a){if(e<t||e>n||e!==s(e))throw Error(i+(a||"Argument")+("number"==typeof e?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function w(e){var t=e.c.length-1;return f(e.e/l)==t&&e.c[t]%2!=0}function b(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function E(e,t,n){var a,r;if(t<0){for(r=n+".";++t;r+=n);e=r+e}else if(++t>(a=e.length)){for(r=n,t-=a;--t;r+=n);e+=r}else t<a&&(e=e.slice(0,t)+"."+e.slice(t));return e}n=function e(t){var n,y,S,k,I,A,_,C,P,v,N=K.prototype={constructor:K,toString:null,valueOf:null},R=new K(1),j=20,O=4,x=-7,L=21,M=-1e7,F=1e7,D=!1,B=1,G=0,U={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},H="0123456789abcdefghijklmnopqrstuvwxyz",q=!0;function K(e,t){var n,r,i,c,d,h,m,f,p=this;if(!(p instanceof K))return new K(e,t);if(null==t){if(e&&!0===e._isBigNumber)return p.s=e.s,void(!e.c||e.e>F?p.c=p.e=null:e.e<M?p.c=[p.e=0]:(p.e=e.e,p.c=e.c.slice()));if((h="number"==typeof e)&&0*e==0){if(p.s=1/e<0?(e=-e,-1):1,e===~~e){for(c=0,d=e;d>=10;d/=10,c++);return void(c>F?p.c=p.e=null:(p.e=c,p.c=[e]))}f=String(e)}else{if(!a.test(f=String(e)))return S(p,f,h);p.s=45==f.charCodeAt(0)?(f=f.slice(1),-1):1}(c=f.indexOf("."))>-1&&(f=f.replace(".","")),(d=f.search(/e/i))>0?(c<0&&(c=d),c+=+f.slice(d+1),f=f.substring(0,d)):c<0&&(c=f.length)}else{if(T(t,2,H.length,"Base"),10==t&&q)return Y(p=new K(e),j+p.e+1,O);if(f=String(e),h="number"==typeof e){if(0*e!=0)return S(p,f,h,t);if(p.s=1/e<0?(f=f.slice(1),-1):1,K.DEBUG&&f.replace(/^0\.0*|\./,"").length>15)throw Error(o+e)}else p.s=45===f.charCodeAt(0)?(f=f.slice(1),-1):1;for(n=H.slice(0,t),c=d=0,m=f.length;d<m;d++)if(n.indexOf(r=f.charAt(d))<0){if("."==r){if(d>c){c=m;continue}}else if(!i&&(f==f.toUpperCase()&&(f=f.toLowerCase())||f==f.toLowerCase()&&(f=f.toUpperCase()))){i=!0,d=-1,c=0;continue}return S(p,String(e),h,t)}h=!1,(c=(f=y(f,t,10,p.s)).indexOf("."))>-1?f=f.replace(".",""):c=f.length}for(d=0;48===f.charCodeAt(d);d++);for(m=f.length;48===f.charCodeAt(--m););if(f=f.slice(d,++m)){if(m-=d,h&&K.DEBUG&&m>15&&(e>u||e!==s(e)))throw Error(o+p.s*e);if((c=c-d-1)>F)p.c=p.e=null;else if(c<M)p.c=[p.e=0];else{if(p.e=c,p.c=[],d=(c+1)%l,c<0&&(d+=l),d<m){for(d&&p.c.push(+f.slice(0,d)),m-=l;d<m;)p.c.push(+f.slice(d,d+=l));d=l-(f=f.slice(d)).length}else d-=m;for(;d--;f+="0");p.c.push(+f)}}else p.c=[p.e=0]}function W(e,t,n,a){var r,s,i,o,c;if(null==n?n=O:T(n,0,8),!e.c)return e.toString();if(r=e.c[0],i=e.e,null==t)c=p(e.c),c=1==a||2==a&&(i<=x||i>=L)?b(c,i):E(c,i,"0");else if(s=(e=Y(new K(e),t,n)).e,o=(c=p(e.c)).length,1==a||2==a&&(t<=s||s<=x)){for(;o<t;c+="0",o++);c=b(c,s)}else if(t-=i,c=E(c,s,"0"),s+1>o){if(--t>0)for(c+=".";t--;c+="0");}else if((t+=s-o)>0)for(s+1==o&&(c+=".");t--;c+="0");return e.s<0&&r?"-"+c:c}function $(e,t){for(var n,a,r=1,s=new K(e[0]);r<e.length;r++)(!(a=new K(e[r])).s||(n=g(s,a))===t||0===n&&s.s===t)&&(s=a);return s}function V(e,t,n){for(var a=1,r=t.length;!t[--r];t.pop());for(r=t[0];r>=10;r/=10,a++);return(n=a+n*l-1)>F?e.c=e.e=null:n<M?e.c=[e.e=0]:(e.e=n,e.c=t),e}function Y(e,t,n,a){var i,o,u,h,m,f,p,g=e.c,T=d;if(g){e:{for(i=1,h=g[0];h>=10;h/=10,i++);if((o=t-i)<0)o+=l,u=t,m=g[f=0],p=s(m/T[i-u-1]%10);else if((f=r((o+1)/l))>=g.length){if(!a)break e;for(;g.length<=f;g.push(0));m=p=0,i=1,u=(o%=l)-l+1}else{for(m=h=g[f],i=1;h>=10;h/=10,i++);p=(u=(o%=l)-l+i)<0?0:s(m/T[i-u-1]%10)}if(a=a||t<0||null!=g[f+1]||(u<0?m:m%T[i-u-1]),a=n<4?(p||a)&&(0==n||n==(e.s<0?3:2)):p>5||5==p&&(4==n||a||6==n&&(o>0?u>0?m/T[i-u]:0:g[f-1])%10&1||n==(e.s<0?8:7)),t<1||!g[0])return g.length=0,a?(t-=e.e+1,g[0]=T[(l-t%l)%l],e.e=-t||0):g[0]=e.e=0,e;if(0==o?(g.length=f,h=1,f--):(g.length=f+1,h=T[l-o],g[f]=u>0?s(m/T[i-u]%T[u])*h:0),a)for(;;){if(0==f){for(o=1,u=g[0];u>=10;u/=10,o++);for(u=g[0]+=h,h=1;u>=10;u/=10,h++);o!=h&&(e.e++,g[0]==c&&(g[0]=1));break}if(g[f]+=h,g[f]!=c)break;g[f--]=0,h=1}for(o=g.length;0===g[--o];g.pop());}e.e>F?e.c=e.e=null:e.e<M&&(e.c=[e.e=0])}return e}function Q(e){var t,n=e.e;return null===n?e.toString():(t=p(e.c),t=n<=x||n>=L?b(t,n):E(t,n,"0"),e.s<0?"-"+t:t)}return K.clone=e,K.ROUND_UP=0,K.ROUND_DOWN=1,K.ROUND_CEIL=2,K.ROUND_FLOOR=3,K.ROUND_HALF_UP=4,K.ROUND_HALF_DOWN=5,K.ROUND_HALF_EVEN=6,K.ROUND_HALF_CEIL=7,K.ROUND_HALF_FLOOR=8,K.EUCLID=9,K.config=K.set=function(e){var t,n;if(null!=e){if("object"!=typeof e)throw Error(i+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(T(n=e[t],0,m,t),j=n),e.hasOwnProperty(t="ROUNDING_MODE")&&(T(n=e[t],0,8,t),O=n),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((n=e[t])&&n.pop?(T(n[0],-m,0,t),T(n[1],0,m,t),x=n[0],L=n[1]):(T(n,-m,m,t),x=-(L=n<0?-n:n))),e.hasOwnProperty(t="RANGE"))if((n=e[t])&&n.pop)T(n[0],-m,-1,t),T(n[1],1,m,t),M=n[0],F=n[1];else{if(T(n,-m,m,t),!n)throw Error(i+t+" cannot be zero: "+n);M=-(F=n<0?-n:n)}if(e.hasOwnProperty(t="CRYPTO")){if((n=e[t])!==!!n)throw Error(i+t+" not true or false: "+n);if(n){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw D=!n,Error(i+"crypto unavailable");D=n}else D=n}if(e.hasOwnProperty(t="MODULO_MODE")&&(T(n=e[t],0,9,t),B=n),e.hasOwnProperty(t="POW_PRECISION")&&(T(n=e[t],0,m,t),G=n),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(n=e[t]))throw Error(i+t+" not an object: "+n);U=n}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(n=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(n))throw Error(i+t+" invalid: "+n);q="0123456789"==n.slice(0,10),H=n}}return{DECIMAL_PLACES:j,ROUNDING_MODE:O,EXPONENTIAL_AT:[x,L],RANGE:[M,F],CRYPTO:D,MODULO_MODE:B,POW_PRECISION:G,FORMAT:U,ALPHABET:H}},K.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!K.DEBUG)return!0;var t,n,a=e.c,r=e.e,o=e.s;e:if("[object Array]"=={}.toString.call(a)){if((1===o||-1===o)&&r>=-m&&r<=m&&r===s(r)){if(0===a[0]){if(0===r&&1===a.length)return!0;break e}if((t=(r+1)%l)<1&&(t+=l),String(a[0]).length==t){for(t=0;t<a.length;t++)if((n=a[t])<0||n>=c||n!==s(n))break e;if(0!==n)return!0}}}else if(null===a&&null===r&&(null===o||1===o||-1===o))return!0;throw Error(i+"Invalid BigNumber: "+e)},K.maximum=K.max=function(){return $(arguments,-1)},K.minimum=K.min=function(){return $(arguments,1)},K.random=(k=9007199254740992,I=Math.random()*k&2097151?function(){return s(Math.random()*k)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,n,a,o,c,u=0,h=[],f=new K(R);if(null==e?e=j:T(e,0,m),o=r(e/l),D)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));u<o;)(c=131072*t[u]+(t[u+1]>>>11))>=9e15?(n=crypto.getRandomValues(new Uint32Array(2)),t[u]=n[0],t[u+1]=n[1]):(h.push(c%1e14),u+=2);u=o/2}else{if(!crypto.randomBytes)throw D=!1,Error(i+"crypto unavailable");for(t=crypto.randomBytes(o*=7);u<o;)(c=281474976710656*(31&t[u])+1099511627776*t[u+1]+4294967296*t[u+2]+16777216*t[u+3]+(t[u+4]<<16)+(t[u+5]<<8)+t[u+6])>=9e15?crypto.randomBytes(7).copy(t,u):(h.push(c%1e14),u+=7);u=o/7}if(!D)for(;u<o;)(c=I())<9e15&&(h[u++]=c%1e14);for(o=h[--u],e%=l,o&&e&&(c=d[l-e],h[u]=s(o/c)*c);0===h[u];h.pop(),u--);if(u<0)h=[a=0];else{for(a=-1;0===h[0];h.splice(0,1),a-=l);for(u=1,c=h[0];c>=10;c/=10,u++);u<l&&(a-=l-u)}return f.e=a,f.c=h,f}),K.sum=function(){for(var e=1,t=arguments,n=new K(t[0]);e<t.length;)n=n.plus(t[e++]);return n},y=function(){var e="0123456789";function t(e,t,n,a){for(var r,s,i=[0],o=0,c=e.length;o<c;){for(s=i.length;s--;i[s]*=t);for(i[0]+=a.indexOf(e.charAt(o++)),r=0;r<i.length;r++)i[r]>n-1&&(null==i[r+1]&&(i[r+1]=0),i[r+1]+=i[r]/n|0,i[r]%=n)}return i.reverse()}return function(a,r,s,i,o){var c,l,u,d,h,m,f,g,T=a.indexOf("."),w=j,b=O;for(T>=0&&(d=G,G=0,a=a.replace(".",""),m=(g=new K(r)).pow(a.length-T),G=d,g.c=t(E(p(m.c),m.e,"0"),10,s,e),g.e=g.c.length),u=d=(f=t(a,r,s,o?(c=H,e):(c=e,H))).length;0==f[--d];f.pop());if(!f[0])return c.charAt(0);if(T<0?--u:(m.c=f,m.e=u,m.s=i,f=(m=n(m,g,w,b,s)).c,h=m.r,u=m.e),T=f[l=u+w+1],d=s/2,h=h||l<0||null!=f[l+1],h=b<4?(null!=T||h)&&(0==b||b==(m.s<0?3:2)):T>d||T==d&&(4==b||h||6==b&&1&f[l-1]||b==(m.s<0?8:7)),l<1||!f[0])a=h?E(c.charAt(1),-w,c.charAt(0)):c.charAt(0);else{if(f.length=l,h)for(--s;++f[--l]>s;)f[l]=0,l||(++u,f=[1].concat(f));for(d=f.length;!f[--d];);for(T=0,a="";T<=d;a+=c.charAt(f[T++]));a=E(a,u,c.charAt(0))}return a}}(),n=function(){function e(e,t,n){var a,r,s,i,o=0,c=e.length,l=t%h,u=t/h|0;for(e=e.slice();c--;)o=((r=l*(s=e[c]%h)+(a=u*s+(i=e[c]/h|0)*l)%h*h+o)/n|0)+(a/h|0)+u*i,e[c]=r%n;return o&&(e=[o].concat(e)),e}function t(e,t,n,a){var r,s;if(n!=a)s=n>a?1:-1;else for(r=s=0;r<n;r++)if(e[r]!=t[r]){s=e[r]>t[r]?1:-1;break}return s}function n(e,t,n,a){for(var r=0;n--;)e[n]-=r,r=e[n]<t[n]?1:0,e[n]=r*a+e[n]-t[n];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(a,r,i,o,u){var d,h,m,p,g,T,w,b,E,y,S,k,I,A,_,C,P,v=a.s==r.s?1:-1,N=a.c,R=r.c;if(!(N&&N[0]&&R&&R[0]))return new K(a.s&&r.s&&(N?!R||N[0]!=R[0]:R)?N&&0==N[0]||!R?0*v:v/0:NaN);for(E=(b=new K(v)).c=[],v=i+(h=a.e-r.e)+1,u||(u=c,h=f(a.e/l)-f(r.e/l),v=v/l|0),m=0;R[m]==(N[m]||0);m++);if(R[m]>(N[m]||0)&&h--,v<0)E.push(1),p=!0;else{for(A=N.length,C=R.length,m=0,v+=2,(g=s(u/(R[0]+1)))>1&&(R=e(R,g,u),N=e(N,g,u),C=R.length,A=N.length),I=C,S=(y=N.slice(0,C)).length;S<C;y[S++]=0);P=R.slice(),P=[0].concat(P),_=R[0],R[1]>=u/2&&_++;do{if(g=0,(d=t(R,y,C,S))<0){if(k=y[0],C!=S&&(k=k*u+(y[1]||0)),(g=s(k/_))>1)for(g>=u&&(g=u-1),w=(T=e(R,g,u)).length,S=y.length;1==t(T,y,w,S);)g--,n(T,C<w?P:R,w,u),w=T.length,d=1;else 0==g&&(d=g=1),w=(T=R.slice()).length;if(w<S&&(T=[0].concat(T)),n(y,T,S,u),S=y.length,-1==d)for(;t(R,y,C,S)<1;)g++,n(y,C<S?P:R,S,u),S=y.length}else 0===d&&(g++,y=[0]);E[m++]=g,y[0]?y[S++]=N[I]||0:(y=[N[I]],S=1)}while((I++<A||null!=y[0])&&v--);p=null!=y[0],E[0]||E.splice(0,1)}if(u==c){for(m=1,v=E[0];v>=10;v/=10,m++);Y(b,i+(b.e=m+h*l-1)+1,o,p)}else b.e=h,b.r=+p;return b}}(),A=/^(-?)0([xbo])(?=\w[\w.]*$)/i,_=/^([^.]+)\.$/,C=/^\.([^.]+)$/,P=/^-?(Infinity|NaN)$/,v=/^\s*\+(?=[\w.])|^\s+|\s+$/g,S=function(e,t,n,a){var r,s=n?t:t.replace(v,"");if(P.test(s))e.s=isNaN(s)?null:s<0?-1:1;else{if(!n&&(s=s.replace(A,function(e,t,n){return r="x"==(n=n.toLowerCase())?16:"b"==n?2:8,a&&a!=r?e:t}),a&&(r=a,s=s.replace(_,"$1").replace(C,"0.$1")),t!=s))return new K(s,r);if(K.DEBUG)throw Error(i+"Not a"+(a?" base "+a:"")+" number: "+t);e.s=null}e.c=e.e=null},N.absoluteValue=N.abs=function(){var e=new K(this);return e.s<0&&(e.s=1),e},N.comparedTo=function(e,t){return g(this,new K(e,t))},N.decimalPlaces=N.dp=function(e,t){var n,a,r,s=this;if(null!=e)return T(e,0,m),null==t?t=O:T(t,0,8),Y(new K(s),e+s.e+1,t);if(!(n=s.c))return null;if(a=((r=n.length-1)-f(this.e/l))*l,r=n[r])for(;r%10==0;r/=10,a--);return a<0&&(a=0),a},N.dividedBy=N.div=function(e,t){return n(this,new K(e,t),j,O)},N.dividedToIntegerBy=N.idiv=function(e,t){return n(this,new K(e,t),0,1)},N.exponentiatedBy=N.pow=function(e,t){var n,a,o,c,u,d,h,m,f=this;if((e=new K(e)).c&&!e.isInteger())throw Error(i+"Exponent not an integer: "+Q(e));if(null!=t&&(t=new K(t)),u=e.e>14,!f.c||!f.c[0]||1==f.c[0]&&!f.e&&1==f.c.length||!e.c||!e.c[0])return m=new K(Math.pow(+Q(f),u?e.s*(2-w(e)):+Q(e))),t?m.mod(t):m;if(d=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new K(NaN);(a=!d&&f.isInteger()&&t.isInteger())&&(f=f.mod(t))}else{if(e.e>9&&(f.e>0||f.e<-1||(0==f.e?f.c[0]>1||u&&f.c[1]>=24e7:f.c[0]<8e13||u&&f.c[0]<=9999975e7)))return c=f.s<0&&w(e)?-0:0,f.e>-1&&(c=1/c),new K(d?1/c:c);G&&(c=r(G/l+2))}for(u?(n=new K(.5),d&&(e.s=1),h=w(e)):h=(o=Math.abs(+Q(e)))%2,m=new K(R);;){if(h){if(!(m=m.times(f)).c)break;c?m.c.length>c&&(m.c.length=c):a&&(m=m.mod(t))}if(o){if(0===(o=s(o/2)))break;h=o%2}else if(Y(e=e.times(n),e.e+1,1),e.e>14)h=w(e);else{if(0===(o=+Q(e)))break;h=o%2}f=f.times(f),c?f.c&&f.c.length>c&&(f.c.length=c):a&&(f=f.mod(t))}return a?m:(d&&(m=R.div(m)),t?m.mod(t):c?Y(m,G,O,undefined):m)},N.integerValue=function(e){var t=new K(this);return null==e?e=O:T(e,0,8),Y(t,t.e+1,e)},N.isEqualTo=N.eq=function(e,t){return 0===g(this,new K(e,t))},N.isFinite=function(){return!!this.c},N.isGreaterThan=N.gt=function(e,t){return g(this,new K(e,t))>0},N.isGreaterThanOrEqualTo=N.gte=function(e,t){return 1===(t=g(this,new K(e,t)))||0===t},N.isInteger=function(){return!!this.c&&f(this.e/l)>this.c.length-2},N.isLessThan=N.lt=function(e,t){return g(this,new K(e,t))<0},N.isLessThanOrEqualTo=N.lte=function(e,t){return-1===(t=g(this,new K(e,t)))||0===t},N.isNaN=function(){return!this.s},N.isNegative=function(){return this.s<0},N.isPositive=function(){return this.s>0},N.isZero=function(){return!!this.c&&0==this.c[0]},N.minus=function(e,t){var n,a,r,s,i=this,o=i.s;if(t=(e=new K(e,t)).s,!o||!t)return new K(NaN);if(o!=t)return e.s=-t,i.plus(e);var u=i.e/l,d=e.e/l,h=i.c,m=e.c;if(!u||!d){if(!h||!m)return h?(e.s=-t,e):new K(m?i:NaN);if(!h[0]||!m[0])return m[0]?(e.s=-t,e):new K(h[0]?i:3==O?-0:0)}if(u=f(u),d=f(d),h=h.slice(),o=u-d){for((s=o<0)?(o=-o,r=h):(d=u,r=m),r.reverse(),t=o;t--;r.push(0));r.reverse()}else for(a=(s=(o=h.length)<(t=m.length))?o:t,o=t=0;t<a;t++)if(h[t]!=m[t]){s=h[t]<m[t];break}if(s&&(r=h,h=m,m=r,e.s=-e.s),(t=(a=m.length)-(n=h.length))>0)for(;t--;h[n++]=0);for(t=c-1;a>o;){if(h[--a]<m[a]){for(n=a;n&&!h[--n];h[n]=t);--h[n],h[a]+=c}h[a]-=m[a]}for(;0==h[0];h.splice(0,1),--d);return h[0]?V(e,h,d):(e.s=3==O?-1:1,e.c=[e.e=0],e)},N.modulo=N.mod=function(e,t){var a,r,s=this;return e=new K(e,t),!s.c||!e.s||e.c&&!e.c[0]?new K(NaN):!e.c||s.c&&!s.c[0]?new K(s):(9==B?(r=e.s,e.s=1,a=n(s,e,0,3),e.s=r,a.s*=r):a=n(s,e,0,B),(e=s.minus(a.times(e))).c[0]||1!=B||(e.s=s.s),e)},N.multipliedBy=N.times=function(e,t){var n,a,r,s,i,o,u,d,m,p,g,T,w,b,E,y=this,S=y.c,k=(e=new K(e,t)).c;if(!(S&&k&&S[0]&&k[0]))return!y.s||!e.s||S&&!S[0]&&!k||k&&!k[0]&&!S?e.c=e.e=e.s=null:(e.s*=y.s,S&&k?(e.c=[0],e.e=0):e.c=e.e=null),e;for(a=f(y.e/l)+f(e.e/l),e.s*=y.s,(u=S.length)<(p=k.length)&&(w=S,S=k,k=w,r=u,u=p,p=r),r=u+p,w=[];r--;w.push(0));for(b=c,E=h,r=p;--r>=0;){for(n=0,g=k[r]%E,T=k[r]/E|0,s=r+(i=u);s>r;)n=((d=g*(d=S[--i]%E)+(o=T*d+(m=S[i]/E|0)*g)%E*E+w[s]+n)/b|0)+(o/E|0)+T*m,w[s--]=d%b;w[s]=n}return n?++a:w.splice(0,1),V(e,w,a)},N.negated=function(){var e=new K(this);return e.s=-e.s||null,e},N.plus=function(e,t){var n,a=this,r=a.s;if(t=(e=new K(e,t)).s,!r||!t)return new K(NaN);if(r!=t)return e.s=-t,a.minus(e);var s=a.e/l,i=e.e/l,o=a.c,u=e.c;if(!s||!i){if(!o||!u)return new K(r/0);if(!o[0]||!u[0])return u[0]?e:new K(o[0]?a:0*r)}if(s=f(s),i=f(i),o=o.slice(),r=s-i){for(r>0?(i=s,n=u):(r=-r,n=o),n.reverse();r--;n.push(0));n.reverse()}for((r=o.length)-(t=u.length)<0&&(n=u,u=o,o=n,t=r),r=0;t;)r=(o[--t]=o[t]+u[t]+r)/c|0,o[t]=c===o[t]?0:o[t]%c;return r&&(o=[r].concat(o),++i),V(e,o,i)},N.precision=N.sd=function(e,t){var n,a,r,s=this;if(null!=e&&e!==!!e)return T(e,1,m),null==t?t=O:T(t,0,8),Y(new K(s),e,t);if(!(n=s.c))return null;if(a=(r=n.length-1)*l+1,r=n[r]){for(;r%10==0;r/=10,a--);for(r=n[0];r>=10;r/=10,a++);}return e&&s.e+1>a&&(a=s.e+1),a},N.shiftedBy=function(e){return T(e,-9007199254740991,u),this.times("1e"+e)},N.squareRoot=N.sqrt=function(){var e,t,a,r,s,i=this,o=i.c,c=i.s,l=i.e,u=j+4,d=new K("0.5");if(1!==c||!o||!o[0])return new K(!c||c<0&&(!o||o[0])?NaN:o?i:1/0);if(0==(c=Math.sqrt(+Q(i)))||c==1/0?(((t=p(o)).length+l)%2==0&&(t+="0"),c=Math.sqrt(+t),l=f((l+1)/2)-(l<0||l%2),a=new K(t=c==1/0?"5e"+l:(t=c.toExponential()).slice(0,t.indexOf("e")+1)+l)):a=new K(c+""),a.c[0])for((c=(l=a.e)+u)<3&&(c=0);;)if(s=a,a=d.times(s.plus(n(i,s,u,1))),p(s.c).slice(0,c)===(t=p(a.c)).slice(0,c)){if(a.e<l&&--c,"9999"!=(t=t.slice(c-3,c+1))&&(r||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(Y(a,a.e+j+2,1),e=!a.times(a).eq(i));break}if(!r&&(Y(s,s.e+j+2,0),s.times(s).eq(i))){a=s;break}u+=4,c+=4,r=1}return Y(a,a.e+j+1,O,e)},N.toExponential=function(e,t){return null!=e&&(T(e,0,m),e++),W(this,e,t,1)},N.toFixed=function(e,t){return null!=e&&(T(e,0,m),e=e+this.e+1),W(this,e,t)},N.toFormat=function(e,t,n){var a,r=this;if(null==n)null!=e&&t&&"object"==typeof t?(n=t,t=null):e&&"object"==typeof e?(n=e,e=t=null):n=U;else if("object"!=typeof n)throw Error(i+"Argument not an object: "+n);if(a=r.toFixed(e,t),r.c){var s,o=a.split("."),c=+n.groupSize,l=+n.secondaryGroupSize,u=n.groupSeparator||"",d=o[0],h=o[1],m=r.s<0,f=m?d.slice(1):d,p=f.length;if(l&&(s=c,c=l,l=s,p-=s),c>0&&p>0){for(s=p%c||c,d=f.substr(0,s);s<p;s+=c)d+=u+f.substr(s,c);l>0&&(d+=u+f.slice(s)),m&&(d="-"+d)}a=h?d+(n.decimalSeparator||"")+((l=+n.fractionGroupSize)?h.replace(new RegExp("\\d{"+l+"}\\B","g"),"$&"+(n.fractionGroupSeparator||"")):h):d}return(n.prefix||"")+a+(n.suffix||"")},N.toFraction=function(e){var t,a,r,s,o,c,u,h,m,f,g,T,w=this,b=w.c;if(null!=e&&(!(u=new K(e)).isInteger()&&(u.c||1!==u.s)||u.lt(R)))throw Error(i+"Argument "+(u.isInteger()?"out of range: ":"not an integer: ")+Q(u));if(!b)return new K(w);for(t=new K(R),m=a=new K(R),r=h=new K(R),T=p(b),o=t.e=T.length-w.e-1,t.c[0]=d[(c=o%l)<0?l+c:c],e=!e||u.comparedTo(t)>0?o>0?t:m:u,c=F,F=1/0,u=new K(T),h.c[0]=0;f=n(u,t,0,1),1!=(s=a.plus(f.times(r))).comparedTo(e);)a=r,r=s,m=h.plus(f.times(s=m)),h=s,t=u.minus(f.times(s=t)),u=s;return s=n(e.minus(a),r,0,1),h=h.plus(s.times(m)),a=a.plus(s.times(r)),h.s=m.s=w.s,g=n(m,r,o*=2,O).minus(w).abs().comparedTo(n(h,a,o,O).minus(w).abs())<1?[m,r]:[h,a],F=c,g},N.toNumber=function(){return+Q(this)},N.toPrecision=function(e,t){return null!=e&&T(e,1,m),W(this,e,t,2)},N.toString=function(e){var t,n=this,a=n.s,r=n.e;return null===r?a?(t="Infinity",a<0&&(t="-"+t)):t="NaN":(null==e?t=r<=x||r>=L?b(p(n.c),r):E(p(n.c),r,"0"):10===e&&q?t=E(p((n=Y(new K(n),j+r+1,O)).c),n.e,"0"):(T(e,2,H.length,"Base"),t=y(E(p(n.c),r,"0"),10,e,a,!0)),a<0&&n.c[0]&&(t="-"+t)),t},N.valueOf=N.toJSON=function(){return Q(this)},N._isBigNumber=!0,null!=t&&K.set(t),K}(),n.default=n.BigNumber=n,"function"==typeof define&&define.amd?define(function(){return n}):void 0!==t&&t.exports?t.exports=n:(e||(e="undefined"!=typeof self&&self?self:window),e.BigNumber=n)}(this)}}},{package:"@metamask/transaction-controller>bignumber.js",file:"node_modules/@metamask/transaction-controller/node_modules/bignumber.js/bignumber.js"}],[3123,{"./actions/update-payment-token.cjs":3124,"./constants.cjs":3125,"./helpers/QuoteRefresher.cjs":3126,"./utils/quotes.cjs":3140,"./utils/source-amounts.cjs":3142,"./utils/transaction.cjs":3146,"@metamask/base-controller":1407,lodash:4901},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},u=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayController=void 0;const d=e("@metamask/base-controller"),h=e("lodash"),m=e("./actions/update-payment-token.cjs"),f=e("./constants.cjs"),p=e("./helpers/QuoteRefresher.cjs"),g=e("./utils/quotes.cjs"),T=e("./utils/source-amounts.cjs"),w=e("./utils/transaction.cjs"),b={transactionData:{includeInDebugSnapshot:!1,includeInStateLogs:!0,persist:!1,usedInUi:!0}};class E extends d.BaseController{constructor({getDelegationTransaction:e,getStrategy:t,messenger:n,state:d}){super({name:f.CONTROLLER_NAME,metadata:b,messenger:n,state:{transactionData:{},...d}}),a.add(this),r.set(this,void 0),s.set(this,void 0),l(this,r,e,"f"),l(this,s,t,"f"),u(this,a,"m",c).call(this),(0,w.pollTransactionChanges)(n,u(this,a,"m",o).bind(this),u(this,a,"m",i).bind(this)),new p.QuoteRefresher({messenger:n,updateTransactionData:u(this,a,"m",o).bind(this)})}setIsMaxAmount(e,t){u(this,a,"m",o).call(this,e,e=>{e.isMaxAmount=t})}updatePaymentToken(e){(0,m.updatePaymentToken)(e,{messenger:this.messenger,updateTransactionData:u(this,a,"m",o).bind(this)})}}n.TransactionPayController=E,r=new WeakMap,s=new WeakMap,a=new WeakSet,i=function(e){this.update(t=>{delete t.transactionData[e]})},o=function e(t,n){let r=!1;this.update(e=>{const{transactionData:a}=e;let s=a[t];const i=s?.paymentToken,o=s?.tokens,c=s?.isMaxAmount;s||(a[t]={isLoading:!1,tokens:[]},s=a[t]),n(s);const l=s.paymentToken!==i,u=s.tokens!==o,d=s.isMaxAmount!==c;(l||d||u)&&((0,T.updateSourceAmounts)(t,s,this.messenger),r=!0)}),r&&(0,g.updateQuotes)({messenger:this.messenger,transactionData:this.state.transactionData[t],transactionId:t,updateTransactionData:u(this,a,"m",e).bind(this)}).catch(h.noop)},c=function(){this.messenger.registerActionHandler("TransactionPayController:getDelegationTransaction",u(this,r,"f").bind(this)),this.messenger.registerActionHandler("TransactionPayController:getStrategy",u(this,s,"f")??(()=>f.TransactionPayStrategy.Relay)),this.messenger.registerActionHandler("TransactionPayController:setIsMaxAmount",this.setIsMaxAmount.bind(this)),this.messenger.registerActionHandler("TransactionPayController:updatePaymentToken",this.updatePaymentToken.bind(this))}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/TransactionPayController.cjs"}],[3124,{"../logger.cjs":3129,"../utils/token.cjs":3144,"../utils/transaction.cjs":3146,"@metamask/utils":3217,"bignumber.js":3188},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.updatePaymentToken=void 0;const a=e("@metamask/utils"),r=e("bignumber.js"),s=e("../logger.cjs"),i=e("../utils/token.cjs"),o=e("../utils/transaction.cjs"),c=(0,a.createModuleLogger)(s.projectLogger,"update-payment-token");n.updatePaymentToken=function(e,t){const{transactionId:n,tokenAddress:a,chainId:s}=e,{messenger:l,updateTransactionData:u}=t,d=(0,o.getTransaction)(n,l);if(!d)throw new Error("Transaction not found");const h=function({chainId:e,from:t,messenger:n,tokenAddress:a}){const{decimals:s,symbol:o}=(0,i.getTokenInfo)(n,a,e)??{};if(s===undefined||!o)return undefined;const c=(0,i.getTokenFiatRate)(n,a,e);if(c===undefined)return undefined;const l=(0,i.getTokenBalance)(n,t,e,a),u=new r.BigNumber(l),d=new r.BigNumber(l).shiftedBy(-s),h=u.toFixed(0),m=d.toString(10),f=d.multipliedBy(c.fiatRate).toString(10),p=d.multipliedBy(c.usdRate).toString(10);return{address:a,balanceFiat:f,balanceHuman:m,balanceRaw:h,balanceUsd:p,chainId:e,decimals:s,symbol:o}}({chainId:s,from:d?.txParams.from,messenger:l,tokenAddress:a});if(!h)throw new Error("Payment token not found");c("Updated payment token",{transactionId:n,paymentToken:h}),u(n,e=>{e.paymentToken=h})}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/actions/update-payment-token.cjs"}],[3125,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a;Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayStrategy=n.POLYGON_USDCE_ADDRESS=n.ARBITRUM_USDC_ADDRESS=n.NATIVE_TOKEN_ADDRESS=n.CHAIN_ID_POLYGON=n.CHAIN_ID_ARBITRUM=n.CONTROLLER_NAME=void 0,n.CONTROLLER_NAME="TransactionPayController",n.CHAIN_ID_ARBITRUM="0xa4b1",n.CHAIN_ID_POLYGON="0x89",n.NATIVE_TOKEN_ADDRESS="0x0000000000000000000000000000000000000000",n.ARBITRUM_USDC_ADDRESS="0xaf88d065e77c8cC2239327C5EDb3A432268e5831",n.POLYGON_USDCE_ADDRESS="0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174",function(e){e.Bridge="bridge",e.Relay="relay",e.Test="test"}(a||(n.TransactionPayStrategy=a={}))}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/constants.cjs"}],[3126,{"../logger.cjs":3129,"../utils/quotes.cjs":3140,"@metamask/utils":3217,lodash:4901},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l,u,d,h,m,f=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},p=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.QuoteRefresher=void 0;const g=e("@metamask/utils"),T=e("lodash"),w=e("../logger.cjs"),b=e("../utils/quotes.cjs"),E=(0,g.createModuleLogger)(w.projectLogger,"quote-refresh");n.QuoteRefresher=class{constructor({messenger:e,updateTransactionData:t}){a.add(this),r.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),f(this,i,e,"f"),f(this,r,!1,"f"),f(this,s,!1,"f"),f(this,c,t,"f"),e.subscribe("TransactionPayController:stateChange",p(this,a,"m",m).bind(this))}},r=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,a=new WeakSet,l=function(){f(this,r,!0,"f"),E("Started"),p(this,s,"f")||p(this,a,"m",h).call(this)},u=function(){p(this,o,"f")&&clearTimeout(p(this,o,"f")),f(this,r,!1,"f"),E("Stopped")},d=async function(){f(this,s,!0,"f");try{await(0,b.refreshQuotes)(p(this,i,"f"),p(this,c,"f"))}catch(e){E("Error refreshing quotes",e)}finally{f(this,s,!1,"f"),p(this,a,"m",h).call(this)}},h=function(){p(this,r,"f")&&(p(this,o,"f")&&clearTimeout(p(this,o,"f")),f(this,o,setTimeout(()=>{p(this,a,"m",d).call(this).catch(T.noop)},1e3),"f"))},m=function(e){const t=Object.values(e.transactionData).some(e=>Boolean(e.quotes?.length));t&&!p(this,r,"f")?p(this,a,"m",l).call(this):!t&&p(this,r,"f")&&p(this,a,"m",u).call(this)}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/helpers/QuoteRefresher.cjs"}],[3127,{"../logger.cjs":3129,"../utils/strategy.cjs":3143,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayPublishHook=void 0;const u=e("@metamask/utils"),d=e("../logger.cjs"),h=e("../utils/strategy.cjs"),m=(0,u.createModuleLogger)(d.projectLogger,"pay-publish-hook"),f={transactionHash:undefined};n.TransactionPayPublishHook=class{constructor({isSmartTransaction:e,messenger:t}){a.add(this),r.set(this,void 0),s.set(this,void 0),c(this,r,e,"f"),c(this,s,t,"f")}getHook(){return l(this,a,"m",i).bind(this)}},r=new WeakMap,s=new WeakMap,a=new WeakSet,i=async function(e,t){try{return await l(this,a,"m",o).call(this,e,t)}catch(e){throw m("Error",e),e}},o=async function(e,t){const{id:n}=e,a=l(this,s,"f").call("TransactionPayController:getState"),i=a.transactionData?.[n]?.quotes??[];if(!i?.length)return m("Skipping as no quotes found"),f;const o=(0,h.getStrategy)(l(this,s,"f"),e);return await o.execute({isSmartTransaction:l(this,r,"f"),quotes:i,messenger:l(this,s,"f"),transaction:e})}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/helpers/TransactionPayPublishHook.cjs"}],[3128,{"./TransactionPayController.cjs":3123,"./constants.cjs":3125,"./helpers/TransactionPayPublishHook.cjs":3127},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayPublishHook=n.TransactionPayController=n.TransactionPayStrategy=void 0;var a=e("./constants.cjs");Object.defineProperty(n,"TransactionPayStrategy",{enumerable:!0,get:function(){return a.TransactionPayStrategy}});var r=e("./TransactionPayController.cjs");Object.defineProperty(n,"TransactionPayController",{enumerable:!0,get:function(){return r.TransactionPayController}});var s=e("./helpers/TransactionPayPublishHook.cjs");Object.defineProperty(n,"TransactionPayPublishHook",{enumerable:!0,get:function(){return s.TransactionPayPublishHook}})}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/index.cjs"}],[3129,{"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.projectLogger=void 0;const a=e("@metamask/utils");Object.defineProperty(n,"createModuleLogger",{enumerable:!0,get:function(){return a.createModuleLogger}}),n.projectLogger=(0,a.createProjectLogger)("transaction-pay-controller")}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/logger.cjs"}],[3130,{"./bridge-quotes.cjs":3131,"./bridge-submit.cjs":3132},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.BridgeStrategy=void 0;const a=e("./bridge-quotes.cjs"),r=e("./bridge-submit.cjs");n.BridgeStrategy=class{async getQuotes(e){return(0,a.getBridgeQuotes)(e)}async getBatchTransactions(e){return(0,a.getBridgeBatchTransactions)(e)}async getRefreshInterval(e){return(0,a.getBridgeRefreshInterval)(e)}async execute(e){const{isSmartTransaction:t,quotes:n,messenger:a,transaction:s}=e,i=s.txParams.from;return await(0,r.submitBridgeQuotes)({from:i,isSmartTransaction:t,messenger:a,quotes:n,transaction:s}),{transactionHash:undefined}}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/bridge/BridgeStrategy.cjs"}],[3131,{"../../index.cjs":3128,"../../logger.cjs":3129,"../../utils/gas.cjs":3139,"../../utils/token.cjs":3144,"@metamask/bridge-controller":3153,"@metamask/controller-utils":1494,"@metamask/transaction-controller":3095,"@metamask/utils":3217,"bignumber.js":3188,lodash:4901},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.refreshQuote=n.getBridgeRefreshInterval=n.getBridgeBatchTransactions=n.getBridgeQuotes=void 0;const a=e("@metamask/bridge-controller"),r=e("@metamask/controller-utils"),s=e("@metamask/transaction-controller"),i=e("@metamask/utils"),o=e("bignumber.js"),c=e("lodash"),l=e("../../index.cjs"),u=e("../../logger.cjs"),d=e("../../utils/gas.cjs"),h=e("../../utils/token.cjs"),m="All quotes under minimum",f=new Map([[s.TransactionType.perpsDeposit,a.FeatureId.PERPS]]),p=(0,i.createModuleLogger)(u.projectLogger,"bridge-strategy");function g(e){return{data:e.data,gas:e.gasLimit?(0,r.toHex)(e.gasLimit):undefined,isAfter:!1,to:e.to,value:e.value}}async function T(e,t,n){const{from:a,slippage:s,sourceChainId:i,sourceTokenAddress:l,sourceTokenAmount:u,targetChainId:d,targetTokenAddress:h}=e,{type:g}=n,T=f.get(g),w={destChainId:d,destTokenAddress:(0,r.toChecksumHexAddress)(h),destWalletAddress:a,gasIncluded:!1,gasIncluded7702:!1,insufficientBal:!1,slippage:100*s,srcChainId:i,srcTokenAddress:(0,r.toChecksumHexAddress)(l),srcTokenAmount:u,walletAddress:a},b=await t.call("BridgeController:fetchQuotes",w,undefined,T);if(!b.length)throw new Error("No quotes found");const E=function(e,t){const n=(0,c.orderBy)(e,e=>e.estimatedProcessingTimeInSeconds,"asc").slice(0,3),a=n.filter(e=>new o.BigNumber(e.quote.minDestTokenAmount).isGreaterThanOrEqualTo(t.targetAmountMinimum));if(p("Finding best quote",{allQuotes:e,fastestQuotes:n,quotesOverMinimumTarget:a}),!a.length)throw new Error(m);return(0,c.orderBy)(a,e=>(0,o.BigNumber)(e.quote.minDestTokenAmount).toNumber(),"desc")[0]}(b,e);return{...E,request:e}}function w(e,t,n,a){const r=new o.BigNumber(e).shiftedBy(-t),s=r.toString(10),i=r.multipliedBy(a).toString(10);return{fiat:r.multipliedBy(n).toString(10),human:s,raw:e,usd:i}}function b(e,t,{isMax:n=!1}={}){const{approval:a,trade:r}=e,s=a?E(a,t,{isMax:n}):{fiat:"0",human:"0",raw:"0",usd:"0"},i=E(r,t,{isMax:n});return{fiat:new o.BigNumber(s.fiat).plus(i.fiat).toString(10),human:new o.BigNumber(s.human).plus(i.human).toString(10),raw:new o.BigNumber(s.raw).plus(i.raw).toString(10),usd:new o.BigNumber(s.usd).plus(i.usd).toString(10)}}function E(e,t,{isMax:n}){const{effectiveGas:a,gasLimit:r}=e,s=n?undefined:a;return(0,d.calculateGasCost)({...e,gas:s??r??"0x0",messenger:t,isMax:n})}n.getBridgeQuotes=async function(e){p("Fetching quotes",e);const{requests:t,messenger:n,transaction:a}=e;try{const r=function(e,t){const n=function(e){const t=e.call("RemoteFeatureFlagController:getState").remoteFeatureFlags.confirmations_pay;return{attemptsMax:t?.attemptsMax??5,bufferInitial:t?.bufferInitial??.04,bufferStep:t?.bufferStep??.04,bufferSubsequent:t?.bufferSubsequent??.05,slippage:t?.slippage??.005}}(t);return e.map(e=>({...e,...n})).map((t,n)=>{const a=0===n,r=a?t.attemptsMax:1,s=e.reduce((e,r,s)=>{const i=r.sourceTokenAddress.toLowerCase()===t.sourceTokenAddress.toLowerCase()&&r.sourceChainId===t.sourceChainId;return a&&s>n&&i?e.minus(r.sourceTokenAmount):e},new o.BigNumber(t.sourceBalanceRaw)).toFixed(0);return{...t,attemptsMax:r,sourceBalanceRaw:s}})}(t,n),s=await Promise.all(r.map((t,n)=>async function(e,t,n){const{attemptsMax:a,bufferInitial:r,bufferStep:s,bufferSubsequent:i,sourceBalanceRaw:c,sourceTokenAmount:l,targetAmountMinimum:u,targetTokenAddress:d}=e,h=new o.BigNumber(l),f=0===t?r:i,g=h.div(1+f),w=Date.now();let b=l;for(let t=0;t<a;t++){const i={...e,sourceTokenAmount:b};try{p("Attempt",{attempt:t+1,attemptsMax:a,bufferInitial:r,bufferStep:s,currentSourceAmount:b,target:d});const e=await T(i,n.messenger,n.transaction),c=new o.BigNumber(e.quote.minDestTokenAmount).minus(u).toString(10);return p("Found valid quote",{attempt:t+1,target:d,targetAmount:e.quote.minDestTokenAmount,goalAmount:u,dust:c,quote:e}),{...e,metrics:{attempts:t+1,buffer:f+s*t,latency:Date.now()-w}}}catch(e){if(e.message!==m)throw e}if(new o.BigNumber(b).isGreaterThanOrEqualTo(c)){p("Reached balance limit",{targetTokenAddress:d,sourceBalanceRaw:c,currentSourceAmount:b,attempt:t+1});break}const l=g.multipliedBy(1+f+s*(t+1));b=l.isLessThan(c)?l.toFixed(0):c}throw p("All attempts failed",d),new Error(m)}(t,n,e)));return s.map((e,t)=>function(e,t,n,a){const r=(0,h.getTokenFiatRate)(n,t.sourceTokenAddress,t.sourceChainId);if(r===undefined)throw new Error(`Fiat rate not found for source token - Chain ID: ${t.sourceChainId}, Address: ${t.sourceTokenAddress}`);const s=(0,h.getTokenFiatRate)(n,t.targetTokenAddress,t.targetChainId);if(s===undefined)throw new Error(`Fiat rate not found for target token - Chain ID: ${t.targetChainId}, Address: ${t.targetTokenAddress}`);const i=w(e.quote.minDestTokenAmount,e.quote.destAsset.decimals,s.fiatRate,s.usdRate),c=w(e.quote.srcTokenAmount,e.quote.srcAsset.decimals,r.fiatRate,r.usdRate),u=w(t.targetAmountMinimum,e.quote.destAsset.decimals,s.fiatRate,s.usdRate),m=(0,d.calculateTransactionGasCost)(a,n),f={estimate:b(e,n),max:b(e,n,{isMax:!0})};return{estimatedDuration:e.estimatedProcessingTimeInSeconds,dust:{fiat:new o.BigNumber(i.fiat).minus(u.fiat).toString(10),usd:new o.BigNumber(i.usd).minus(u.usd).toString(10)},fees:{provider:{fiat:new o.BigNumber(c.fiat).minus(i.fiat).toString(10),usd:new o.BigNumber(c.usd).minus(i.usd).toString(10)},sourceNetwork:f,targetNetwork:m},original:e,request:t,sourceAmount:c,targetAmount:u,strategy:l.TransactionPayStrategy.Bridge}}(e,r[t],n,a))}catch(e){throw p("Error fetching quotes",{error:e}),new Error(`Failed to fetch bridge quotes: ${String(e)}`)}},n.getBridgeBatchTransactions=async function(e){const{quotes:t}=e,n=t[0]?.original?.quote;return n?.srcChainId!==n?.destChainId?(p("No batch transactions needed for bridge quotes"),[]):t.map(e=>e.original).flatMap(e=>{const t=[];return e.approval&&t.push({...g(e.approval),type:s.TransactionType.swapApproval}),t.push({...g(e.trade),type:s.TransactionType.swap}),t})},n.getBridgeRefreshInterval=function(e){const{chainId:t,messenger:n}=e,a=n.call("RemoteFeatureFlagController:getState").remoteFeatureFlags.bridgeConfigV2,r=a?.chains?.[parseInt(t,16)]?.refreshRate,s=a?.refreshRate;return r??s},n.refreshQuote=async function(e,t,n){const a=await T({...e.original.request,attemptsMax:1},t,n);return p("Refreshed quote",{old:e,new:a}),a}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/bridge/bridge-quotes.cjs"}],[3132,{"../../logger.cjs":3129,"../../utils/transaction.cjs":3146,"./bridge-quotes.cjs":3131,"@metamask/bridge-controller":3153,"@metamask/controller-utils":1494,"@metamask/utils":3217,lodash:4901},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.submitBridgeQuotes=void 0;const a=e("@metamask/bridge-controller"),r=e("@metamask/controller-utils"),s=e("@metamask/utils"),i=e("lodash"),o=e("./bridge-quotes.cjs"),c=e("../../logger.cjs"),l=e("../../utils/transaction.cjs"),u=(0,s.createModuleLogger)(c.projectLogger,"bridge-strategy");async function d(e,t){const{isSmartTransaction:n,messenger:s,from:o,transaction:c}=e,d=(0,i.cloneDeep)(t),h=(0,r.toHex)(d.quote.srcChainId),m=n(h),f=[],p=(0,l.collectTransactionIds)(h,o,s,e=>(0,l.updateTransaction)({transactionId:c.id,messenger:s,note:"Add required transaction ID"},t=>{t.requiredTransactionIds??(t.requiredTransactionIds=[]),t?.requiredTransactionIds.push(e),f.push(e)})),g={amount:"0",valueInCurrency:null,usd:null},T={gasFee:{effective:g,max:g,total:g},totalNetworkFee:g,totalMaxNetworkFee:g,toTokenAmount:g,minToTokenAmount:g,adjustedReturn:g,sentAmount:g,swapRate:"0",cost:g},w=await s.call("BridgeStatusController:submitTx",o,{...d,...T},m);p.end(),u("Bridge transaction submitted",{requiredTransactionIds:f,result:w}),await Promise.all(f.map(e=>(0,l.waitForTransactionConfirmed)(e,s))),u("All required transactions confirmed",f);const{id:b}=w;u("Waiting for bridge completion",b),await async function(e,t){return new Promise((n,r)=>{const s=(e,t)=>{const s=e?.status?.status;return u("Checking bridge status",s??"missing"),s===a.StatusTypes.COMPLETE?(t?.(),n(),!0):s===a.StatusTypes.FAILED&&(t?.(),r(new Error("Bridge failed")),!0)},i=t.call("BridgeStatusController:getState").txHistory[e];if(s(i))return;const o=e=>{s(e,()=>t.unsubscribe("BridgeStatusController:stateChange",o))};t.subscribe("BridgeStatusController:stateChange",o,t=>t.txHistory[e])})}(b,s)}n.submitBridgeQuotes=async function(e){const{quotes:t,messenger:n,transaction:a}=e;if(!t?.length)return void u("No quotes found");if(t[0].original.quote.srcChainId===t[0].original.quote.destChainId)return void u("Ignoring quotes as source is same chain",t[0].original.quote.srcChainId);let r=0;for(const s of t){u("Submitting bridge",r,s);let t=s.original;if(r>0)try{t=await(0,o.refreshQuote)(s,n,a)}catch(e){u("Failed to refresh subsequent quote before submit",e)}await d(e,t),r+=1}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/bridge/bridge-submit.cjs"}],[3133,{"./relay-quotes.cjs":3135,"./relay-submit.cjs":3136},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RelayStrategy=void 0;const a=e("./relay-quotes.cjs"),r=e("./relay-submit.cjs");n.RelayStrategy=class{async getQuotes(e){return(0,a.getRelayQuotes)(e)}async execute(e){return await(0,r.submitRelayQuotes)(e)}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/relay/RelayStrategy.cjs"}],[3134,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TOKEN_TRANSFER_FOUR_BYTE=n.RELAY_POLLING_INTERVAL=n.RELAY_STATUS_URL=n.RELAY_URL_BASE=n.CHAIN_ID_HYPERCORE=void 0,n.CHAIN_ID_HYPERCORE="0x539",n.RELAY_URL_BASE="https://api.relay.link",n.RELAY_STATUS_URL=`${n.RELAY_URL_BASE}/intents/status/v3`,n.RELAY_POLLING_INTERVAL=1e3,n.TOKEN_TRANSFER_FOUR_BYTE="0xa9059cbb"}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/relay/constants.cjs"}],[3135,{"../../constants.cjs":3125,"../../index.cjs":3128,"../../logger.cjs":3129,"../../utils/feature-flags.cjs":3138,"../../utils/gas.cjs":3139,"../../utils/token.cjs":3144,"./constants.cjs":3134,"@ethersproject/abi":754,"@metamask/controller-utils":1494,"@metamask/utils":3217,"bignumber.js":3188},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRelayQuotes=void 0;const a=e("@ethersproject/abi"),r=e("@metamask/controller-utils"),s=e("@metamask/utils"),i=e("bignumber.js"),o=e("./constants.cjs"),c=e("../../index.cjs"),l=e("../../constants.cjs"),u=e("../../logger.cjs"),d=e("../../utils/feature-flags.cjs"),h=e("../../utils/gas.cjs"),m=e("../../utils/token.cjs"),f=(0,s.createModuleLogger)(u.projectLogger,"relay-strategy");function p(e,t){const n=e.multipliedBy(t);return{usd:e.toString(10),fiat:n.toString(10)}}function g(e,t){return new a.Interface(["function transfer(address to, uint256 amount)"]).encodeFunctionData("transfer",[e,t])}function T(e){return new a.Interface(["function transfer(address to, uint256 amount)"]).decodeFunctionData("transfer",e).to.toLowerCase()}n.getRelayQuotes=async function(e){const{requests:t}=e;f("Fetching quotes",t);try{const n=t.filter(e=>"0"!==e.targetAmountMinimum).map(e=>function(e){const t={...e},n=e.targetChainId===l.CHAIN_ID_ARBITRUM&&e.targetTokenAddress.toLowerCase()===l.ARBITRUM_USDC_ADDRESS.toLowerCase(),a=e.sourceChainId===l.CHAIN_ID_POLYGON&&e.sourceTokenAddress===(0,m.getNativeToken)(e.sourceChainId);a&&(t.sourceTokenAddress=l.NATIVE_TOKEN_ADDRESS);n&&(t.targetChainId=o.CHAIN_ID_HYPERCORE,t.targetTokenAddress="0x00000000000000000000000000000000",t.targetAmountMinimum=new i.BigNumber(e.targetAmountMinimum).shiftedBy(2).toString(10),f("Converting Arbitrum Hyperliquid deposit to direct deposit",{originalRequest:e,normalizedRequest:t}));return t}(e));return f("Normalized requests",n),await Promise.all(n.map(t=>async function(e,t){const{messenger:n,transaction:a}=t,{slippage:s}=(0,d.getFeatureFlags)(n),u=new i.BigNumber(100*s*100).toFixed(0),{from:w,isMaxAmount:b,sourceChainId:E,sourceTokenAddress:y,sourceTokenAmount:S,targetAmountMinimum:k,targetChainId:I,targetTokenAddress:A}=e;try{const s={amount:b?S:k,destinationChainId:Number(I),destinationCurrency:A,originChainId:Number(E),originCurrency:y,recipient:w,slippageTolerance:u,tradeType:b?"EXACT_INPUT":"EXPECTED_OUTPUT",user:w};await async function(e,t,n,a){const{nestedTransactions:r,txParams:s}=e,{isMaxAmount:i,targetChainId:c}=t,l=s?.data,u=1===r?.length?r[0].data:l,d=c===o.CHAIN_ID_HYPERCORE,h=!d&&Boolean(u?.startsWith(o.TOKEN_TRANSFER_FOUR_BYTE));h&&(n.recipient=T(u),f("Updating recipient as token transfer",n.recipient));const m=u===undefined||"0x"===u;if(m||h||d)return void f("Skipping delegation as token transfer or Hypercore deposit");if(i)throw new Error("Max amount quotes do not support included transactions");const p=await a.call("TransactionPayController:getDelegationTransaction",{transaction:e}),w=p.authorizationList?.map(e=>({...e,chainId:Number(e.chainId),nonce:Number(e.nonce),r:e.r,s:e.s,yParity:Number(e.yParity)}));n.authorizationList=w,n.tradeType="EXACT_OUTPUT";const b=r?.find(e=>e.data?.startsWith(o.TOKEN_TRANSFER_FOUR_BYTE))?.data;b&&(n.recipient=T(b),n.refundTo=t.from);n.txs=[{to:t.targetTokenAddress,data:g(t.from,t.targetAmountMinimum),value:"0x0"},{to:p.to,data:p.data,value:p.value}]}(a,e,s,n);const _=(0,d.getFeatureFlags)(n).relayQuoteUrl;f("Request body",{body:s,url:_});const C=await(0,r.successfulFetch)(_,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),P=await C.json();return P.request=s,f("Fetched relay quote",P),async function(e,t,n){const{messenger:a}=n,{details:s}=e,{currencyIn:o,currencyOut:u}=s,{usdToFiatRate:g}=function(e,t){const{sourceChainId:n,sourceTokenAddress:a}=t,r=n===l.CHAIN_ID_POLYGON&&a===l.NATIVE_TOKEN_ADDRESS?(0,m.getNativeToken)(n):a,s=(0,m.getTokenFiatRate)(e,r,n);if(!s)throw new Error("Source token fiat rate not found");const o=new i.BigNumber(s.fiatRate).dividedBy(s.usdRate);return{sourceFiatRate:s,usdToFiatRate:o}}(a,t),T=p(function(e,t){const{currencyOut:n}=e.details,{amountUsd:a,amountFormatted:r,minimumAmount:s}=n,{decimals:o}=n.currency,c=new i.BigNumber(a).dividedBy(r),l=new i.BigNumber(s).minus(t.targetAmountMinimum);return l.shiftedBy(-o).multipliedBy(c)}(e,t),g),w=p(function(e){return new i.BigNumber(e.details.totalImpact.usd).abs()}(e),g),{gasLimits:b,isGasFeeToken:E,...y}=await async function(e,t,n){const{from:a,sourceChainId:s,sourceTokenAddress:o}=n,c=e.steps.flatMap(e=>e.items).map(e=>e.data),{relayDisabledGasStationChains:l}=(0,d.getFeatureFlags)(t),{chainId:u,data:p,maxFeePerGas:g,maxPriorityFeePerGas:T,to:w,value:b}=c[0],{totalGasEstimate:E,totalGasLimit:y,gasLimits:S}=await async function(e,t){if(1===e.length)return async function(e,t){const n=e.gas?new i.BigNumber(e.gas).toNumber():undefined;if(n)return f("Using single gas limit from params",{paramGasLimit:n}),{totalGasEstimate:n,totalGasLimit:n,gasLimits:[n]};try{const{chainId:n,data:a,from:s,to:o,value:c}=e,l=(0,r.toHex)(n),u=(0,r.toHex)(c??"0"),h=(0,d.getGasBuffer)(t,l),m=t.call("NetworkController:findNetworkClientIdByChainId",l),{gas:p,simulationFails:g}=await t.call("TransactionController:estimateGas",{from:s,data:a,to:o,value:u},m),T=new i.BigNumber(p).toNumber(),w=Math.ceil(T*h);if(!g)return f("Estimated gas limit for single transaction",{chainId:l,estimatedGas:T,bufferedGas:w,gasBuffer:h}),{totalGasEstimate:w,totalGasLimit:w,gasLimits:[w]}}catch(e){f("Failed to estimate gas limit for single transaction",e)}const a=(0,d.getFeatureFlags)(t).relayFallbackGas;return f("Using fallback gas for single transaction",{fallbackGas:a}),{totalGasEstimate:a.estimate,totalGasLimit:a.max,gasLimits:[a.max]}}(e[0],t);return async function(e,t){try{const{chainId:n,from:a}=e[0],s=(0,r.toHex)(n),o=(0,d.getGasBuffer)(t,s),c=e.map(e=>({...e,gas:e.gas?(0,r.toHex)(e.gas):undefined,maxFeePerGas:undefined,maxPriorityFeePerGas:undefined,value:(0,r.toHex)(e.value??"0")})),l=e.map(e=>e.gas?new i.BigNumber(e.gas).toNumber():undefined),{totalGasLimit:u,gasLimits:h}=await t.call("TransactionController:estimateGasBatch",{chainId:s,from:a,transactions:c}),m=h.map((e,t)=>{const n=1===h.length||l[t]!==h[t]?o:1;return Math.ceil(e*n)}),p=m.reduce((e,t)=>e+t,0);return f("Estimated gas limit for batch",{chainId:s,totalGasLimit:u,gasLimits:h,bufferedTotalGasLimit:p,bufferedGasLimits:m,gasBuffer:o}),{totalGasEstimate:p,totalGasLimit:p,gasLimits:m}}catch(e){f("Failed to estimate gas limit for batch",e)}const n=(0,d.getFeatureFlags)(t).relayFallbackGas,a=e.reduce((e,t)=>{const a=t.gas??n.estimate;return e+new i.BigNumber(a).toNumber()},0),s=e.map(e=>{const t=e.gas??n.max;return new i.BigNumber(t).toNumber()}),o=s.reduce((e,t)=>e+t,0);return f("Using fallback gas for batch",{totalGasEstimate:a,totalGasLimit:o,gasLimits:s}),{totalGasEstimate:a,totalGasLimit:o,gasLimits:s}}(e,t)}(c,t);f("Gas limit",{totalGasEstimate:E,totalGasLimit:y,gasLimits:S});const k=(0,h.calculateGasCost)({chainId:u,gas:E,maxFeePerGas:g,maxPriorityFeePerGas:T,messenger:t}),I=(0,h.calculateGasCost)({chainId:u,gas:y,maxFeePerGas:g,maxPriorityFeePerGas:T,messenger:t,isMax:!0}),A=(0,m.getTokenBalance)(t,a,s,(0,m.getNativeToken)(s)),_={estimate:k,max:I,gasLimits:S};if(new i.BigNumber(A).isGreaterThanOrEqualTo(I.raw))return _;if(l.includes(s))return f("Skipping gas station as disabled chain",{sourceChainId:s,disabledChainIds:l}),_;f("Checking gas fee tokens as insufficient native balance",{nativeBalance:A,max:I.raw});const C=await t.call("TransactionController:getGasFeeTokens",{chainId:s,data:p,from:a,to:w,value:(0,r.toHex)(b??"0")});f("Source gas fee tokens",{gasFeeTokens:C});const P=C.find(e=>e.tokenAddress.toLowerCase()===o.toLowerCase());if(!P)return f("No matching gas fee token found",{sourceTokenAddress:o,gasFeeTokens:C}),_;let v=P.amount;if(c.length>1){const e=new i.BigNumber(P.amount,16).dividedBy(P.gas,16),t=e.multipliedBy(E);v=(0,r.toHex)(t.toFixed(0)),f("Estimated gas fee token amount for batch",{finalAmount:t.toString(10),gasRate:e.toString(10),totalGasEstimate:E})}const N={...P,amount:v},R=(0,h.calculateGasFeeTokenCost)({chainId:s,gasFeeToken:N,messenger:t});if(!R)return _;return f("Using gas fee token for source network",{gasFeeTokenCost:R}),{isGasFeeToken:!0,estimate:R,max:R,gasLimits:S}}(e,a,t),S={usd:"0",fiat:"0"},k={human:o.amountFormatted,raw:o.amount,...p(new i.BigNumber(o.amountUsd),g)},I={human:u.amountFormatted,raw:u.amount,...p(new i.BigNumber(u.amountUsd),g)},A={gasLimits:b};return{dust:T,estimatedDuration:s.timeEstimate,fees:{isSourceGasFeeToken:E,provider:w,sourceNetwork:y,targetNetwork:S},original:{...e,metamask:A},request:t,sourceAmount:k,targetAmount:I,strategy:c.TransactionPayStrategy.Relay}}(P,e,t)}catch(e){throw f("Error fetching relay quote",e),e}}(t,e)))}catch(e){throw f("Error fetching quotes",{error:e}),new Error(`Failed to fetch Relay quotes: ${String(e)}`)}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/relay/relay-quotes.cjs"}],[3136,{"../../logger.cjs":3129,"../../utils/feature-flags.cjs":3138,"../../utils/transaction.cjs":3146,"./constants.cjs":3134,"@metamask/controller-utils":1494,"@metamask/transaction-controller":3095,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.submitRelayQuotes=void 0;const a=e("@metamask/controller-utils"),r=e("@metamask/transaction-controller"),s=e("@metamask/utils"),i=e("./constants.cjs"),o=e("../../logger.cjs"),c=e("../../utils/feature-flags.cjs"),l=e("../../utils/transaction.cjs"),u="0x0",d=(0,s.createModuleLogger)(o.projectLogger,"relay-strategy");async function h(e,t,n){d("Executing single quote",e),(0,l.updateTransaction)({transactionId:n.id,messenger:t,note:"Remove nonce from skipped transaction"},e=>{e.txParams.nonce=undefined}),await async function(e,t,n){const{steps:s}=e.original,i=s.flatMap(e=>e.items).map(e=>e.data),o=s.find(e=>"transaction"!==e.kind)?.kind;if(o)throw new Error(`Unsupported step kind: ${o}`);const u=i.map(e=>function(e,t){const n=(0,c.getFeatureFlags)(t);return{data:e.data,from:e.from,gas:(0,a.toHex)(e.gas??n.relayFallbackGas.max),maxFeePerGas:(0,a.toHex)(e.maxFeePerGas),maxPriorityFeePerGas:(0,a.toHex)(e.maxPriorityFeePerGas),to:e.to,value:(0,a.toHex)(e.value??"0")}}(e,n)),h=[],{from:m,sourceChainId:f,sourceTokenAddress:p}=e.request,g=n.call("NetworkController:findNetworkClientIdByChainId",f);d("Adding transactions",{normalizedParams:u,sourceChainId:f,from:m,networkClientId:g});const{end:T}=(0,l.collectTransactionIds)(f,m,n,e=>{h.push(e),(0,l.updateTransaction)({transactionId:t,messenger:n,note:"Add required transaction ID from Relay submission"},t=>{t.requiredTransactionIds??(t.requiredTransactionIds=[]),t.requiredTransactionIds.push(e)})});let w;const b=e.fees.isSourceGasFeeToken?p:undefined,E=e.original.details.currencyIn.currency.chainId===e.original.details.currencyOut.currency.chainId,y=E&&e.original.request.authorizationList?.length?e.original.request.authorizationList.map(e=>({address:e.address,chainId:(0,a.toHex)(e.chainId)})):undefined,{gasLimits:S}=e.original.metamask;if(1===i.length){const e={...u[0],authorizationList:y,gas:(0,a.toHex)(S[0])};w=await n.call("TransactionController:addTransaction",e,{gasFeeToken:b,networkClientId:g,origin:a.ORIGIN_METAMASK,requireApproval:!1,type:r.TransactionType.relayDeposit})}else{const e=1===S.length?(0,a.toHex)(S[0]):undefined,t=u.map((t,n)=>({params:{data:t.data,gas:e?undefined:(0,a.toHex)(S[n]),maxFeePerGas:t.maxFeePerGas,maxPriorityFeePerGas:t.maxPriorityFeePerGas,to:t.to,value:t.value},type:0===n?r.TransactionType.tokenMethodApprove:r.TransactionType.relayDeposit}));await n.call("TransactionController:addTransactionBatch",{from:m,disable7702:!e,disableHook:Boolean(e),disableSequential:Boolean(e),gasFeeToken:b,gasLimit7702:e,networkClientId:g,origin:a.ORIGIN_METAMASK,overwriteUpgrade:!0,requireApproval:!1,transactions:t})}if(T(),d("Added transactions",h),w){const e=await w.result;d("Submitted transaction",e)}await Promise.all(h.map(e=>(0,l.waitForTransactionConfirmed)(e,n))),d("All transactions confirmed",h);const k=(0,l.getTransaction)(h.slice(-1)[0],n)?.hash;return k}(e,n.id,t);const s=await async function(e){if(e.details.currencyIn.currency.chainId===e.details.currencyOut.currency.chainId)return d("Skipping polling as same chain"),u;const{requestId:t}=e.steps[0],n=`${i.RELAY_STATUS_URL}?requestId=${t}`;for(;;){const e=await(0,a.successfulFetch)(n,{method:"GET"}),t=await e.json();if(d("Polled status",t.status,t),"success"===t.status){const e=t.txHashes?.slice(-1)[0];return e??u}if(["failure","refund","refunded"].includes(t.status))throw new Error(`Relay request failed with status: ${t.status}`);await new Promise(e=>setTimeout(e,i.RELAY_POLLING_INTERVAL))}}(e.original);return d("Relay request completed",s),(0,l.updateTransaction)({transactionId:n.id,messenger:t,note:"Intent complete after Relay completion"},e=>{e.isIntentComplete=!0}),{transactionHash:s}}n.submitRelayQuotes=async function(e){d("Executing quotes",e);const{quotes:t,messenger:n,transaction:a}=e;let r;for(const e of t)({transactionHash:r}=await h(e,n,a));return{transactionHash:r}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/relay/relay-submit.cjs"}],[3137,{"../../index.cjs":3128,"../../logger.cjs":3129,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.TestStrategy=void 0;const i=e("@metamask/utils"),o=e("../../index.cjs"),c=e("../../logger.cjs"),l=(0,i.createModuleLogger)(c.projectLogger,"test-strategy");n.TestStrategy=class{constructor(){a.add(this)}async getQuotes(e){const{requests:t}=e;return l("Getting quotes",t),await s(this,a,"m",r).call(this,5e3),[{dust:{fiat:"0.12",usd:"0.34"},estimatedDuration:5,fees:{provider:{fiat:"1.23",usd:"1.23"},sourceNetwork:{estimate:{human:"2.34",fiat:"2.34",usd:"2.34",raw:"234000"},max:{human:"2.35",fiat:"2.35",usd:"2.35",raw:"235000"}},targetNetwork:{fiat:"3.45",usd:"3.45"}},original:undefined,request:t[0],sourceAmount:{human:"4.56",fiat:"4.56",raw:"456000",usd:"4.56"},targetAmount:{human:"5.67",fiat:"5.67",raw:"567000",usd:"5.67"},strategy:o.TransactionPayStrategy.Test}]}async execute(e){const{quotes:t}=e;return l("Executing",t),await s(this,a,"m",r).call(this,5e3),{transactionHash:undefined}}},a=new WeakSet,r=function(e){return new Promise(t=>setTimeout(t,e))}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/test/TestStrategy.cjs"}],[3138,{"../logger.cjs":3129,"../strategy/relay/constants.cjs":3134,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getGasBuffer=n.getFeatureFlags=n.DEFAULT_SLIPPAGE=n.DEFAULT_RELAY_QUOTE_URL=n.DEFAULT_RELAY_FALLBACK_GAS_MAX=n.DEFAULT_RELAY_FALLBACK_GAS_ESTIMATE=n.DEFAULT_GAS_BUFFER=void 0;const a=e("@metamask/utils"),r=e("../logger.cjs"),s=e("../strategy/relay/constants.cjs"),i=(0,a.createModuleLogger)(r.projectLogger,"feature-flags");function o(e){return e.call("RemoteFeatureFlagController:getState").remoteFeatureFlags.confirmations_pay??{}}n.DEFAULT_GAS_BUFFER=1,n.DEFAULT_RELAY_FALLBACK_GAS_ESTIMATE=9e5,n.DEFAULT_RELAY_FALLBACK_GAS_MAX=15e5,n.DEFAULT_RELAY_QUOTE_URL=`${s.RELAY_URL_BASE}/quote`,n.DEFAULT_SLIPPAGE=.005,n.getFeatureFlags=function(e){const t=o(e),a=t.relayFallbackGas?.estimate??n.DEFAULT_RELAY_FALLBACK_GAS_ESTIMATE,r=t.relayFallbackGas?.max??n.DEFAULT_RELAY_FALLBACK_GAS_MAX,s=t.relayQuoteUrl??n.DEFAULT_RELAY_QUOTE_URL,c={relayDisabledGasStationChains:t.relayDisabledGasStationChains??[],relayFallbackGas:{estimate:a,max:r},relayQuoteUrl:s,slippage:t.slippage??n.DEFAULT_SLIPPAGE};return i("Feature flags:",{raw:t,result:c}),c},n.getGasBuffer=function(e,t){const a=o(e);return a.gasBuffer?.perChainConfig?.[t]?.buffer??a.gasBuffer?.default??n.DEFAULT_GAS_BUFFER}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/feature-flags.cjs"}],[3139,{"../logger.cjs":3129,"./token.cjs":3144,"@metamask/controller-utils":1494,"bignumber.js":3188},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.calculateGasFeeTokenCost=n.calculateGasCost=n.calculateTransactionGasCost=void 0;const a=e("@metamask/controller-utils"),r=e("bignumber.js"),s=e("./token.cjs"),i=e("../logger.cjs"),o=(0,i.createModuleLogger)(i.projectLogger,"gas");function c(e){const{chainId:t,gas:n,isMax:i,maxFeePerGas:o,maxPriorityFeePerGas:c,messenger:l}=e,u=(0,a.toHex)(t),{estimatedBaseFee:d,maxFeePerGas:h,maxPriorityFeePerGas:m}=function(e,t){const n=t.call("GasFeeController:getState"),a=n?.gasFeeEstimatesByChainId?.[e],{estimatedBaseFee:s,medium:i}=a?.gasFeeEstimates??{},o=i?.suggestedMaxFeePerGas,c=i?.suggestedMaxPriorityFeePerGas,l=s?new r.BigNumber(s).shiftedBy(9).toString(10):undefined,u=o?new r.BigNumber(o).shiftedBy(9).toString(10):undefined,d=c?new r.BigNumber(c).shiftedBy(9).toString(10):undefined;return{estimatedBaseFee:l,maxFeePerGas:u,maxPriorityFeePerGas:d}}(u,l),f=o??h,p=c??m,g=d&&p&&!i?new r.BigNumber(d).plus(p):new r.BigNumber(f??"0x0"),T=new r.BigNumber(n).multipliedBy(g),w=T.toString(10),b=T.shiftedBy(-18),E=b.toString(10),y=(0,s.getTokenFiatRate)(l,(0,s.getNativeToken)(u),u);if(!y)throw new Error("Could not fetch fiat rate for native token");const S=b.multipliedBy(y.usdRate).toString(10);return{fiat:b.multipliedBy(y.fiatRate).toString(10),human:E,raw:w,usd:S}}function l({chainId:e,gasFeeToken:t,messenger:n}){const{amount:a,decimals:i,tokenAddress:c}=t,l=(0,s.getTokenFiatRate)(n,c,e);if(!l)return o("Cannot get gas fee token info"),undefined;const u=new r.BigNumber(a),d=u.toString(10),h=u.shiftedBy(-i),m=h.toString(10);return{isGasFeeToken:!0,fiat:h.multipliedBy(l.fiatRate).toString(10),human:m,raw:d,usd:h.multipliedBy(l.usdRate).toString(10)}}n.calculateTransactionGasCost=function(e,t,{isMax:n}={}){const{chainId:a,gasUsed:i,gasLimitNoBuffer:u,txParams:d}=e,{from:h,gas:m,maxFeePerGas:f,maxPriorityFeePerGas:p}=d,g=(n?undefined:i)??u??m??"0x0",T=c({chainId:a,gas:g,isMax:n,maxFeePerGas:f,maxPriorityFeePerGas:p,messenger:t}),w=c({chainId:a,gas:g,isMax:!0,messenger:t}),b=(0,s.getTokenBalance)(t,h,a,(0,s.getNativeToken)(a)),E=function({hasBalance:e,messenger:t,transaction:n}){const{chainId:a,gasFeeTokens:r,isGasFeeTokenIgnoredIfBalance:s,selectedGasFeeToken:i}=n;if(!r||!i||s&&e)return undefined;o("Calculating gas fee token cost",{selectedGasFeeToken:i,chainId:a});const c=r?.find(e=>e.tokenAddress.toLowerCase()===i.toLowerCase());if(!c)return o("Gas fee token not found",{gasFeeTokens:r,selectedGasFeeToken:i}),undefined;return l({chainId:a,gasFeeToken:c,messenger:t})}({hasBalance:new r.BigNumber(b).gte(w.raw),messenger:t,transaction:e});return E||T},n.calculateGasCost=c,n.calculateGasFeeTokenCost=l}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/gas.cjs"}],[3140,{"../logger.cjs":3129,"./strategy.cjs":3143,"./totals.cjs":3145,"./transaction.cjs":3146,"@metamask/transaction-controller":3095,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.refreshQuotes=n.updateQuotes=void 0;const a=e("@metamask/transaction-controller"),r=e("@metamask/utils"),s=e("./strategy.cjs"),i=e("./totals.cjs"),o=e("./transaction.cjs"),c=e("../logger.cjs"),l=(0,r.createModuleLogger)(c.projectLogger,"quotes");async function u(e){const{messenger:t,transactionData:n,transactionId:r,updateTransactionData:c}=e,u=(0,o.getTransaction)(r,t);if(!u||!n)throw new Error("Transaction not found");if(u?.status!==a.TransactionStatus.unapproved)return!1;l("Updating quotes",{transactionId:r});const{isMaxAmount:d,paymentToken:h,sourceAmounts:m,tokens:f}=n,p=function({from:e,isMaxAmount:t,paymentToken:n,sourceAmounts:a,tokens:r,transactionId:s}){if(!n)return[];const i=(a??[]).map(a=>{const s=r.find(e=>e.address===a.targetTokenAddress);return{from:e,isMaxAmount:t,sourceBalanceRaw:n.balanceRaw,sourceTokenAmount:a.sourceAmountRaw,sourceChainId:n.chainId,sourceTokenAddress:n.address,targetAmountMinimum:s.allowUnderMinimum?"0":s.amountRaw,targetChainId:s.chainId,targetTokenAddress:s.address}});i.length||l("No quote requests",{transactionId:s});return i}({from:u.txParams.from,isMaxAmount:d??!1,paymentToken:h,sourceAmounts:m,tokens:f,transactionId:r});c(r,e=>{e.isLoading=!0});try{const{batchTransactions:e,quotes:n}=await async function(e,t,n){const{id:a}=e,r=(0,s.getStrategy)(n,e);let i=[];try{i=t?.length?await r.getQuotes({messenger:n,requests:t,transaction:e}):[]}catch(e){l("Error fetching quotes",{error:e,transactionId:a})}l("Updated",{transactionId:a,quotes:i});const o=i?.length&&r.getBatchTransactions?await r.getBatchTransactions({messenger:n,quotes:i}):[];return l("Batch transactions",{transactionId:a,batchTransactions:o}),{batchTransactions:o,quotes:i}}(u,p,t),a=(0,i.calculateTotals)({isMaxAmount:d,messenger:t,quotes:n,tokens:f,transaction:u});l("Calculated totals",{transactionId:r,totals:a}),function({batchTransactions:e,messenger:t,paymentToken:n,totals:a,transactionId:r}){if(!n)return;(0,o.updateTransaction)({transactionId:r,messenger:t,note:"Update transaction pay data"},t=>{t.batchTransactions=e,t.batchTransactionsOptions={},t.metamaskPay={bridgeFeeFiat:a.fees.provider.usd,chainId:n.chainId,networkFeeFiat:a.fees.sourceNetwork.estimate.usd,targetFiat:a.targetAmount.usd,tokenAddress:n.address,totalFiat:a.total.usd}})}({batchTransactions:e,messenger:t,paymentToken:h,totals:a,transactionId:r}),c(r,e=>{e.quotes=n,e.quotesLastUpdated=Date.now(),e.totals=a})}finally{c(r,e=>{e.isLoading=!1})}return!0}n.updateQuotes=u,n.refreshQuotes=async function(e,t){const n=e.call("TransactionPayController:getState"),a=Object.keys(n.transactionData);for(const r of a){const a=n.transactionData[r],{isLoading:i,quotes:o,quotesLastUpdated:c}=a;if(i||!o?.length)continue;const d=o[0].strategy,h=(0,s.getStrategyByName)(d),m=await(h.getRefreshInterval?.({chainId:o[0].request.sourceChainId,messenger:e}))??3e4;if(!(Date.now()-(c??0)>m))continue;await u({messenger:e,transactionData:a,transactionId:r,updateTransactionData:t})&&l("Refreshed quotes",{transactionId:r,strategy:d})}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/quotes.cjs"}],[3141,{"./token.cjs":3144,"@ethersproject/abi":754,"@metamask/controller-utils":1494,"@metamask/metamask-eth-abis":2376,"@metamask/utils":3217,"bignumber.js":3188},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.parseRequiredTokens=void 0;const a=e("@ethersproject/abi"),r=e("@metamask/controller-utils"),s=e("@metamask/metamask-eth-abis"),i=e("@metamask/utils"),o=e("bignumber.js"),c=e("./token.cjs"),l="0xa9059cbb";function u(e,t){const{data:n,to:i}=function(e){const{nestedTransactions:t,txParams:n}=e,{data:a}=n,r=n?.to;if(a?.startsWith(l)&&r)return{data:a,to:r,index:undefined};const s=t?.findIndex(e=>e.data?.startsWith(l)),i=s===undefined?undefined:t?.[s];if(i?.data&&i.to)return{data:i.data,to:i.to,index:s};return undefined}(e)??{};if(!i||!n)return undefined;let o;try{const e=new a.Interface(s.abiERC20).decodeFunctionData("transfer",n);o=(0,r.toHex)(e._value)}catch{}return o===undefined?undefined:h(e,i,o,t)}function d(e,t){const{chainId:n,txParams:a}=e,{gas:r,maxFeePerGas:s}=a,l=(0,c.getNativeToken)(n),u=h(e,l,(0,i.add0x)(new o.BigNumber(r??"0x0").multipliedBy(new o.BigNumber(s??"0x0")).toString(16)),t);if(!u)return undefined;const d=new o.BigNumber(u.amountUsd);if(new o.BigNumber(u.balanceRaw).isGreaterThanOrEqualTo(u.amountRaw)||d.isGreaterThanOrEqualTo(1))return{...u,allowUnderMinimum:!0,skipIfBalance:!0};const m=(0,c.getTokenFiatRate)(t,l,n),f=h(e,l,(0,i.add0x)(new o.BigNumber(1).dividedBy(m.usdRate).shiftedBy(18).toString(16)),t);return f?{...f,allowUnderMinimum:!0,skipIfBalance:!0}:undefined}function h(e,t,n,a){const{chainId:r,txParams:s}=e,i=s.from,{decimals:o,symbol:l}=(0,c.getTokenInfo)(a,t,r)??{},u=(0,c.getTokenFiatRate)(a,t,r),d=(0,c.getTokenBalance)(a,i,r,t);if(o===undefined||!l||u===undefined)return undefined;const{amountHuman:h,amountRaw:f,amountFiat:p,amountUsd:g}=m(d,o,u),{amountHuman:T,amountRaw:w,amountFiat:b,amountUsd:E}=m(n,o,u);return{address:t,allowUnderMinimum:!1,amountFiat:b,amountHuman:T,amountRaw:w,amountUsd:E,balanceFiat:p,balanceHuman:h,balanceRaw:f,balanceUsd:g,chainId:r,decimals:o,skipIfBalance:!1,symbol:l}}function m(e,t,n){const a=new o.BigNumber(e),r=a.shiftedBy(-t),s=r.multipliedBy(n.fiatRate).toString(10),i=r.multipliedBy(n.usdRate).toString(10),c=a.toFixed(0);return{amountFiat:s,amountHuman:r.toString(10),amountRaw:c,amountUsd:i}}n.parseRequiredTokens=function(e,t){return[u(e,t),d(e,t)].filter(Boolean)}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/required-tokens.cjs"}],[3142,{"../constants.cjs":3125,"../index.cjs":3128,"../logger.cjs":3129,"./token.cjs":3144,"./transaction.cjs":3146,"@metamask/utils":3217,"bignumber.js":3188},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.updateSourceAmounts=void 0;const a=e("@metamask/utils"),r=e("bignumber.js"),s=e("./token.cjs"),i=e("./transaction.cjs"),o=e("../index.cjs"),c=e("../constants.cjs"),l=e("../logger.cjs"),u=(0,a.createModuleLogger)(l.projectLogger,"source-amounts");n.updateSourceAmounts=function(e,t,n){if(!t)return;const{isMaxAmount:a,paymentToken:l,tokens:d}=t;if(!d.length||!l)return;const h=d.map(t=>function(e,t,n,a,l){const d=(0,s.getTokenFiatRate)(n,e.address,e.chainId);if(!d)return undefined;const h=new r.BigNumber(t.balanceRaw).gte(t.amountRaw);if(t.skipIfBalance&&h)return u("Skipping token as sufficient balance",{tokenAddress:t.address}),undefined;const m=function(e,t){const n=(0,i.getTransaction)(e,t);return t.call("TransactionPayController:getStrategy",n)}(a,n),f=t.address.toLowerCase()===e.address.toLowerCase()&&t.chainId===e.chainId,p=function(e,t){const n=e.chainId===c.CHAIN_ID_ARBITRUM&&e.address.toLowerCase()===c.ARBITRUM_USDC_ADDRESS.toLowerCase();return t===o.TransactionPayStrategy.Relay&&n}(t,m);if(f&&!p)return u("Skipping token as same as payment token"),undefined;const g=new r.BigNumber(t.amountUsd).div(d.usdRate),T=g.toString(10),w=g.shiftedBy(e.decimals).toFixed(0);if("0"===t.amountRaw)return u("Skipping token as zero amount",{tokenAddress:t.address}),undefined;if(l)return{sourceAmountHuman:e.balanceHuman,sourceAmountRaw:e.balanceRaw,targetTokenAddress:t.address};return{sourceAmountHuman:T,sourceAmountRaw:w,targetTokenAddress:t.address}}(l,t,n,e,a??!1)).filter(Boolean);u("Updated source amounts",{transactionId:e,sourceAmounts:h}),t.sourceAmounts=h}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/source-amounts.cjs"}],[3143,{"../constants.cjs":3125,"../strategy/bridge/BridgeStrategy.cjs":3130,"../strategy/relay/RelayStrategy.cjs":3133,"../strategy/test/TestStrategy.cjs":3137},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getStrategyByName=n.getStrategy=void 0;const a=e("../constants.cjs"),r=e("../strategy/bridge/BridgeStrategy.cjs"),s=e("../strategy/relay/RelayStrategy.cjs"),i=e("../strategy/test/TestStrategy.cjs");function o(e){switch(e){case a.TransactionPayStrategy.Bridge:return new r.BridgeStrategy;case a.TransactionPayStrategy.Relay:return new s.RelayStrategy;case a.TransactionPayStrategy.Test:return new i.TestStrategy;default:throw new Error(`Unknown strategy: ${e}`)}}n.getStrategy=function(e,t){return o(e.call("TransactionPayController:getStrategy",t))},n.getStrategyByName=o}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/strategy.cjs"}],[3144,{"../constants.cjs":3125,"@metamask/controller-utils":1494,"bignumber.js":3188,lodash:4901},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getNativeToken=n.getTokenFiatRate=n.getTokenInfo=n.getAllTokenBalances=n.getTokenBalance=void 0;const a=e("@metamask/controller-utils"),r=e("bignumber.js"),s=e("lodash"),i=e("../constants.cjs"),o={[i.CHAIN_ID_ARBITRUM]:[i.ARBITRUM_USDC_ADDRESS.toLowerCase()],[i.CHAIN_ID_POLYGON]:[i.POLYGON_USDCE_ADDRESS.toLowerCase()]};function c(e,t,n,s){const i=e.call("TokenBalancesController:getState"),o=t.toLowerCase(),c=(0,a.toChecksumHexAddress)(s),u=c===l(n),d=i.tokenBalances?.[o]?.[n]?.[c];if(!u&&d===undefined)return"0";if(!u&&d)return new r.BigNumber(d,16).toString(10);const h=e.call("AccountTrackerController:getState"),m=h.accountsByChainId?.[n],f=(0,a.toChecksumHexAddress)(o),p=m?.[f]?.balance;return new r.BigNumber(p??"0x0",16).toString(10)}function l(e){return"0x89"===e?"0x0000000000000000000000000000000000001010":i.NATIVE_TOKEN_ADDRESS}function u(e,t){try{const n=t.call("NetworkController:findNetworkClientIdByChainId",e);return t.call("NetworkController:getNetworkClientById",n).configuration.ticker}catch{return undefined}}n.getTokenBalance=c,n.getAllTokenBalances=function(e,t){const n=e.call("TokenBalancesController:getState"),a=e.call("AccountTrackerController:getState"),r=Object.keys(a.accountsByChainId),i=t.toLowerCase(),o=n.tokenBalances?.[i],u=Object.keys(o);return(0,s.uniq)([...u,...r]).flatMap(n=>[...Object.keys(o[n]??{}),l(n)].map(a=>({chainId:n,tokenAddress:a,balance:c(e,t,n,a)})))},n.getTokenInfo=function(e,t,n){const a=e.call("TokensController:getState"),r=t.toLowerCase(),s=r===l(n).toLowerCase(),i=Object.values(a.allTokens?.[n]??{}).flat().find(e=>e.address.toLowerCase()===r);if(!i&&!s)return undefined;if(i&&!s)return{decimals:Number(i.decimals),symbol:i.symbol};const o=u(n,e);return o?{decimals:18,symbol:o}:undefined},n.getTokenFiatRate=function(e,t,n){const s=u(n,e);if(!s)return undefined;const i=e.call("TokenRatesController:getState"),c=e.call("CurrencyRateController:getState"),d=(0,a.toChecksumHexAddress)(t),h=d===l(n),m=i.marketData?.[n]?.[d]?.price;if(m===undefined&&!h)return undefined;const{conversionRate:f,usdConversionRate:p}=c.currencyRates?.[s]??{conversionRate:null,usdConversionRate:null};if(null===f||null===p)return undefined;const g=o[n]?.includes(t.toLowerCase());return{usdRate:g?"1":new r.BigNumber(m??1).multipliedBy(p).toString(10),fiatRate:new r.BigNumber(m??1).multipliedBy(f).toString(10)}},n.getNativeToken=l}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/token.cjs"}],[3145,{"./gas.cjs":3139,"bignumber.js":3188},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.calculateTotals=void 0;const a=e("bignumber.js"),r=e("./gas.cjs");function s(e){return{...i(e),human:o(e,e=>e.human),raw:o(e,e=>e.raw)}}function i(e){return{fiat:o(e,e=>e.fiat),usd:o(e,e=>e.usd)}}function o(e,t){return e.map(t).reduce((e,t)=>e.plus(t),new a.BigNumber(0)).toString(10)}n.calculateTotals=function({isMaxAmount:e,quotes:t,messenger:n,tokens:c,transaction:l}){const u=i(t.map(e=>e.fees.provider)),d=s(t.map(e=>e.fees.sourceNetwork.max)),h=s(t.map(e=>e.fees.sourceNetwork.estimate)),m=(0,r.calculateTransactionGasCost)(l,n),f=t?.length?{...i(t.map(e=>e.fees.targetNetwork)),isGasFeeToken:!1}:m,p=s(t.map(e=>e.sourceAmount)),g=s(t.map(e=>e.targetAmount)),T=c.filter(e=>!e.skipIfBalance),w=o(T,e=>e.amountFiat),b=o(T,e=>e.amountUsd),E=t.length>0,y=new a.BigNumber(u.fiat).plus(h.fiat).plus(f.fiat).plus(e&&E?g.fiat:w).toString(10),S=new a.BigNumber(u.usd).plus(h.usd).plus(f.usd).plus(e&&E?g.usd:b).toString(10);return{estimatedDuration:Number(o(t,e=>e.estimatedDuration)),fees:{isSourceGasFeeToken:t.some(e=>e.fees.isSourceGasFeeToken),isTargetGasFeeToken:Boolean(f.isGasFeeToken)||t.some(e=>e.fees.isTargetGasFeeToken),provider:u,sourceNetwork:{estimate:h,max:d},targetNetwork:f},sourceAmount:p,targetAmount:g,total:{fiat:y,usd:S}}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/totals.cjs"}],[3146,{"../logger.cjs":3129,"./required-tokens.cjs":3141,"@metamask/transaction-controller":3095,"@metamask/utils":3217,lodash:4901},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.collectTransactionIds=n.updateTransaction=n.waitForTransactionConfirmed=n.pollTransactionChanges=n.getTransaction=n.FINALIZED_STATUSES=void 0;const a=e("@metamask/transaction-controller"),r=e("@metamask/utils"),s=e("lodash"),i=e("./required-tokens.cjs"),o=e("../logger.cjs"),c=(0,r.createModuleLogger)(o.projectLogger,"transaction");function l(e,t){return t.call("TransactionController:getState").transactions.find(t=>t.id===e)}n.FINALIZED_STATUSES=[a.TransactionStatus.confirmed,a.TransactionStatus.dropped,a.TransactionStatus.failed],n.getTransaction=l,n.pollTransactionChanges=function(e,t,a){e.subscribe("TransactionController:stateChange",(r,s)=>{const o=r.filter(e=>!s?.find(t=>t.id===e.id)),l=r.filter(e=>{const t=s?.find(t=>t.id===e.id);return t&&t?.txParams.data!==e.txParams.data});[...r.filter(e=>{const t=s?.find(t=>t.id===e.id);return t&&!n.FINALIZED_STATUSES.includes(t.status)&&n.FINALIZED_STATUSES.includes(e.status)}),...(s??[]).filter(e=>!r.find(t=>t.id===e.id))].forEach(e=>function(e,t){c("Transaction finalized",{transaction:e}),t(e.id)}(e,a)),[...o,...l].forEach(n=>function(e,t,n){const a=(0,i.parseRequiredTokens)(e,t);c("Transaction changed",{transaction:e,tokens:a}),n(e.id,e=>{e.tokens=a})}(n,e,t))},e=>e.transactions)},n.waitForTransactionConfirmed=function(e,t){return new Promise((n,r)=>{const s=(e,t)=>(c("Checking transaction status",e?.status,e?.type),e?.status===a.TransactionStatus.confirmed?(t?.(),n(),!0):!![a.TransactionStatus.dropped,a.TransactionStatus.failed].includes(e?.status)&&(t?.(),r(new Error(`Transaction failed - ${e?.type} - ${e?.error?.message}`)),!0)),i=t.call("TransactionController:getState").transactions.find(t=>t.id===e);if(s(i))return;const o=e=>{s(e,()=>t.unsubscribe("TransactionController:stateChange",o))};t.subscribe("TransactionController:stateChange",o,t=>t.transactions.find(t=>t.id===e))})},n.updateTransaction=function({transactionId:e,messenger:t,note:n},a){const r=l(e,t);if(!r)throw new Error(`Transaction not found: ${e}`);const i=(0,s.cloneDeep)(r);a(i),t.call("TransactionController:updateTransaction",i,n)},n.collectTransactionIds=function(e,t,n,a){const r=n=>{n.chainId===e&&n.txParams.from.toLowerCase()===t.toLowerCase()&&a(n.id)};return n.subscribe("TransactionController:unapprovedTransactionAdded",r),{end:()=>{n.unsubscribe("TransactionController:unapprovedTransactionAdded",r)}}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/transaction.cjs"}],[3147,{"./constants/bridge.cjs":3148,"./constants/chains.cjs":3149,"./constants/swaps.cjs":3150,"./constants/traces.cjs":3152,"./selectors.cjs":3154,"./types.cjs":3155,"./utils/assets.cjs":3156,"./utils/balance.cjs":3157,"./utils/bridge.cjs":3158,"./utils/caip-formatters.cjs":3159,"./utils/feature-flags.cjs":3160,"./utils/fetch.cjs":3162,"./utils/metrics/constants.cjs":3163,"./utils/metrics/properties.cjs":3164,"./utils/quote-fees.cjs":3165,"./utils/quote.cjs":3166,"./utils/snaps.cjs":3168,"@ethersproject/bignumber":768,"@ethersproject/contracts":777,"@ethersproject/providers":815,"@metamask/metamask-eth-abis":2376,"@metamask/polling-controller":2561},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l,u,d,h,m,f,p,g,T,w,b,E,y,S,k,I,A,_,C,P=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},v=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.BridgeController=void 0;const N=e("@ethersproject/bignumber"),R=e("@ethersproject/contracts"),j=e("@ethersproject/providers"),O=e("@metamask/metamask-eth-abis"),x=e("@metamask/polling-controller"),L=e("./constants/bridge.cjs"),M=e("./constants/chains.cjs"),F=e("./constants/swaps.cjs"),D=e("./constants/traces.cjs"),B=e("./selectors.cjs"),G=e("./types.cjs"),U=e("./utils/assets.cjs"),H=e("./utils/balance.cjs"),q=e("./utils/bridge.cjs"),K=e("./utils/caip-formatters.cjs"),W=e("./utils/feature-flags.cjs"),$=e("./utils/fetch.cjs"),V=e("./utils/metrics/constants.cjs"),Y=e("./utils/metrics/properties.cjs"),Q=e("./utils/quote.cjs"),z=e("./utils/quote-fees.cjs"),J=e("./utils/snaps.cjs"),X={quoteRequest:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},quotes:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},quotesInitialLoadTime:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},quotesLastFetched:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},quotesLoadingStatus:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},quoteFetchError:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},quotesRefreshCount:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},assetExchangeRates:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},minimumBalanceForRentExemptionInLamports:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0}};class Z extends((0,x.StaticIntervalPollingController)()){constructor({messenger:e,state:t,clientId:n,clientVersion:x,getLayer1GasFee:Z,fetchFn:ee,config:te,trackMetaMetricsFn:ne,traceFn:ae}){super({name:L.BRIDGE_CONTROLLER_NAME,metadata:X,messenger:e,state:{...(0,q.getDefaultBridgeControllerState)(),...t}}),a.add(this),r.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,void 0),h.set(this,void 0),this._executePoll=async e=>{await v(this,w,"f").call(this,e)},this.updateBridgeQuoteRequestParams=async(e,t)=>{v(this,_,"f").call(this,e),this.resetState(V.AbortReason.QuoteRequestUpdated);const n={...L.DEFAULT_BRIDGE_CONTROLLER_STATE.quoteRequest,...e};if(this.update(e=>{e.quoteRequest=n}),await v(this,p,"f").call(this,n).catch(e=>console.warn("Failed to fetch asset exchange rates",e)),(0,Q.isValidQuoteRequest)(n)){P(this,s,Date.now(),"f");const r=(0,q.isNonEvmChainId)(n.srcChainId),i=r?undefined:v(this,a,"m",S).call(this,(0,K.formatChainIdToHex)(n.srcChainId))?.configuration;let o,c=Boolean(e.resetApproval);r?o=e.insufficientBal:i?.rpcUrl?.includes("tenderly")?o=!0:(this.update(e=>{e.quotesLoadingStatus=G.RequestStatus.LOADING}),c=await v(this,T,"f").call(this,n),o=e.insufficientBal??await v(this,g,"f").call(this,n)),this.setChainIntervalLength(),this.startPolling({updatedQuoteRequest:{...n,insufficientBal:o,resetApproval:c},context:t})}},this.fetchQuotes=async(e,t=null,n=null)=>{const r=(0,W.getBridgeFeatureFlags)(this.messenger),s=n?r.quoteRequestOverrides?.[n]:undefined,u=await v(this,T,"f").call(this,e),{quotes:d,validationFailures:f}=await(0,$.fetchBridgeQuotes)(s?{...e,...s,resetApproval:u}:{...e,resetApproval:u},t,v(this,i,"f"),v(this,l,"f"),v(this,h,"f").customBridgeApiBaseUrl??L.BRIDGE_PROD_API_BASE_URL,n,v(this,o,"f"));v(this,m,"f").call(this,f);const p=await(0,z.appendFeesToQuotes)(d,this.messenger,v(this,c,"f"),v(this,a,"m",y).call(this,e.walletAddress));return(0,Q.sortQuotes)(p,n)},m.set(this,e=>{0!==e.length&&this.trackUnifiedSwapBridgeEvent(V.UnifiedSwapBridgeEventName.QuotesValidationFailed,{failures:e})}),f.set(this,()=>({...this.messenger.call("MultichainAssetsRatesController:getState"),...this.messenger.call("CurrencyRateController:getState"),...this.messenger.call("TokenRatesController:getState"),...this.state})),p.set(this,async({srcChainId:e,srcTokenAddress:t,destChainId:n,destTokenAddress:a})=>{const s=new Set([]),c=v(this,f,"f").call(this);t&&e&&!(0,B.selectIsAssetExchangeRateInState)(c,e,t)&&(0,U.getAssetIdsForToken)(t,e).forEach(e=>s.add(e)),a&&n&&!(0,B.selectIsAssetExchangeRateInState)(c,n,a)&&(0,U.getAssetIdsForToken)(a,n).forEach(e=>s.add(e));const u=this.messenger.call("CurrencyRateController:getState").currentCurrency;if(0===s.size)return;const d=await(0,$.fetchAssetPrices)({assetIds:s,currencies:new Set([u]),clientId:v(this,i,"f"),clientVersion:v(this,o,"f"),fetchFn:v(this,l,"f"),signal:v(this,r,"f")?.signal}),h=(0,U.toExchangeRates)(u,d);this.update(e=>{e.assetExchangeRates={...e.assetExchangeRates,...h}})}),g.set(this,async e=>{try{const t=(0,K.formatChainIdToHex)(e.srcChainId),n=v(this,a,"m",S).call(this,t)?.provider,r=(0,K.formatAddressToCaipReference)(e.srcTokenAddress);return!(n&&r&&e.srcTokenAmount&&t&&await(0,H.hasSufficientBalance)(n,e.walletAddress,r,e.srcTokenAmount,t))}catch(e){return console.warn("Failed to set insufficientBal",e),!0}}),T.set(this,async e=>{if((0,q.isNonEvmChainId)(e.srcChainId))return!1;try{const t=(0,K.formatAddressToCaipReference)(e.srcTokenAddress);if((0,q.isEthUsdt)(e.srcChainId,t)){const n=N.BigNumber.from(await v(this,C,"f").call(this,e.walletAddress,t,e.destChainId));return n.lt(e.srcTokenAmount)&&n.gt(0)}return!1}catch(e){return console.warn("Failed to set resetApproval",e),!0}}),this.stopPollingForQuotes=(e,t)=>{this.stopAllPolling(),this.state.quotesLoadingStatus===G.RequestStatus.LOADING&&t&&this.trackUnifiedSwapBridgeEvent(V.UnifiedSwapBridgeEventName.QuotesReceived,t),v(this,r,"f")?.abort(e)},this.resetState=(e=V.AbortReason.ResetState)=>{this.stopPollingForQuotes(e),this.update(e=>{e.quoteRequest=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quoteRequest,e.quotesInitialLoadTime=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotesInitialLoadTime,e.quotes=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotes,e.quotesLastFetched=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotesLastFetched,e.quotesLoadingStatus=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotesLoadingStatus,e.quoteFetchError=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quoteFetchError,e.quotesRefreshCount=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotesRefreshCount,e.assetExchangeRates=L.DEFAULT_BRIDGE_CONTROLLER_STATE.assetExchangeRates,e.minimumBalanceForRentExemptionInLamports=L.DEFAULT_BRIDGE_CONTROLLER_STATE.minimumBalanceForRentExemptionInLamports})},this.setChainIntervalLength=()=>{const{state:e}=this,{srcChainId:t}=e.quoteRequest,n=(0,W.getBridgeFeatureFlags)(this.messenger),a=t?n.chains[(0,K.formatChainIdToCaip)(t)]?.refreshRate:undefined,r=n.refreshRate;this.setIntervalLength(a??r)},w.set(this,async({updatedQuoteRequest:e,context:t})=>{v(this,r,"f")?.abort("New quote request"),P(this,r,new AbortController,"f"),this.trackUnifiedSwapBridgeEvent(V.UnifiedSwapBridgeEventName.QuotesRequested,t);const{sse:n,maxRefreshCount:i}=(0,W.getBridgeFeatureFlags)(this.messenger),c=n?.enabled&&(0,W.hasMinimumRequiredVersion)(v(this,o,"f"),n.minimumVersion);this.update(t=>{t.quoteRequest=e,t.quoteFetchError=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quoteFetchError,t.quotesLastFetched=Date.now(),t.quotesLoadingStatus=G.RequestStatus.LOADING});try{await v(this,d,"f").call(this,{name:(0,q.isCrossChain)(e.srcChainId,e.destChainId)?D.TraceName.BridgeQuotesFetched:D.TraceName.SwapQuotesFetched,data:{srcChainId:(0,K.formatChainIdToCaip)(e.srcChainId),destChainId:(0,K.formatChainIdToCaip)(e.destChainId)}},async()=>{const t=v(this,a,"m",y).call(this,e.walletAddress);if(v(this,E,"f").call(this,e.srcChainId,t?.metadata?.snap?.id),c)return void await v(this,b,"f").call(this,e,t);const n=await this.fetchQuotes(e,v(this,r,"f")?.signal);this.update(e=>{e.quotesRefreshCount===L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotesRefreshCount&&v(this,s,"f")&&(e.quotesInitialLoadTime=Date.now()-v(this,s,"f")),e.quotes=n,e.quotesLoadingStatus=G.RequestStatus.FETCHED})})}catch(e){if(this.update(e=>{e.quotes=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotes}),e.toString().includes("AbortError")||e.toString().includes("FetchRequestCanceledException")||[V.AbortReason.ResetState,V.AbortReason.NewQuoteRequest,V.AbortReason.QuoteRequestUpdated,V.AbortReason.TransactionSubmitted].includes(e))return;this.update(t=>{let n;try{n=e?.message??e.toString()}catch{}finally{t.quoteFetchError=n??"Unknown error"}t.quotesLoadingStatus=G.RequestStatus.ERROR}),this.trackUnifiedSwapBridgeEvent(V.UnifiedSwapBridgeEventName.QuotesError,t),console.log(`Failed to ${c?"stream":"fetch"} bridge quotes`,e)}this.update(e=>{e.quotesRefreshCount+=1}),(e.insufficientBal||!e.insufficientBal&&this.state.quotesRefreshCount>=i)&&this.stopAllPolling()}),b.set(this,async(e,t)=>{let n=0;const a=new Set;await(0,$.fetchBridgeQuoteStream)(v(this,l,"f"),e,v(this,r,"f")?.signal,v(this,i,"f"),v(this,h,"f").customBridgeApiBaseUrl??L.BRIDGE_PROD_API_BASE_URL,{onValidationFailure:v(this,m,"f"),onValidQuoteReceived:async e=>{const r=(async()=>{const a=await(0,z.appendFeesToQuotes)([e],this.messenger,v(this,c,"f"),t);a.length>0&&(n+=1),this.update(e=>{1===n&&(e.quotes=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotes,!e.quotesInitialLoadTime&&v(this,s,"f")&&(e.quotesInitialLoadTime=Date.now()-v(this,s,"f"))),e.quotes=[...e.quotes,...a]})})();a.add(r),r.catch(e=>{console.error("Error appending fees to quote",e)}).finally(()=>{a.delete(r)}),await r},onClose:async()=>{await Promise.allSettled(Array.from(a)),this.update(e=>{0===n&&(e.quotes=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotes),e.quotesLoadingStatus=G.RequestStatus.FETCHED})}},v(this,o,"f"))}),E.set(this,async(e,t)=>{if(!(0,q.isSolanaChainId)(e)||!t)return;const n=await(0,J.getMinimumBalanceForRentExemptionInLamports)(t,this.messenger);this.update(e=>{e.minimumBalanceForRentExemptionInLamports=n})}),k.set(this,()=>({slippage_limit:this.state.quoteRequest.slippage,swap_type:(0,Y.getSwapTypeFromQuote)(this.state.quoteRequest),custom_slippage:(0,Y.isCustomSlippage)(this.state.quoteRequest.slippage)})),I.set(this,()=>({quotes_count:this.state.quotes.length,quotes_list:this.state.quotes.map(({quote:e})=>(0,Y.formatProviderLabel)(e)),initial_load_time_all_quotes:this.state.quotesInitialLoadTime??0,has_gas_included_quote:this.state.quotes.some(({quote:e})=>e.gasIncluded)})),A.set(this,(e,t)=>{const n={...t,action_type:V.MetricsActionType.SWAPBRIDGE_V1};switch(e){case V.UnifiedSwapBridgeEventName.ButtonClicked:case V.UnifiedSwapBridgeEventName.PageViewed:return{...(0,Y.getRequestParams)(this.state.quoteRequest),...n};case V.UnifiedSwapBridgeEventName.QuotesValidationFailed:return{...(0,Y.getRequestParams)(this.state.quoteRequest),refresh_count:this.state.quotesRefreshCount,...n};case V.UnifiedSwapBridgeEventName.QuotesReceived:return{...(0,Y.getRequestParams)(this.state.quoteRequest),...v(this,k,"f").call(this),...v(this,I,"f").call(this),is_hardware_wallet:(0,Y.isHardwareWallet)(v(this,a,"m",y).call(this)),refresh_count:this.state.quotesRefreshCount,...n};case V.UnifiedSwapBridgeEventName.QuotesRequested:return{...(0,Y.getRequestParams)(this.state.quoteRequest),...v(this,k,"f").call(this),is_hardware_wallet:(0,Y.isHardwareWallet)(v(this,a,"m",y).call(this)),has_sufficient_funds:!this.state.quoteRequest.insufficientBal,...n};case V.UnifiedSwapBridgeEventName.QuotesError:return{...(0,Y.getRequestParams)(this.state.quoteRequest),...v(this,k,"f").call(this),is_hardware_wallet:(0,Y.isHardwareWallet)(v(this,a,"m",y).call(this)),error_message:this.state.quoteFetchError,has_sufficient_funds:!this.state.quoteRequest.insufficientBal,...n};case V.UnifiedSwapBridgeEventName.AllQuotesOpened:case V.UnifiedSwapBridgeEventName.AllQuotesSorted:case V.UnifiedSwapBridgeEventName.QuoteSelected:return{...(0,Y.getRequestParams)(this.state.quoteRequest),...v(this,k,"f").call(this),...v(this,I,"f").call(this),is_hardware_wallet:(0,Y.isHardwareWallet)(v(this,a,"m",y).call(this)),...n};case V.UnifiedSwapBridgeEventName.Failed:return{...n,...(0,Y.getRequestParams)(this.state.quoteRequest),...v(this,k,"f").call(this),...v(this,I,"f").call(this),...t};case V.UnifiedSwapBridgeEventName.AssetDetailTooltipClicked:return n;case V.UnifiedSwapBridgeEventName.Submitted:case V.UnifiedSwapBridgeEventName.Completed:return t;case V.UnifiedSwapBridgeEventName.InputChanged:default:return n}}),_.set(this,e=>{Object.entries(e).forEach(([t,n])=>{const a=Y.toInputChangedPropertyKey[t],r=Y.toInputChangedPropertyValue[t]?.(e);a&&r!==undefined&&n!==this.state.quoteRequest[t]&&this.trackUnifiedSwapBridgeEvent(V.UnifiedSwapBridgeEventName.InputChanged,{input:a,input_value:r})})}),this.trackUnifiedSwapBridgeEvent=(e,t)=>{try{const n=v(this,A,"f").call(this,e,t);v(this,u,"f").call(this,e,n)}catch(t){console.error(`Error tracking cross-chain swaps MetaMetrics event ${e}`,t)}},C.set(this,async(e,t,n)=>{const r=v(this,a,"m",S).call(this,M.CHAIN_IDS.MAINNET),s=r?.provider;if(!s)throw new Error("No provider found");const i=new j.Web3Provider(s),o=new R.Contract(t,O.abiERC20,i),c=(0,q.isCrossChain)(M.CHAIN_IDS.MAINNET,n)?L.METABRIDGE_ETHEREUM_ADDRESS:F.SWAPS_CONTRACT_ADDRESSES[M.CHAIN_IDS.MAINNET];return(await o.allowance(e,c)).toString()}),this.setIntervalLength(L.REFRESH_INTERVAL_MS),P(this,r,new AbortController,"f"),P(this,c,Z,"f"),P(this,i,n,"f"),P(this,o,x,"f"),P(this,l,ee,"f"),P(this,u,ne,"f"),P(this,h,te??{},"f"),P(this,d,ae??((e,t)=>t?.()),"f"),this.messenger.registerActionHandler(`${L.BRIDGE_CONTROLLER_NAME}:setChainIntervalLength`,this.setChainIntervalLength.bind(this)),this.messenger.registerActionHandler(`${L.BRIDGE_CONTROLLER_NAME}:updateBridgeQuoteRequestParams`,this.updateBridgeQuoteRequestParams.bind(this)),this.messenger.registerActionHandler(`${L.BRIDGE_CONTROLLER_NAME}:resetState`,this.resetState.bind(this)),this.messenger.registerActionHandler(`${L.BRIDGE_CONTROLLER_NAME}:trackUnifiedSwapBridgeEvent`,this.trackUnifiedSwapBridgeEvent.bind(this)),this.messenger.registerActionHandler(`${L.BRIDGE_CONTROLLER_NAME}:stopPollingForQuotes`,this.stopPollingForQuotes.bind(this)),this.messenger.registerActionHandler(`${L.BRIDGE_CONTROLLER_NAME}:fetchQuotes`,this.fetchQuotes.bind(this))}}n.BridgeController=Z,r=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,m=new WeakMap,f=new WeakMap,p=new WeakMap,g=new WeakMap,T=new WeakMap,w=new WeakMap,b=new WeakMap,E=new WeakMap,k=new WeakMap,I=new WeakMap,A=new WeakMap,_=new WeakMap,C=new WeakMap,a=new WeakSet,y=function(e){const t=e??this.state.quoteRequest.walletAddress;if(!t)throw new Error("Account address is required");return this.messenger.call("AccountsController:getAccountByAddress",t)},S=function(e){const t=this.messenger.call("NetworkController:findNetworkClientIdByChainId",e);if(!t)throw new Error(`No network client found for chainId: ${e}`);return this.messenger.call("NetworkController:getNetworkClientById",t)}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/bridge-controller.cjs"}],[3148,{"./chains.cjs":3149,"@ethersproject/constants":774,"@metamask/keyring-api":2306},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.METABRIDGE_CHAIN_TO_ADDRESS_MAP=n.DEFAULT_BRIDGE_CONTROLLER_STATE=n.DEFAULT_FEATURE_FLAG_CONFIG=n.BRIDGE_CONTROLLER_NAME=n.DEFAULT_MAX_REFRESH_COUNT=n.REFRESH_INTERVAL_MS=n.BRIDGE_MM_FEE_RATE=n.BRIDGE_PREFERRED_GAS_ESTIMATE=n.BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE=n.BRIDGE_QUOTE_MAX_ETA_SECONDS=n.METABRIDGE_ETHEREUM_ADDRESS=n.ETH_USDT_ADDRESS=n.BridgeClientId=n.BRIDGE_PROD_API_BASE_URL=n.BRIDGE_DEV_API_BASE_URL=n.ALLOWED_BRIDGE_CHAIN_IDS=void 0;const a=e("@ethersproject/constants"),r=e("@metamask/keyring-api"),s=e("./chains.cjs");var i;n.ALLOWED_BRIDGE_CHAIN_IDS=[s.CHAIN_IDS.MAINNET,s.CHAIN_IDS.BSC,s.CHAIN_IDS.POLYGON,s.CHAIN_IDS.ZKSYNC_ERA,s.CHAIN_IDS.AVALANCHE,s.CHAIN_IDS.OPTIMISM,s.CHAIN_IDS.ARBITRUM,s.CHAIN_IDS.LINEA_MAINNET,s.CHAIN_IDS.BASE,s.CHAIN_IDS.SEI,s.CHAIN_IDS.MONAD,r.SolScope.Mainnet,r.BtcScope.Mainnet,r.TrxScope.Mainnet],n.BRIDGE_DEV_API_BASE_URL="https://bridge.dev-api.cx.metamask.io",n.BRIDGE_PROD_API_BASE_URL="https://bridge.api.cx.metamask.io",function(e){e.EXTENSION="extension",e.MOBILE="mobile"}(i||(n.BridgeClientId=i={})),n.ETH_USDT_ADDRESS="0xdac17f958d2ee523a2206206994597c13d831ec7",n.METABRIDGE_ETHEREUM_ADDRESS="0x0439e60F02a8900a951603950d8D4527f400C3f1",n.BRIDGE_QUOTE_MAX_ETA_SECONDS=3600,n.BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE=.5,n.BRIDGE_PREFERRED_GAS_ESTIMATE="medium",n.BRIDGE_MM_FEE_RATE=.875,n.REFRESH_INTERVAL_MS=3e4,n.DEFAULT_MAX_REFRESH_COUNT=5,n.BRIDGE_CONTROLLER_NAME="BridgeController",n.DEFAULT_FEATURE_FLAG_CONFIG={minimumVersion:"0.0.0",refreshRate:n.REFRESH_INTERVAL_MS,maxRefreshCount:n.DEFAULT_MAX_REFRESH_COUNT,support:!1,chains:{}},n.DEFAULT_BRIDGE_CONTROLLER_STATE={quoteRequest:{srcTokenAddress:a.AddressZero},quotesInitialLoadTime:null,quotes:[],quotesLastFetched:null,quotesLoadingStatus:null,quoteFetchError:null,quotesRefreshCount:0,assetExchangeRates:{},minimumBalanceForRentExemptionInLamports:"0"},n.METABRIDGE_CHAIN_TO_ADDRESS_MAP={[s.CHAIN_IDS.MAINNET]:n.METABRIDGE_ETHEREUM_ADDRESS}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/constants/bridge.cjs"}],[3149,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.NETWORK_TO_NAME_MAP=n.MONAD_DISPLAY_NAME=n.SEI_DISPLAY_NAME=n.MODE_DISPLAY_NAME=n.MODE_SEPOLIA_DISPLAY_NAME=n.SONEIUM_DISPLAY_NAME=n.INK_DISPLAY_NAME=n.INK_SEPOLIA_DISPLAY_NAME=n.LISK_SEPOLIA_DISPLAY_NAME=n.LISK_DISPLAY_NAME=n.METACHAIN_ONE_DISPLAY_NAME=n.BERACHAIN_DISPLAY_NAME=n.OP_BNB_DISPLAY_NAME=n.SCROLL_SEPOLIA_DISPLAY_NAME=n.SCROLL_DISPLAY_NAME=n.MOONRIVER_DISPLAY_NAME=n.MOONBEAM_DISPLAY_NAME=n.POLYGON_ZKEVM_DISPLAY_NAME=n.CRONOS_DISPLAY_NAME=n.AURORA_DISPLAY_NAME=n.BASE_DISPLAY_NAME=n.ZK_SYNC_ERA_DISPLAY_NAME=n.GNOSIS_DISPLAY_NAME=n.CELO_DISPLAY_NAME=n.PALM_DISPLAY_NAME=n.HARMONY_DISPLAY_NAME=n.FANTOM_DISPLAY_NAME=n.OPTIMISM_DISPLAY_NAME=n.BNB_DISPLAY_NAME=n.ARBITRUM_DISPLAY_NAME=n.AVALANCHE_DISPLAY_NAME=n.POLYGON_DISPLAY_NAME=n.BSC_DISPLAY_NAME=n.LOCALHOST_DISPLAY_NAME=n.LINEA_MAINNET_DISPLAY_NAME=n.LINEA_SEPOLIA_DISPLAY_NAME=n.LINEA_GOERLI_DISPLAY_NAME=n.SEPOLIA_DISPLAY_NAME=n.GOERLI_DISPLAY_NAME=n.MAINNET_DISPLAY_NAME=n.NETWORK_TYPES=n.CHAIN_IDS=void 0,n.CHAIN_IDS={MAINNET:"0x1",GOERLI:"0x5",LOCALHOST:"0x539",BSC:"0x38",BSC_TESTNET:"0x61",OPTIMISM:"0xa",OPTIMISM_TESTNET:"0xaa37dc",OPTIMISM_GOERLI:"0x1a4",BASE:"0x2105",BASE_TESTNET:"0x14a33",OPBNB:"0xcc",OPBNB_TESTNET:"0x15eb",POLYGON:"0x89",POLYGON_TESTNET:"0x13881",AVALANCHE:"0xa86a",AVALANCHE_TESTNET:"0xa869",FANTOM:"0xfa",FANTOM_TESTNET:"0xfa2",CELO:"0xa4ec",ARBITRUM:"0xa4b1",HARMONY:"0x63564c40",PALM:"0x2a15c308d",SEPOLIA:"0xaa36a7",HOLESKY:"0x4268",LINEA_GOERLI:"0xe704",LINEA_SEPOLIA:"0xe705",AMOY:"0x13882",BASE_SEPOLIA:"0x14a34",BLAST_SEPOLIA:"0xa0c71fd",OPTIMISM_SEPOLIA:"0xaa37dc",PALM_TESTNET:"0x2a15c3083",CELO_TESTNET:"0xaef3",ZK_SYNC_ERA_TESTNET:"0x12c",MANTA_SEPOLIA:"0x138b",UNICHAIN_SEPOLIA:"0x515",LINEA_MAINNET:"0xe708",AURORA:"0x4e454152",MOONBEAM:"0x504",MOONBEAM_TESTNET:"0x507",MOONRIVER:"0x505",CRONOS:"0x19",GNOSIS:"0x64",ZKSYNC_ERA:"0x144",TEST_ETH:"0x539",ARBITRUM_GOERLI:"0x66eed",BLAST:"0x13e31",FILECOIN:"0x13a",POLYGON_ZKEVM:"0x44d",SCROLL:"0x82750",SCROLL_SEPOLIA:"0x8274f",WETHIO:"0x4e",CHZ:"0x15b38",NUMBERS:"0x290b",SEI:"0x531",APE_TESTNET:"0x8157",APE_MAINNET:"0x8173",BERACHAIN:"0x138d5",METACHAIN_ONE:"0x1b6e6",ARBITRUM_SEPOLIA:"0x66eee",NEAR:"0x18d",NEAR_TESTNET:"0x18e",B3:"0x208d",B3_TESTNET:"0x7c9",GRAVITY_ALPHA_MAINNET:"0x659",GRAVITY_ALPHA_TESTNET_SEPOLIA:"0x34c1",LISK:"0x46f",LISK_SEPOLIA:"0x106a",INK_SEPOLIA:"0xba5eD",INK:"0xdef1",MODE_SEPOLIA:"0x397",MODE:"0x868b",MONAD:"0x8f"},n.NETWORK_TYPES={GOERLI:"goerli",LOCALHOST:"localhost",MAINNET:"mainnet",SEPOLIA:"sepolia",LINEA_GOERLI:"linea-goerli",LINEA_SEPOLIA:"linea-sepolia",LINEA_MAINNET:"linea-mainnet"},n.MAINNET_DISPLAY_NAME="Ethereum Mainnet",n.GOERLI_DISPLAY_NAME="Goerli",n.SEPOLIA_DISPLAY_NAME="Sepolia",n.LINEA_GOERLI_DISPLAY_NAME="Linea Goerli",n.LINEA_SEPOLIA_DISPLAY_NAME="Linea Sepolia",n.LINEA_MAINNET_DISPLAY_NAME="Linea Mainnet",n.LOCALHOST_DISPLAY_NAME="Localhost 8545",n.BSC_DISPLAY_NAME="Binance Smart Chain",n.POLYGON_DISPLAY_NAME="Polygon",n.AVALANCHE_DISPLAY_NAME="Avalanche Network C-Chain",n.ARBITRUM_DISPLAY_NAME="Arbitrum One",n.BNB_DISPLAY_NAME="BNB Chain",n.OPTIMISM_DISPLAY_NAME="OP Mainnet",n.FANTOM_DISPLAY_NAME="Fantom Opera",n.HARMONY_DISPLAY_NAME="Harmony Mainnet Shard 0",n.PALM_DISPLAY_NAME="Palm",n.CELO_DISPLAY_NAME="Celo Mainnet",n.GNOSIS_DISPLAY_NAME="Gnosis",n.ZK_SYNC_ERA_DISPLAY_NAME="zkSync Era Mainnet",n.BASE_DISPLAY_NAME="Base Mainnet",n.AURORA_DISPLAY_NAME="Aurora Mainnet",n.CRONOS_DISPLAY_NAME="Cronos",n.POLYGON_ZKEVM_DISPLAY_NAME="Polygon zkEVM",n.MOONBEAM_DISPLAY_NAME="Moonbeam",n.MOONRIVER_DISPLAY_NAME="Moonriver",n.SCROLL_DISPLAY_NAME="Scroll",n.SCROLL_SEPOLIA_DISPLAY_NAME="Scroll Sepolia",n.OP_BNB_DISPLAY_NAME="opBNB",n.BERACHAIN_DISPLAY_NAME="Berachain Artio",n.METACHAIN_ONE_DISPLAY_NAME="Metachain One Mainnet",n.LISK_DISPLAY_NAME="Lisk",n.LISK_SEPOLIA_DISPLAY_NAME="Lisk Sepolia",n.INK_SEPOLIA_DISPLAY_NAME="Ink Sepolia",n.INK_DISPLAY_NAME="Ink Mainnet",n.SONEIUM_DISPLAY_NAME="Soneium Mainnet",n.MODE_SEPOLIA_DISPLAY_NAME="Mode Sepolia",n.MODE_DISPLAY_NAME="Mode Mainnet",n.SEI_DISPLAY_NAME="Sei Network",n.MONAD_DISPLAY_NAME="Monad",n.NETWORK_TO_NAME_MAP={[n.NETWORK_TYPES.GOERLI]:n.GOERLI_DISPLAY_NAME,[n.NETWORK_TYPES.MAINNET]:n.MAINNET_DISPLAY_NAME,[n.NETWORK_TYPES.LINEA_GOERLI]:n.LINEA_GOERLI_DISPLAY_NAME,[n.NETWORK_TYPES.LINEA_SEPOLIA]:n.LINEA_SEPOLIA_DISPLAY_NAME,[n.NETWORK_TYPES.LINEA_MAINNET]:n.LINEA_MAINNET_DISPLAY_NAME,[n.NETWORK_TYPES.LOCALHOST]:n.LOCALHOST_DISPLAY_NAME,[n.NETWORK_TYPES.SEPOLIA]:n.SEPOLIA_DISPLAY_NAME,[n.CHAIN_IDS.ARBITRUM]:n.ARBITRUM_DISPLAY_NAME,[n.CHAIN_IDS.AVALANCHE]:n.AVALANCHE_DISPLAY_NAME,[n.CHAIN_IDS.BSC]:n.BSC_DISPLAY_NAME,[n.CHAIN_IDS.BASE]:n.BASE_DISPLAY_NAME,[n.CHAIN_IDS.GOERLI]:n.GOERLI_DISPLAY_NAME,[n.CHAIN_IDS.MAINNET]:n.MAINNET_DISPLAY_NAME,[n.CHAIN_IDS.LINEA_GOERLI]:n.LINEA_GOERLI_DISPLAY_NAME,[n.CHAIN_IDS.LINEA_MAINNET]:n.LINEA_MAINNET_DISPLAY_NAME,[n.CHAIN_IDS.LINEA_SEPOLIA]:n.LINEA_SEPOLIA_DISPLAY_NAME,[n.CHAIN_IDS.LOCALHOST]:n.LOCALHOST_DISPLAY_NAME,[n.CHAIN_IDS.OPTIMISM]:n.OPTIMISM_DISPLAY_NAME,[n.CHAIN_IDS.POLYGON]:n.POLYGON_DISPLAY_NAME,[n.CHAIN_IDS.SCROLL]:n.SCROLL_DISPLAY_NAME,[n.CHAIN_IDS.SCROLL_SEPOLIA]:n.SCROLL_SEPOLIA_DISPLAY_NAME,[n.CHAIN_IDS.SEPOLIA]:n.SEPOLIA_DISPLAY_NAME,[n.CHAIN_IDS.OPBNB]:n.OP_BNB_DISPLAY_NAME,[n.CHAIN_IDS.ZKSYNC_ERA]:n.ZK_SYNC_ERA_DISPLAY_NAME,[n.CHAIN_IDS.BERACHAIN]:n.BERACHAIN_DISPLAY_NAME,[n.CHAIN_IDS.METACHAIN_ONE]:n.METACHAIN_ONE_DISPLAY_NAME,[n.CHAIN_IDS.LISK]:n.LISK_DISPLAY_NAME,[n.CHAIN_IDS.LISK_SEPOLIA]:n.LISK_SEPOLIA_DISPLAY_NAME,[n.CHAIN_IDS.SEI]:n.SEI_DISPLAY_NAME,[n.CHAIN_IDS.MONAD]:n.MONAD_DISPLAY_NAME}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/constants/chains.cjs"}],[3150,{"./chains.cjs":3149},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ALLOWED_CONTRACT_ADDRESSES=n.SWAPS_WRAPPED_TOKENS_ADDRESSES=n.SWAPS_CONTRACT_ADDRESSES=n.SWAPS_API_V2_BASE_URL=void 0;const a=e("./chains.cjs");n.SWAPS_API_V2_BASE_URL="https://swap.api.cx.metamask.io";const r="0x881d40237659c251811cec9c364ef91dc08d300c";n.SWAPS_CONTRACT_ADDRESSES={[a.CHAIN_IDS.MAINNET]:r,[a.CHAIN_IDS.LOCALHOST]:r,[a.CHAIN_IDS.BSC]:"0x1a1ec25dc08e98e5e93f1104b5e5cdd298707d31",[a.CHAIN_IDS.POLYGON]:"0x1a1ec25dc08e98e5e93f1104b5e5cdd298707d31",[a.CHAIN_IDS.AVALANCHE]:"0x1a1ec25dc08e98e5e93f1104b5e5cdd298707d31",[a.CHAIN_IDS.ARBITRUM]:"0x9dda6ef3d919c9bc8885d5560999a3640431e8e6",[a.CHAIN_IDS.OPTIMISM]:"0x9dda6ef3d919c9bc8885d5560999a3640431e8e6",[a.CHAIN_IDS.ZKSYNC_ERA]:"0xf504c1fe13d14df615e66dcd0abf39e60c697f34",[a.CHAIN_IDS.LINEA_MAINNET]:"0x9dda6ef3d919c9bc8885d5560999a3640431e8e6",[a.CHAIN_IDS.BASE]:"0x9dda6ef3d919c9bc8885d5560999a3640431e8e6",[a.CHAIN_IDS.SEI]:"0x962287c9d5B8a682389E61edAE90ec882325d08b"};const s="0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2";n.SWAPS_WRAPPED_TOKENS_ADDRESSES={[a.CHAIN_IDS.MAINNET]:s,[a.CHAIN_IDS.LOCALHOST]:s,[a.CHAIN_IDS.BSC]:"0xbb4cdb9cbd36b01bd1cbaebf2de08d9173bc095c",[a.CHAIN_IDS.POLYGON]:"0x0d500b1d8e8ef31e21c99d1db9a6444d3adf1270",[a.CHAIN_IDS.AVALANCHE]:"0xb31f66aa3c1e785363f0875a1b74e27b85fd66c7",[a.CHAIN_IDS.ARBITRUM]:"0x82af49447d8a07e3bd95bd0d56f35241523fbab1",[a.CHAIN_IDS.OPTIMISM]:"0x4200000000000000000000000000000000000006",[a.CHAIN_IDS.ZKSYNC_ERA]:"0x5AEa5775959fBC2557Cc8789bC1bf90A239D9a91",[a.CHAIN_IDS.LINEA_MAINNET]:"0xe5D7C2a44FfDDf6b295A15c148167daaAf5Cf34f",[a.CHAIN_IDS.BASE]:"0x4200000000000000000000000000000000000006",[a.CHAIN_IDS.SEI]:"0xe30fedd158a2e3b13e9badaeabafc5516e95e8c7"},n.ALLOWED_CONTRACT_ADDRESSES={[a.CHAIN_IDS.MAINNET]:[n.SWAPS_CONTRACT_ADDRESSES[a.CHAIN_IDS.MAINNET],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[a.CHAIN_IDS.MAINNET]],[a.CHAIN_IDS.LOCALHOST]:[n.SWAPS_CONTRACT_ADDRESSES[a.CHAIN_IDS.LOCALHOST],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[a.CHAIN_IDS.LOCALHOST]],[a.CHAIN_IDS.BSC]:[n.SWAPS_CONTRACT_ADDRESSES[a.CHAIN_IDS.BSC],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[a.CHAIN_IDS.BSC]],[a.CHAIN_IDS.POLYGON]:[n.SWAPS_CONTRACT_ADDRESSES[a.CHAIN_IDS.POLYGON],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[a.CHAIN_IDS.POLYGON]],[a.CHAIN_IDS.AVALANCHE]:[n.SWAPS_CONTRACT_ADDRESSES[a.CHAIN_IDS.AVALANCHE],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[a.CHAIN_IDS.AVALANCHE]],[a.CHAIN_IDS.ARBITRUM]:[n.SWAPS_CONTRACT_ADDRESSES[a.CHAIN_IDS.ARBITRUM],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[a.CHAIN_IDS.ARBITRUM]],[a.CHAIN_IDS.OPTIMISM]:[n.SWAPS_CONTRACT_ADDRESSES[a.CHAIN_IDS.OPTIMISM],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[a.CHAIN_IDS.OPTIMISM]],[a.CHAIN_IDS.ZKSYNC_ERA]:[n.SWAPS_CONTRACT_ADDRESSES[a.CHAIN_IDS.ZKSYNC_ERA],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[a.CHAIN_IDS.ZKSYNC_ERA]],[a.CHAIN_IDS.LINEA_MAINNET]:[n.SWAPS_CONTRACT_ADDRESSES[a.CHAIN_IDS.LINEA_MAINNET],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[a.CHAIN_IDS.LINEA_MAINNET]],[a.CHAIN_IDS.BASE]:[n.SWAPS_CONTRACT_ADDRESSES[a.CHAIN_IDS.BASE],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[a.CHAIN_IDS.BASE]],[a.CHAIN_IDS.SEI]:[n.SWAPS_CONTRACT_ADDRESSES[a.CHAIN_IDS.SEI],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[a.CHAIN_IDS.SEI]]}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/constants/swaps.cjs"}],[3151,{"./chains.cjs":3149,"@metamask/keyring-api":2306},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SYMBOL_TO_SLIP44_MAP=n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP=n.DEFAULT_TOKEN_ADDRESS=void 0;const a=e("@metamask/keyring-api"),r=e("./chains.cjs");n.DEFAULT_TOKEN_ADDRESS="0x0000000000000000000000000000000000000000";const s="AVAX",i="BNB",o="ETH",c="POL",l="TESTETH",u="SOL",d="SEI",h="BTC",m="TRX",f="MON",p={symbol:o,name:"Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},g={symbol:i,name:"Binance Coin",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},T={symbol:c,name:"Polygon",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},w={symbol:s,name:"Avalanche",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},b={symbol:l,name:"Test Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},E={symbol:o,name:"Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},y={symbol:o,name:"Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},S={...p},k={...p},I={...p},A={...p},_={...p},C={symbol:u,name:"Solana",address:n.DEFAULT_TOKEN_ADDRESS,decimals:9,iconUrl:""},P={symbol:h,name:"Bitcoin",address:n.DEFAULT_TOKEN_ADDRESS,decimals:8,iconUrl:""},v={symbol:d,name:"Sei",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},N={symbol:m,name:"Tron",address:n.DEFAULT_TOKEN_ADDRESS,decimals:6,iconUrl:""},R={symbol:f,name:"Mon",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""};n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP={[r.CHAIN_IDS.MAINNET]:p,[r.CHAIN_IDS.LOCALHOST]:b,[r.CHAIN_IDS.BSC]:g,[r.CHAIN_IDS.POLYGON]:T,[r.CHAIN_IDS.GOERLI]:E,[r.CHAIN_IDS.SEPOLIA]:y,[r.CHAIN_IDS.AVALANCHE]:w,[r.CHAIN_IDS.OPTIMISM]:k,[r.CHAIN_IDS.ARBITRUM]:S,[r.CHAIN_IDS.ZKSYNC_ERA]:I,[r.CHAIN_IDS.LINEA_MAINNET]:A,[r.CHAIN_IDS.BASE]:_,[r.CHAIN_IDS.SEI]:v,[r.CHAIN_IDS.MONAD]:R,[a.SolScope.Mainnet]:C,[a.SolScope.Devnet]:C,[a.BtcScope.Mainnet]:P,[a.TrxScope.Mainnet]:N},n.SYMBOL_TO_SLIP44_MAP={SOL:"slip44:501",BTC:"slip44:0",ETH:"slip44:60",POL:"slip44:966",BNB:"slip44:714",AVAX:"slip44:9000",TESTETH:"slip44:60",SEI:"slip44:19000118",TRX:"slip44:195",MON:"slip44:268435779"}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/constants/tokens.cjs"}],[3152,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a;Object.defineProperty(n,"__esModule",{value:!0}),n.TraceName=void 0,function(e){e.BridgeQuotesFetched="Bridge Quotes Fetched",e.SwapQuotesFetched="Swap Quotes Fetched"}(a||(n.TraceName=a={}))}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/constants/traces.cjs"}],[3153,{"./bridge-controller.cjs":3147,"./constants/bridge.cjs":3148,"./constants/swaps.cjs":3150,"./constants/tokens.cjs":3151,"./selectors.cjs":3154,"./types.cjs":3155,"./utils/balance.cjs":3157,"./utils/bridge.cjs":3158,"./utils/caip-formatters.cjs":3159,"./utils/feature-flags.cjs":3160,"./utils/fetch.cjs":3162,"./utils/metrics/constants.cjs":3163,"./utils/metrics/properties.cjs":3164,"./utils/quote.cjs":3166,"./utils/slippage.cjs":3167,"./utils/swaps.cjs":3169,"./utils/trade-utils.cjs":3170,"./utils/validators.cjs":3171},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isValidQuoteRequest=n.isCrossChain=n.getDefaultBridgeControllerState=n.getNativeAssetForChainId=n.isNonEvmChainId=n.isBitcoinChainId=n.isSolanaChainId=n.isNativeAddress=n.isEthUsdt=n.MetricsSwapType=n.MetricsActionType=n.ALLOWED_CONTRACT_ADDRESSES=n.SWAPS_WRAPPED_TOKENS_ADDRESSES=n.SWAPS_CONTRACT_ADDRESSES=n.SWAPS_API_V2_BASE_URL=n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP=n.BRIDGE_PROD_API_BASE_URL=n.BRIDGE_DEV_API_BASE_URL=n.METABRIDGE_CHAIN_TO_ADDRESS_MAP=n.DEFAULT_BRIDGE_CONTROLLER_STATE=n.DEFAULT_MAX_REFRESH_COUNT=n.REFRESH_INTERVAL_MS=n.BRIDGE_MM_FEE_RATE=n.BRIDGE_PREFERRED_GAS_ESTIMATE=n.BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE=n.BRIDGE_QUOTE_MAX_ETA_SECONDS=n.BRIDGE_CONTROLLER_NAME=n.BridgeClientId=n.ALLOWED_BRIDGE_CHAIN_IDS=n.FeatureId=n.BridgeAssetSchema=n.ActionTypes=n.FeeType=n.BridgeBackgroundAction=n.BridgeUserAction=n.RequestStatus=n.ChainId=n.SortOrder=n.AssetType=n.StatusTypes=n.AbortReason=n.getQuotesReceivedProperties=n.isCustomSlippage=n.isHardwareWallet=n.getSwapType=n.getRequestParams=n.formatProviderLabel=n.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY=n.UnifiedSwapBridgeEventName=n.BridgeController=void 0,n.fetchTokens=n.getSwapsContractAddress=n.isValidSwapsContractAddress=n.BRIDGE_DEFAULT_SLIPPAGE=n.getBridgeFeatureFlags=n.DEFAULT_FEATURE_FLAG_CONFIG=n.selectMinimumBalanceForRentExemptionInSOL=n.selectBridgeFeatureFlags=n.selectIsQuoteExpired=n.selectExchangeRateByChainIdAndAddress=n.selectDefaultSlippagePercentage=n.selectBridgeQuotes=n.isEvmTxData=n.isTronTrade=n.isBitcoinTrade=n.extractTradeData=n.formatAddressToAssetId=n.formatAddressToCaipReference=n.formatChainIdToHex=n.formatChainIdToCaip=n.getClientHeaders=n.fetchBridgeTokens=n.calcLatestSrcBalance=n.calcSlippagePercentage=n.formatEtaInMinutes=void 0;var a=e("./bridge-controller.cjs");Object.defineProperty(n,"BridgeController",{enumerable:!0,get:function(){return a.BridgeController}});var r=e("./utils/metrics/constants.cjs");Object.defineProperty(n,"UnifiedSwapBridgeEventName",{enumerable:!0,get:function(){return r.UnifiedSwapBridgeEventName}}),Object.defineProperty(n,"UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY",{enumerable:!0,get:function(){return r.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY}});var s=e("./utils/metrics/properties.cjs");Object.defineProperty(n,"formatProviderLabel",{enumerable:!0,get:function(){return s.formatProviderLabel}}),Object.defineProperty(n,"getRequestParams",{enumerable:!0,get:function(){return s.getRequestParams}}),Object.defineProperty(n,"getSwapType",{enumerable:!0,get:function(){return s.getSwapType}}),Object.defineProperty(n,"isHardwareWallet",{enumerable:!0,get:function(){return s.isHardwareWallet}}),Object.defineProperty(n,"isCustomSlippage",{enumerable:!0,get:function(){return s.isCustomSlippage}}),Object.defineProperty(n,"getQuotesReceivedProperties",{enumerable:!0,get:function(){return s.getQuotesReceivedProperties}});var i=e("./utils/metrics/constants.cjs");Object.defineProperty(n,"AbortReason",{enumerable:!0,get:function(){return i.AbortReason}});var o=e("./types.cjs");Object.defineProperty(n,"StatusTypes",{enumerable:!0,get:function(){return o.StatusTypes}});var c=e("./types.cjs");Object.defineProperty(n,"AssetType",{enumerable:!0,get:function(){return c.AssetType}}),Object.defineProperty(n,"SortOrder",{enumerable:!0,get:function(){return c.SortOrder}}),Object.defineProperty(n,"ChainId",{enumerable:!0,get:function(){return c.ChainId}}),Object.defineProperty(n,"RequestStatus",{enumerable:!0,get:function(){return c.RequestStatus}}),Object.defineProperty(n,"BridgeUserAction",{enumerable:!0,get:function(){return c.BridgeUserAction}}),Object.defineProperty(n,"BridgeBackgroundAction",{enumerable:!0,get:function(){return c.BridgeBackgroundAction}});var l=e("./utils/validators.cjs");Object.defineProperty(n,"FeeType",{enumerable:!0,get:function(){return l.FeeType}}),Object.defineProperty(n,"ActionTypes",{enumerable:!0,get:function(){return l.ActionTypes}}),Object.defineProperty(n,"BridgeAssetSchema",{enumerable:!0,get:function(){return l.BridgeAssetSchema}}),Object.defineProperty(n,"FeatureId",{enumerable:!0,get:function(){return l.FeatureId}});var u=e("./constants/bridge.cjs");Object.defineProperty(n,"ALLOWED_BRIDGE_CHAIN_IDS",{enumerable:!0,get:function(){return u.ALLOWED_BRIDGE_CHAIN_IDS}}),Object.defineProperty(n,"BridgeClientId",{enumerable:!0,get:function(){return u.BridgeClientId}}),Object.defineProperty(n,"BRIDGE_CONTROLLER_NAME",{enumerable:!0,get:function(){return u.BRIDGE_CONTROLLER_NAME}}),Object.defineProperty(n,"BRIDGE_QUOTE_MAX_ETA_SECONDS",{enumerable:!0,get:function(){return u.BRIDGE_QUOTE_MAX_ETA_SECONDS}}),Object.defineProperty(n,"BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE",{enumerable:!0,get:function(){return u.BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE}}),Object.defineProperty(n,"BRIDGE_PREFERRED_GAS_ESTIMATE",{enumerable:!0,get:function(){return u.BRIDGE_PREFERRED_GAS_ESTIMATE}}),Object.defineProperty(n,"BRIDGE_MM_FEE_RATE",{enumerable:!0,get:function(){return u.BRIDGE_MM_FEE_RATE}}),Object.defineProperty(n,"REFRESH_INTERVAL_MS",{enumerable:!0,get:function(){return u.REFRESH_INTERVAL_MS}}),Object.defineProperty(n,"DEFAULT_MAX_REFRESH_COUNT",{enumerable:!0,get:function(){return u.DEFAULT_MAX_REFRESH_COUNT}}),Object.defineProperty(n,"DEFAULT_BRIDGE_CONTROLLER_STATE",{enumerable:!0,get:function(){return u.DEFAULT_BRIDGE_CONTROLLER_STATE}}),Object.defineProperty(n,"METABRIDGE_CHAIN_TO_ADDRESS_MAP",{enumerable:!0,get:function(){return u.METABRIDGE_CHAIN_TO_ADDRESS_MAP}}),Object.defineProperty(n,"BRIDGE_DEV_API_BASE_URL",{enumerable:!0,get:function(){return u.BRIDGE_DEV_API_BASE_URL}}),Object.defineProperty(n,"BRIDGE_PROD_API_BASE_URL",{enumerable:!0,get:function(){return u.BRIDGE_PROD_API_BASE_URL}});var d=e("./constants/tokens.cjs");Object.defineProperty(n,"SWAPS_CHAINID_DEFAULT_TOKEN_MAP",{enumerable:!0,get:function(){return d.SWAPS_CHAINID_DEFAULT_TOKEN_MAP}});var h=e("./constants/swaps.cjs");Object.defineProperty(n,"SWAPS_API_V2_BASE_URL",{enumerable:!0,get:function(){return h.SWAPS_API_V2_BASE_URL}}),Object.defineProperty(n,"SWAPS_CONTRACT_ADDRESSES",{enumerable:!0,get:function(){return h.SWAPS_CONTRACT_ADDRESSES}}),Object.defineProperty(n,"SWAPS_WRAPPED_TOKENS_ADDRESSES",{enumerable:!0,get:function(){return h.SWAPS_WRAPPED_TOKENS_ADDRESSES}}),Object.defineProperty(n,"ALLOWED_CONTRACT_ADDRESSES",{enumerable:!0,get:function(){return h.ALLOWED_CONTRACT_ADDRESSES}});var m=e("./utils/metrics/constants.cjs");Object.defineProperty(n,"MetricsActionType",{enumerable:!0,get:function(){return m.MetricsActionType}}),Object.defineProperty(n,"MetricsSwapType",{enumerable:!0,get:function(){return m.MetricsSwapType}});var f=e("./utils/bridge.cjs");Object.defineProperty(n,"isEthUsdt",{enumerable:!0,get:function(){return f.isEthUsdt}}),Object.defineProperty(n,"isNativeAddress",{enumerable:!0,get:function(){return f.isNativeAddress}}),Object.defineProperty(n,"isSolanaChainId",{enumerable:!0,get:function(){return f.isSolanaChainId}}),Object.defineProperty(n,"isBitcoinChainId",{enumerable:!0,get:function(){return f.isBitcoinChainId}}),Object.defineProperty(n,"isNonEvmChainId",{enumerable:!0,get:function(){return f.isNonEvmChainId}}),Object.defineProperty(n,"getNativeAssetForChainId",{enumerable:!0,get:function(){return f.getNativeAssetForChainId}}),Object.defineProperty(n,"getDefaultBridgeControllerState",{enumerable:!0,get:function(){return f.getDefaultBridgeControllerState}}),Object.defineProperty(n,"isCrossChain",{enumerable:!0,get:function(){return f.isCrossChain}});var p=e("./utils/quote.cjs");Object.defineProperty(n,"isValidQuoteRequest",{enumerable:!0,get:function(){return p.isValidQuoteRequest}}),Object.defineProperty(n,"formatEtaInMinutes",{enumerable:!0,get:function(){return p.formatEtaInMinutes}}),Object.defineProperty(n,"calcSlippagePercentage",{enumerable:!0,get:function(){return p.calcSlippagePercentage}});var g=e("./utils/balance.cjs");Object.defineProperty(n,"calcLatestSrcBalance",{enumerable:!0,get:function(){return g.calcLatestSrcBalance}});var T=e("./utils/fetch.cjs");Object.defineProperty(n,"fetchBridgeTokens",{enumerable:!0,get:function(){return T.fetchBridgeTokens}}),Object.defineProperty(n,"getClientHeaders",{enumerable:!0,get:function(){return T.getClientHeaders}});var w=e("./utils/caip-formatters.cjs");Object.defineProperty(n,"formatChainIdToCaip",{enumerable:!0,get:function(){return w.formatChainIdToCaip}}),Object.defineProperty(n,"formatChainIdToHex",{enumerable:!0,get:function(){return w.formatChainIdToHex}}),Object.defineProperty(n,"formatAddressToCaipReference",{enumerable:!0,get:function(){return w.formatAddressToCaipReference}}),Object.defineProperty(n,"formatAddressToAssetId",{enumerable:!0,get:function(){return w.formatAddressToAssetId}});var b=e("./utils/trade-utils.cjs");Object.defineProperty(n,"extractTradeData",{enumerable:!0,get:function(){return b.extractTradeData}}),Object.defineProperty(n,"isBitcoinTrade",{enumerable:!0,get:function(){return b.isBitcoinTrade}}),Object.defineProperty(n,"isTronTrade",{enumerable:!0,get:function(){return b.isTronTrade}}),Object.defineProperty(n,"isEvmTxData",{enumerable:!0,get:function(){return b.isEvmTxData}});var E=e("./selectors.cjs");Object.defineProperty(n,"selectBridgeQuotes",{enumerable:!0,get:function(){return E.selectBridgeQuotes}}),Object.defineProperty(n,"selectDefaultSlippagePercentage",{enumerable:!0,get:function(){return E.selectDefaultSlippagePercentage}}),Object.defineProperty(n,"selectExchangeRateByChainIdAndAddress",{enumerable:!0,get:function(){return E.selectExchangeRateByChainIdAndAddress}}),Object.defineProperty(n,"selectIsQuoteExpired",{enumerable:!0,get:function(){return E.selectIsQuoteExpired}}),Object.defineProperty(n,"selectBridgeFeatureFlags",{enumerable:!0,get:function(){return E.selectBridgeFeatureFlags}}),Object.defineProperty(n,"selectMinimumBalanceForRentExemptionInSOL",{enumerable:!0,get:function(){return E.selectMinimumBalanceForRentExemptionInSOL}});var y=e("./constants/bridge.cjs");Object.defineProperty(n,"DEFAULT_FEATURE_FLAG_CONFIG",{enumerable:!0,get:function(){return y.DEFAULT_FEATURE_FLAG_CONFIG}});var S=e("./utils/feature-flags.cjs");Object.defineProperty(n,"getBridgeFeatureFlags",{enumerable:!0,get:function(){return S.getBridgeFeatureFlags}});var k=e("./utils/slippage.cjs");Object.defineProperty(n,"BRIDGE_DEFAULT_SLIPPAGE",{enumerable:!0,get:function(){return k.BRIDGE_DEFAULT_SLIPPAGE}});var I=e("./utils/swaps.cjs");Object.defineProperty(n,"isValidSwapsContractAddress",{enumerable:!0,get:function(){return I.isValidSwapsContractAddress}}),Object.defineProperty(n,"getSwapsContractAddress",{enumerable:!0,get:function(){return I.getSwapsContractAddress}}),Object.defineProperty(n,"fetchTokens",{enumerable:!0,get:function(){return I.fetchTokens}})}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/index.cjs"}],[3154,{"./constants/bridge.cjs":3148,"./types.cjs":3155,"./utils/bridge.cjs":3158,"./utils/caip-formatters.cjs":3159,"./utils/feature-flags.cjs":3160,"./utils/quote.cjs":3166,"./utils/slippage.cjs":3167,"@ethersproject/constants":774,"@metamask/utils":3217,"bignumber.js":3188,lodash:4901,reselect:5371},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.selectDefaultSlippagePercentage=n.selectMinimumBalanceForRentExemptionInSOL=n.selectBridgeQuotes=n.selectIsQuoteExpired=n.selectIsAssetExchangeRateInState=n.selectExchangeRateByChainIdAndAddress=n.selectBridgeFeatureFlags=void 0;const a=e("@ethersproject/constants"),r=e("@metamask/utils"),s=e("bignumber.js"),i=e("lodash"),o=e("reselect"),c=e("./constants/bridge.cjs"),l=e("./types.cjs"),u=e("./utils/bridge.cjs"),d=e("./utils/caip-formatters.cjs"),h=e("./utils/feature-flags.cjs"),m=e("./utils/quote.cjs"),f=e("./utils/slippage.cjs"),p=o.createStructuredSelector.withTypes(),g=o.createSelector.withTypes(),T=o.createSelector.withTypes();n.selectBridgeFeatureFlags=T([e=>e.remoteFeatureFlags.bridgeConfig],e=>(0,h.processFeatureFlags)(e));const w=(e,t,n)=>{if(!t||!n)return{};const a=(0,d.formatAddressToAssetId)(n,t);if(!a)return{};const{assetExchangeRates:i,currencyRates:o,marketData:c,conversionRates:l}=e,h=i?.[a]??i?.[a.toLowerCase()];if(h?.exchangeRate)return h;if((0,u.isNonEvmChainId)(t)){const e=l?.[a];return e?{exchangeRate:e.rate,usdExchangeRate:undefined}:{}}if((0,u.isNativeAddress)(n)){const{symbol:e}=(0,u.getNativeAssetForChainId)(t),n=o?.[e];return n?{exchangeRate:n?.conversionRate?.toString(),usdExchangeRate:n?.usdConversionRate?.toString()}:{}}if(!(0,u.isNonEvmChainId)(t)){const e=c?.[(0,d.formatChainIdToHex)(t)],a=(0,r.isStrictHexString)(n)?e?.[n]:null,i=a?o[a?.currency]:undefined;if(a&&i)return{exchangeRate:new s.BigNumber(a.price).multipliedBy(i.conversionRate??0).toString(),usdExchangeRate:new s.BigNumber(a.price).multipliedBy(i.usdConversionRate??0).toString()}}return{}};n.selectExchangeRateByChainIdAndAddress=(e,t,n)=>w(e,t,n);n.selectIsAssetExchangeRateInState=(...e)=>Boolean(w(...e)?.exchangeRate)&&Boolean(w(...e)?.usdExchangeRate);const b=g([({quotes:e})=>e,p({estimatedBaseFeeInDecGwei:({gasFeeEstimates:e})=>e?.estimatedBaseFee,feePerGasInDecGwei:({gasFeeEstimates:e})=>e?.[c.BRIDGE_PREFERRED_GAS_ESTIMATE]?.suggestedMaxFeePerGas,maxFeePerGasInDecGwei:({gasFeeEstimates:e})=>e?.high?.suggestedMaxFeePerGas}),g([e=>e,({quoteRequest:{srcChainId:e}})=>e,({quoteRequest:{srcTokenAddress:e}})=>e],n.selectExchangeRateByChainIdAndAddress),g([e=>e,({quoteRequest:{destChainId:e}})=>e,({quoteRequest:{destTokenAddress:e}})=>e],n.selectExchangeRateByChainIdAndAddress),g([e=>e,({quoteRequest:{srcChainId:e}})=>e],(e,t)=>(0,n.selectExchangeRateByChainIdAndAddress)(e,t,a.AddressZero))],(e,t,n,a,r)=>e.map(e=>{const s=(0,m.calcSentAmount)(e.quote,n),i=(0,m.calcToAmount)(e.quote.destTokenAmount,e.quote.destAsset,a),o=(0,m.calcToAmount)(e.quote.minDestTokenAmount,e.quote.destAsset,a),c=(0,m.calcIncludedTxFees)(e.quote,n,a);let l,d,h,f;(0,u.isEvmQuoteResponse)(e)?(h=(0,m.calcRelayerFee)(e,r),f=(0,m.calcEstimatedAndMaxTotalGasFee)({bridgeQuote:e,...t,...r}),l=(0,m.calcTotalEstimatedNetworkFee)(f,h),d=(0,m.calcTotalMaxNetworkFee)(f,h)):(l=(0,m.calcNonEvmTotalNetworkFee)(e,r),f={effective:l,total:l,max:l},d=l);const p=(0,m.calcAdjustedReturn)(i,l,e.quote),g=(0,m.calcCost)(p,s);return{...e,sentAmount:s,toTokenAmount:i,minToTokenAmount:o,swapRate:(0,m.calcSwapRate)(s.amount,i.amount),totalNetworkFee:l,totalMaxNetworkFee:d,gasFee:f,adjustedReturn:p,cost:g,includedTxFees:c}})),E=g([b,(e,{sortOrder:t})=>t],(e,t)=>t===l.SortOrder.ETA_ASC?(0,i.orderBy)(e,e=>e.estimatedProcessingTimeInSeconds,"asc"):(0,i.orderBy)(e,({cost:e})=>e.valueInCurrency?Number(e.valueInCurrency):0,"asc")),y=g([E],e=>e.length>0?e[0]:null),S=g([y,(e,{selectedQuote:t})=>t],(e,t)=>t??e),k=g([n.selectBridgeFeatureFlags,e=>e.quoteRequest.insufficientBal,e=>e.quotesRefreshCount],(e,t,n)=>!t&&e.maxRefreshCount>n),I=g([n.selectBridgeFeatureFlags,e=>e.quoteRequest.srcChainId],(e,t)=>(t?e.chains[(0,d.formatChainIdToCaip)(t)]?.refreshRate:e.refreshRate)??e.refreshRate);n.selectIsQuoteExpired=g([k,({quotesLastFetched:e})=>e,I,(e,t,n)=>n],(e,t,n,a)=>Boolean(!e&&t&&a-t>n)),n.selectBridgeQuotes=p({sortedQuotes:E,recommendedQuote:y,activeQuote:S,quotesLastFetchedMs:e=>e.quotesLastFetched,isLoading:e=>e.quotesLoadingStatus===l.RequestStatus.LOADING,quoteFetchError:e=>e.quoteFetchError,quotesRefreshCount:e=>e.quotesRefreshCount,quotesInitialLoadTimeMs:e=>e.quotesInitialLoadTime,isQuoteGoingToRefresh:k});n.selectMinimumBalanceForRentExemptionInSOL=e=>new s.BigNumber(e.minimumBalanceForRentExemptionInLamports??0).div(10**9).toString(),n.selectDefaultSlippagePercentage=g([e=>(0,n.selectBridgeFeatureFlags)(e).chains,(e,t)=>t.srcTokenAddress,(e,t)=>t.destTokenAddress,(e,t)=>t.srcChainId?(0,d.formatChainIdToCaip)(t.srcChainId):undefined,(e,t)=>t.destChainId?(0,d.formatChainIdToCaip)(t.destChainId):undefined],(e,t,n,a,r)=>(0,f.getDefaultSlippagePercentage)({srcTokenAddress:t,destTokenAddress:n,srcChainId:a,destChainId:r},a?e[a]?.stablecoins:undefined,r?e[r]?.stablecoins:undefined))}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/selectors.cjs"}],[3155,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l;Object.defineProperty(n,"__esModule",{value:!0}),n.BridgeBackgroundAction=n.BridgeUserAction=n.RequestStatus=n.ChainId=n.StatusTypes=n.SortOrder=n.AssetType=void 0,function(e){e.native="NATIVE",e.token="TOKEN",e.NFT="NFT",e.unknown="UNKNOWN"}(a||(n.AssetType=a={})),function(e){e.COST_ASC="cost_ascending",e.ETA_ASC="time_descending"}(r||(n.SortOrder=r={})),function(e){e.SUBMITTED="SUBMITTED",e.UNKNOWN="UNKNOWN",e.FAILED="FAILED",e.PENDING="PENDING",e.COMPLETE="COMPLETE"}(s||(n.StatusTypes=s={})),function(e){e[e.ETH=1]="ETH",e[e.OPTIMISM=10]="OPTIMISM",e[e.BSC=56]="BSC",e[e.POLYGON=137]="POLYGON",e[e.ZKSYNC=324]="ZKSYNC",e[e.BASE=8453]="BASE",e[e.ARBITRUM=42161]="ARBITRUM",e[e.AVALANCHE=43114]="AVALANCHE",e[e.LINEA=59144]="LINEA",e[e.SOLANA=0x416edef1601be]="SOLANA",e[e.BTC=20000000000001]="BTC",e[e.TRON=728126428]="TRON",e[e.SEI=1329]="SEI",e[e.MONAD=143]="MONAD"}(i||(n.ChainId=i={})),function(e){e[e.LOADING=0]="LOADING",e[e.FETCHED=1]="FETCHED",e[e.ERROR=2]="ERROR"}(o||(n.RequestStatus=o={})),function(e){e.SELECT_DEST_NETWORK="selectDestNetwork",e.UPDATE_QUOTE_PARAMS="updateBridgeQuoteRequestParams"}(c||(n.BridgeUserAction=c={})),function(e){e.SET_CHAIN_INTERVAL_LENGTH="setChainIntervalLength",e.RESET_STATE="resetState",e.TRACK_METAMETRICS_EVENT="trackUnifiedSwapBridgeEvent",e.STOP_POLLING_FOR_QUOTES="stopPollingForQuotes",e.FETCH_QUOTES="fetchQuotes"}(l||(n.BridgeBackgroundAction=l={}))}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/types.cjs"}],[3156,{"./bridge.cjs":3158,"./caip-formatters.cjs":3159},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.toExchangeRates=n.getAssetIdsForToken=void 0;const a=e("./bridge.cjs"),r=e("./caip-formatters.cjs");n.getAssetIdsForToken=(e,t)=>{const n=[],s=(0,r.formatAddressToAssetId)(e,t);return s&&(n.push(s),(0,a.getNativeAssetForChainId)(t)?.assetId&&n.push((0,a.getNativeAssetForChainId)(t).assetId)),n};n.toExchangeRates=(e,t)=>Object.entries(t).reduce((t,[n,a])=>(a&&(t[n]={exchangeRate:a[e],usdExchangeRate:a.usd}),t),{})}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/assets.cjs"}],[3157,{"./bridge.cjs":3158,"@ethersproject/address":761,"@ethersproject/contracts":777,"@ethersproject/providers":815,"@metamask/metamask-eth-abis":2376},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.hasSufficientBalance=n.calcLatestSrcBalance=n.fetchTokenBalance=void 0;const a=e("@ethersproject/address"),r=e("@ethersproject/contracts"),s=e("@ethersproject/providers"),i=e("@metamask/metamask-eth-abis"),o=e("./bridge.cjs");n.fetchTokenBalance=async(e,t,n)=>{const a=new s.Web3Provider(n),o=new r.Contract(e,i.abiERC20,a),c="function"==typeof o?.balanceOf?o.balanceOf(t):Promise.resolve(undefined);return await c};n.calcLatestSrcBalance=async(e,t,r,i)=>{if(r&&i){if((0,o.isNativeAddress)(r)){const n=new s.Web3Provider(e);return await n.getBalance((0,a.getAddress)(t))}return await(0,n.fetchTokenBalance)(r,t,e)}return undefined};n.hasSufficientBalance=async(e,t,a,r,s)=>{const i=await(0,n.calcLatestSrcBalance)(e,t,a,s);return!!i&&i.gte(r)}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/balance.cjs"}],[3158,{"../constants/bridge.cjs":3148,"../constants/chains.cjs":3149,"../constants/swaps.cjs":3150,"../constants/tokens.cjs":3151,"../types.cjs":3155,"./caip-formatters.cjs":3159,"@ethersproject/constants":774,"@ethersproject/contracts":777,"@metamask/keyring-api":2306,"@metamask/metamask-eth-abis":2376,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isEvmQuoteResponse=n.isNonEvmChainId=n.isTronChainId=n.isBitcoinChainId=n.isSolanaChainId=n.isNativeAddress=n.isSwapsDefaultTokenSymbol=n.isSwapsDefaultTokenAddress=n.sumHexes=n.isEthUsdt=n.getEthUsdtResetData=n.getNativeAssetForChainId=n.getDefaultBridgeControllerState=n.isCrossChain=void 0;const a=e("@ethersproject/constants"),r=e("@ethersproject/contracts"),s=e("@metamask/keyring-api"),i=e("@metamask/metamask-eth-abis"),o=e("@metamask/utils"),c=e("./caip-formatters.cjs"),l=e("../constants/bridge.cjs"),u=e("../constants/chains.cjs"),d=e("../constants/swaps.cjs"),h=e("../constants/tokens.cjs"),m=e("../types.cjs");n.isCrossChain=(e,t)=>{try{return!!t&&(0,c.formatChainIdToCaip)(e)!==(0,c.formatChainIdToCaip)(t)}catch{return!1}};n.getDefaultBridgeControllerState=()=>l.DEFAULT_BRIDGE_CONTROLLER_STATE;const f=(e,t)=>`${(0,c.formatChainIdToCaip)(e)}/${h.SYMBOL_TO_SLIP44_MAP[t]}`;n.getNativeAssetForChainId=e=>{const t=(0,c.formatChainIdToCaip)(e),n=h.SWAPS_CHAINID_DEFAULT_TOKEN_MAP[(0,c.formatChainIdToCaip)(e)]??h.SWAPS_CHAINID_DEFAULT_TOKEN_MAP[(0,c.formatChainIdToHex)(e)];if(!n)throw new Error(`No XChain Swaps native asset found for chainId: ${e}`);return{...n,chainId:(0,c.formatChainIdToDec)(e),assetId:f(t,n.symbol)}};n.getEthUsdtResetData=e=>{const t=(0,n.isCrossChain)(u.CHAIN_IDS.MAINNET,e)?l.METABRIDGE_ETHEREUM_ADDRESS:d.SWAPS_CONTRACT_ADDRESSES[u.CHAIN_IDS.MAINNET];return new r.Contract(l.ETH_USDT_ADDRESS,i.abiERC20).interface.encodeFunctionData("approve",[t,"0"])};n.isEthUsdt=(e,t)=>(0,c.formatChainIdToDec)(e)===m.ChainId.ETH&&t.toLowerCase()===l.ETH_USDT_ADDRESS.toLowerCase();n.sumHexes=(...e)=>{if(0===e.length)return"0x0";return`0x${e.reduce((e,t)=>e+BigInt(t),BigInt(0)).toString(16)}`};n.isSwapsDefaultTokenAddress=(e,t)=>!(!e||!t)&&e===(0,n.getNativeAssetForChainId)(t)?.address;n.isSwapsDefaultTokenSymbol=(e,t)=>!(!e||!t)&&e===(0,n.getNativeAssetForChainId)(t)?.symbol;n.isNativeAddress=e=>e===a.AddressZero||""===e||!e||!(0,o.isStrictHexString)(e)&&Object.values(h.SYMBOL_TO_SLIP44_MAP).some(t=>e.includes(t)||t.endsWith(e));n.isSolanaChainId=e=>(0,o.isCaipChainId)(e)?e===s.SolScope.Mainnet.toString():e.toString()===m.ChainId.SOLANA.toString();n.isBitcoinChainId=e=>(0,o.isCaipChainId)(e)?e===s.BtcScope.Mainnet.toString():e.toString()===m.ChainId.BTC.toString();n.isTronChainId=e=>(0,o.isCaipChainId)(e)?e===s.TrxScope.Mainnet.toString():e.toString()===m.ChainId.TRON.toString();n.isNonEvmChainId=e=>(0,n.isSolanaChainId)(e)||(0,n.isBitcoinChainId)(e)||(0,n.isTronChainId)(e);n.isEvmQuoteResponse=e=>!(0,n.isNonEvmChainId)(e.quote.srcChainId)}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/bridge.cjs"}],[3159,{"../types.cjs":3155,"./bridge.cjs":3158,"@ethersproject/address":761,"@ethersproject/constants":774,"@metamask/controller-utils":1494,"@metamask/keyring-api":2306,"@metamask/multichain-network-controller":3176,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.formatAddressToAssetId=n.formatAddressToCaipReference=n.formatChainIdToHex=n.formatChainIdToDec=n.formatChainIdToCaip=void 0;const a=e("@ethersproject/address"),r=e("@ethersproject/constants"),s=e("@metamask/controller-utils"),i=e("@metamask/keyring-api"),o=e("@metamask/multichain-network-controller"),c=e("@metamask/utils"),l=e("./bridge.cjs"),u=e("../types.cjs");n.formatChainIdToCaip=e=>(0,c.isCaipChainId)(e)?e:(0,c.isStrictHexString)(e)?(0,o.toEvmCaipChainId)(e):(0,l.isSolanaChainId)(e)?i.SolScope.Mainnet:(0,l.isBitcoinChainId)(e)?i.BtcScope.Mainnet:(0,l.isTronChainId)(e)?i.TrxScope.Mainnet:(0,o.toEvmCaipChainId)((0,c.numberToHex)(Number(e)));n.formatChainIdToDec=e=>(0,c.isStrictHexString)(e)?(0,s.convertHexToDecimal)(e):e===i.SolScope.Mainnet?u.ChainId.SOLANA:e===i.BtcScope.Mainnet?u.ChainId.BTC:e===i.TrxScope.Mainnet?u.ChainId.TRON:(0,c.isCaipChainId)(e)?Number(e.split(":").at(-1)):"string"==typeof e?parseInt(e,10):e;n.formatChainIdToHex=e=>{if((0,c.isStrictHexString)(e))return e;if("number"==typeof e||parseInt(e,10))return(0,c.numberToHex)(Number(e));if((0,c.isCaipChainId)(e)){const{reference:t}=(0,c.parseCaipChainId)(e);if((0,c.isCaipReference)(t)&&!isNaN(Number(t)))return(0,c.numberToHex)(Number(t))}throw new Error(`Invalid cross-chain swaps chainId: ${e}`)};n.formatAddressToCaipReference=e=>{if((0,c.isStrictHexString)(e))return(0,a.getAddress)(e);if((0,l.isNativeAddress)(e))return r.AddressZero;const t=e.split(":").at(-1);if(!t)throw new Error("Invalid address");return t};n.formatAddressToAssetId=(e,t)=>(0,c.isCaipAssetType)(e)?e:(0,l.isNativeAddress)(e)?(0,l.getNativeAssetForChainId)(t).assetId:t===i.SolScope.Mainnet?c.CaipAssetTypeStruct.create(`${t}/token:${e}`):(0,c.isStrictHexString)(e)?c.CaipAssetTypeStruct.create(`${(0,n.formatChainIdToCaip)(t)}/erc20:${e}`):undefined}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/caip-formatters.cjs"}],[3160,{"../constants/bridge.cjs":3148,"./caip-formatters.cjs":3159,"./validators.cjs":3171},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.hasMinimumRequiredVersion=n.getBridgeFeatureFlags=n.processFeatureFlags=n.formatFeatureFlags=void 0;const a=e("./caip-formatters.cjs"),r=e("./validators.cjs"),s=e("../constants/bridge.cjs");n.formatFeatureFlags=e=>{return{...e,chains:(t=e.chains,Object.entries(t).reduce((e,[t,n])=>({...e,[(0,a.formatChainIdToCaip)(t)]:n}),{}))};var t};n.processFeatureFlags=e=>(0,r.validateFeatureFlagsResponse)(e)?(0,n.formatFeatureFlags)(e):s.DEFAULT_FEATURE_FLAG_CONFIG,n.getBridgeFeatureFlags=function(e){const t=e.call("RemoteFeatureFlagController:getState"),a=t?.remoteFeatureFlags?.bridgeConfigV2,r=t?.remoteFeatureFlags?.bridgeConfig;return(0,n.processFeatureFlags)(a||r)};n.hasMinimumRequiredVersion=(e,t)=>{const[n,a,r]=e.split(".").map(Number),[s,i,o]=t.split(".").map(Number);return n>s||(n===s&&a>i||n===s&&a===i&&r>=o)}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/feature-flags.cjs"}],[3161,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.fetchServerEvents=void 0;n.fetchServerEvents=async(e,{onMessage:t,onError:n,onClose:a,fetchFn:r,...s})=>{let i;try{const n=await r(e,s);if(!n.ok||!n.body)throw new Error(`${n.status}`);i=n.body.getReader();const o=new TextDecoder("utf-8");let c="";for(;;){const{done:e,value:n}=await i.read();if(e)break;c+=o.decode(n,{stream:!0});const a=c.split("\n\n");c=a.pop()||"";for(const e of a){const n=e.split("\n");let a;const r=[];for(const e of n)e.startsWith("event:")?a=e.slice(6).trim():e.startsWith("data:")&&r.push(e.slice(5).trim());if("error"===a)throw new Error(`Bridge-api error: ${r.join("\n")}`);if(r.length>0){const e=JSON.parse(r.join("\n"));await t(e,a)}}}await(a?.())}catch(e){n?.(e)}finally{try{await(i?.cancel())}catch(e){console.error("Error cleaning up stream reader",e)}}}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/fetch-server-events.cjs"}],[3162,{"./bridge.cjs":3158,"./caip-formatters.cjs":3159,"./fetch-server-events.cjs":3161,"./trade-utils.cjs":3170,"./validators.cjs":3171,"@metamask/superstruct":3037},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.fetchBridgeQuoteStream=n.fetchAssetPrices=n.fetchBridgeQuotes=n.fetchBridgeTokens=n.getClientHeaders=void 0;const a=e("@metamask/superstruct"),r=e("./bridge.cjs"),s=e("./caip-formatters.cjs"),i=e("./fetch-server-events.cjs"),o=e("./trade-utils.cjs"),c=e("./validators.cjs");n.getClientHeaders=(e,t)=>({"X-Client-Id":e,...t?{"Client-Version":t}:{}}),n.fetchBridgeTokens=async function(e,t,a,r,i){const o=`${r}/getTokens?chainId=${(0,s.formatChainIdToDec)(e)}`,l=await a(o,{headers:(0,n.getClientHeaders)(t,i)}),u={};return l.forEach(e=>{(0,c.validateSwapsTokenObject)(e)&&(u[e.address]=e)}),u};const l=e=>{const t=e.destWalletAddress??e.walletAddress,n={walletAddress:(0,s.formatAddressToCaipReference)(e.walletAddress),destWalletAddress:(0,s.formatAddressToCaipReference)(t),srcChainId:(0,s.formatChainIdToDec)(e.srcChainId),destChainId:(0,s.formatChainIdToDec)(e.destChainId),srcTokenAddress:(0,s.formatAddressToCaipReference)(e.srcTokenAddress),destTokenAddress:(0,s.formatAddressToCaipReference)(e.destTokenAddress),srcTokenAmount:e.srcTokenAmount,insufficientBal:Boolean(e.insufficientBal),resetApproval:Boolean(e.resetApproval),gasIncluded:Boolean(e.gasIncluded),gasIncluded7702:Boolean(e.gasIncluded7702)};e.slippage!==undefined&&(n.slippage=e.slippage),e.fee!==undefined&&(n.fee=e.fee),e.aggIds&&e.aggIds.length>0&&(n.aggIds=e.aggIds),e.bridgeIds&&e.bridgeIds.length>0&&(n.bridgeIds=e.bridgeIds);const a=new URLSearchParams;return Object.entries(n).forEach(([e,t])=>{a.append(e,t.toString())}),a};n.fetchBridgeQuotes=async function(e,t,s,i,u,d,h){const m=`${u}/getQuote?${l(e)}`,f=await i(m,{headers:(0,n.getClientHeaders)(s,h),signal:t}),p=new Set([]),g=f.filter(e=>{try{return(0,c.validateQuoteResponse)(e)}catch(t){return t instanceof a.StructError&&t.failures().forEach(({branch:t,path:n})=>{const a=t?.[0]?.quote?.bridgeId||t?.[0]?.quote?.bridges?.[0]||e?.quote?.bridgeId||e?.quote?.bridges?.[0]||"unknown",r=n?.join(".")||"unknown";p.add([a,r].join("|"))}),!1}}).map(t=>({...t,featureId:d??undefined,resetApproval:e.resetApproval&&t.approval&&(0,o.isEvmTxData)(t.approval)?{...t.approval,data:(0,r.getEthUsdtResetData)(e.destChainId)}:undefined})),T=Array.from(p);return p.size>0&&console.warn("Quote validation failed",T),{quotes:g,validationFailures:T}};n.fetchAssetPrices=async e=>{const{currencies:t,...a}=e,r=await Promise.allSettled(Array.from(t).map(async e=>await(async e=>{const{currency:t,assetIds:a,clientId:r,clientVersion:s,fetchFn:i,signal:o}=e,c=Array.from(a).filter(Boolean);if(0===c.length)return{};const l=`https://price.api.cx.metamask.io/v3/spot-prices?${new URLSearchParams({assetIds:c.filter(Boolean).join(","),vsCurrency:t})}`,u=await i(l,{headers:(0,n.getClientHeaders)(r,s),signal:o});return u&&"object"==typeof u?Object.entries(u).reduce((e,[n,a])=>a?(e[n]||(e[n]={}),a[t]&&(e[n][t]=a[t].toString()),e):e,{}):{}})({...a,currency:e}))).then(e=>e.reduce((e,t)=>("fulfilled"===t.status&&Object.entries(t.value).forEach(([t,n])=>{e[t]||(e[t]={}),Object.entries(n).forEach(([n,a])=>{e[t][n]=a})}),e),{}));return r},n.fetchBridgeQuoteStream=async function(e,t,s,u,d,h,m){const f=`${d}/getQuoteStream?${l(t)}`;await(0,i.fetchServerEvents)(f,{headers:{...(0,n.getClientHeaders)(u,m),"Content-Type":"text/event-stream"},signal:s,onMessage:async e=>{const n=new Set([]);try{if((0,c.validateQuoteResponse)(e))return await h.onValidQuoteReceived({...e,resetApproval:t.resetApproval&&e.approval&&(0,o.isEvmTxData)(e.approval)?{...e.approval,data:(0,r.getEthUsdtResetData)(t.destChainId)}:undefined})}catch(t){t instanceof a.StructError&&t.failures().forEach(({branch:t,path:a})=>{const r=t?.[0]?.quote?.bridgeId||t?.[0]?.quote?.bridges?.[0]||e?.quote?.bridgeId||e?.quote?.bridges?.[0]||"unknown",s=a?.join(".")||"unknown";n.add([r,s].join("|"))});const r=Array.from(n);if(n.size>0)return console.warn("Quote validation failed",r),h.onValidationFailure(r);throw t}return undefined},onError:e=>{throw e},onClose:async()=>{await h.onClose()},fetchFn:e})}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/fetch.cjs"}],[3163,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o;Object.defineProperty(n,"__esModule",{value:!0}),n.MetricsSwapType=n.MetricsActionType=n.MetaMetricsSwapsEventSource=n.AbortReason=n.UnifiedSwapBridgeEventName=n.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY=void 0,n.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY="Unified SwapBridge",function(e){e.ButtonClicked="Unified SwapBridge Button Clicked",e.PageViewed="Unified SwapBridge Page Viewed",e.InputChanged="Unified SwapBridge Input Changed",e.InputSourceDestinationSwitched="Unified SwapBridge Source Destination Switched",e.QuotesRequested="Unified SwapBridge Quotes Requested",e.QuotesReceived="Unified SwapBridge Quotes Received",e.QuotesError="Unified SwapBridge Quotes Error",e.Submitted="Unified SwapBridge Submitted",e.Completed="Unified SwapBridge Completed",e.Failed="Unified SwapBridge Failed",e.AllQuotesOpened="Unified SwapBridge All Quotes Opened",e.AllQuotesSorted="Unified SwapBridge All Quotes Sorted",e.QuoteSelected="Unified SwapBridge Quote Selected",e.AssetDetailTooltipClicked="Unified SwapBridge Asset Detail Tooltip Clicked",e.QuotesValidationFailed="Unified SwapBridge Quotes Failed Validation",e.StatusValidationFailed="Unified SwapBridge Status Failed Validation"}(a||(n.UnifiedSwapBridgeEventName=a={})),function(e){e.NewQuoteRequest="New Quote Request",e.QuoteRequestUpdated="Quote Request Updated",e.ResetState="Reset controller state",e.TransactionSubmitted="Transaction submitted"}(r||(n.AbortReason=r={})),function(e){e.MainView="Main View",e.TokenView="Token View"}(s||(n.MetaMetricsSwapsEventSource=s={})),function(e){e.CROSSCHAIN_V1="crosschain-v1",e.SWAPBRIDGE_V1="swapbridge-v1"}(i||(n.MetricsActionType=i={})),function(e){e.SINGLE="single_chain",e.CROSSCHAIN="crosschain"}(o||(n.MetricsSwapType=o={}))}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/metrics/constants.cjs"}],[3164,{"../../constants/bridge.cjs":3148,"../../types.cjs":3155,"../bridge.cjs":3158,"../caip-formatters.cjs":3159,"./constants.cjs":3163},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getQuotesReceivedProperties=n.isCustomSlippage=n.isHardwareWallet=n.getRequestParams=n.formatProviderLabel=n.getSwapTypeFromQuote=n.getSwapType=n.toInputChangedPropertyValue=n.toInputChangedPropertyKey=void 0;const a=e("./constants.cjs"),r=e("../../constants/bridge.cjs"),s=e("../../types.cjs"),i=e("../bridge.cjs"),o=e("../caip-formatters.cjs");n.toInputChangedPropertyKey={srcTokenAddress:"token_source",destTokenAddress:"token_destination",srcChainId:"chain_source",destChainId:"chain_destination",slippage:"slippage"},n.toInputChangedPropertyValue={srcTokenAddress:({srcTokenAddress:e,srcChainId:t})=>t?(0,o.formatAddressToAssetId)(e??"",t):undefined,destTokenAddress:({destTokenAddress:e,destChainId:t})=>t?(0,o.formatAddressToAssetId)(e??"",t):undefined,srcChainId:({srcChainId:e})=>e?(0,o.formatChainIdToCaip)(e):undefined,destChainId:({destChainId:e})=>e?(0,o.formatChainIdToCaip)(e):undefined,slippage:({slippage:e})=>e?Number(e):e};n.getSwapType=(e,t)=>e&&!(0,i.isCrossChain)(e,t??e)?a.MetricsSwapType.SINGLE:a.MetricsSwapType.CROSSCHAIN;n.getSwapTypeFromQuote=e=>(0,n.getSwapType)(e.srcChainId,e.destChainId);n.formatProviderLabel=({bridgeId:e,bridges:t})=>`${e}_${t[0]}`;n.getRequestParams=({srcChainId:e,destChainId:t,srcTokenAddress:n,destTokenAddress:a})=>{const r=(0,o.formatChainIdToCaip)(e??s.ChainId.ETH);return{chain_id_source:r,chain_id_destination:t?(0,o.formatChainIdToCaip)(t):null,token_address_source:n?(0,o.formatAddressToAssetId)(n,r)??(0,i.getNativeAssetForChainId)(r)?.assetId??null:(0,i.getNativeAssetForChainId)(r)?.assetId??null,token_address_destination:a?(0,o.formatAddressToAssetId)(a,t??r)??null:null}};n.isHardwareWallet=e=>e?.metadata?.keyring.type?.includes("Hardware")??!1;n.isCustomSlippage=e=>e!==r.DEFAULT_BRIDGE_CONTROLLER_STATE.quoteRequest.slippage;n.getQuotesReceivedProperties=(e,t=[],a=!0,r,s)=>{const i=e?(0,n.formatProviderLabel)(e.quote):"_";return{can_submit:a,gas_included:Boolean(e?.quote?.gasIncluded),gas_included_7702:Boolean(e?.quote?.gasIncluded7702),quoted_time_minutes:e?.estimatedProcessingTimeInSeconds?e.estimatedProcessingTimeInSeconds/60:0,usd_quoted_gas:Number(e?.gasFee?.effective?.usd??0),usd_quoted_return:Number(e?.toTokenAmount?.usd??0),usd_balance_source:s??0,best_quote_provider:r?(0,n.formatProviderLabel)(r.quote):i,provider:i,warnings:t,price_impact:Number(e?.quote.priceData?.priceImpact??0)}}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/metrics/properties.cjs"}],[3165,{"../constants/chains.cjs":3149,"./bridge.cjs":3158,"./caip-formatters.cjs":3159,"./snaps.cjs":3168,"./trade-utils.cjs":3170,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.appendFeesToQuotes=void 0;const a=e("@metamask/utils"),r=e("./bridge.cjs"),s=e("./caip-formatters.cjs"),i=e("./snaps.cjs"),o=e("./trade-utils.cjs"),c=e("../constants/chains.cjs");n.appendFeesToQuotes=async(e,t,n,l)=>{const u=await(async(e,t)=>{if(e.some(({quote:e})=>{const t=(0,s.formatChainIdToCaip)(e.srcChainId);return![c.CHAIN_IDS.OPTIMISM,c.CHAIN_IDS.BASE].map(s.formatChainIdToCaip).includes(t)}))return undefined;const n=Promise.allSettled(e.map(async e=>{const{quote:n,trade:s,approval:i}=e,o=(0,a.numberToHex)(n.srcChainId),c=e=>({from:e.from,to:e.to,value:e.value,data:e.data,gasLimit:e.gasLimit?.toString()}),l=i?await t({transactionParams:c(i),chainId:o}):"0x0",u=await t({transactionParams:c(s),chainId:o});return l===undefined||u===undefined?undefined:{...e,l1GasFeesInHexWei:(0,r.sumHexes)(l,u)}}));return(await n).reduce((e,t)=>("fulfilled"===t.status&&t.value?e.push(t.value):"rejected"===t.status&&console.error("Error calculating L1 gas fees for quote",t.reason),e),[])})(e,n),d=await(async(e,t,n)=>{if(e.some(({quote:{srcChainId:e}})=>!(0,r.isNonEvmChainId)(e)))return undefined;const a=Promise.allSettled(e.map(async e=>{const{trade:a,quote:r}=e;if(!n?.metadata?.snap?.id||!a)return e;try{const c=(0,s.formatChainIdToCaip)(r.srcChainId),l=(0,o.extractTradeData)(a),u=(0,o.isTronTrade)(a)?{visible:a.visible,type:a.raw_data?.contract?.[0]?.type,feeLimit:a.raw_data?.fee_limit}:undefined,d=await t.call("SnapController:handleRequest",(0,i.computeFeeRequest)(n?.metadata?.snap?.id,l,n?.id,c,u)),h=d?.find(e=>"base"===e.type)||d?.find(e=>"priority"===e.type)||d?.[0],m=h?.asset?.amount||"0";return{...e,nonEvmFeesInNative:m}}catch(t){return console.error(`Failed to compute non-EVM fees for quote ${r.requestId}:`,t),{...e,nonEvmFeesInNative:undefined}}}));return(await a).reduce((e,t)=>("fulfilled"===t.status&&t.value&&e.push(t.value),e),[])})(e,t,l);return u??d??e}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/quote-fees.cjs"}],[3166,{"./bridge.cjs":3158,"./validators.cjs":3171,"@metamask/controller-utils":1494,"bignumber.js":3188},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.sortQuotes=n.formatEtaInMinutes=n.calcSlippagePercentage=n.calcCost=n.calcSwapRate=n.calcAdjustedReturn=n.calcIncludedTxFees=n.calcTotalMaxNetworkFee=n.calcTotalEstimatedNetworkFee=n.calcEstimatedAndMaxTotalGasFee=n.calcRelayerFee=n.calcSentAmount=n.calcToAmount=n.calcNonEvmTotalNetworkFee=n.getQuoteIdentifier=n.isValidQuoteRequest=void 0;const a=e("@metamask/controller-utils"),r=e("bignumber.js"),s=e("./bridge.cjs"),i=e("./validators.cjs");n.isValidQuoteRequest=(e,t=!0)=>{const n=["srcTokenAddress","destTokenAddress","srcChainId","destChainId","walletAddress"];if(t&&n.push("srcTokenAmount"),e.destChainId&&e.srcChainId&&e.destChainId!==e.srcChainId&&((0,s.isNonEvmChainId)(e.destChainId)||(0,s.isNonEvmChainId)(e.srcChainId))&&(n.push("destWalletAddress"),!e.destWalletAddress))return!1;const a=[];return e.slippage!==undefined&&a.push("slippage"),n.every(t=>t in e&&"string"==typeof e[t]&&e[t]!==undefined&&""!==e[t]&&null!==e[t])&&a.every(t=>t in e&&"number"==typeof e[t]&&e[t]!==undefined&&!isNaN(Number(e[t]))&&null!==e[t])&&(!t||Boolean((e.srcTokenAmount??"").match(/^[1-9]\d*$/u)))};n.getQuoteIdentifier=e=>`${e.bridgeId}-${e.bridges[0]}-${e.steps.length}`;const o=(e,t)=>{const n=new r.BigNumber(10).pow(t??0);return new r.BigNumber(e).div(n)};n.calcNonEvmTotalNetworkFee=(e,{exchangeRate:t,usdExchangeRate:n})=>{const{nonEvmFeesInNative:a}=e,s=new r.BigNumber(a??"0");return{amount:s.toString(),valueInCurrency:t?s.times(t).toString():null,usd:n?s.times(n).toString():null}};n.calcToAmount=(e,t,{exchangeRate:n,usdExchangeRate:a})=>{const r=o(e,t.decimals);return{amount:r.toString(),valueInCurrency:n?r.times(n).toString():null,usd:a?r.times(a).toString():null}};n.calcSentAmount=({srcTokenAmount:e,srcAsset:t,feeData:n},{exchangeRate:a,usdExchangeRate:s})=>{const i=Object.values(n).filter(e=>e&&e.amount&&e.asset?.assetId===t.assetId).reduce((e,{amount:t})=>e.plus(t),new r.BigNumber(e)),c=o(i,t.decimals);return{amount:c.toString(),valueInCurrency:a?c.times(a).toString():null,usd:s?c.times(s).toString():null}};n.calcRelayerFee=(e,{exchangeRate:t,usdExchangeRate:i})=>{const{quote:c,trade:l}=e,u=new r.BigNumber((0,a.convertHexToDecimal)(l.value||"0x0"));let d=o(u,18);if((0,s.isNativeAddress)(c.srcAsset.address)){const e=(0,n.calcSentAmount)(c,{exchangeRate:t,usdExchangeRate:i}).amount;d=d.minus(e)}return{amount:d,valueInCurrency:t?d.times(t):null,usd:i?d.times(i):null}};const c=({approvalGasLimit:e,resetApprovalGasLimit:t,tradeGasLimit:n,l1GasFeesInHexWei:s,feePerGasInDecGwei:i,nativeToDisplayCurrencyExchangeRate:o,nativeToUsdExchangeRate:c})=>{const l=new r.BigNumber(n?.toString()??"0").plus(e?.toString()??"0").plus(t?.toString()??"0"),u=(0,a.weiHexToGweiDec)((0,a.toHex)(s??"0")),d=l.times(i).plus(u).times(new r.BigNumber(10).pow(-9)),h=o?d.times(o.toString()):null,m=c?d.times(c.toString()):null;return{amount:d.toString(),valueInCurrency:h?.toString()??null,usd:m?.toString()??null}};n.calcEstimatedAndMaxTotalGasFee=({bridgeQuote:{approval:e,trade:t,l1GasFeesInHexWei:n,resetApproval:a},feePerGasInDecGwei:r,maxFeePerGasInDecGwei:s,exchangeRate:i,usdExchangeRate:o})=>{const{amount:l,valueInCurrency:u,usd:d}=c({approvalGasLimit:e?.effectiveGas??e?.gasLimit,resetApprovalGasLimit:a?.effectiveGas??a?.gasLimit,tradeGasLimit:t?.effectiveGas??t?.gasLimit,l1GasFeesInHexWei:n,feePerGasInDecGwei:r,nativeToDisplayCurrencyExchangeRate:i,nativeToUsdExchangeRate:o}),{amount:h,valueInCurrency:m,usd:f}=c({approvalGasLimit:e?.gasLimit,resetApprovalGasLimit:a?.gasLimit,tradeGasLimit:t?.gasLimit,l1GasFeesInHexWei:n,feePerGasInDecGwei:r,nativeToDisplayCurrencyExchangeRate:i,nativeToUsdExchangeRate:o}),{amount:p,valueInCurrency:g,usd:T}=c({approvalGasLimit:e?.gasLimit,resetApprovalGasLimit:a?.gasLimit,tradeGasLimit:t?.gasLimit,l1GasFeesInHexWei:n,feePerGasInDecGwei:s,nativeToDisplayCurrencyExchangeRate:i,nativeToUsdExchangeRate:o});return{effective:{amount:l,valueInCurrency:u,usd:d},total:{amount:h,valueInCurrency:m,usd:f},max:{amount:p,valueInCurrency:g,usd:T}}};n.calcTotalEstimatedNetworkFee=({total:e},t)=>({amount:new r.BigNumber(e?.amount??"0").plus(t.amount).toString(),valueInCurrency:e?.valueInCurrency?new r.BigNumber(e.valueInCurrency).plus(t.valueInCurrency||"0").toString():null,usd:e?.usd?new r.BigNumber(e.usd).plus(t.usd||"0").toString():null});n.calcTotalMaxNetworkFee=(e,t)=>({amount:new r.BigNumber(e.max.amount).plus(t.amount).toString(),valueInCurrency:e.max.valueInCurrency?new r.BigNumber(e.max.valueInCurrency).plus(t.valueInCurrency||"0").toString():null,usd:e.max.usd?new r.BigNumber(e.max.usd).plus(t.usd||"0").toString():null});n.calcIncludedTxFees=({gasIncluded:e,gasIncluded7702:t,srcAsset:n,feeData:{txFee:a}},r,s)=>{if(!a||!e&&!t)return null;const{exchangeRate:i,usdExchangeRate:c}=a.asset.assetId===n.assetId?r:s,l=o(a.amount,a.asset.decimals);return{amount:l.toString(),valueInCurrency:i?l.times(i).toString():null,usd:c?l.times(c).toString():null}};n.calcAdjustedReturn=(e,t,{feeData:{txFee:n},destAsset:{assetId:a}})=>n?.asset?.assetId===a?{valueInCurrency:e.valueInCurrency,usd:e.usd}:{valueInCurrency:e.valueInCurrency&&t.valueInCurrency?new r.BigNumber(e.valueInCurrency).minus(t.valueInCurrency).toString():null,usd:e.usd&&t.usd?new r.BigNumber(e.usd).minus(t.usd).toString():null};n.calcSwapRate=(e,t)=>new r.BigNumber(t).div(e).toString();n.calcCost=(e,t)=>({valueInCurrency:e.valueInCurrency&&t.valueInCurrency?new r.BigNumber(t.valueInCurrency).minus(e.valueInCurrency).toString():null,usd:e.usd&&t.usd?new r.BigNumber(t.usd).minus(e.usd).toString():null});n.calcSlippagePercentage=(e,t)=>{const a=(0,n.calcCost)(e,t);return a.valueInCurrency&&t.valueInCurrency?new r.BigNumber(a.valueInCurrency).div(t.valueInCurrency).times(100).abs().toString():a.usd&&t.usd?new r.BigNumber(a.usd).div(t.usd).times(100).abs().toString():null};n.formatEtaInMinutes=e=>e<60?"< 1":(e/60).toFixed();n.sortQuotes=(e,t)=>t===i.FeatureId.PERPS?e.sort((e,t)=>e.estimatedProcessingTimeInSeconds-t.estimatedProcessingTimeInSeconds):e}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/quote.cjs"}],[3167,{"./bridge.cjs":3158},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getDefaultSlippagePercentage=n.BRIDGE_DEFAULT_SLIPPAGE=void 0;const a=e("./bridge.cjs");n.BRIDGE_DEFAULT_SLIPPAGE=.5;const r=undefined;n.getDefaultSlippagePercentage=({srcTokenAddress:e,destTokenAddress:t,srcChainId:s,destChainId:i},o,c)=>!s||(0,a.isCrossChain)(s,i)?n.BRIDGE_DEFAULT_SLIPPAGE:(0,a.isSolanaChainId)(s)?r:e&&t&&o?.map(e=>e.toLowerCase()).includes(e.toLowerCase())&&(c??o)?.map(e=>e.toLowerCase()).includes(t.toLowerCase())?.5:2}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/slippage.cjs"}],[3168,{"../constants/bridge.cjs":3148,"@metamask/keyring-api":2306,uuid:5796},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.computeFeeRequest=n.getMinimumBalanceForRentExemptionInLamports=n.getMinimumBalanceForRentExemptionRequest=void 0;const a=e("@metamask/keyring-api"),r=e("uuid"),s=e("../constants/bridge.cjs");n.getMinimumBalanceForRentExemptionRequest=e=>({snapId:e,origin:"metamask",handler:"onProtocolRequest",request:{method:" ",jsonrpc:"2.0",params:{scope:a.SolScope.Mainnet,request:{id:(0,r.v4)(),jsonrpc:"2.0",method:"getMinimumBalanceForRentExemption",params:[0,{commitment:"confirmed"}]}}}});n.getMinimumBalanceForRentExemptionInLamports=async(e,t)=>String(await t.call("SnapController:handleRequest",(0,n.getMinimumBalanceForRentExemptionRequest)(e)).catch(e=>(console.error("Error setting minimum balance for rent exemption",e),s.DEFAULT_BRIDGE_CONTROLLER_STATE.minimumBalanceForRentExemptionInLamports)));n.computeFeeRequest=(e,t,n,a,s)=>({snapId:e,origin:"metamask",handler:"onClientRequest",request:{id:(0,r.v4)(),jsonrpc:"2.0",method:"computeFee",params:{transaction:t,accountId:n,scope:a,...s&&{options:s}}}})}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/snaps.cjs"}],[3169,{"../constants/chains.cjs":3149,"../constants/swaps.cjs":3150,"../constants/tokens.cjs":3151,"./caip-formatters.cjs":3159},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.fetchTokens=n.DEV_BASE_URL=n.API_BASE_URL=n.getSwapsContractAddress=n.isValidSwapsContractAddress=void 0;const a=e("./caip-formatters.cjs"),r=e("../constants/chains.cjs"),s=e("../constants/swaps.cjs"),i=e("../constants/tokens.cjs");function o(e){return e?{"X-Client-Id":e}:undefined}n.isValidSwapsContractAddress=function(e,t){return!(!t||!s.ALLOWED_CONTRACT_ADDRESSES[e])&&s.ALLOWED_CONTRACT_ADDRESSES[e].some(e=>t.toLowerCase()===e.toLowerCase())},n.getSwapsContractAddress=function(e){return s.SWAPS_CONTRACT_ADDRESSES[e]},n.API_BASE_URL="https://swap.api.cx.metamask.io",n.DEV_BASE_URL="https://swap.dev-api.cx.metamask.io",n.fetchTokens=async function(e,t,s){const[c,l]=e===r.CHAIN_IDS.LOCALHOST?[r.CHAIN_IDS.MAINNET,n.DEV_BASE_URL]:[e,n.API_BASE_URL],u=`${l}/networks/${(0,a.formatChainIdToDec)(c)}/tokens`,d=(await t(u,{headers:o(s)})).filter(e=>e.address!==i.DEFAULT_TOKEN_ADDRESS),h=i.SWAPS_CHAINID_DEFAULT_TOKEN_MAP[e];return d.push(h),d}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/swaps.cjs"}],[3170,{buffer:4137},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(e){(function(){Object.defineProperty(n,"__esModule",{value:!0}),n.extractTradeData=n.isTronTrade=n.isBitcoinTrade=n.isEvmTxData=void 0;n.isEvmTxData=e=>"object"==typeof e&&null!==e&&"data"in e&&"chainId"in e&&"to"in e;n.isBitcoinTrade=e=>"object"==typeof e&&null!==e&&"unsignedPsbtBase64"in e;n.isTronTrade=e=>"object"==typeof e&&null!==e&&"raw_data_hex"in e;n.extractTradeData=t=>(0,n.isBitcoinTrade)(t)?t.unsignedPsbtBase64:(0,n.isTronTrade)(t)?e.from(t.raw_data_hex,"hex").toString("base64"):"string"==typeof t?t:(0,n.isEvmTxData)(t)?t.data:""}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/trade-utils.cjs"}],[3171,{"@metamask/controller-utils":1494,"@metamask/superstruct":3037,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateQuoteResponse=n.QuoteResponseSchema=n.TronTradeDataSchema=n.BitcoinTradeDataSchema=n.TxDataSchema=n.QuoteSchema=n.IntentSchema=n.IntentOrderSchema=n.StepSchema=n.ProtocolSchema=n.FeeDataSchema=n.validateSwapsTokenObject=n.validateFeatureFlagsResponse=n.PlatformConfigSchema=n.PriceImpactThresholdSchema=n.ChainConfigurationSchema=n.BridgeAssetSchema=n.truthyString=n.ActionTypes=n.FeatureId=n.FeeType=void 0;const a=e("@metamask/controller-utils"),r=e("@metamask/superstruct"),s=e("@metamask/utils");var i,o,c;!function(e){e.METABRIDGE="metabridge",e.REFUEL="refuel",e.TX_FEE="txFee"}(i||(n.FeeType=i={})),function(e){e.PERPS="perps"}(o||(n.FeatureId=o={})),function(e){e.BRIDGE="bridge",e.SWAP="swap",e.REFUEL="refuel"}(c||(n.ActionTypes=c={}));const l=(0,r.define)("HexAddress",e=>(0,a.isValidHexAddress)(e,{allowNonPrefixed:!1})),u=(0,r.define)("HexString",e=>(0,s.isStrictHexString)(e)),d=(0,r.define)("VersionString",e=>"string"==typeof e&&/^(\d+\.*){2}\d+$/u.test(e)&&3===e.split(".").length);n.truthyString=e=>Boolean(e?.length);const h=(0,r.pattern)((0,r.string)(),/^\d+$/u),m=(0,r.number)();n.BridgeAssetSchema=(0,r.type)({chainId:m,address:(0,r.string)(),assetId:s.CaipAssetTypeStruct,symbol:(0,r.string)(),name:(0,r.string)(),decimals:(0,r.number)(),icon:(0,r.optional)((0,r.nullable)((0,r.string)())),iconUrl:(0,r.optional)((0,r.nullable)((0,r.string)()))});const f=(0,r.type)({standard:(0,r.record)((0,r.string)(),(0,r.string)()),other:(0,r.record)((0,r.string)(),(0,r.string)())});n.ChainConfigurationSchema=(0,r.type)({isActiveSrc:(0,r.boolean)(),isActiveDest:(0,r.boolean)(),refreshRate:(0,r.optional)((0,r.number)()),topAssets:(0,r.optional)((0,r.array)((0,r.string)())),stablecoins:(0,r.optional)((0,r.array)((0,r.string)())),isUnifiedUIEnabled:(0,r.optional)((0,r.boolean)()),isSingleSwapBridgeButtonEnabled:(0,r.optional)((0,r.boolean)()),isGaslessSwapEnabled:(0,r.optional)((0,r.boolean)()),noFeeAssets:(0,r.optional)((0,r.array)((0,r.string)())),defaultPairs:(0,r.optional)(f)}),n.PriceImpactThresholdSchema=(0,r.type)({gasless:(0,r.number)(),normal:(0,r.number)()});const p=(0,r.type)({aggIds:(0,r.optional)((0,r.array)((0,r.string)())),bridgeIds:(0,r.optional)((0,r.array)((0,r.string)())),fee:(0,r.optional)((0,r.number)())}),g=(0,r.enums)(Object.values(o));n.PlatformConfigSchema=(0,r.type)({priceImpactThreshold:(0,r.optional)(n.PriceImpactThresholdSchema),quoteRequestOverrides:(0,r.optional)((0,r.record)(g,(0,r.optional)(p))),minimumVersion:(0,r.string)(),refreshRate:(0,r.number)(),maxRefreshCount:(0,r.number)(),support:(0,r.boolean)(),chains:(0,r.record)((0,r.string)(),n.ChainConfigurationSchema),bip44DefaultPairs:(0,r.optional)((0,r.record)((0,r.string)(),(0,r.optional)(f))),sse:(0,r.optional)((0,r.type)({enabled:(0,r.boolean)(),minimumVersion:d}))});n.validateFeatureFlagsResponse=e=>(0,r.is)(e,n.PlatformConfigSchema);n.validateSwapsTokenObject=e=>(0,r.is)(e,n.BridgeAssetSchema),n.FeeDataSchema=(0,r.type)({amount:h,asset:n.BridgeAssetSchema}),n.ProtocolSchema=(0,r.type)({name:(0,r.string)(),displayName:(0,r.optional)((0,r.string)()),icon:(0,r.optional)((0,r.string)())}),n.StepSchema=(0,r.type)({action:(0,r.enums)(Object.values(c)),srcChainId:m,destChainId:(0,r.optional)(m),srcAsset:n.BridgeAssetSchema,destAsset:n.BridgeAssetSchema,srcAmount:(0,r.string)(),destAmount:(0,r.string)(),protocol:n.ProtocolSchema});const T=n.StepSchema,w=(0,r.union)([h,(0,r.number)()]),b=(0,r.string)();n.IntentOrderSchema=(0,r.type)({sellToken:l,buyToken:l,receiver:(0,r.optional)(l),validTo:w,appData:(0,r.string)(),appDataHash:u,feeAmount:h,kind:(0,r.enums)(["sell","buy"]),partiallyFillable:(0,r.boolean)(),sellAmount:(0,r.optional)(h),buyAmount:(0,r.optional)(h),from:(0,r.optional)(l)}),n.IntentSchema=(0,r.type)({protocol:b,order:n.IntentOrderSchema,settlementContract:(0,r.optional)(l),relayer:(0,r.optional)(l)}),n.QuoteSchema=(0,r.type)({requestId:(0,r.string)(),srcChainId:m,srcAsset:n.BridgeAssetSchema,srcTokenAmount:(0,r.string)(),destChainId:m,destAsset:n.BridgeAssetSchema,destTokenAmount:(0,r.string)(),minDestTokenAmount:(0,r.string)(),feeData:(0,r.type)({[i.METABRIDGE]:n.FeeDataSchema,[i.TX_FEE]:(0,r.optional)((0,r.intersection)([n.FeeDataSchema,(0,r.type)({maxFeePerGas:(0,r.string)(),maxPriorityFeePerGas:(0,r.string)()})]))}),gasIncluded:(0,r.optional)((0,r.boolean)()),gasIncluded7702:(0,r.optional)((0,r.boolean)()),bridgeId:(0,r.string)(),bridges:(0,r.array)((0,r.string)()),steps:(0,r.array)(n.StepSchema),refuel:(0,r.optional)(T),priceData:(0,r.optional)((0,r.type)({totalFromAmountUsd:(0,r.optional)((0,r.string)()),totalToAmountUsd:(0,r.optional)((0,r.string)()),priceImpact:(0,r.optional)((0,r.string)()),totalFeeAmountUsd:(0,r.optional)((0,r.string)())})),intent:(0,r.optional)(n.IntentSchema),gasSponsored:(0,r.optional)((0,r.boolean)())}),n.TxDataSchema=(0,r.type)({chainId:(0,r.number)(),to:l,from:l,value:u,data:u,gasLimit:(0,r.nullable)((0,r.number)()),effectiveGas:(0,r.optional)((0,r.number)())}),n.BitcoinTradeDataSchema=(0,r.type)({unsignedPsbtBase64:(0,r.string)(),inputsToSign:(0,r.nullable)((0,r.array)((0,r.type)({})))}),n.TronTradeDataSchema=(0,r.type)({raw_data_hex:(0,r.string)(),visible:(0,r.optional)((0,r.boolean)()),raw_data:(0,r.optional)((0,r.nullable)((0,r.type)({contract:(0,r.optional)((0,r.array)((0,r.type)({type:(0,r.optional)((0,r.string)())}))),fee_limit:(0,r.optional)((0,r.number)())})))}),n.QuoteResponseSchema=(0,r.type)({quote:n.QuoteSchema,estimatedProcessingTimeInSeconds:(0,r.number)(),approval:(0,r.optional)((0,r.union)([n.TxDataSchema,n.TronTradeDataSchema])),trade:(0,r.union)([n.TxDataSchema,n.BitcoinTradeDataSchema,n.TronTradeDataSchema,(0,r.string)()])});n.validateQuoteResponse=e=>((0,r.assert)(e,n.QuoteResponseSchema),!0)}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/validators.cjs"}],[3172,{"../api/accounts-api.cjs":3174,"../constants.cjs":3175,"../types.cjs":3177,"../utils.cjs":3178,"@metamask/base-controller":1407,"@metamask/keyring-api":2306,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l,u,d,h=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},m=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainNetworkController=void 0;const f=e("@metamask/base-controller"),p=e("@metamask/keyring-api"),g=e("@metamask/utils"),T=e("../api/accounts-api.cjs"),w=e("../constants.cjs"),b=e("../types.cjs"),E=e("../utils.cjs");class y extends f.BaseController{constructor({messenger:e,state:t,networkService:n}){super({messenger:e,name:b.MULTICHAIN_NETWORK_CONTROLLER_NAME,metadata:w.MULTICHAIN_NETWORK_CONTROLLER_METADATA,state:{...(0,w.getDefaultMultichainNetworkControllerState)(),...t,multichainNetworkConfigurationsByChainId:w.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS}}),a.add(this),r.set(this,void 0),h(this,r,n,"f"),m(this,a,"m",u).call(this),m(this,a,"m",d).call(this)}async setActiveNetwork(e){if((0,g.isCaipChainId)(e)){if(!(0,E.checkIfSupportedCaipChainId)(e))throw new Error(`Unsupported Caip chain ID: ${String(e)}`);return m(this,a,"m",i).call(this,e)}return await m(this,a,"m",s).call(this,e)}async getNetworksWithTransactionActivityByAccounts(){const e=this.messenger.call("AccountsController:listMultichainAccounts").filter(e=>(0,p.isEvmAccountType)(e.type));if(!e||0===e.length)return this.state.networksWithTransactionActivity;const t=e.map(e=>(0,T.toAllowedCaipAccountIds)(e)).flat(),n=await m(this,r,"f").fetchNetworkActivity(t),a=(0,T.toActiveNetworksByAddress)(n);return this.update(e=>{e.networksWithTransactionActivity=a}),this.state.networksWithTransactionActivity}async removeNetwork(e){return(0,E.isEvmCaipChainId)(e)?await m(this,a,"m",o).call(this,e):m(this,a,"m",c).call(this,e)}}n.MultichainNetworkController=y,r=new WeakMap,a=new WeakSet,s=async function(e){const{selectedNetworkClientId:t}=this.messenger.call("NetworkController:getState"),n=!this.state.isEvmSelected,a=e!==t;(n||a)&&(n&&this.update(e=>{e.isEvmSelected=!0}),a&&await this.messenger.call("NetworkController:setActiveNetwork",e),(n||a)&&this.messenger.publish("MultichainNetworkController:networkDidChange",e))},i=function(e){(e!==this.state.selectedMultichainNetworkChainId||this.state.isEvmSelected)&&(this.update(t=>{t.selectedMultichainNetworkChainId=e,t.isEvmSelected=!1}),this.messenger.publish("MultichainNetworkController:networkDidChange",e))},o=async function(e){const t=(0,E.convertEvmCaipToHexChainId)(e);if(this.messenger.call("NetworkController:getSelectedChainId")===t){if(this.state.isEvmSelected)throw new Error("Cannot remove the currently selected network");const e="0x1",t=this.messenger.call("NetworkController:findNetworkClientIdByChainId",e);await this.messenger.call("NetworkController:setActiveNetwork",t)}this.messenger.call("NetworkController:removeNetwork",t)},c=function(e){throw new Error("Removal of non-EVM networks is not supported")},l=function(e){const{type:t,scopes:n}=e;if((0,p.isEvmAccountType)(t)){if(this.state.isEvmSelected)return;return void this.update(e=>{e.isEvmSelected=!0})}if(n.includes(this.state.selectedMultichainNetworkChainId))return void this.update(e=>{e.isEvmSelected=!1});const a=(0,E.getChainIdForNonEvm)(n);this.update(e=>{e.selectedMultichainNetworkChainId=a,e.isEvmSelected=!1})},u=function(){this.messenger.subscribe("AccountsController:selectedAccountChange",e=>m(this,a,"m",l).call(this,e))},d=function(){this.messenger.registerActionHandler("MultichainNetworkController:setActiveNetwork",this.setActiveNetwork.bind(this)),this.messenger.registerActionHandler("MultichainNetworkController:getNetworksWithTransactionActivityByAccounts",this.getNetworksWithTransactionActivityByAccounts.bind(this))}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/dist/MultichainNetworkController/MultichainNetworkController.cjs"}],[3173,{"../api/accounts-api.cjs":3174,"@metamask/superstruct":3037,lodash:4901},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},c=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainNetworkService=void 0;const l=e("@metamask/superstruct"),u=e("lodash"),d=e("../api/accounts-api.cjs");n.MultichainNetworkService=class{constructor({fetch:e,batchSize:t}){a.add(this),r.set(this,void 0),s.set(this,void 0),o(this,r,e,"f"),o(this,s,t??20,"f")}async fetchNetworkActivity(e){if(0===e.length)return{activeNetworks:[]};if(e.length<=c(this,s,"f"))return c(this,a,"m",i).call(this,e);const t=(0,u.chunk)(e,c(this,s,"f"));return{activeNetworks:(await Promise.all(t.map(e=>c(this,a,"m",i).call(this,e)))).flatMap(e=>e.activeNetworks)}}},r=new WeakMap,s=new WeakMap,a=new WeakSet,i=async function(e){try{const t=(0,d.buildActiveNetworksUrl)(e),n=await c(this,r,"f").call(this,t.toString(),{method:"GET",headers:{[d.MULTICHAIN_ACCOUNTS_CLIENT_HEADER]:d.MULTICHAIN_ACCOUNTS_CLIENT_ID,Accept:"application/json"}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const a=await n.json();return(0,l.assert)(a,d.ActiveNetworksResponseStruct),a}catch(e){if(e instanceof Error){if("AbortError"===e.name)throw new Error("Request timeout: Failed to fetch active networks");throw e}throw new Error(`Failed to fetch active networks: ${String(e)}`)}}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/dist/MultichainNetworkService/MultichainNetworkService.cjs"}],[3174,{"@metamask/keyring-api":2306,"@metamask/superstruct":3037,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.buildActiveNetworksUrl=n.toActiveNetworksByAddress=n.toAllowedCaipAccountIds=n.MULTICHAIN_ALLOWED_ACTIVE_NETWORK_SCOPES=n.MULTICHAIN_ACCOUNTS_CLIENT_ID=n.MULTICHAIN_ACCOUNTS_CLIENT_HEADER=n.MULTICHAIN_ACCOUNTS_BASE_URL=n.ActiveNetworksResponseStruct=void 0;const a=e("@metamask/keyring-api"),r=e("@metamask/superstruct"),s=e("@metamask/utils");n.ActiveNetworksResponseStruct=(0,r.object)({activeNetworks:(0,r.array)(s.CaipAccountIdStruct)}),n.MULTICHAIN_ACCOUNTS_BASE_URL="https://accounts.api.cx.metamask.io",n.MULTICHAIN_ACCOUNTS_CLIENT_HEADER="x-metamask-clientproduct",n.MULTICHAIN_ACCOUNTS_CLIENT_ID="metamask-multichain-network-controller",n.MULTICHAIN_ALLOWED_ACTIVE_NETWORK_SCOPES=[String(a.BtcScope.Mainnet),String(a.BtcScope.Testnet),String(a.BtcScope.Testnet4),String(a.BtcScope.Signet),String(a.BtcScope.Regtest),String(a.SolScope.Mainnet),String(a.SolScope.Devnet),String(a.EthScope.Mainnet),String(a.EthScope.Testnet),String(a.EthScope.Eoa),String(a.TrxScope.Mainnet),String(a.TrxScope.Nile),String(a.TrxScope.Shasta)],n.toAllowedCaipAccountIds=function(e){const t=[];for(const a of e.scopes)n.MULTICHAIN_ALLOWED_ACTIVE_NETWORK_SCOPES.includes(a)&&t.push(`${a}:${e.address}`);return t},n.toActiveNetworksByAddress=function(e){const t={};return e.activeNetworks.forEach(e=>{const{address:n,chain:{namespace:a,reference:r}}=(0,s.parseCaipAccountId)(e);t[n]||(t[n]={namespace:a,activeChains:[]}),t[n].activeChains.push(r)}),t},n.buildActiveNetworksUrl=function(e){const t=new URL(`${n.MULTICHAIN_ACCOUNTS_BASE_URL}/v2/activeNetworks`);return t.searchParams.append("accountIds",e.join(",")),t}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/dist/api/accounts-api.cjs"}],[3175,{"@metamask/keyring-api":2306,"@metamask/network-controller":3183},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MULTICHAIN_NETWORK_DECIMAL_PLACES=n.MULTICHAIN_NETWORK_TICKER=n.MULTICHAIN_NETWORK_CONTROLLER_METADATA=n.getDefaultMultichainNetworkControllerState=n.NETWORKS_METADATA=n.NON_EVM_TESTNET_IDS=n.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS=n.TRX_SHASTA_NATIVE_ASSET=n.TRX_NILE_NATIVE_ASSET=n.TRX_NATIVE_ASSET=n.SOL_DEVNET_NATIVE_ASSET=n.SOL_TESTNET_NATIVE_ASSET=n.SOL_NATIVE_ASSET=n.BTC_REGTEST_NATIVE_ASSET=n.BTC_SIGNET_NATIVE_ASSET=n.BTC_TESTNET4_NATIVE_ASSET=n.BTC_TESTNET_NATIVE_ASSET=n.BTC_NATIVE_ASSET=void 0;const a=e("@metamask/keyring-api"),r=e("@metamask/network-controller");n.BTC_NATIVE_ASSET=`${a.BtcScope.Mainnet}/slip44:0`,n.BTC_TESTNET_NATIVE_ASSET=`${a.BtcScope.Testnet}/slip44:0`,n.BTC_TESTNET4_NATIVE_ASSET=`${a.BtcScope.Testnet4}/slip44:0`,n.BTC_SIGNET_NATIVE_ASSET=`${a.BtcScope.Signet}/slip44:0`,n.BTC_REGTEST_NATIVE_ASSET=`${a.BtcScope.Regtest}/slip44:0`,n.SOL_NATIVE_ASSET=`${a.SolScope.Mainnet}/slip44:501`,n.SOL_TESTNET_NATIVE_ASSET=`${a.SolScope.Testnet}/slip44:501`,n.SOL_DEVNET_NATIVE_ASSET=`${a.SolScope.Devnet}/slip44:501`,n.TRX_NATIVE_ASSET=`${a.TrxScope.Mainnet}/slip44:195`,n.TRX_NILE_NATIVE_ASSET=`${a.TrxScope.Nile}/slip44:195`,n.TRX_SHASTA_NATIVE_ASSET=`${a.TrxScope.Shasta}/slip44:195`,n.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS={[a.BtcScope.Mainnet]:{chainId:a.BtcScope.Mainnet,name:"Bitcoin",nativeCurrency:n.BTC_NATIVE_ASSET,isEvm:!1},[a.BtcScope.Testnet]:{chainId:a.BtcScope.Testnet,name:"Bitcoin Testnet",nativeCurrency:n.BTC_TESTNET_NATIVE_ASSET,isEvm:!1},[a.BtcScope.Testnet4]:{chainId:a.BtcScope.Testnet4,name:"Bitcoin Testnet4",nativeCurrency:n.BTC_TESTNET4_NATIVE_ASSET,isEvm:!1},[a.BtcScope.Signet]:{chainId:a.BtcScope.Signet,name:"Bitcoin Mutinynet",nativeCurrency:n.BTC_SIGNET_NATIVE_ASSET,isEvm:!1},[a.BtcScope.Regtest]:{chainId:a.BtcScope.Regtest,name:"Bitcoin Regtest",nativeCurrency:n.BTC_REGTEST_NATIVE_ASSET,isEvm:!1},[a.SolScope.Mainnet]:{chainId:a.SolScope.Mainnet,name:"Solana",nativeCurrency:n.SOL_NATIVE_ASSET,isEvm:!1},[a.SolScope.Testnet]:{chainId:a.SolScope.Testnet,name:"Solana Testnet",nativeCurrency:n.SOL_TESTNET_NATIVE_ASSET,isEvm:!1},[a.SolScope.Devnet]:{chainId:a.SolScope.Devnet,name:"Solana Devnet",nativeCurrency:n.SOL_DEVNET_NATIVE_ASSET,isEvm:!1},[a.TrxScope.Mainnet]:{chainId:a.TrxScope.Mainnet,name:"Tron",nativeCurrency:n.TRX_NATIVE_ASSET,isEvm:!1},[a.TrxScope.Nile]:{chainId:a.TrxScope.Nile,name:"Tron Nile",nativeCurrency:n.TRX_NILE_NATIVE_ASSET,isEvm:!1},[a.TrxScope.Shasta]:{chainId:a.TrxScope.Shasta,name:"Tron Shasta",nativeCurrency:n.TRX_SHASTA_NATIVE_ASSET,isEvm:!1}},n.NON_EVM_TESTNET_IDS=[a.BtcScope.Testnet,a.BtcScope.Testnet4,a.BtcScope.Signet,a.BtcScope.Regtest,a.SolScope.Testnet,a.SolScope.Devnet,a.TrxScope.Nile,a.TrxScope.Shasta],n.NETWORKS_METADATA={[a.BtcScope.Mainnet]:{features:[],status:r.NetworkStatus.Available},[a.SolScope.Mainnet]:{features:[],status:r.NetworkStatus.Available},[a.TrxScope.Mainnet]:{features:[],status:r.NetworkStatus.Available}};n.getDefaultMultichainNetworkControllerState=()=>({multichainNetworkConfigurationsByChainId:n.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS,selectedMultichainNetworkChainId:a.SolScope.Mainnet,isEvmSelected:!0,networksWithTransactionActivity:{}}),n.MULTICHAIN_NETWORK_CONTROLLER_METADATA={multichainNetworkConfigurationsByChainId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},selectedMultichainNetworkChainId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},isEvmSelected:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},networksWithTransactionActivity:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0}},n.MULTICHAIN_NETWORK_TICKER={[a.BtcScope.Mainnet]:"BTC",[a.BtcScope.Testnet]:"tBTC",[a.BtcScope.Testnet4]:"tBTC",[a.BtcScope.Signet]:"sBTC",[a.BtcScope.Regtest]:"rBTC",[a.SolScope.Mainnet]:"SOL",[a.SolScope.Testnet]:"tSOL",[a.SolScope.Devnet]:"dSOL",[a.TrxScope.Mainnet]:"TRX",[a.TrxScope.Nile]:"tTRX",[a.TrxScope.Shasta]:"sTRX"},n.MULTICHAIN_NETWORK_DECIMAL_PLACES={[a.BtcScope.Mainnet]:8,[a.BtcScope.Testnet]:8,[a.BtcScope.Testnet4]:8,[a.BtcScope.Signet]:8,[a.BtcScope.Regtest]:8,[a.SolScope.Mainnet]:5,[a.SolScope.Testnet]:5,[a.SolScope.Devnet]:5,[a.TrxScope.Mainnet]:6,[a.TrxScope.Nile]:6,[a.TrxScope.Shasta]:6}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/dist/constants.cjs"}],[3176,{"./MultichainNetworkController/MultichainNetworkController.cjs":3172,"./MultichainNetworkService/MultichainNetworkService.cjs":3173,"./constants.cjs":3175,"./utils.cjs":3178},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.toEvmCaipChainId=n.toMultichainNetworkConfigurationsByChainId=n.toMultichainNetworkConfiguration=n.checkIfSupportedCaipChainId=n.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS=n.MULTICHAIN_NETWORK_DECIMAL_PLACES=n.MULTICHAIN_NETWORK_TICKER=n.NON_EVM_TESTNET_IDS=n.getDefaultMultichainNetworkControllerState=n.MultichainNetworkService=n.MultichainNetworkController=void 0;var a=e("./MultichainNetworkController/MultichainNetworkController.cjs");Object.defineProperty(n,"MultichainNetworkController",{enumerable:!0,get:function(){return a.MultichainNetworkController}});var r=e("./MultichainNetworkService/MultichainNetworkService.cjs");Object.defineProperty(n,"MultichainNetworkService",{enumerable:!0,get:function(){return r.MultichainNetworkService}});var s=e("./constants.cjs");Object.defineProperty(n,"getDefaultMultichainNetworkControllerState",{enumerable:!0,get:function(){return s.getDefaultMultichainNetworkControllerState}}),Object.defineProperty(n,"NON_EVM_TESTNET_IDS",{enumerable:!0,get:function(){return s.NON_EVM_TESTNET_IDS}}),Object.defineProperty(n,"MULTICHAIN_NETWORK_TICKER",{enumerable:!0,get:function(){return s.MULTICHAIN_NETWORK_TICKER}}),Object.defineProperty(n,"MULTICHAIN_NETWORK_DECIMAL_PLACES",{enumerable:!0,get:function(){return s.MULTICHAIN_NETWORK_DECIMAL_PLACES}}),Object.defineProperty(n,"AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS",{enumerable:!0,get:function(){return s.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS}});var i=e("./utils.cjs");Object.defineProperty(n,"checkIfSupportedCaipChainId",{enumerable:!0,get:function(){return i.checkIfSupportedCaipChainId}}),Object.defineProperty(n,"toMultichainNetworkConfiguration",{enumerable:!0,get:function(){return i.toMultichainNetworkConfiguration}}),Object.defineProperty(n,"toMultichainNetworkConfigurationsByChainId",{enumerable:!0,get:function(){return i.toMultichainNetworkConfigurationsByChainId}}),Object.defineProperty(n,"toEvmCaipChainId",{enumerable:!0,get:function(){return i.toEvmCaipChainId}})}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/dist/index.cjs"}],[3177,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MULTICHAIN_NETWORK_CONTROLLER_NAME=void 0,n.MULTICHAIN_NETWORK_CONTROLLER_NAME="MultichainNetworkController"}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/dist/types.cjs"}],[3178,{"./constants.cjs":3175,"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isKnownCaipNamespace=n.toMultichainNetworkConfigurationsByChainId=n.toMultichainNetworkConfiguration=n.convertEvmCaipToHexChainId=n.toEvmCaipChainId=n.checkIfSupportedCaipChainId=n.getChainIdForNonEvm=n.isEvmCaipChainId=void 0;const a=e("@metamask/utils"),r=e("./constants.cjs");n.isEvmCaipChainId=function(e){const{namespace:t}=(0,a.parseCaipChainId)(e);return t===a.KnownCaipNamespace.Eip155},n.getChainIdForNonEvm=function(e){const t=e.find(e=>Object.keys(r.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS).includes(e));if(t)return t;throw new Error(`Unsupported scope: ${e.join(", ")}.`)},n.checkIfSupportedCaipChainId=function(e){return Object.keys(r.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS).includes(e)};n.toEvmCaipChainId=e=>(0,a.toCaipChainId)(a.KnownCaipNamespace.Eip155,(0,a.hexToNumber)(e).toString()),n.convertEvmCaipToHexChainId=function(e){const{namespace:t,reference:n}=(0,a.parseCaipChainId)(e);if(t===a.KnownCaipNamespace.Eip155)return(0,a.add0x)(parseInt(n,10).toString(16));throw new Error(`Unsupported CAIP chain ID namespace: ${t}. Only eip155 is supported.`)};n.toMultichainNetworkConfiguration=e=>{const{chainId:t,name:a,rpcEndpoints:r,defaultRpcEndpointIndex:s,nativeCurrency:i,blockExplorerUrls:o,defaultBlockExplorerUrlIndex:c=0}=e;return{chainId:(0,n.toEvmCaipChainId)(t),isEvm:!0,name:a||r[s].url,nativeCurrency:i,blockExplorerUrls:o,defaultBlockExplorerUrlIndex:c}};n.toMultichainNetworkConfigurationsByChainId=e=>Object.entries(e).reduce((e,[,t])=>({...e,[(0,n.toEvmCaipChainId)(t.chainId)]:(0,n.toMultichainNetworkConfiguration)(t)}),{}),n.isKnownCaipNamespace=function(e){return Object.values(a.KnownCaipNamespace).includes(e)}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/dist/utils.cjs"}],[3179,{"./constants.cjs":3180,"./create-auto-managed-network-client.cjs":3181,"./logger.cjs":3184,"./types.cjs":3187,"@metamask/base-controller":1407,"@metamask/controller-utils":1494,"@metamask/eth-query":2079,"@metamask/rpc-errors":2698,"@metamask/swappable-obj-proxy":3046,"@metamask/utils":3217,"fast-deep-equal":4445,immer:4678,lodash:4901,reselect:5371,"uri-js":5770,uuid:5796},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l,u,d,h,m,f,p,g,T,w,b,E,y,S,k,I,A,_,C,P,v,N,R,j=this&&this.__createBinding||(Object.create?function(e,t,n,a){a===undefined&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){a===undefined&&(a=n),e[a]=t[n]}),O=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),x=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&j(t,e,n);return O(t,e),t},L=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},M=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)},F=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkController=n.selectAvailableNetworkClientIds=n.getAvailableNetworkClientIds=n.selectNetworkConfigurations=n.getNetworkConfigurations=n.getDefaultNetworkControllerState=n.knownKeysOf=n.RpcEndpointType=void 0;const D=e("@metamask/base-controller"),B=e("@metamask/controller-utils"),G=F(e("@metamask/eth-query")),U=e("@metamask/rpc-errors"),H=e("@metamask/swappable-obj-proxy"),q=e("@metamask/utils"),K=F(e("fast-deep-equal")),W=e("immer"),$=e("lodash"),V=e("reselect"),Y=x(e("uri-js")),Q=e("uuid"),z=e("./constants.cjs"),J=e("./create-auto-managed-network-client.cjs"),X=e("./logger.cjs"),Z=e("./types.cjs"),ee=(0,X.createModuleLogger)(X.projectLogger,"NetworkController"),te=/^https:\/\/(?<networkName>[^.]+)\.infura\.io\/v\d+\/(?<apiKey>.+)$/u;var ne;function ae(e){return Object.keys(e)}!function(e){e.Custom="custom",e.Infura="infura"}(ne||(n.RpcEndpointType=ne={})),n.knownKeysOf=ae;const re="NetworkController";function se(e=[]){const t=Object.values(B.InfuraNetworkType).reduce((e,t)=>{const n=B.ChainId[t];if(z.DEPRECATED_NETWORKS.has(n))return e;const a=`https://${t}.infura.io/v3/{infuraProjectId}`,r={blockExplorerUrls:[],chainId:n,defaultRpcEndpointIndex:0,name:B.NetworkNickname[t],nativeCurrency:B.NetworksTicker[t],rpcEndpoints:[{failoverUrls:[],networkClientId:t,type:ne.Infura,url:a}]};return{...e,[n]:r}},{}),n={[B.ChainId["megaeth-testnet"]]:ie(B.CustomNetworkType["megaeth-testnet"]),[B.ChainId["megaeth-testnet-v2"]]:ie(B.CustomNetworkType["megaeth-testnet-v2"]),[B.ChainId["monad-testnet"]]:ie(B.CustomNetworkType["monad-testnet"])};return e.reduce((e,t)=>((0,q.hasProperty)(n,t)&&(e[t]=n[t]),e),t)}function ie(e){const{ticker:t,rpcPrefs:n}=B.BUILT_IN_NETWORKS[e],a=B.BUILT_IN_CUSTOM_NETWORKS_RPC[e];return{blockExplorerUrls:[n.blockExplorerUrl],chainId:B.ChainId[e],defaultRpcEndpointIndex:0,defaultBlockExplorerUrlIndex:0,name:B.NetworkNickname[e],nativeCurrency:t,rpcEndpoints:[{failoverUrls:[],networkClientId:e,type:ne.Custom,url:a}]}}function oe(e){const t=se(e);return{selectedNetworkClientId:B.InfuraNetworkType.mainnet,networksMetadata:{},networkConfigurationsByChainId:t}}n.getDefaultNetworkControllerState=oe;function ce(e){return Object.values(e.networkConfigurationsByChainId)}function le(e){return e.flatMap(e=>e.rpcEndpoints.map(e=>e.networkClientId))}function ue(e){const t=Y.parse(e);return t.error===undefined&&("http"===t.scheme||"https"===t.scheme)}function de(e){const t=te.exec(e);if(t?.groups){if((0,B.isInfuraNetworkType)(t.groups.networkName))return t.groups.networkName;throw new Error(`Unknown Infura network '${t.groups.networkName}'`)}throw new Error("Could not derive Infura network from RPC endpoint URL")}function he(e){return new Map(Object.values(e).flatMap(e=>e.rpcEndpoints.map(t=>[t.networkClientId,e])))}n.getNetworkConfigurations=ce,n.selectNetworkConfigurations=(0,V.createSelector)(e=>e.networkConfigurationsByChainId,e=>Object.values(e)),n.getAvailableNetworkClientIds=le,n.selectAvailableNetworkClientIds=(0,V.createSelector)(n.selectNetworkConfigurations,le);class me extends D.BaseController{constructor(e){const{messenger:t,state:n,infuraProjectId:g,log:T,getRpcServiceOptions:w,getBlockTrackerOptions:b,additionalDefaultNetworks:E,isRpcFailoverEnabled:S=!1}=e,k={...oe(E),...n};!function(e){const t=Object.entries(e.networkConfigurationsByChainId),n=le(ce(e));if(0===t.length)throw new Error("NetworkController state is invalid: `networkConfigurationsByChainId` cannot be empty");for(const[e,n]of t){if(e!==n.chainId)throw new Error(`NetworkController state has invalid \`networkConfigurationsByChainId\`: Network configuration '${n.name}' is filed under '${e}' which does not match its \`chainId\` of '${n.chainId}'`);if(n.blockExplorerUrls.length>0?n.defaultBlockExplorerUrlIndex===undefined||n.blockExplorerUrls[n.defaultBlockExplorerUrlIndex]===undefined:n.defaultBlockExplorerUrlIndex!==undefined)throw new Error(`NetworkController state has invalid \`networkConfigurationsByChainId\`: Network configuration '${n.name}' has a \`defaultBlockExplorerUrlIndex\` that does not refer to an entry in \`blockExplorerUrls\``);if(n.rpcEndpoints[n.defaultRpcEndpointIndex]===undefined)throw new Error(`NetworkController state has invalid \`networkConfigurationsByChainId\`: Network configuration '${n.name}' has a \`defaultRpcEndpointIndex\` that does not refer to an entry in \`rpcEndpoints\``)}if([...new Set(n)].length<n.length)throw new Error("NetworkController state has invalid `networkConfigurationsByChainId`: Every RPC endpoint across all network configurations must have a unique `networkClientId`")}(k);const I=function(e,t){const n=ce(e).sort((e,t)=>e.chainId.localeCompare(t.chainId)),a=le(n),r=Object.keys(e.networksMetadata).filter(e=>!a.includes(e));return(0,W.produce)(e,s=>{if(!a.includes(e.selectedNetworkClientId)){const a=n[0],r=a.rpcEndpoints[a.defaultRpcEndpointIndex].networkClientId;t.captureException?.(new Error(`\`selectedNetworkClientId\` '${e.selectedNetworkClientId}' does not refer to an RPC endpoint within a network configuration; correcting to '${r}'`)),s.selectedNetworkClientId=r}if(r.length>0){for(const e of r)delete s.networksMetadata[e];t.captureException?.(new Error("`networksMetadata` had invalid network client IDs, which have been removed"))}})}(k,t);if(!g||"string"!=typeof g)throw new Error("Invalid Infura project ID");super({name:re,metadata:{selectedNetworkClientId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},networksMetadata:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},networkConfigurationsByChainId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0}},messenger:t,state:I}),a.add(this),r.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,void 0),h.set(this,void 0),m.set(this,void 0),f.set(this,void 0),p.set(this,void 0),L(this,s,g,"f"),L(this,d,T,"f"),L(this,h,w,"f"),L(this,m,b,"f"),L(this,p,S,"f"),L(this,i,this.state.selectedNetworkClientId,"f"),L(this,f,he(this.state.networkConfigurationsByChainId),"f"),this.messenger.registerActionHandler(`${this.name}:getEthQuery`,()=>M(this,r,"f")),this.messenger.registerActionHandler(`${this.name}:getNetworkClientById`,this.getNetworkClientById.bind(this)),this.messenger.registerActionHandler(`${this.name}:getEIP1559Compatibility`,this.getEIP1559Compatibility.bind(this)),this.messenger.registerActionHandler(`${this.name}:setActiveNetwork`,this.setActiveNetwork.bind(this)),this.messenger.registerActionHandler(`${this.name}:setProviderType`,this.setProviderType.bind(this)),this.messenger.registerActionHandler(`${this.name}:findNetworkClientIdByChainId`,this.findNetworkClientIdByChainId.bind(this)),this.messenger.registerActionHandler(`${this.name}:getNetworkConfigurationByChainId`,this.getNetworkConfigurationByChainId.bind(this)),this.messenger.registerActionHandler(`${this.name}:getNetworkConfigurationByNetworkClientId`,this.getNetworkConfigurationByNetworkClientId.bind(this)),this.messenger.registerActionHandler(`${this.name}:getSelectedNetworkClient`,this.getSelectedNetworkClient.bind(this)),this.messenger.registerActionHandler(`${this.name}:getSelectedChainId`,this.getSelectedChainId.bind(this)),this.messenger.registerActionHandler(`${this.name}:addNetwork`,this.addNetwork.bind(this)),this.messenger.registerActionHandler(`${this.name}:removeNetwork`,this.removeNetwork.bind(this)),this.messenger.registerActionHandler(`${this.name}:updateNetwork`,this.updateNetwork.bind(this)),this.messenger.subscribe(`${this.name}:rpcEndpointChainUnavailable`,({networkClientId:e})=>{M(this,a,"m",y).call(this,e,{networkStatus:z.NetworkStatus.Unavailable})}),this.messenger.subscribe(`${this.name}:rpcEndpointChainDegraded`,({networkClientId:e})=>{M(this,a,"m",y).call(this,e,{networkStatus:z.NetworkStatus.Degraded})}),this.messenger.subscribe(`${this.name}:rpcEndpointChainAvailable`,({networkClientId:e})=>{M(this,a,"m",y).call(this,e,{networkStatus:z.NetworkStatus.Available})})}enableRpcFailover(){M(this,a,"m",g).call(this,!0)}disableRpcFailover(){M(this,a,"m",g).call(this,!1)}getProviderAndBlockTracker(){return{provider:M(this,o,"f"),blockTracker:M(this,c,"f")}}getSelectedNetworkClient(){return M(this,o,"f")&&M(this,c,"f")?{provider:M(this,o,"f"),blockTracker:M(this,c,"f")}:undefined}getSelectedChainId(){const e=this.getNetworkConfigurationByNetworkClientId(this.state.selectedNetworkClientId);return e?.chainId}getNetworkClientRegistry(){const e=M(this,a,"m",v).call(this);return Object.assign({},e[Z.NetworkClientType.Infura],e[Z.NetworkClientType.Custom])}getNetworkClientById(e){if(!e)throw new Error("No network client ID was provided.");const t=M(this,a,"m",v).call(this);if((0,B.isInfuraNetworkType)(e)){const n=t[Z.NetworkClientType.Infura][e];if(!n)throw new Error(`No Infura network client was found with the ID "${e}".`);return n}const n=t[Z.NetworkClientType.Custom][e];if(!n)throw new Error(`No custom network client was found with the ID "${e}".`);return n}initializeProvider({lookupNetwork:e=!0}={}){return M(this,a,"m",R).call(this,this.state.selectedNetworkClientId),e?this.lookupNetwork():undefined}async lookupNetwork(e){e?await M(this,a,"m",b).call(this,e):await M(this,a,"m",E).call(this)}async lookupNetworkByClientId(e){await M(this,a,"m",b).call(this,e)}async setProviderType(e){if(e===B.NetworkType.rpc)throw new Error(`NetworkController - cannot call "setProviderType" with type "${B.NetworkType.rpc}". Use "setActiveNetwork"`);if(!(0,B.isInfuraNetworkType)(e))throw new Error(`Unknown Infura provider type "${String(e)}".`);await this.setActiveNetwork(e)}async setActiveNetwork(e,t={}){L(this,i,this.state.selectedNetworkClientId,"f"),await M(this,a,"m",T).call(this,e,t)}async getEIP1559Compatibility(e){if(e)return this.get1559CompatibilityWithNetworkClientId(e);if(!M(this,r,"f"))return!1;const{EIPS:t}=this.state.networksMetadata[this.state.selectedNetworkClientId];if(t[1559]!==undefined)return t[1559];const n=await M(this,a,"m",k).call(this,this.state.selectedNetworkClientId);return this.update(e=>{n!==undefined&&(e.networksMetadata[e.selectedNetworkClientId].EIPS[1559]=n)}),n}async get1559CompatibilityWithNetworkClientId(e){let t=this.state.networksMetadata[e];t?.EIPS[1559]===undefined&&(await this.lookupNetwork(e),t=this.state.networksMetadata[e]);const{EIPS:n}=t;return n[1559]}async resetConnection(){await M(this,a,"m",T).call(this,this.state.selectedNetworkClientId)}getNetworkConfigurationByChainId(e){return this.state.networkConfigurationsByChainId[e]}getNetworkConfigurationByNetworkClientId(e){return M(this,f,"f").get(e)}addNetwork(e){const{rpcEndpoints:t}=e,n=M(this,a,"m",v).call(this);M(this,a,"m",I).call(this,{mode:"add",networkFields:e,autoManagedNetworkClientRegistry:n});const r=t.map(e=>({type:"add",rpcEndpoint:e.type===ne.Custom?{...e,networkClientId:(0,Q.v4)()}:e})),s=M(this,a,"m",A).call(this,{networkFields:e,networkClientOperations:r});return M(this,a,"m",_).call(this,{networkFields:e,networkClientOperations:r,autoManagedNetworkClientRegistry:n}),this.update(t=>{M(this,a,"m",P).call(this,{state:t,mode:"add",networkFields:e,networkConfigurationToPersist:s})}),this.messenger.publish(`${re}:networkAdded`,s),s}async updateNetwork(e,t,{replacementSelectedRpcEndpointIndex:n}={}){const r=this.state.networkConfigurationsByChainId[e];if(r===undefined)throw new Error(`Could not update network: Cannot find network configuration for chain '${e}'`);const s=e,{chainId:i,rpcEndpoints:o}=t,c=M(this,a,"m",v).call(this);M(this,a,"m",I).call(this,{mode:"update",networkFields:t,existingNetworkConfiguration:r,autoManagedNetworkClientRegistry:c});const l=[];for(const e of o){const t=r.rpcEndpoints.find(t=>t.type===e.type&&t.url===e.url&&(t.networkClientId===e.networkClientId||e.networkClientId===undefined)),n=r.rpcEndpoints.find(t=>t.type===ne.Infura&&e.type===ne.Infura||t.type===e.type&&t.networkClientId===e.networkClientId&&t.url===e.url),a=r.rpcEndpoints.find(t=>t.type===e.type&&(t.url===e.url||t.networkClientId===e.networkClientId));if(i!==s&&n!==undefined){const t=e.type===ne.Infura?e:{...e,networkClientId:(0,Q.v4)()};l.push({type:"replace",oldRpcEndpoint:n,newRpcEndpoint:t})}else if(t!==undefined){let n;n=t.type===ne.Infura?t:Object.assign({},e,{networkClientId:t.networkClientId}),l.push({type:"noop",rpcEndpoint:n})}else if(a===undefined){const t={type:"add",rpcEndpoint:e.type===ne.Infura?e:{...e,networkClientId:(0,Q.v4)()}};l.push(t)}else{let t;t=e.type===ne.Infura?e:{...e,networkClientId:(0,Q.v4)()},l.push({type:"replace",oldRpcEndpoint:a,newRpcEndpoint:t})}}for(const e of r.rpcEndpoints)if(!l.some(t=>{const n="replace"===t.type?t.oldRpcEndpoint:t.rpcEndpoint;return n.type===e.type&&n.networkClientId===e.networkClientId&&n.url===e.url})){const t={type:"remove",rpcEndpoint:e};l.push(t)}const u=M(this,a,"m",A).call(this,{networkFields:t,networkClientOperations:l});if(n===undefined&&l.some(e=>"remove"===e.type&&e.rpcEndpoint.networkClientId===this.state.selectedNetworkClientId)&&!l.some(e=>"replace"===e.type&&e.oldRpcEndpoint.networkClientId===this.state.selectedNetworkClientId))throw new Error(`Could not update network: Cannot update RPC endpoints in such a way that the selected network '${this.state.selectedNetworkClientId}' would be removed without a replacement. Choose a different RPC endpoint as the selected network via the \`replacementSelectedRpcEndpointIndex\` option.`);M(this,a,"m",_).call(this,{networkFields:t,networkClientOperations:l,autoManagedNetworkClientRegistry:c});const d=l.map((e,t)=>[e,t]).find(([e,t])=>"replace"===e.type&&e.oldRpcEndpoint.networkClientId===this.state.selectedNetworkClientId),h=n??d?.[1];let m;if(h!==undefined&&(m=u.rpcEndpoints[h],m===undefined))throw new Error(`Could not update network: \`replacementSelectedRpcEndpointIndex\` ${h} does not refer to an entry in \`rpcEndpoints\``);return m&&m.networkClientId!==this.state.selectedNetworkClientId?await this.setActiveNetwork(m.networkClientId,{updateState:e=>{M(this,a,"m",P).call(this,{state:e,mode:"update",networkFields:t,networkConfigurationToPersist:u,existingNetworkConfiguration:r})}}):this.update(e=>{M(this,a,"m",P).call(this,{state:e,mode:"update",networkFields:t,networkConfigurationToPersist:u,existingNetworkConfiguration:r})}),M(this,a,"m",C).call(this,{networkClientOperations:l,autoManagedNetworkClientRegistry:c}),u}removeNetwork(e){const t=this.state.networkConfigurationsByChainId[e];if(t===undefined)throw new Error(`Cannot find network configuration for chain '${e}'`);if(t.rpcEndpoints.some(e=>e.networkClientId===this.state.selectedNetworkClientId))throw new Error("Cannot remove the currently selected network");const n=M(this,a,"m",v).call(this),r=t.rpcEndpoints.map(e=>({type:"remove",rpcEndpoint:e}));M(this,a,"m",C).call(this,{networkClientOperations:r,autoManagedNetworkClientRegistry:n}),this.update(e=>{M(this,a,"m",P).call(this,{state:e,mode:"remove",existingNetworkConfiguration:t});for(const n of t.rpcEndpoints)delete e.networksMetadata[n.networkClientId]}),this.messenger.publish("NetworkController:networkRemoved",t)}async rollbackToPreviousProvider(){await M(this,a,"m",T).call(this,M(this,i,"f"))}async destroy(){await(M(this,c,"f")?.destroy())}loadBackup({networkConfigurationsByChainId:e}){this.update(t=>{t.networkConfigurationsByChainId={...t.networkConfigurationsByChainId,...e}})}findNetworkClientIdByChainId(e){const t=this.state.networkConfigurationsByChainId[e];if(!t)throw new Error(`Invalid chain ID "${e}"`);const{networkClientId:n}=t.rpcEndpoints[t.defaultRpcEndpointIndex];return n}}n.NetworkController=me,r=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,m=new WeakMap,f=new WeakMap,p=new WeakMap,a=new WeakSet,g=function(e){if(M(this,p,"f")===e)return;const t=M(this,a,"m",v).call(this);for(const n of Object.values(t))for(const t of Object.keys(n)){const a=n[t];a.configuration.failoverRpcUrls&&a.configuration.failoverRpcUrls.length>0&&(e?a.enableRpcFailover():a.disableRpcFailover())}L(this,p,e,"f")},T=async function(e,t={}){this.messenger.publish("NetworkController:networkWillChange",this.state),M(this,a,"m",R).call(this,e,t),this.messenger.publish("NetworkController:networkDidChange",this.state),await this.lookupNetwork()},w=async function(e){const t=((0,B.isInfuraNetworkType)(e),this.getNetworkClientById(e)).configuration.type===Z.NetworkClientType.Infura;let n,r;try{r=await M(this,a,"m",k).call(this,e),n=z.NetworkStatus.Available}catch(e){if(ee("NetworkController: lookupNetwork: ",e),function(e){return"object"==typeof e&&null!==e&&"code"in e}(e)){let a;if(t&&(0,q.hasProperty)(e,"message")&&"string"==typeof e.message)try{a=JSON.parse(e.message)}catch{M(this,d,"f")?.warn("NetworkController: lookupNetwork: json parse error: ",e)}(0,q.isPlainObject)(a)&&a.error===z.INFURA_BLOCKED_KEY?n=z.NetworkStatus.Blocked:e.code===U.errorCodes.rpc.internal?(n=z.NetworkStatus.Unknown,M(this,d,"f")?.warn("NetworkController: lookupNetwork: rpc internal error: ",e)):(n=z.NetworkStatus.Unavailable,M(this,d,"f")?.warn("NetworkController: lookupNetwork: ",e))}else ee("NetworkController - could not determine network status",e),n=z.NetworkStatus.Unknown,M(this,d,"f")?.warn("NetworkController: lookupNetwork: ",e)}return{isInfura:t,networkStatus:n,isEIP1559Compatible:r}},b=async function(e){const{networkStatus:t,isEIP1559Compatible:n}=await M(this,a,"m",w).call(this,e);M(this,a,"m",y).call(this,e,{networkStatus:t,isEIP1559Compatible:n})},E=async function(){if(!M(this,r,"f"))return;let e=!1;const t=()=>{e=!0;try{this.messenger.unsubscribe("NetworkController:networkDidChange",t)}catch(e){if(!(e instanceof Error)||"Subscription not found for event: NetworkController:networkDidChange"!==e.message)throw e}};this.messenger.subscribe("NetworkController:networkDidChange",t);const{isInfura:n,networkStatus:s,isEIP1559Compatible:i}=await M(this,a,"m",w).call(this,this.state.selectedNetworkClientId);if(!e){try{this.messenger.unsubscribe("NetworkController:networkDidChange",t)}catch(e){if(!(e instanceof Error)||"Subscription not found for event: NetworkController:networkDidChange"!==e.message)throw e}M(this,a,"m",y).call(this,this.state.selectedNetworkClientId,{networkStatus:s,isEIP1559Compatible:i}),n?s===z.NetworkStatus.Available?this.messenger.publish("NetworkController:infuraIsUnblocked"):s===z.NetworkStatus.Blocked&&this.messenger.publish("NetworkController:infuraIsBlocked"):this.messenger.publish("NetworkController:infuraIsUnblocked")}},y=function(e,t){this.update(n=>{var a;(a=n.networksMetadata)[e]??(a[e]={status:z.NetworkStatus.Unknown,EIPS:{}});const r=n.networksMetadata[e];r.status=t.networkStatus,"isEIP1559Compatible"in t&&(t.isEIP1559Compatible===undefined?delete r.EIPS[1559]:r.EIPS[1559]=t.isEIP1559Compatible)})},S=function(e=this.state.selectedNetworkClientId){const t=this.getNetworkClientById(e),n=new G.default(t.provider);return new Promise((e,t)=>{n.sendAsync({method:"eth_getBlockByNumber",params:["latest",!1]},(n,a)=>{n?t(n):e(a)})})},k=async function(e){const t=await M(this,a,"m",S).call(this,e);return t?t.baseFeePerGas!==undefined:undefined},I=function(e){const{mode:t,networkFields:n,autoManagedNetworkClientRegistry:a}=e,r="existingNetworkConfiguration"in e?e.existingNetworkConfiguration:null,s="update"===t?"Could not update network":"Could not add network";if(!(0,q.isStrictHexString)(n.chainId)||!(0,B.isSafeChainId)(n.chainId))throw new Error(`${s}: Invalid \`chainId\` '${n.chainId}' (must start with "0x" and not exceed the maximum)`);if(null===r||n.chainId!==r.chainId){const t=this.state.networkConfigurationsByChainId[n.chainId];if(t!==undefined)throw null===r?new Error(`Could not add network for chain ${e.networkFields.chainId} as another network for that chain already exists ('${t.name}')`):new Error(`Cannot move network from chain ${r.chainId} to ${n.chainId} as another network for that chain already exists ('${t.name}')`)}if(n.blockExplorerUrls.length>0?n.defaultBlockExplorerUrlIndex===undefined||n.blockExplorerUrls[n.defaultBlockExplorerUrlIndex]===undefined:n.defaultBlockExplorerUrlIndex!==undefined)throw new Error(`${s}: \`defaultBlockExplorerUrlIndex\` must refer to an entry in \`blockExplorerUrls\``);if(0===n.rpcEndpoints.length)throw new Error(`${s}: \`rpcEndpoints\` must be a non-empty array`);for(const e of n.rpcEndpoints){if(!ue(e.url))throw new Error(`${s}: An entry in \`rpcEndpoints\` has invalid URL '${e.url}'`);const i="networkClientId"in e?e.networkClientId:undefined;if(e.type===ne.Custom&&i!==undefined&&(0,B.isInfuraNetworkType)(i))throw new Error(`${s}: Custom RPC endpoint '${e.url}' has invalid network client ID '${i}'`);if("update"===t&&i!==undefined&&e.type===ne.Custom&&!Object.values(a).some(e=>i in e))throw new Error(`${s}: RPC endpoint '${e.url}' refers to network client '${i}' that does not exist`);if(n.rpcEndpoints.some(t=>t!==e&&Y.equal(t.url,e.url)))throw new Error(`${s}: Each entry in rpcEndpoints must have a unique URL`);const o=Object.values(this.state.networkConfigurationsByChainId).filter(e=>!r||e.chainId!==r.chainId);for(const n of o){if(n.rpcEndpoints.find(t=>Y.equal(e.url,t.url)))throw"update"===t?new Error(`Could not update network to point to same RPC endpoint as existing network for chain ${n.chainId} ('${n.name}')`):new Error(`Could not add network that points to same RPC endpoint as existing network for chain ${n.chainId} ('${n.name}')`)}}if([...new Set(n.rpcEndpoints)].length<n.rpcEndpoints.length)throw new Error(`${s}: Each entry in rpcEndpoints must be unique`);const i=n.rpcEndpoints.map(e=>"networkClientId"in e?e.networkClientId:undefined).filter(e=>e!==undefined);if([...new Set(i)].length<i.length)throw new Error(`${s}: Each entry in rpcEndpoints must have a unique networkClientId`);const o=n.rpcEndpoints.filter(e=>e.type===ne.Infura);if(o.length>1)throw new Error(`${s}: There cannot be more than one Infura RPC endpoint`);const c=o[0];if(c){const e=de(c.url),a=B.NetworkNickname[e],r=B.ChainId[e];if(n.chainId!==r)throw new Error("add"===t?`Could not add network with chain ID ${n.chainId} and Infura RPC endpoint for '${a}' which represents ${r}, as the two conflict`:`Could not update network with chain ID ${n.chainId} and Infura RPC endpoint for '${a}' which represents ${r}, as the two conflict`)}if(n.rpcEndpoints[n.defaultRpcEndpointIndex]===undefined)throw new Error(`${s}: \`defaultRpcEndpointIndex\` must refer to an entry in \`rpcEndpoints\``)},A=function({networkFields:e,networkClientOperations:t}){return{...e,rpcEndpoints:t.filter(e=>"add"===e.type||"noop"===e.type).map(e=>e.rpcEndpoint).concat(t.filter(e=>"replace"===e.type).map(e=>e.newRpcEndpoint))}},_=function({networkFields:e,networkClientOperations:t,autoManagedNetworkClientRegistry:n}){const a=t.filter(e=>"add"===e.type).map(e=>e.rpcEndpoint).concat(t.filter(e=>"replace"===e.type).map(e=>e.newRpcEndpoint));for(const t of a)t.type===ne.Infura?n[Z.NetworkClientType.Infura][t.networkClientId]=(0,J.createAutoManagedNetworkClient)({networkClientId:t.networkClientId,networkClientConfiguration:{type:Z.NetworkClientType.Infura,chainId:e.chainId,network:t.networkClientId,failoverRpcUrls:t.failoverUrls,infuraProjectId:M(this,s,"f"),ticker:e.nativeCurrency},getRpcServiceOptions:M(this,h,"f"),getBlockTrackerOptions:M(this,m,"f"),messenger:this.messenger,isRpcFailoverEnabled:M(this,p,"f"),logger:M(this,d,"f")}):n[Z.NetworkClientType.Custom][t.networkClientId]=(0,J.createAutoManagedNetworkClient)({networkClientId:t.networkClientId,networkClientConfiguration:{type:Z.NetworkClientType.Custom,chainId:e.chainId,failoverRpcUrls:t.failoverUrls,rpcUrl:t.url,ticker:e.nativeCurrency},getRpcServiceOptions:M(this,h,"f"),getBlockTrackerOptions:M(this,m,"f"),messenger:this.messenger,isRpcFailoverEnabled:M(this,p,"f"),logger:M(this,d,"f")})},C=function({networkClientOperations:e,autoManagedNetworkClientRegistry:t}){const n=e.filter(e=>"remove"===e.type).map(e=>e.rpcEndpoint).concat(e.filter(e=>"replace"===e.type).map(e=>e.oldRpcEndpoint));for(const e of n){const n=this.getNetworkClientById(e.networkClientId);n.destroy(),delete t[n.configuration.type][e.networkClientId]}},P=function(e){const{state:t,mode:n}=e;("remove"===n||"update"===n&&e.networkFields.chainId!==e.existingNetworkConfiguration.chainId)&&delete t.networkConfigurationsByChainId[e.existingNetworkConfiguration.chainId],"add"!==n&&"update"!==n||((0,K.default)(t.networkConfigurationsByChainId[e.networkFields.chainId],e.networkConfigurationToPersist)||(e.networkConfigurationToPersist.lastUpdatedAt=Date.now()),t.networkConfigurationsByChainId[e.networkFields.chainId]=e.networkConfigurationToPersist),L(this,f,he((0,$.cloneDeep)(t.networkConfigurationsByChainId)),"f")},v=function(){return L(this,l,M(this,l,"f")??M(this,a,"m",N).call(this),"f")},N=function(){return ae(this.state.networkConfigurationsByChainId).flatMap(e=>{const t=this.state.networkConfigurationsByChainId[e];return t.rpcEndpoints.map(e=>{if(e.type===ne.Infura){const n=de(e.url);return[e.networkClientId,(0,J.createAutoManagedNetworkClient)({networkClientId:e.networkClientId,networkClientConfiguration:{type:Z.NetworkClientType.Infura,network:n,failoverRpcUrls:e.failoverUrls,infuraProjectId:M(this,s,"f"),chainId:t.chainId,ticker:t.nativeCurrency},getRpcServiceOptions:M(this,h,"f"),getBlockTrackerOptions:M(this,m,"f"),messenger:this.messenger,isRpcFailoverEnabled:M(this,p,"f"),logger:M(this,d,"f")})]}return[e.networkClientId,(0,J.createAutoManagedNetworkClient)({networkClientId:e.networkClientId,networkClientConfiguration:{type:Z.NetworkClientType.Custom,chainId:t.chainId,failoverRpcUrls:e.failoverUrls,rpcUrl:e.url,ticker:t.nativeCurrency},getRpcServiceOptions:M(this,h,"f"),getBlockTrackerOptions:M(this,m,"f"),messenger:this.messenger,isRpcFailoverEnabled:M(this,p,"f"),logger:M(this,d,"f")})]})}).reduce((e,[t,n])=>({...e,[n.configuration.type]:{...e[n.configuration.type],[t]:n}}),{[Z.NetworkClientType.Custom]:{},[Z.NetworkClientType.Infura]:{}})},R=function(e,{updateState:t}={}){const n=M(this,a,"m",v).call(this);let s;if((0,B.isInfuraNetworkType)(e)){const t=n[Z.NetworkClientType.Infura][e];if(!t)throw new Error(`No Infura network client found with ID '${e}'`);s=t}else{const t=n[Z.NetworkClientType.Custom][e];if(!t)throw new Error(`No network client found with ID '${e}'`);s=t}L(this,u,s,"f"),this.update(n=>{var a;n.selectedNetworkClientId=e,(a=n.networksMetadata)[e]??(a[e]={status:z.NetworkStatus.Unknown,EIPS:{}}),t?.(n)}),M(this,o,"f")?M(this,o,"f").setTarget(M(this,u,"f").provider):L(this,o,(0,H.createSwappableProxy)(M(this,u,"f").provider),"f"),M(this,c,"f")?M(this,c,"f").setTarget(M(this,u,"f").blockTracker):L(this,c,(0,H.createEventEmitterProxy)(M(this,u,"f").blockTracker,{eventFilter:"skipInternal"}),"f"),L(this,r,new G.default(M(this,o,"f")),"f")}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller>@metamask/network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/node_modules/@metamask/network-controller/dist/NetworkController.cjs"}],[3180,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a;Object.defineProperty(n,"__esModule",{value:!0}),n.DEPRECATED_NETWORKS=n.INFURA_BLOCKED_KEY=n.NetworkStatus=void 0,function(e){e.Unknown="unknown",e.Available="available",e.Degraded="degraded",e.Unavailable="unavailable",e.Blocked="blocked"}(a||(n.NetworkStatus=a={})),n.INFURA_BLOCKED_KEY="countryBlocked",n.DEPRECATED_NETWORKS=new Set(["0xe704","0x5"])}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller>@metamask/network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/node_modules/@metamask/network-controller/dist/constants.cjs"}],[3181,{"./create-network-client.cjs":3182},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createAutoManagedNetworkClient=void 0;const a=e("./create-network-client.cjs"),r="__target__",s={__UNINITIALIZED__:!0};n.createAutoManagedNetworkClient=function({networkClientId:e,networkClientConfiguration:t,getRpcServiceOptions:n,getBlockTrackerOptions:i=()=>({}),messenger:o,isRpcFailoverEnabled:c,logger:l}){let u,d=c;const h=()=>{if(u??(u=(0,a.createNetworkClient)({id:e,configuration:t,getRpcServiceOptions:n,getBlockTrackerOptions:i,messenger:o,isRpcFailoverEnabled:d,logger:l})),u===undefined)throw new Error("It looks like `createNetworkClient` didn't return anything. Perhaps it's being mocked?");return u},m=new Proxy(s,{get(e,t,n){if(t===r)return u?.provider;const{provider:a}=h();if(t in a){const e=a[t];return"function"==typeof e?function(...t){return e.apply(this===n?a:this,t)}:e}return undefined},has(e,t){if(t===r)return!0;const{provider:n}=h();return t in n}}),f=new Proxy(s,{get(e,t,n){if(t===r)return u?.blockTracker;const{blockTracker:a}=h();if(t in a){const e=a[t];return"function"==typeof e?function(...t){return e.apply(this===n?a:this,t)}:e}return undefined},has(e,t){if(t===r)return!0;const{blockTracker:n}=h();return t in n}}),p=()=>{u?.destroy()};return{configuration:t,provider:m,blockTracker:f,destroy:p,enableRpcFailover:()=>{d=!0,p(),u=undefined},disableRpcFailover:()=>{d=!1,p(),u=undefined}}}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller>@metamask/network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/node_modules/@metamask/network-controller/dist/create-auto-managed-network-client.cjs"}],[3182,{"./rpc-service/rpc-service-chain.cjs":3185,"./types.cjs":3187,"@metamask/connectivity-controller":1488,"@metamask/controller-utils":1494,"@metamask/eth-block-tracker":1903,"@metamask/eth-json-rpc-infura":1941,"@metamask/eth-json-rpc-middleware":1952,"@metamask/eth-json-rpc-provider":1969,"@metamask/json-rpc-engine":2222,"@metamask/json-rpc-engine/v2":2232},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createNetworkClient=void 0;const a=e("@metamask/connectivity-controller"),r=e("@metamask/controller-utils"),s=e("@metamask/eth-block-tracker"),i=e("@metamask/eth-json-rpc-infura"),o=e("@metamask/eth-json-rpc-middleware"),c=e("@metamask/eth-json-rpc-provider"),l=e("@metamask/eth-json-rpc-provider"),u=e("@metamask/json-rpc-engine"),d=e("@metamask/json-rpc-engine/v2"),h=e("./rpc-service/rpc-service-chain.cjs"),m=e("./types.cjs");function f({network:e}){return(0,d.createScaffoldMiddleware)({eth_chainId:r.ChainId[e]})}n.createNetworkClient=function({id:e,configuration:t,getRpcServiceOptions:n,getBlockTrackerOptions:r,messenger:g,isRpcFailoverEnabled:T,logger:w}){const b=t.type===m.NetworkClientType.Infura?`https://${t.network}.infura.io/v3/${t.infuraProjectId}`:t.rpcUrl,E=function({id:e,primaryEndpointUrl:t,configuration:n,getRpcServiceOptions:r,messenger:s,isRpcFailoverEnabled:i,logger:o}){const c=i?[t,...n.failoverRpcUrls??[]]:[t],l=()=>s.call("ConnectivityController:getState").connectivityStatus===a.CONNECTIVITY_STATUSES.Offline,u=c.map(e=>({...r(e),endpointUrl:e,logger:o,isOffline:l})),d=e=>"error"in e?e.error:"value"in e?e.value:undefined,m=new h.RpcServiceChain([u[0],...u.slice(1)]);return m.onBreak(t=>{const a=d(t);if(a===undefined)throw new Error("Could not make request to endpoint.");s.publish("NetworkController:rpcEndpointChainUnavailable",{chainId:n.chainId,networkClientId:e,error:a})}),m.onServiceBreak(({endpointUrl:t,primaryEndpointUrl:a,...r})=>{const i=d(r);if(i===undefined)throw new Error("Could not make request to endpoint.");s.publish("NetworkController:rpcEndpointUnavailable",{chainId:n.chainId,networkClientId:e,primaryEndpointUrl:a,endpointUrl:t,error:i})}),m.onDegraded(t=>{const a=d(t);s.publish("NetworkController:rpcEndpointChainDegraded",{chainId:n.chainId,networkClientId:e,error:a})}),m.onServiceDegraded(({endpointUrl:t,primaryEndpointUrl:a,...r})=>{const i=d(r);s.publish("NetworkController:rpcEndpointDegraded",{chainId:n.chainId,networkClientId:e,primaryEndpointUrl:a,endpointUrl:t,error:i})}),m.onAvailable(()=>{s.publish("NetworkController:rpcEndpointChainAvailable",{chainId:n.chainId,networkClientId:e})}),m.onServiceRetry(({attempt:t,endpointUrl:a,primaryEndpointUrl:r})=>{s.publish("NetworkController:rpcEndpointRetried",{chainId:n.chainId,networkClientId:e,primaryEndpointUrl:r,endpointUrl:a,attempt:t})}),m}({id:e,primaryEndpointUrl:b,configuration:t,getRpcServiceOptions:n,messenger:g,isRpcFailoverEnabled:T,logger:w});let y;y=t.type===m.NetworkClientType.Infura?(0,u.asV2Middleware)((0,i.createInfuraMiddleware)({rpcService:E,options:{source:"metamask"}})):(0,o.createFetchMiddleware)({rpcService:E});const S=(0,l.providerFromMiddlewareV2)(y),k=function({networkClientType:e,endpointUrl:t,getOptions:n,provider:a}){const r={};return new s.PollingBlockTracker({...r,...n(t),provider:a})}({networkClientType:t.type,endpointUrl:b,getOptions:r,provider:S}),I=t.type===m.NetworkClientType.Infura?function({blockTracker:e,network:t,rpcProvider:n,rpcApiMiddleware:a}){return d.JsonRpcEngineV2.create({middleware:[f({network:t}),(0,o.createBlockCacheMiddleware)({blockTracker:e}),(0,o.createInflightCacheMiddleware)(),(0,o.createBlockRefMiddleware)({blockTracker:e,provider:n}),(0,o.createRetryOnEmptyMiddleware)({blockTracker:e,provider:n}),(0,o.createBlockTrackerInspectorMiddleware)({blockTracker:e}),a]}).asMiddleware()}({blockTracker:k,network:t.network,rpcProvider:S,rpcApiMiddleware:y}):function({blockTracker:e,chainId:t,rpcApiMiddleware:n}){const a=[];return d.JsonRpcEngineV2.create({middleware:[...a,p(t),(0,o.createBlockRefRewriteMiddleware)({blockTracker:e}),(0,o.createBlockCacheMiddleware)({blockTracker:e}),(0,o.createInflightCacheMiddleware)(),(0,o.createBlockTrackerInspectorMiddleware)({blockTracker:e}),n]}).asMiddleware()}({blockTracker:k,chainId:t.chainId,rpcApiMiddleware:y});return{configuration:t,provider:new c.InternalProvider({engine:d.JsonRpcEngineV2.create({middleware:[I]})}),blockTracker:k,destroy:()=>{k.destroy()}}};const p=e=>({request:t,next:n})=>"eth_chainId"===t.method?e:n()}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller>@metamask/network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/node_modules/@metamask/network-controller/dist/create-network-client.cjs"}],[3183,{"./NetworkController.cjs":3179,"./constants.cjs":3180,"./rpc-service/rpc-service.cjs":3186,"./types.cjs":3187},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){a===undefined&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){a===undefined&&(a=n),e[a]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||a(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.isConnectionError=n.NetworkClientType=n.RpcEndpointType=n.NetworkController=n.knownKeysOf=n.selectAvailableNetworkClientIds=n.getDefaultNetworkControllerState=void 0;var s=e("./NetworkController.cjs");Object.defineProperty(n,"getDefaultNetworkControllerState",{enumerable:!0,get:function(){return s.getDefaultNetworkControllerState}}),Object.defineProperty(n,"selectAvailableNetworkClientIds",{enumerable:!0,get:function(){return s.selectAvailableNetworkClientIds}}),Object.defineProperty(n,"knownKeysOf",{enumerable:!0,get:function(){return s.knownKeysOf}}),Object.defineProperty(n,"NetworkController",{enumerable:!0,get:function(){return s.NetworkController}}),Object.defineProperty(n,"RpcEndpointType",{enumerable:!0,get:function(){return s.RpcEndpointType}}),r(e("./constants.cjs"),n);var i=e("./types.cjs");Object.defineProperty(n,"NetworkClientType",{enumerable:!0,get:function(){return i.NetworkClientType}});var o=e("./rpc-service/rpc-service.cjs");Object.defineProperty(n,"isConnectionError",{enumerable:!0,get:function(){return o.isConnectionError}})}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller>@metamask/network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/node_modules/@metamask/network-controller/dist/index.cjs"}],[3184,{"@metamask/utils":3217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.projectLogger=void 0;const a=e("@metamask/utils");Object.defineProperty(n,"createModuleLogger",{enumerable:!0,get:function(){return a.createModuleLogger}}),n.projectLogger=(0,a.createProjectLogger)("network-controller")}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller>@metamask/network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/node_modules/@metamask/network-controller/dist/logger.cjs"}],[3185,{"../logger.cjs":3184,"./rpc-service.cjs":3186,"@metamask/controller-utils":1494},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},u=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.RpcServiceChain=void 0;const d=e("@metamask/controller-utils"),h=e("./rpc-service.cjs"),m=e("../logger.cjs"),f=(0,m.createModuleLogger)(m.projectLogger,"RpcServiceChain"),p="available",g="degraded",T="unknown",w="unavailable";n.RpcServiceChain=class{constructor(e){a.set(this,void 0),r.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l(this,o,e.map(e=>new h.RpcService(e)),"f"),l(this,i,u(this,o,"f")[0],"f"),l(this,c,T,"f"),l(this,r,new d.CockatielEventEmitter,"f"),l(this,s,new d.CockatielEventEmitter,"f");for(const e of u(this,o,"f"))e.onDegraded(e=>{if(u(this,c,"f")!==g){f('Updating status to "degraded"',e),l(this,c,g,"f");const{endpointUrl:t,...n}=e;u(this,s,"f").emit(n)}});l(this,a,new d.CockatielEventEmitter,"f");for(const e of u(this,o,"f"))e.onAvailable(e=>{if(u(this,c,"f")!==p){f('Updating status to "available"',e),l(this,c,p,"f");const{endpointUrl:t,...n}=e;u(this,a,"f").emit(n)}})}onServiceRetry(e){const t=u(this,o,"f").map(t=>t.onRetry(t=>{e({...t,primaryEndpointUrl:u(this,i,"f").endpointUrl.toString()})}));return{dispose(){t.forEach(e=>e.dispose())}}}onBreak(e){return u(this,r,"f").addListener(e)}onServiceBreak(e){const t=u(this,o,"f").map(t=>t.onBreak(t=>{e({...t,primaryEndpointUrl:u(this,i,"f").endpointUrl.toString()})}));return{dispose(){t.forEach(e=>e.dispose())}}}onDegraded(e){return u(this,s,"f").addListener(e)}onServiceDegraded(e){const t=u(this,o,"f").map(t=>t.onDegraded(t=>{e({...t,primaryEndpointUrl:u(this,i,"f").endpointUrl.toString()})}));return{dispose(){t.forEach(e=>e.dispose())}}}onAvailable(e){return u(this,a,"f").addListener(e)}async request(e,t={}){let n,a;for(const[s,i]of u(this,o,"f").entries()){f(`Trying service #${s+1}...`);const h=i.getCircuitState();try{a=await i.request(e,t),f("Service successfully received request."),n=s;break}catch(e){const{lastError:t}=i,n=i.getCircuitState()===d.CircuitState.Open;if(f("Service failed! error =",e,"lastError = ",t),n){if(s<u(this,o,"f").length-1){f("This service's circuit is open. Proceeding to next service...");continue}h!==d.CircuitState.Open&&u(this,c,"f")!==w&&t!==undefined&&(f('This service\'s circuit just opened and it is the last service. Updating status to "unavailable" and triggering onBreak.'),l(this,c,w,"f"),u(this,r,"f").emit({error:t}))}throw f((n?"":"This service's circuit is closed. ")+"Re-throwing error."),e}}if(a){if(n!==undefined)for(const[e,t]of[...u(this,o,"f").entries()].slice(n+1))f(`Resetting policy for service #${e+1}.`),t.resetPolicy();return a}throw new Error("Nothing to return")}},a=new WeakMap,r=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller>@metamask/network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/node_modules/@metamask/network-controller/dist/rpc-service/rpc-service-chain.cjs"}],[3186,{"../logger.cjs":3184,"@metamask/controller-utils":1494,"@metamask/rpc-errors":2698,"@metamask/utils":3217,cockatiel:4197,deepmerge:4290},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a,r,s,i,o,c,l,u,d=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},h=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)},m=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.RpcService=n.isConnectionError=n.CUSTOM_RPC_ERRORS=n.CONNECTION_ERRORS=n.DEFAULT_MAX_CONSECUTIVE_FAILURES=n.DEFAULT_MAX_RETRIES=void 0;const f=e("@metamask/controller-utils"),p=e("@metamask/rpc-errors"),g=e("@metamask/utils"),T=(e("cockatiel"),m(e("deepmerge"))),w=e("../logger.cjs"),b=(0,w.createModuleLogger)(w.projectLogger,"RpcService");function E(e){if("object"!=typeof e||null===e||!("message"in e))return!1;const{message:t}=e;return"string"==typeof t&&!function(e){return e.includes("Nock:")}(t)&&n.CONNECTION_ERRORS.some(({constructorName:n,pattern:a})=>e.constructor.name===n&&a.test(t))}function y(e){return e instanceof SyntaxError||/invalid json/iu.test((0,g.getErrorMessage)(e))}n.DEFAULT_MAX_RETRIES=4,n.DEFAULT_MAX_CONSECUTIVE_FAILURES=3*(1+n.DEFAULT_MAX_RETRIES),n.CONNECTION_ERRORS=[{constructorName:"TypeError",pattern:/network error/u},{constructorName:"TypeError",pattern:/Failed to fetch/u},{constructorName:"TypeError",pattern:/NetworkError when attempting to fetch resource\./u},{constructorName:"TypeError",pattern:/The Internet connection appears to be offline\./u},{constructorName:"TypeError",pattern:/Load failed/u},{constructorName:"TypeError",pattern:/Network request failed/u},{constructorName:"FetchError",pattern:/request to (.+) failed/u},{constructorName:"TypeError",pattern:/fetch failed/u},{constructorName:"TypeError",pattern:/terminated/u}],n.CUSTOM_RPC_ERRORS={unauthorized:-32006,httpClientError:-32080},n.isConnectionError=E;n.RpcService=class{constructor(e){a.add(this),r.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0);const{btoa:t,endpointUrl:l,fetch:u,logger:m,fetchOptions:p={},policyOptions:T={},isOffline:w}=e;d(this,r,u,"f");const b=(S=l)instanceof URL?S:new URL(S);var S;d(this,s,h(this,a,"m",c).call(this,b,p,t),"f"),this.endpointUrl=function(e){const t=new URL(e.toString());return t.username="",t.password="",t}(b),d(this,i,m,"f"),d(this,o,(0,f.createServicePolicy)({maxRetries:n.DEFAULT_MAX_RETRIES,maxConsecutiveFailures:n.DEFAULT_MAX_CONSECUTIVE_FAILURES,...T,retryFilterPolicy:(0,f.handleWhen)(e=>!w()&&(E(e)||y(e)||"httpStatus"in e&&(502===e.httpStatus||503===e.httpStatus||504===e.httpStatus)||(0,g.hasProperty)(e,"code")&&("ETIMEDOUT"===e.code||"ECONNRESET"===e.code)))}),"f")}resetPolicy(){h(this,o,"f").reset()}getCircuitState(){return h(this,o,"f").getCircuitState()}onRetry(e){return h(this,o,"f").onRetry(t=>{e({...t,endpointUrl:this.endpointUrl.toString()})})}onBreak(e){return h(this,o,"f").onBreak(t=>{"isolated"in t||e({...t,endpointUrl:this.endpointUrl.toString()})})}onDegraded(e){return h(this,o,"f").onDegraded(t=>{e({...t??{},endpointUrl:this.endpointUrl.toString()})})}onAvailable(e){return h(this,o,"f").onAvailable(()=>{e({endpointUrl:this.endpointUrl.toString()})})}async request(e,t={}){const n=h(this,a,"m",l).call(this,e,t);return await h(this,a,"m",u).call(this,n)}},r=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,a=new WeakSet,c=function(e,t,n){if(e.username&&e.password){const a=n(`${e.username}:${e.password}`);return(0,T.default)(t,{headers:{Authorization:`Basic ${a}`}})}return t},l=function(e,t){const n=(0,T.default)({method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}},(0,T.default)(h(this,s,"f"),t)),{id:a,jsonrpc:r,method:i,params:o}=e;return{...n,body:JSON.stringify({id:a,jsonrpc:r,method:i,params:o})}},u=async function(e){let t;try{b(`[${this.endpointUrl}] Circuit state`,h(this,o,"f").getCircuitState());const n=await h(this,o,"f").execute(async n=>{if(b("REQUEST INITIATED:",this.endpointUrl.toString(),"::",e,`(attempt ${n.attempt+1})`),t=await h(this,r,"f").call(this,this.endpointUrl,e),!t.ok)throw new f.HttpError(t.status);return b("REQUEST SUCCESSFUL:",this.endpointUrl.toString(),t.status),await t.json()});return this.lastError=undefined,n}catch(e){if(b("REQUEST ERROR:",this.endpointUrl.toString(),e),this.lastError=e instanceof Error?e:new Error((0,g.getErrorMessage)(e)),e instanceof f.HttpError){const t=e.httpStatus;if(401===t)throw new p.JsonRpcError(n.CUSTOM_RPC_ERRORS.unauthorized,"Unauthorized.",{httpStatus:t});if(429===t)throw p.rpcErrors.limitExceeded({message:"Request is being rate limited.",data:{httpStatus:t}});if(t>=500||402===t||404===t)throw p.rpcErrors.resourceUnavailable({message:"RPC endpoint not found or unavailable.",data:{httpStatus:t}});throw new p.JsonRpcError(n.CUSTOM_RPC_ERRORS.httpClientError,"RPC endpoint returned HTTP client error.",{httpStatus:t})}if(y(e))throw p.rpcErrors.parse({message:"RPC endpoint did not return JSON."});if(e instanceof f.BrokenCircuitError){h(this,i,"f")?.warn(e);const t=h(this,o,"f").getRemainingCircuitOpenDuration(),n=Intl.NumberFormat(undefined,{maximumFractionDigits:2}).format((t??h(this,o,"f").circuitBreakDuration)/g.Duration.Minute);throw p.rpcErrors.resourceUnavailable({message:`RPC endpoint returned too many errors, retrying in ${n} minutes. Consider using a different RPC endpoint.`})}throw e}}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller>@metamask/network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/node_modules/@metamask/network-controller/dist/rpc-service/rpc-service.cjs"}],[3187,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var a;Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkClientType=void 0,function(e){e.Custom="custom",e.Infura="infura"}(a||(n.NetworkClientType=a={}))}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller>@metamask/network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/multichain-network-controller/node_modules/@metamask/network-controller/dist/types.cjs"}]],[],{});